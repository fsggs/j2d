/**
 * J2D (jQuery plugin of the fork j2ds)
 *
 * @authors Skaner, likerRr, DeVinterX
 * @license BSD, zlib
 * @version 0.1.5
 * @see https://github.com/SkanerSoft/J2ds/commit/501b8993fc41960794572dc481a5f2fe492da349
 */

if (global === undefined) var global = window;
if (typeof define !== 'function' || define.amd) global.J2D = {};

!function(t,e){"function"==typeof define&&define.amd?define("vanilla.override",[],e):e()}(global,function(){"use strict";var t={version:"1.0.3"};return function(){if(!global.vanilla||global.vanilla.version!==t.version){global.vanilla=t,console.info('J2D Initialize "vanilla.override" module.'),Array.prototype.equals&&console.warn("Overriding existing Array.prototype.equals."),global.Array.prototype.equals=function(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var e=0,i=this.length;i>e;e++)if(this[e]instanceof Array&&t[e]instanceof Array){if(!this[e].equals(t[e]))return!1}else if(this[e]!=t[e])return!1;return!0},Object.defineProperty(Array.prototype,"equals",{enumerable:!1}),Array.prototype.contains&&console.warn("Overriding existing Array.prototype.contains."),Array.prototype.contains=function(t){for(var e=this.length;e--;)if(this[e]===t)return!0;return!1},Object.defineProperty(Array.prototype,"contains",{enumerable:!1}),Array.prototype.each&&console.warn("Overriding existing Array.prototype.each."),Array.prototype.each=function(t){if(!t)return!1;for(var e=!1,i=0;i<this.length;i++)if(0==(e=t(this[i],i)))return e},Object.defineProperty(Array.prototype,"each",{enumerable:!1}),Array.prototype.add&&console.warn("Overriding existing Array.prototype.add."),Array.prototype.add=function(t,e){this.contains(t)?this[t]=e:(this.push(t),this[t]=e)},Object.defineProperty(Array.prototype,"add",{enumerable:!1}),Array.prototype.remove&&console.warn("Overriding existing Array.prototype.remove."),Array.prototype.remove=function(t){for(var e=0;e<this.length;++e)if(this[e]==t)return void this.splice(e,1)},Object.defineProperty(Array.prototype,"remove",{enumerable:!1});var e=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,o=/[^-+\dA-Z]/g,n=function(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t};return function(s,a,r){var l=e;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(s)||/\d/.test(s)||(a=s,s=void 0),s=s?new Date(s):new Date,isNaN(s))throw new SyntaxError("invalid date");a=String(l.masks[a]||a||l.masks["default"]),"UTC:"==a.slice(0,4)&&(a=a.slice(4),r=!0);var h=r?"getUTC":"get",d=s[h+"Date"](),c=s[h+"Day"](),p=s[h+"Month"](),u=s[h+"FullYear"](),f=s[h+"Hours"](),y=s[h+"Minutes"](),g=s[h+"Seconds"](),m=s[h+"Milliseconds"](),v=r?0:s.getTimezoneOffset(),x={d:d,dd:n(d),ddd:l.i18n.dayNames[c],dddd:l.i18n.dayNames[c+7],m:p+1,mm:n(p+1),mmm:l.i18n.monthNames[p],mmmm:l.i18n.monthNames[p+12],yy:String(u).slice(2),yyyy:u,h:f%12||12,hh:n(f%12||12),H:f,HH:n(f),M:y,MM:n(y),s:g,ss:n(g),l:n(m,3),L:n(m>99?Math.round(m/10):m),t:12>f?"a":"p",tt:12>f?"am":"pm",T:12>f?"A":"P",TT:12>f?"AM":"PM",Z:r?"UTC":(String(s).match(i)||[""]).pop().replace(o,""),o:(v>0?"-":"+")+n(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return a.replace(t,function(t){return t in x?x[t]:t.slice(1,t.length-1)})}}();e.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},e.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format&&console.warn("Overriding existing Date.prototype.format."),Date.prototype.format=function(t,i){return e(this,t,i)},Object.defineProperty(Date.prototype,"format",{enumerable:!1})}}(),t}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.frame",["vanilla.override"],e):e()}(global,function(){"use strict";var t,e=[],i=[],o={frameLimit:60,frameRun:!1,breakAnimationFrame:!1},n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){o.breakAnimationFrame?o.breakAnimationFrame=!1:window.setTimeout(t.call(t,[Date.now()]),1e3/o.frameLimit)}}(),s=function(){return o.breakAnimationFrame=!0,window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame}(),a=function(){};return a.prototype.start=function(t,n,s){var a={j2d:void 0,frameLimit:o.frameLimit,now:0,deltaTime:0,lastTime:0,sceneStartTime:0,sceneSkipTime:0};if(void 0!==s.frameLimit&&s.frameLimit<=o.frameLimit&&(a.frameLimit=s.frameLimit),void 0===s.j2d)throw"j2d not transported to FrameManager.start(id, engine, {... j2d: j2d ...});";a.j2d=s.j2d,a.interval=1e3/a.frameLimit,a.lastTime=Date.now(),e.add(t,n),i.add(t,a),o.frameRun||this.pulse()},a.prototype.stop=function(t){e.remove(t),i.remove(t)},a.prototype.pulse=function(){this.runMainLoop(Date.now())},a.prototype.runMainLoop=function(t,a){if(void 0===a&&(a=this),e.length<=0&&o.frameRun)return o.frameRun=!1,s(this.runMainLoop);o.frameRun=!0;for(var r in e)if(e.hasOwnProperty(r)&&"function"==typeof e[r]){var l=e[r],h=i[r];h.now=Date.now(),h.j2d.options.deltaTime=h.deltaTime=(h.now-h.lastTime)/100,h.j2d.options.io&&!h.j2d.options.pause&&h.j2d.options.io.update(),100*h.deltaTime>h.interval&&(h.lastTime=h.now-100*h.deltaTime%h.interval,h.j2d.options.pause||(h.j2d.options.deltaTime=h.deltaTime,l(t,h))),h.j2d.options.io&&!h.j2d.options.pause&&h.j2d.options.io.clear()}n(function(t){a.runMainLoop(t,a)})},a.prototype.setDefaultFrameLimit=function(t){60>=t&&t>0&&(o.frameLimit=t)},a.Init=function(){return void 0!==window.J2D?window.instanceFrameManager||(window.instanceFrameManager=new a):t||(t=new a)},void 0!==global.J2D&&(global.FrameManager=a.Init()),a.Init()}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.scene",[],e):e()}(global,function(){"use strict";var t=function(t){this.parent=t,this.enableFullscreen=!1,this.layerName="sceneNode",this.layers=parent.layers?parent.layers:{}};return t.prototype.resize=function(t,e){var i=this.parent;this.width=t,this.height=e;for(var o in i.layers.list)i.layers.list.hasOwnProperty(o)&&i.layers.list[o].resize(t,e)},t.prototype.async=function(t,e){setTimeout(t.call(t,e),0)},t.prototype.setGameState=function(t){this.parent.setActiveEngine(t),this.parent.element.trigger("changedGameState")},t.prototype.start=function(t,e){this.parent.options.io&&this.parent.options.io.init(),this.parent.element.trigger("beforeStart"),this.parent.start(t,e),this.parent.element.trigger("afterStart")},t.prototype.fullScreen=function(t){var e=document.getElementById(this.parent.element.attr("id"));void 0===e.requestFullscreen&&(e.requestFullscreen=e.webkitRequestFullscreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen),void 0===document.exitFullscreen&&(document.exitFullscreen=document.webkitExitFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen),t?e.requestFullscreen():document.exitFullscreen()},t.prototype.resizeToFullPage=function(t){$("div.canvas[guid]:not(.active)").toggle(t);var e=this.parent,i=this;t?(i.originalWidth=i.width,i.originalHeight=i.height,i.resize(e.device.width,e.device.height),i.enableFullscreen=!0,this.parent.element.width(e.device.width).height(e.device.height).css("margin",0)):(i.resize(i.originalWidth,i.originalHeight),i.enableFullscreen=!1,this.parent.element.width(i.originalWidth).height(i.originalHeight).css("margin",i.originalMargin))},t.prototype.scaleToFullScreen=function(t){$("div.canvas[guid]:not(.active)").toggle(t);var e,i;if(t){for(i in this.parent.layers.list)this.parent.layers.list.hasOwnProperty(i)&&(e=this.parent.layers.list[i].canvas,e.style.width=this.parent.device.width+"px",e.style.height=this.parent.device.height+"px");this.enableFullscreen=!0,this.parent.element.width(this.parent.device.width).height(this.parent.device.height).css("margin",0)}else{for(i in this.parent.layers.list)this.parent.layers.list.hasOwnProperty(i)&&(e=this.parent.layers.list[i].canvas,e.style.width=this.width+"px",e.style.height=this.height+"px");this.enableFullscreen=!1,this.parent.element.width(this.width).height(this.height).css("margin",this.originalMargin)}},t.prototype.toggleFullScreen=function(t,e){void 0===e&&(e={fullscreen:void 0}),!t.scene.enableFullscreen||e.fullscreen?t.scene.fullScreen(!0):t.scene.fullScreen(!1)},t.prototype.setViewPosition=function(t){this.parent.scene.viewport.x=t.x-Math.ceil(this.parent.scene.width/2),this.parent.scene.viewport.y=t.y-Math.ceil(this.parent.scene.height/2)},t.prototype.setViewFocus=function(t,e){this.parent.scene.viewport.x=t.getPosition().x-Math.ceil(this.parent.scene.width/2)+(e?e.x:0),this.parent.scene.viewport.y=t.getPosition().y-Math.ceil(this.parent.scene.height/2)+(e?e.y:0)},t.prototype.viewMove=function(t){this.parent.scene.viewport.x+=t.x,this.parent.scene.viewport.y+=t.y},t.prototype.clear=function(){this.getLayer().clear()},t.prototype.getLayer=function(){return this.parent.layers.getLayer("sceneNode")},t.prototype.init=function(t,e){var i=this.parent;i.element.trigger("beforeInit"),this.width=this.originalWidth=t,this.height=this.originalHeight=e,this.originalMargin=i.element.css("margin"),this.parent.element.width(t).height(e),i.layers.add("sceneNode",0),this.context=i.layers.getLayer("sceneNode").context,this.canvas=i.layers.getLayer("sceneNode").canvas,this.visible=!0,this.cancelClear=!1,this.viewport=i.vector.vec2df(0,0),i.element.trigger("afterInit"),$(window).ready(function(){for(var t in i.layers.list)i.layers.list.hasOwnProperty(t)&&i.element.append(i.layers.getLayer(t).canvas);i.options.ready=!0,i.element.trigger("ready")})},void 0!==global.J2D&&(global.Scene=t),t}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.layers",[],e):e()}(global,function(){"use strict";var t,e=function(e,i){this.parent=e,this.list={},t=i};return e.prototype.getLayer=function(t){return this.list[t]},e.prototype.add=function(e,i){if(this.list[e])return!1;var o={},n=this.parent;return o.layerName=e,o.canvas=document.createElement("canvas"),o.canvas.width=n.scene.width,o.canvas.height=n.scene.height,o.width=n.scene.width,o.height=n.scene.height,n.options.webGL?(t.enable(o.canvas),o.context=o.canvas.getContext("WebGL-2d")):o.context=o.canvas.getContext("2d"),n.options.smoothing?o.smoothing=!0:(o.smoothing=!1,o.disableSmoothing=n.util.disableSmoothing,n.util.disableSmoothing(o.context)),o.context.shadowColor="rgba(0,0,0,0)",o.canvas.style.zIndex=1e3+i,o.canvas.style.position="absolute",o.canvas.style.left="0",o.canvas.style.top="0",o.canvas.id=e,o.opacity=1,o.angle=0,o.visible=1,o.fillColor=!1,o.onContext=function(t){t(this.context)},o.fill=function(t){this.fillColor=t,this.context.fillStyle=t,this.context.fillRect(0,0,this.width,this.height)},o.setOpacity=function(t){this.canvas.style.opacity=t,this.opacity=t},o.getOpacity=function(){return this.opacity},o.setVisible=function(t){t?(this.canvas.style.display="block",this.visible=!0):(this.canvas.style.display="none",this.visible=!1)},o.isVisible=function(){return this.visible},o.setIndex=function(t){this.canvas.style.zIndex=1e3+t},o.clear=function(){this.context.clearRect(0,0,this.width,this.height)},o.clearNode=function(t){t.isLookScene()&&this.context.clearRect(t.pos.x-n.scene.viewport.x,t.pos.y-n.scene.viewport.y,t.size.x,t.size.y)},o.clearRect=function(t,e){this.context.clearRect(t.x-n.scene.viewport.x,t.y-n.scene.viewport.y,e.x,e.y)},o.resize=function(t,e){this.canvas.width=t,this.canvas.height=e,this.width=t,this.height=e,this.fillColor&&(this.context.save(),this.context.fillStyle=this.fillColor,this.context.fillRect(0,0,this.width,this.height),this.context.restore()),this.smoothing||this.disableSmoothing(this.context)},this.list[e]=o,n.options.ready&&n.element.append(this.list[e].canvas),o},void 0!==global.J2D&&(global.LayersManager=e),e}),!function(t,e){"function"==typeof define&&define.amd?define("jquery.j2d",["jquery","j2d.webGL2d","j2d.frame","j2d.scene","j2d.layers"],e):e(t.jQuery,t.WebGL2D,FrameManager,Scene,LayersManager)}(global,function(t,e,i,o,n){if(void 0===s)var s;var a={id:void 0,io:void 0,deltaTime:0,pause:!1,ready:!1,frameLimit:60,smoothing:!0,window:global,webGL:!1};return s=function(t,i,s){this.id=t,this.element=i,this.options=s,this.options.id=this.id,this.layers=new n(this,e),this.scene=new o(this)},s.prototype.getInfo=function(){return{name:"jquery.j2d",version:"0.1.5",site:"https://github.com/fsggs/jquery.j2d",info:"jquery.j2d - jQuery plugin of the fork j2ds.",author:"DeVinterX, Skaner(j2ds)"}},s.prototype.getIO=function(){return this.options.io},s.prototype.IOHandler=function(t){return this.options.io=t},s.prototype.setWindow=function(t){this.window=t?t:global},s.prototype.start=function(t,e){var o=this;t=t||function(){o.element.html("Please init game engine function!"),console.warn("Please init game engine function for "+o.id+"!")},i.start(o.id,t,{j2d:o,frameLimit:e}),o.options.frameLimit=e,o.element.trigger("start")},s.prototype.stop=function(){i.stop(this.id),this.element.trigger("stop")},s.prototype.pause=function(){this.options.io&&this.options.io.flush(),this.options.pause=!0,this.element.addClass("pause"),this.element.trigger("pause")},s.prototype.resume=function(){this.element.removeClass("pause").focus(),this.options.pause=!1,this.options.io&&this.options.io.flush(),this.element.trigger("resume")},s.prototype.isPlay=function(){return!this.options.pause},s.prototype.enableWebGL=function(){this.options.webGL=!0,this.element.addClass("WebGL")},s.prototype.setSmoothing=function(t){this.options.smoothing=!!t},s.prototype.disableWebGL=function(){this.options.webGL=!1,this.element.removeClass("WebGL")},s.prototype.setActiveEngine=function(t){var e=this;t=t||function(){e.element.html("Please set game engine function!"),console.warn("Please set game engine function for "+e.id+"!")},i.stop(e.id),i.start(e.id,t,{j2d:e,frameLimit:e.options.frameLimit})},s.prototype.getDevice=function(){return this.device},s.prototype.device={width:parseInt(t(document).width())<parseInt(screen.width)?parseInt(t(document).width()):parseInt(screen.width),height:parseInt(t(document).height())<parseInt(screen.height)?parseInt(t(document).height()):parseInt(screen.height),resize:function(){this.width=global.innerWidth,this.height=global.innerHeight}},s.prototype.vector={vec2df:function(t,e){return{x:t,y:e}},vec2di:function(t,e){return{x:t>>0,y:e>>0}}},s.math={toInt:function(t){return t>>0},randomColor:function(t,e,i){return"rgba("+s.math.random(t,e)+", "+s.math.random(t,e)+", "+s.math.random(t,e)+", "+i+")"},random:function(t,e,i){var o=Math.floor(Math.random()*(e-t+1)+t);return i&&0==o?s.math.random(t,e,i):o},rad:function(t){return t*(Math.PI/180)}},s.prototype.math=s.math,s.util={disableSmoothing:function(t){var e=global.navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),i=e?parseInt(e[2],10):!1;t.imageSmoothingEnabled=!1,t.mozImageSmoothingEnabled=!1,t.oImageSmoothingEnabled=!1,i&&29>=i&&(t.webkitImageSmoothingEnabled=!1),t.msImageSmoothingEnabled=!1}},s.prototype.util=s.util,s.prototype.getLayers=function(){return this.layers},s.prototype.getScene=function(){return this.scene},s.initJQueryPlugin=function(){if(void 0!==global.j2dPlugin)return null;global.j2dPlugin={pluginInit:!0},t.fn.j2d=function(e){this.filter("div.canvas:not([guid])").each(function(){var e=t.extend(!0,{},a,e),i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)});t(this).attr("guid",i);var o=t(this).attr("id");("undefined"==typeof o||o===!1)&&t(this).attr("id",i);var n=t(this).attr("tabindex");("undefined"==typeof n||n===!1)&&t(this).attr("tabindex","-1"),t(this).data("j2d",new s(i,t(this),e)).addClass("j2d"),t(this).click().focus()});var i=[];return this.filter("div.canvas[guid]").each(function(){i.push(t(this).data("j2d"))}),1===i.length?t(this).data("j2d"):i};var e=function(){return!!(document.webkitFullscreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement)};t(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(i){var o=e();o||(t("div.canvas[guid].active").data("j2d").scene.resizeToFullPage(o),t("div.canvas[guid]:not(.active)").toggle(!o))}),t(document).on("click","div.canvas[guid].pause",function(){t(this).data("j2d").resume();var e=this;t("div.canvas[guid]:not(.pause-disable):not(:focus)").each(function(){e!==this&&t(this).removeClass("active").data("j2d").pause()}),t("div.canvas[guid].active.pause-disable:not(:focus)").each(function(){e!==this&&t(this).removeClass("active")})}),t(document).on("click touch mouseenter","div.canvas[guid]:not(.resume-by-click):not(:focus)",function(e){t(this).addClass("active").focus().data("j2d").resume();var i=this;t("div.canvas[guid]:not(.pause-disable):not(:focus)").each(function(){i!==this&&t(this).removeClass("active").data("j2d").pause()}),t("div.canvas[guid].active.pause-disable:not(:focus)").each(function(){i!==this&&t(this).removeClass("active")})}),t(global).on("focus",function(){t("div.canvas[guid].active").each(function(){t(this).data("j2d").resume()})}).on("blur",function(){t("div.canvas[guid]").each(function(){t(this).data("j2d").pause()})}),t(global).on("resize",function(){t("div.canvas[guid]").each(function(){t(this).data("j2d").device.resize()});var i=e();i&&t("div.canvas[guid].active").data("j2d").scene.resizeToFullPage(i)}),i.pulse()},void 0!==global.J2D&&(global.J2D=s),s}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.base",["jquery.j2d","j2d.scene"],e):e(t.J2D,Scene)}(global,function(t,e){"use strict";e.prototype.addBaseNode||(e.prototype.addBaseNode=function(t,e){return new i(this.parent,t,e)});var i=function(t,e,i){this.nodeName="BaseNode",this.j2d=t,this.layer=t.scene,this.options={visible:!0,alpha:1,position:e,size:i,parent:!1,angle:0,box:{offset:{x:0,y:0},size:{x:0,y:0}}}};return i.prototype.mergeOptions=function(t,e){void 0===e&&(e=this.options);for(var i in t)if(t.hasOwnProperty(i))try{t[i].constructor==Object?e[i]=this.mergeOptions(t[i],e[i]):e[i]=t[i]}catch(o){e[i]=t[i]}return e},i.prototype.saveJSON=function(){return JSON.stringify({node:this.nodeName,data:this.options})},i.prototype.loadJSON=function(t){if(t=JSON.parse(t),this.nodeName===t.node)return this.mergeOptions(t.data);throw"Node type invalid to loadJSON data."},i.prototype.resizeBox=function(t,e){this.options.box.offset=t,this.options.box.size=e},i.prototype.setLayer=function(t){this.layer=t?this.j2d.layers.getLayer(t):this.j2d.scene},i.prototype.getLayer=function(){return this.layer},i.prototype.setVisible=function(t){this.options.visible=t},i.prototype.isVisible=function(){return this.options.visible},i.prototype.setAlpha=function(t){0>t&&(t=0),t>1&&(t=1),this.options.alpha=t},i.prototype.getAlpha=function(t){return this.options.alpha},i.prototype.moveTo=function(t,e){e=e?e:1,this.move(this.j2d.vector.vec2df((t.x-this.getPosition().x)/e,(t.y-this.getPosition().y)/e))},i.prototype.setPosition=function(t){this.options.position=this.j2d.vector.vec2df(t.x-Math.ceil(this.options.size.x/2),t.y-Math.ceil(this.options.size.y/2))},i.prototype.move=function(t){this.options.position.x+=t.x,this.options.position.y+=t.y},i.prototype.getPosition=function(){return this.j2d.vector.vec2df(this.options.position.x+Math.ceil(this.options.size.x/2),this.options.position.y+Math.ceil(this.options.size.y/2))},i.prototype.setSize=function(t){this.options.size=t},i.prototype.getSize=function(){return this.options.size},i.prototype.setParent=function(t){this.parent=t},i.prototype.getDistance=function(t){return Math.ceil(Math.sqrt(Math.pow(t.getPosition().x-this.getPosition().x,2)+Math.pow(t.getPosition().y-this.getPosition().y,2)))},i.prototype.getDistanceXY=function(t){return this.j2d.vector.vec2df(Math.abs(t.getPosition().x-this.getPosition().x),Math.abs(t.getPosition().y-this.getPosition().y))},i.prototype.isIntersect=function(t){var e={x1:this.options.position.x+this.options.box.offset.x,x2:t.options.position.x+t.options.box.offset.x,y1:this.options.position.y+this.options.box.offset.y,y2:t.options.position.y+t.options.box.offset.y},i={x1:this.options.size.x+this.options.box.size.x,x2:t.options.size.x+t.options.box.size.x,y1:this.options.size.y+this.options.box.size.y,y2:t.options.size.y+t.options.box.size.y};return e.y1+i.y1>=e.y2&&e.x1+i.x1>=e.x2&&e.x1<e.x2+i.x2&&e.y1<e.y2+i.y2},i.prototype.isCollision=function(t){var e=!1;return this.getDistanceXY(t).x<this.options.size.x/2+t.options.size.x/2&&this.getDistanceXY(t).y<this.options.size.y/2+t.options.size.y/2&&(e=!0),e},i.prototype.isLookScene=function(){var t=!0;return(this.options.position.x>this.j2d.scene.viewport.x+this.j2d.scene.width||this.options.position.x+this.options.size.x<this.j2d.scene.viewport.x||this.options.position.y>this.j2d.scene.viewport.y+this.j2d.scene.height||this.options.position.y+this.options.size.y<this.j2d.scene.viewport.y)&&(t=!1),t},i.prototype.turn=function(t){this.options.angle=this.options.angle%360,this.options.angle+=t},i.prototype.setRotation=function(t){this.options.angle=t%360},i.prototype.getRotation=function(t){return this.options.angle},i.prototype.isOutScene=function(){return{x:this.options.position.x+this.options.size.x>=this.j2d.scene.viewport.x+this.j2d.scene.width?1:this.options.position.x<=this.j2d.scene.viewport.x?-1:0,y:this.options.position.y+this.options.size.y>=this.j2d.scene.viewport.y+this.j2d.scene.height?1:this.options.position.y<=this.j2d.scene.viewport.y?-1:0,all:this.x||this.y}},i.prototype.moveDir=function(t){this.options.position.x+=t*Math.cos(this.j2d.math.rad(this.options.angle)),this.options.position.y+=t*Math.sin(this.j2d.math.rad(this.options.angle))},i.prototype.drawBox=function(){var t=this.layer.context;this.options.angle&&(t.save(),t.translate(this.getPosition().x-this.j2d.scene.viewport.x,this.getPosition().y-this.j2d.scene.viewport.y),t.rotate(this.j2d.math.rad(this.options.angle)),t.translate(-(this.getPosition().x-this.j2d.scene.viewport.x),-(this.getPosition().y-this.j2d.scene.viewport.y))),t.lineWidth=2,t.strokeStyle="black",t.lineCap="round",t.beginPath(),t.rect(this.options.position.x-this.j2d.scene.viewport.x,this.options.position.y-this.j2d.scene.viewport.y,this.options.size.x,this.options.size.y),t.stroke(),t.strokeStyle="yellow",t.beginPath(),t.rect(this.options.box.offset.x+this.options.position.x-this.j2d.scene.viewport.x,this.options.box.offset.y+this.options.position.y-this.j2d.scene.viewport.y,this.options.box.size.x+this.options.size.x,this.options.box.size.y+this.options.size.y),t.stroke(),t.lineCap="butt",this.options.angle&&t.restore()},void 0!==global.J2D&&(global.BaseNode=i),i}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.circle",["jquery.j2d","j2d.base","j2d.scene"],e):e(t.J2D,BaseNode,Scene)}(global,function(t,e,i){"use strict";i.prototype.addCircleNode||(i.prototype.addCircleNode=function(t,e,i){return new o(this.parent,t,e,i)});var o=function(t,i,o,n){e.call(this,t,i,t.vector.vec2df(2*o,2*o)),this.nodeName="CircleNode",this.mergeOptions({color:n,radius:o})};return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype.draw=function(){var t=this.layer.context;if(this.options.visible&&this.isLookScene()){if(1!=this.options.alpha){var e=t.globalAlpha;t.globalAlpha=this.options.alpha}t.lineWidth=0,t.fillStyle=this.options.color,t.beginPath(),t.arc(this.options.position.x-this.j2d.scene.viewport.x+this.options.radius,this.options.position.y-this.j2d.scene.viewport.y+this.options.radius,this.options.radius,0,2*Math.PI,!0),t.stroke(),t.fill(),1!=this.options.alpha&&(t.globalAlpha=e)}},void 0!==global.J2D&&(global.CircleNode=o),o}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.fps",e):e()}(global,function(){"use strict";var t=function(){this.tmp_of_fps=0,this.maxFPS=60,this.tmp_of_time=Date.now()};return t.prototype.start=function(t){this.maxFPS=t.frameLimit,void 0===this.fps&&(this.fps=t.frameLimit),this.tmp_of_fps+=1},t.prototype.end=function(t){t.now-this.tmp_of_time>=1e3&&(this.fps=this.tmp_of_fps,this.tmp_of_fps=0,this.tmp_of_time=t.now)},t.prototype.getFPS=function(){return this.fps>this.maxFPS?this.maxFPS:this.fps},void 0!==global.J2D&&(global.FPSMeter=t),t}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.input",["jquery","vanilla.override"],e):e(t.jQuery)}(global,function($){"use strict";function getKey(t,e){return Object.keys(t).filter(function(i){return t[i]===e})[0]}var InputManager=function(t){this.j2d=t,this.id=t.id,this.element=t.element,this.data={mouse:{startPosition:{x:0,y:0},currentPosition:{x:0,y:0},previousDistance:0,distance:0},viewport:{position:{x:0,y:0}},enabled:!1,enableAdditionalData:!1,keysPressed:[],writeMode:!1,timePressed:0,preventAll:!1,cursor:{enabled:!1,image:"auto"}},this.keyMap={FULLSCREEN:[[InputManager.key.KEY_CTRL,InputManager.key.KEY_F11],"j2d.scene.toggleFullScreen",{}]}},checkKeyMap=function(e,enableCallback){void 0===enableCallback&&(enableCallback=!0);var j2d=e.data.manager.j2d,manager=e.data.manager,keyCode=e.which,keyMap=e.data.manager.keyMap;for(var index in keyMap)if(keyMap.hasOwnProperty(index)){var value=keyMap[index];if(!$.isArray(value[0])&&value[0]===keyCode&&value[1])return"string"==typeof value[1]&&(value[1]=eval("("+value[1]+")")),"function"==typeof value[1]&&enableCallback&&value[1](j2d,value[2]),!0;if($.isArray(value[0])&&manager.data.keysPressed.equals(value[0])&&value[1])return"string"==typeof value[1]&&(value[1]=eval("("+value[1]+")")),"function"==typeof value[1]&&enableCallback&&value[1](j2d,value[2]),!0}return!1},events={onMouseClick:function(t){var e=t.data.manager;if(!e.data.enabled||!e.j2d.isPlay()||!e.j2d.element.hasClass("active"))return!0;var i=e.data.keysPressed,o=getKey(InputManager.key,t.which)||"KEY_UNKNOWN_"+t.which,n=e.data.mouse;2!==t.data.event?(0===t.data.event?(-1===$.inArray(InputManager.key[o],i)&&(i.push(InputManager.key[o]),e.data.enableAdditionalData&&(n.startPosition.x=t.pageX,n.startPosition.y=t.pageY,n.distance=0,e.data.timePressed=t.timeStamp)),(checkKeyMap(t,!1)||e.data.preventAll)&&t.preventDefault()):((checkKeyMap(t)||e.data.preventAll)&&t.preventDefault(),e.data.enableAdditionalData&&(n.previousDistance=n.distance,n.startPosition.x=0,n.startPosition.y=0),i.splice(i.indexOf(InputManager.key[o]),1)),e.element.trigger(0===t.data.event?"mouseKeyDown":"mouseKeyUp",{keyCode:o})):checkKeyMap(t,!1)&&t.preventDefault()},onMouseWheel:function(t){var e=t.data.manager;if(!e.data.enabled||!e.j2d.isPlay()||!e.j2d.element.hasClass("active"))return!0;var i=e.data.keysPressed,o=t.originalEvent.wheelDelta/120>0?getKey(InputManager.key,4):getKey(InputManager.key,5);t.which=t.originalEvent.wheelDelta/120>0?4:5,-1===$.inArray(InputManager.key[o],i)&&i.push(InputManager.key[o]),(checkKeyMap(t)||e.data.preventAll)&&(t.preventDefault(),e.fixMouseWheel()),e.element.trigger("mouseWheel",{keyCode:o})},mouseWheelCancel:function(t,e){t.splice(t.indexOf(InputManager.key[e]),1)},onMouseMove:function(t){var e=t.data.manager,i=t.data.manager.data.mouse;e.data.mouse.currentPosition.x=t.pageX,e.data.mouse.currentPosition.y=t.pageY,t.data.manager.data.enableAdditionalData&&(i.distance=Math.sqrt(Math.pow(i.currentPosition.x-i.startPosition.x,2)+Math.pow(i.currentPosition.y-i.startPosition.y,2)).toFixed(1))},onKeyboardPress:function(t){var e=t.data.manager;if(!e.data.enabled||!e.j2d.isPlay()||!e.element.hasClass("active"))return!0;var i=e.data.keysPressed,o=getKey(InputManager.key,t.which)||"KEY_UNKNOWN_"+t.which;if(2===t.data.event&&!0===e.data.writeMode){var n=String.fromCharCode(t.which||t.keyCode);t.preventDefault(),e.element.focus().trigger("keyboardCharPress",{key:t.which||t.keyCode,keyCode:o,"char":n})}2!==t.data.event&&!1===e.data.writeMode&&(0===t.data.event?(-1===$.inArray(InputManager.key[o],i)&&(i.push(InputManager.key[o]),e.data.enableAdditionalData&&(e.data.timePressed=t.timeStamp)),(checkKeyMap(t,!1)||e.data.preventAll)&&t.preventDefault()):((checkKeyMap(t)||e.data.preventAll)&&t.preventDefault(),i.splice(i.indexOf(InputManager.key[o]),1)),e.element.trigger(0===t.data.event?"keyboardKeyDown":"keyboardKeyUp",{keyCode:o,key:t.which||t.keyCode})),2!==t.data.event&&!0===e.data.writeMode&&e.element.trigger(0===t.data.event?"keyboardKeyDown":"keyboardKeyUp",{keyCode:o,key:t.which||t.keyCode})},onTouchTap:function(t){var e=t.data.manager;if(!e.data.enabled||!e.j2d.isPlay()||!e.j2d.element.hasClass("active"))return!0;var i=e.data.keysPressed,o=getKey(InputManager.key,t.which+1)||"KEY_UNKNOWN_"+t.which,n=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],s=e.data.mouse;0===t.data.event?(-1===$.inArray(InputManager.key[o],i)&&(i.push(InputManager.key[o]),e.data.enableAdditionalData&&(s.startPosition.x=n.pageX,s.startPosition.y=n.pageY,s.distance=0,e.data.timePressed=t.timeStamp)),(checkKeyMap(t,!1)||e.data.preventAll)&&t.preventDefault()):((checkKeyMap(t)||e.data.preventAll)&&t.preventDefault(),e.data.enableAdditionalData&&(s.previousDistance=s.distance,s.startPosition.x=0,s.startPosition.y=0),i.splice(i.indexOf(InputManager.key[o]),1)),e.element.trigger(0===t.data.event?"mouseKeyDown":"mouseKeyUp",{keyCode:o})},onTouchMove:function(t){var e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],i=t.data.manager.data.mouse;i.currentPosition.x=e.pageX.toFixed(0),i.currentPosition.y=e.pageY.toFixed(0),t.data.manager.data.enableAdditionalData&&(i.distance=Math.sqrt(Math.pow(i.currentPosition.x-i.startPosition.x,2)+Math.pow(i.currentPosition.y-i.startPosition.y,2)).toFixed(1))}},bindEvents=function(t){var e="[guid="+t.id+"]";$(document).on("contextmenu",e,{manager:t,event:2},events.onMouseClick),$(document).on("mousedown",e,{manager:t,event:0},events.onMouseClick),$(document).on("mouseup",e,{manager:t,event:1},events.onMouseClick),$(document).on("mousewheel",e,{manager:t},events.onMouseWheel),$(document).on("mousemove",e,{manager:t},events.onMouseMove),$(document).on("keydown",null,{manager:t,event:0},events.onKeyboardPress),$(document).on("keyup",null,{manager:t,event:1},events.onKeyboardPress),$(document).on("keypress",null,{manager:t,event:2},events.onKeyboardPress),$(document).on("touchstart",e,{manager:t,event:0},events.onTouchTap),$(document).on("touchend",e,{manager:t,event:1},events.onTouchTap),$(document).on("touchmove ",e,{manager:t},events.onTouchMove)},unbindEvents=function(t){var e="[guid="+t.id+"]";$(document).off("contextmenu",e,{manager:t,event:1},events.onMouseClick),$(document).off("mousedown",e,{manager:t,event:0},events.onMouseClick),$(document).off("mouseup",e,{manager:t,event:1},events.onMouseClick),$(document).off("mousewheel",e,{manager:t},events.onMouseWheel),$(document).off("mousemove",e,{manager:t},events.onMouseMove),$(document).off("keydown",null,{manager:t,event:0},events.onKeyboardPress),$(document).off("keyup",null,{manager:t,event:1},events.onKeyboardPress),$(document).off("keypress",null,{manager:t,event:2},events.onKeyboardPress),$(document).off("touchstart",e,{manager:t,event:0},events.onTouchTap),$(document).off("touchend",e,{manager:t,event:1},events.onTouchTap),$(document).off("touchmove ",e,{manager:t},events.onTouchMove)};InputManager.prototype.init=function(){!this.data.enabled&&global.j2dPlugin.pluginInit&&(bindEvents(this),this.data.enabled=!0)},InputManager.prototype.update=function(){if(!this.data.enabled)return!1;var t=this.j2d.scene.canvas.offsetWidth/this.j2d.scene.width,e=this.j2d.scene.canvas.offsetHeight/this.j2d.scene.height,i=this.data.mouse.currentPosition.x/t,o=this.data.mouse.currentPosition.y/e,n=this.element.offset();
this.data.viewport.x=this.j2d.scene.viewport.x+i-n.left,this.data.viewport.y=this.j2d.scene.viewport.y+o-n.top},InputManager.prototype.flush=function(){this.data.keysPressed=[]},InputManager.prototype.clear=function(){},InputManager.prototype.fixMouseWheel=function(){var t=this.data.keysPressed;-1!==$.inArray(InputManager.key.SCROLL_MOUSE_UP,t)?events.mouseWheelCancel(t,InputManager.key.SCROLL_MOUSE_UP):-1!==$.inArray(InputManager.key.SCROLL_MOUSE_DOWN,t)&&events.mouseWheelCancel(t,InputManager.key.SCROLL_MOUSE_DOWN)},InputManager.prototype.enable=function(){this.data.enabled||(this.data.enabled=!1)},InputManager.prototype.disable=function(){this.data.enabled&&(this.data.enabled=!1)},InputManager.prototype.load=function(t){var e=JSON.stringify(this.keyMap);return this.keyMap=JSON.parse(t),e},InputManager.prototype.save=function(){return JSON.stringify(this.keyMap)},InputManager.prototype.setKeys=function(t){this.keyMap=$.extend(!0,{},this.keyMap,t)};var getPressData=function(t,e){return t.data.enableAdditionalData?{keyList:e,time:Date.now()-t.data.timePressed}:!0};return InputManager.prototype.getMouseMoveDistance=function(){return this.data.enableAdditionalData?{current:this.data.mouse.distance,previous:this.data.mouse.previousDistance}:0},InputManager.prototype.checkPressedKeyList=function(t){return $.isArray(t)?t.length!==this.data.keysPressed.length?!1:this.data.keysPressed.equals(t)?(this.fixMouseWheel(),getPressData(this,t)):(this.fixMouseWheel(),!1):isNaN(t)?!1:-1!==this.data.keysPressed.indexOf(t)?(this.fixMouseWheel(),getPressData(this,t)):(this.fixMouseWheel(),!1)},InputManager.prototype.checkPressedKeyMap=function(t){if(void 0===this.keyMap[t])return!1;var e=this.keyMap[t][0];return this.checkPressedKeyList(e)},InputManager.prototype.getPosition=function(){return this.j2d.vector.vec2df(this.data.viewport.x+.5,this.data.viewport.y+.5)},InputManager.prototype.onNode=function(t){return t.layer.visible?this.data.viewport.x>t.options.position.x&&this.data.viewport.x<t.options.position.x+t.options.size.x&&this.data.viewport.y>t.options.position.y&&this.data.viewport.y<t.options.position.y+t.options.size.y:!1},InputManager.prototype.setWriteMode=function(t){this.data.writeMode=t},InputManager.prototype.isWriteMode=function(){return!!this.data.writeMode},InputManager.prototype.setCursorImage=function(t){this.data.cursor.image='url("'+t+'"), auto',$(this.element).css("cursor",this.data.cursor.image)},InputManager.prototype.toggleCursor=function(t){void 0!==t?this.data.cursor.enable=t:this.data.cursor.enable=!this.data.cursor.enable,this.data.cursor.enable?$(this.element).css("cursor",this.data.cursor.image):(this.data.cursor.image=$(this.j2d.element).css("cursor"),$(this.element).css("cursor","none"))},InputManager.prototype.isCursorVisible=function(){return this.data.cursor.enable},InputManager.key={KEY_MOUSE_LEFT:1,KEY_MOUSE_MIDDLE:2,KEY_MOUSE_RIGHT:3,SCROLL_MOUSE_UP:4,SCROLL_MOUSE_DOWN:5,KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_BREAK:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE_BAR:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_LEFT_WINDOW_KEY:91,KEY_RIGHT_WINDOW_KEY:92,KEY_SELECT_KEY:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SUBTRACT:109,KEY_DECIMAL_POINT:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_SEMI_COLON:186,KEY_EQUAL_SIGN:187,KEY_COMMA:188,KEY_DASH:189,KEY_PERIOD:190,KEY_FORWARD_SLASH:191,KEY_GRAVE_ACCENT:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_SINGLE_QUOTE:222,KEY_LEFT_COMMAND:224,KEY_RIGHT_COMMAND:224},void 0!==global.J2D&&(global.InputManager=InputManager),InputManager}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.io.legacy",["jquery"],e):e(t.jQuery)}(global,function(t){"use strict";var e=function(t){this.j2d=t,this.data={pos:{x:0,y:0},x:0,y:0,abs:{x:0,y:0},lClick:!1,mClick:!1,rClick:!1,touch:!1,keyDown:[],keyPress:[],keyPressed:[],keyUp:[],keyUpped:!1,canceled:!1,body:!1,anyKey:!1,writeMode:!1,displayCursor:"",visible:!0}};return e.prototype.init=function(){var t=this;e.activeElement=t.j2d.element,e.activeElement.focus(),t.j2d.options.window.ontouchstart=t.onTouch,t.j2d.options.window.ontouchmove=t.onTouch,t.j2d.options.window.ontouchend=function(){t.data.canceled=!1,t.falseInput()},t.j2d.options.window.oncontextmenu=function(){return!1},t.j2d.options.window.onselectstart=t.j2d.options.window.oncontextmenu,t.j2d.options.window.ondragstart=t.j2d.options.window.oncontextmenu,t.j2d.options.window.onmousedown=t.onClick,t.j2d.options.window.onmouseup=function(){t.data.canceled=!1,t.falseInput()},t.j2d.options.window.onmousemove=t.cursorPosition,t.j2d.options.window.onkeydown=function(e){t.keyEvent(e)},t.j2d.options.window.onkeyup=function(e){t.data.canceled=!1,t.keyEvent(e)},t.j2d.options.window.onkeypress=function(e){t.keyEvent(e)}},e.prototype.update=function(){var t=this.j2d.scene.canvas.offsetWidth/this.j2d.scene.width,e=this.j2d.scene.canvas.offsetHeight/this.j2d.scene.height;this.data.x=this.data.abs.x/t,this.data.y=this.data.abs.y/e,this.data.pos.x=this.j2d.scene.viewport.x+this.data.x,this.data.pos.y=this.j2d.scene.viewport.y+this.data.y},e.prototype.clear=function(){this.data.keyPress=[],this.data.keyUp=[]},e.prototype.keyList=function(){var t=[];for(var i in e.keys)e.keys.hasOwnProperty(i)&&t.push(i);return t},e.prototype.isKeyDown=function(t){return this.data.keyDown[e.keys[t]]},e.prototype.isKeyPress=function(t){return this.data.keyPress[e.keys[t]]},e.prototype.isKeyUp=function(t){return this.data.keyUp[e.keys[t]]},e.prototype.getPosition=function(){return this.j2d.vector.vec2df(this.data.pos.x,this.data.pos.y)},e.prototype.setWriteMode=function(t){this.data.writeMode=t},e.prototype.isWriteMode=function(){return this.data.writeMode},e.prototype.keyEvent=function(e){if("keydown"==e.type)this.data.keyPressed[e.keyCode]||(this.data.keyPress[e.keyCode]=!0,this.data.keyPressed[e.keyCode]=!0),this.data.writeMode?t(this.j2d.element).trigger("keyPress"):e.preventDefault();else if("keyup"==e.type)this.data.keyPressed[e.keyCode]&&(this.data.keyPress[e.keyCode]=!1,this.data.keyPressed[e.keyCode]=!1,this.data.keyUp[e.keyCode]=!0,this.data.keyUpped=!0,e.preventDefault());else if("keypress"==e.type&&this.data.writeMode){var i="";0!=e.which&&0!=e.charCode&&e.which>=32&&(i=String.fromCharCode(e.which)),t(this.j2d.element).trigger("keyPress",[i])}return this.data.keyDown[e.keyCode]="keydown"==e.type&&!this.data.canceled,this.data.anyKey=e.keyCode,!1},e.prototype.cancel=function(t){t?this.data.keyDown[e.keys[t]]=!1:(this.data.canceled=!0,this.falseInput(),this.data.keyDown=[])},e.prototype.onNode=function(t){return t.layer.visible?this.data.pos.x>t.options.position.x&&this.data.pos.x<t.options.position.x+t.options.size.x&&this.data.pos.y>t.options.position.y&&this.data.pos.y<t.options.position.y+t.options.size.y:!1},e.prototype.cursorPosition=function(t){var i=e.activeElement.j2d().options.io;if(!i.data.touch){var o,n;document.all?(o=t.x+document.body.scrollLeft,n=t.y+document.body.scrollTop):(o=t.pageX,n=t.pageY),i.data.abs.x=o,i.data.abs.y=n}},e.prototype.onClick=function(t){var i=e.activeElement.j2d().options.io;return!t.which&&t.button&&(1&t.button?t.which=1:4&t.button?t.which=2:2&t.button&&(t.which=3)),i.data.lClick=1==t.which&&!i.data.canceled,i.data.mClick=2==t.which&&!i.data.canceled,i.data.rClick=3==t.which&&!i.data.canceled,e.activeElement.focus(),t.preventDefault(),!1},e.prototype.onTouch=function(t){var i=e.activeElement.j2d().options.io;return i.data.abs.x=t.touches[0].pageX,i.data.abs.y=t.touches[0].pageY,i.data.lClick=!i.data.canceled,i.data.touch=!i.data.canceled,e.activeElement.focus(),t.preventDefault(),!1},e.prototype.falseInput=function(){this.data.lClick=!1,this.data.mClick=!1,this.data.rClick=!1},e.prototype.setCursorImage=function(e){t(this.j2d.element).css("cursor",'url("'+e+'"), auto')},e.prototype.setVisible=function(e){this.data.visible=e,e?t(this.j2d.element).css("cursor",this.data.displayCursor):(this.data.displayCursor=t(this.j2d.element).css("cursor"),t(this.j2d.element).css("cursor","none"))},e.prototype.isVisible=function(){return this.data.visible},e.keys={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,CTRL:17,SHIFT:16,ALT:18,ESC:27,ENTER:13,MINUS:189,PLUS:187,CAPS_LOCK:20,BACKSPACE:8,TAB:9,Q:81,W:87,E:69,R:82,T:84,Y:89,U:85,I:73,O:79,P:80,A:65,S:83,D:68,F:70,G:71,H:72,J:74,K:75,L:76,Z:90,X:88,V:86,B:66,N:78,M:77,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,C:67,9:57,NUM_0:45,NUM_1:35,NUM_2:40,NUM_3:34,NUM_4:37,NUM_5:12,NUM_6:39,NUM_7:36,NUM_8:38,NUM_9:33,NUM_MINUS:109,NUM_PLUS:107,NUM_LOCK:144,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},e.activeElement=void 0,void 0!==global.J2D&&(global.IO=e),e}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.line",["jquery.j2d","j2d.base","j2d.scene"],e):e(t.J2D,BaseNode,Scene)}(global,function(t,e,i){"use strict";i.prototype.addLineNode||(i.prototype.addLineNode=function(t,e,i,n,s,a,r){return new o(this.parent,t,e,i,n,s,a,r)});var o=function(t,i,o,n,s,a,r,l){e.call(this,t,i,t.vector.vec2df(0,0)),this.nodeName="LineNode",this.mergeOptions({color:s,points:o,fill:r||!1,scale:n||0,cFill:l,lineWidth:a})};return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype.draw=function(){var t=this.layer.context;if(this.options.visible&&this.isLookScene()){if(1!=this.options.alpha){var e=t.globalAlpha;t.globalAlpha=this.options.alpha}this.options.angle&&(t.save(),t.translate(this.getPosition().x-this.j2d.scene.viewport.x,this.getPosition().y-this.j2d.scene.viewport.y),t.rotate(this.j2d.math.rad(this.options.angle)),t.translate(-(this.getPosition().x-this.j2d.scene.viewport.x),-(this.getPosition().y-this.j2d.scene.viewport.y))),t.strokeStyle=this.options.color,t.lineWidth=this.options.lineWidth,t.lineCap="round",t.beginPath(),t.moveTo(this.options.position.x-this.j2d.scene.viewport.x,this.options.position.y-this.j2d.scene.viewport.y);for(var i=0,o=this.options.points.length;o>i;i+=1)t.lineTo(this.options.position.x+this.options.points[i][0]*this.options.scale-this.j2d.scene.viewport.x,this.options.position.y+this.options.points[i][1]*this.options.scale-this.j2d.scene.viewport.y);t.stroke(),this.options.fill&&(t.fillStyle=this.options.cFill,t.fill()),t.lineWidth=0,t.lineCap="butt",this.options.angle&&t.restore(),1!=this.options.alpha&&(t.globalAlpha=e)}},void 0!==global.J2D&&(global.LineNode=o),o}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.rect",["jquery.j2d","j2d.base","j2d.scene"],e):e(t.J2D,BaseNode,Scene)}(global,function(t,e,i){"use strict";i.prototype.addRectNode||(i.prototype.addRectNode=function(t,e,i){return new o(this.parent,t,e,i)});var o=function(t,i,o,n){e.call(this,t,i,o),this.nodeName="RectNode",this.mergeOptions({color:n})};return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype.draw=function(){var t=this.layer.context;if(this.options.visible&&this.isLookScene()){if(1!=this.options.alpha){var e=t.globalAlpha;t.globalAlpha=this.options.alpha}this.options.angle&&(t.save(),t.translate(this.getPosition().x-this.j2d.scene.viewport.x,this.getPosition().y-this.j2d.scene.viewport.y),t.rotate(this.j2d.math.rad(this.options.angle)),t.translate(-(this.getPosition().x-this.j2d.scene.viewport.x),-(this.getPosition().y-this.j2d.scene.viewport.y))),t.fillStyle=this.options.color,t.lineWidth=0,t.fillRect(this.options.position.x-this.j2d.scene.viewport.x,this.options.position.y-this.j2d.scene.viewport.y,this.options.size.x,this.options.size.y),this.options.angle&&t.restore(),1!=this.options.alpha&&(t.globalAlpha=e)}},void 0!==global.J2D&&(global.RectNode=o),o}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.sprite",["jquery.j2d","j2d.base","j2d.scene"],e):e(t.J2D,BaseNode,Scene)}(global,function(t,e,i){"use strict";i.prototype.addSpriteNode||(i.prototype.addSpriteNode=function(t,e,i){return new o(this.parent,t,e,i)});var o=function(t,i,o,n){e.call(this,t,i,o),this.nodeName="SpriteNode",this.mergeOptions({tmpSpeed:0,frame:0,animation:n,flip:{x:!1,y:!1}})};return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype.setFlip=function(t,e){this.options.flip={x:t,y:e}},o.prototype.draw=function(t){this.options.visible&&this.isLookScene()&&(t=t||1,this.options.frame>this.options.animation.frameCount&&(this.options.frame=0),this.drawFrame(this.options.frame+1),this.options.tmpSpeed>t?(this.options.frame+=1,this.options.tmpSpeed=0):this.options.tmpSpeed+=1)},o.prototype.drawFrame=function(t){var e=this.layer.context;if(this.options.visible&&this.isLookScene()){if(1!=this.options.alpha){var i=e.globalAlpha;e.globalAlpha=this.options.alpha}e.lineWidth=0,(this.options.angle||this.options.flip.x||this.options.flip.y)&&(e.save(),e.translate(this.getPosition().x-this.j2d.scene.viewport.x,this.getPosition().y-this.j2d.scene.viewport.y),e.rotate(this.j2d.math.rad(this.options.angle)),e.scale(this.options.flip.x?-1:1,this.options.flip.y?-1:1),e.translate(-(this.getPosition().x-this.j2d.scene.viewport.x),-(this.getPosition().y-this.j2d.scene.viewport.y))),t=t?t-1:0,e.drawImage(this.options.animation.imageMap.img,this.options.animation.sourceX+this.options.animation.sourceW*t,this.options.animation.sourceY,this.options.animation.sourceW,this.options.animation.sourceH,this.options.position.x-this.j2d.scene.viewport.x,this.options.position.y-this.j2d.scene.viewport.y,this.options.size.x,this.options.size.y),(this.options.angle||this.options.flip.x||this.options.flip.y)&&e.restore(),1!=this.options.alpha&&(e.globalAlpha=i)}},o.prototype.setAnimation=function(t){this.options.animation!=t&&(this.options.animation=t)},void 0!==global.J2D&&(global.SpriteNode=o),o}),!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery)}(global,function(t){"use strict";(void 0===t.localStorage||void 0===t.sessionStorage)&&t.map(["localStorage","sessionStorage"],function(e){var i={cookiePrefix:"fallback:"+e+":",cookieOptions:{path:"/",domain:document.domain,expires:"localStorage"===e?{expires:365}:void 0}};try{t.support[e]=e in window&&null!==window[e]}catch(o){t.support[e]=!1}t[e]=function(o,n){var s=t.extend({},i,t[e].options);return this.getItem=function(i){var o=function(i){return JSON.parse(t.support[e]?window[e].getItem(i):t.cookie(s.cookiePrefix+i))};if("string"==typeof i)return o(i);for(var n=[],a=i.length;a--;)n[a]=o(i[a]);return n},this.setItem=function(i,o){return o=JSON.stringify(o),t.support[e]?window[e].setItem(i,o):t.cookie(s.cookiePrefix+i,o,s.cookieOptions)},this.removeItem=function(i){return t.support[e]?window[e].removeItem(i):t.cookie(s.cookiePrefix+i,null,t.extend(s.cookieOptions,{expires:-1}))},this.clear=function(){if(t.support[e])return window[e].clear();var i=new RegExp("^"+s.cookiePrefix,""),o=t.extend(s.cookieOptions,{expires:-1});document.cookie&&""!==document.cookie&&t.map(document.cookie.split(";"),function(e){i.test(e=t.trim(e))&&t.cookie(e.substr(0,e.indexOf("=")),null,o)})},"undefined"!=typeof o?"undefined"!=typeof n?null===n?this.removeItem(o):this.setItem(o,n):this.getItem(o):this},t[e].options=i});var e=function(t,e){this.storage="sessionStorage"===e?"sessionStorage":"localStorage",this.id=void 0!==t&&"string"==typeof t?t:"xxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)})};return e.prototype.load=function(e){return t[this.storage](this.id+"_"+e)},e.prototype.exist=function(e){return!!t[this.storage](this.id+"_"+e)},e.prototype.save=function(e,i){t[this.storage](this.id+"_"+e,i)},e.prototype.loadNode=function(e,i){return i.loadJSON(t[this.storage](this.id+"_"+e))},e.prototype.saveNode=function(e,i){t[this.storage](this.id+"_"+e,i.saveJSON())},void 0!==global.J2D&&(global.Storage=e),e}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.text",["jquery.j2d","j2d.base","j2d.scene"],e):e(t.J2D,BaseNode,Scene)}(global,function(t,e,i){"use strict";i.prototype.addTextNode||(i.prototype.addTextNode=function(t,e,i,n,s,a,r){return new o(this.parent,t,e,i,n,s,a,r)});var o=function(t,i,o,n,s,a,r,l){e.call(this,t,i,t.vector.vec2df(0,0)),this.nodeName="TextNode",this.mergeOptions({vAlign:"top",hAlign:"left",color:s?s:"black",family:a?a:"sans-serif",sizePx:n?n:20,box:{offset:{y:this.j2d.math.toInt(.26*this.sizePx)},size:{y:-this.j2d.math.toInt(.26*this.sizePx)}},lineWidth:r?r:0,colorL:l?l:"black",fullText:o,maxWidth:0,lines:o.split("\n")}),this.options.font=this.options.sizePx+"px "+this.options.family,this.j2d.scene.context.font=this.options.font;for(var h=0,d=this.options.lines.length;d>h;h+=1)this.options.maxWidth=this.options.maxWidth<this.j2d.scene.context.measureText(this.options.lines[h]).width?this.j2d.scene.context.measureText(this.options.lines[h]).width:this.options.maxWidth;this.options.size.x=this.options.maxWidth,this.options.size.y=this.options.lines.length*this.options.sizePx};return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype.setSize=function(t){this.options.sizePx=t,this.options.font=this.options.sizePx+"px "+this.options.family,this.j2d.scene.context.font=this.options.font,this.options.box.offset.y=this.j2d.math.toInt(.26*this.options.sizePx),this.options.box.size.y=-this.j2d.math.toInt(.26*this.options.sizePx);for(var e=0,i=this.options.lines.length;i>e;e+=1)this.options.maxWidth=this.options.maxWidth<this.j2d.scene.context.measureText(this.options.lines[e]).width?this.j2d.scene.context.measureText(this.options.lines[e]).width:this.options.maxWidth;this.options.size.x=this.options.maxWidth,this.options.size.y=this.options.lines.length*this.options.sizePx},o.prototype.getSize=function(){return this.options.sizePx},o.prototype.drawSimpleText=function(t,e,i,o){var n=this.layer.context;n.fillStyle=i?i:this.options.color,n.textAlign=this.options.hAlign,n.textBaseline=this.options.vAlign,n.font=this.options.font,n.lineWidth=this.options.lineWidth,n.strokeStyle=o?o:this.options.colorL;var s=t.split("\n");e=e?e:this.options.position;for(var a=0,r=s.length;r>a;a+=1)this.options.lineWidth&&n.strokeText(s[a],e.x,e.y+this.options.sizePx*a),n.fillText(s[a],e.x,e.y+this.options.sizePx*a);n.lineWidth=0,n.strokeStyle="black"},o.prototype.getText=function(){return this.options.fullText},o.prototype.setText=function(t){this.options.fullText=t,this.options.maxWidth=0,this.options.lines=t.split("\n"),this.j2d.scene.context.font=this.options.font,this.options.box.offset.y=this.j2d.math.toInt(.26*this.options.sizePx),this.options.box.size.y=-this.j2d.math.toInt(.26*this.options.sizePx);for(var e=0,i=this.options.lines.length;i>e;e+=1)this.options.maxWidth=this.options.maxWidth<this.j2d.scene.context.measureText(this.options.lines[e]).width?this.j2d.scene.context.measureText(this.options.lines[e]).width:this.options.maxWidth;this.options.size.x=this.options.maxWidth,this.options.size.y=this.options.lines.length*this.options.sizePx},o.prototype.draw=function(){var t=this.layer.context;if(this.options.visible&&this.isLookScene()){if(1!=this.options.alpha){var e=t.globalAlpha;t.globalAlpha=this.options.alpha}this.options.angle&&(t.save(),t.translate(this.getPosition().x-this.j2d.scene.viewport.x,this.getPosition().y-this.j2d.scene.viewport.y),t.rotate(this.j2d.math.rad(this.options.angle)),t.translate(-(this.getPosition().x-this.j2d.scene.viewport.x),-(this.getPosition().y-this.j2d.scene.viewport.y))),t.fillStyle=this.options.color,t.textAlign=this.options.hAlign,t.textBaseline=this.options.vAlign,t.font=this.options.font,t.lineWidth=this.options.lineWidth,t.strokeStyle=this.options.colorL;for(var i=0,o=this.options.lines.length;o>i;i+=1)this.options.lineWidth&&t.strokeText(this.options.lines[i],this.options.position.x,this.options.position.y+this.options.sizePx*i),t.fillText(this.options.lines[i],this.options.position.x,this.options.position.y+this.options.sizePx*i);t.lineWidth=0,t.strokeStyle="black",this.options.angle&&t.restore(),1!=this.options.alpha&&(t.globalAlpha=e)}},void 0!==global.J2D&&(global.TextNode=o),o}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.textures",["jquery.j2d"],e):e(t.J2D)}(global,function(t){"use strict";var e={loadImageMap:!1,createImageMap:!1,templates:{}};return e.createImageMap=function(e,i,o){var n={img:void 0,width:e,height:i};return n.img=document.createElement("canvas"),n.context=n.img.getContext("2d"),n.img.width=n.width,n.img.height=n.height,t.util.disableSmoothing(n.context),o(n.context),n.getAnimation=function(t,e,i,o,n){return{imageMap:this,sourceX:t,sourceY:e,sourceW:i,sourceH:o,frameCount:n-1}},n},e.loadImageMap=function(t,e){var i={img:void 0,width:0,height:0,loaded:!1};return i.img=document.createElement("img"),i.crossOrigin="anonymous",i.img.src=t,i.img.onload=function(){i.width=i.img.width,i.height=i.img.height,i.loaded=!0,e&&e()},i.getAnimation=function(t,e,i,o,n){return{imageMap:this,sourceX:t,sourceY:e,sourceW:i,sourceH:o,frameCount:n-1}},i},e.templates.ellipsis=function(t,e,i){},e.templates.fillRect=function(t,e,i){t.fillStyle=i,t.fillRect(0,0,e.x,e.y)},e.templates.strokeRect=function(t,e,i,o){t.strokeStyle=i,t.lineWidth=o,t.strokeRect(0,0,e.x,e.y)},e.templates.gradientL=function(t,e,i,o){var n=t.createLinearGradient(0,0,e.x,0),s=1/i.length;o||(n=t.createLinearGradient(0,0,0,e.y));for(var a=s/2,r=0;r<i.length;r+=1,a+=s)n.addColorStop(a,i[r]);t.fillStyle=n,t.fillRect(0,0,e.x,e.y)},e.templates.gradientR=function(t,e,i,o,n,s,a){for(var r=t.createRadialGradient(i.x,i.y,o,n.x,n.y,s),l=1/a.length,h=l/2,d=0;d<a.length;d+=1,h+=l)r.addColorStop(h,a[d]);t.fillStyle=r,t.fillRect(0,0,e.x,e.y)},t.prototype.getTextureManager=function(){return e},void 0!==global.J2D&&(global.TextureManager=e),e}),!function(t,e){"function"==typeof define&&define.amd?define("j2d.webGL2d",[],e):e()}(global,function(){"use strict";function t(t){return t>0&&0===(t-1&t)}function e(t){return this.clearStack(t)}var i={identity:[1,0,0,0,1,0,0,0,1],multiply:function(t,e){var i=t[0],o=t[1],n=t[2],s=t[3],a=t[4],r=t[5],l=t[6],h=t[7],d=t[8],c=e[0],p=e[1],u=e[2],f=e[3],y=e[4],g=e[5],m=e[6],v=e[7],x=e[8];e[0]=c*i+f*o+m*n,e[1]=p*i+y*o+v*n,e[2]=u*i+g*o+x*n,e[3]=c*s+f*a+m*r,e[4]=p*s+y*a+v*r,e[5]=u*s+g*a+x*r,e[6]=c*l+f*h+m*d,e[7]=p*l+y*h+v*d,e[8]=u*l+g*h+x*d},vec2_multiply:function(t,e){var i=[];return i[0]=e[0]*t[0]+e[3]*t[1]+e[6],i[1]=e[1]*t[0]+e[4]*t[1]+e[7],i},transpose:function(t){return[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]}},o=16;e.prototype.clearStack=function(t){this.m_stack=[],this.m_cache=[],this.c_stack=0,this.valid=0,this.result=null;for(var e=0;o>e;e++)this.m_stack[e]=this.getIdentity();void 0!==t?this.m_stack[0]=t:this.setIdentity()},e.prototype.setIdentity=function(){this.m_stack[this.c_stack]=this.getIdentity(),this.valid===this.c_stack&&this.c_stack&&this.valid--},e.prototype.getIdentity=function(){return[1,0,0,0,1,0,0,0,1]},e.prototype.getResult=function(){if(!this.c_stack)return this.m_stack[0];var t=i.identity;this.valid>this.c_stack-1&&(this.valid=this.c_stack-1);for(var e=this.valid;e<this.c_stack+1;e++)t=i.multiply(this.m_stack[e],t),this.m_cache[e]=t;return this.valid=this.c_stack-1,this.result=this.m_cache[this.c_stack],this.result},e.prototype.pushMatrix=function(){this.c_stack++,this.m_stack[this.c_stack]=this.getIdentity()},e.prototype.popMatrix=function(){0!==this.c_stack&&this.c_stack--};var n=e.prototype.getIdentity();e.prototype.translate=function(t,e){n[6]=t,n[7]=e,i.multiply(n,this.m_stack[this.c_stack])};var s=e.prototype.getIdentity();e.prototype.tr=function(t,e,o,n,a,r){s[0]=t,s[1]=e,s[3]=o,s[4]=n,s[6]=a,s[7]=r,i.multiply(s,this.m_stack[this.c_stack])};var a=e.prototype.getIdentity();e.prototype.scale=function(t,e){a[0]=t,a[4]=e,i.multiply(a,this.m_stack[this.c_stack])};var r=e.prototype.getIdentity();e.prototype.rotate=function(t){var e,o;e=Math.sin(-t),o=Math.cos(-t),r[0]=o,r[3]=e,r[1]=-e,r[4]=o,i.multiply(r,this.m_stack[this.c_stack])};var l=global.WebGL2D=function(t,i){this.canvas=t,this.options=i||{},this.gl=void 0,this.fs=void 0,this.vs=void 0,this.shaderProgram=void 0,this.transform=new e,this.shaderPool=[],this.maxTextureSize=void 0,t.gl2d=this,t.$getContext=t.getContext,t.getContext=function(e){return function(i){if(!e.options.force&&"WebGL-2d"!==i||0===t.width||0===t.height)return e.canvas.$getContext(i);if(e.gl)return e.gl;var o=e.gl=e.canvas.$getContext("experimental-webgl");return"undefined"==typeof o||null===o?e.canvas.$getContext("2d"):(e.initShaders(),e.initBuffers(),e.initCanvas2DAPI(),o.enable(o.BLEND),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA),e.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),o)}}(this),this.postInit()};l.enable=function(t,e){return t.gl2d||new l(t,e)};var h={texture:1,crop:2,path:4};l.prototype.getFragmentShaderSource=function(t){var e=["#ifdef GL_ES","precision highp float;","#endif","#define hasTexture "+(t&h.texture?"1":"0"),"#define hasCrop "+(t&h.crop?"1":"0"),"varying vec4 vColor;","#if hasTexture","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","#if hasCrop","uniform vec4 uCropSource;","#endif","#endif","void main(void) {","#if hasTexture","#if hasCrop","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x * uCropSource.z, vTextureCoord.y * uCropSource.w) + uCropSource.xy);","#else","gl_FragColor = texture2D(uSampler, vTextureCoord);","#endif","#else","gl_FragColor = vColor;","#endif","}"].join("\n");return e},l.prototype.getVertexShaderSource=function(t,e){t=t||1;var i=["#define hasTexture "+(e&h.texture?"1":"0"),"attribute vec4 aVertexPosition;","#if hasTexture","varying vec2 vTextureCoord;","#endif","uniform vec4 uColor;","uniform mat3 uTransforms["+t+"];","varying vec4 vColor;","uniform mat4 pMatrix;","mat3 crunchStack(void) {","mat3 result = uTransforms[0];","for (int i = 1; i < "+t+"; ++i) {","result = uTransforms[i] * result;","}","return result;","}","void main(void) {","vec3 position = crunchStack() * vec3(aVertexPosition.x, aVertexPosition.y, 1.0);","gl_Position = pMatrix * vec4(position, 1.0);","vColor = uColor;","#if hasTexture","vTextureCoord = aVertexPosition.zw;","#endif","}"].join("\n");return i},l.prototype.initShaders=function(t,e){var i=this.gl;t=t||1,e=e||0;var o=this.shaderPool[t];if(o||(o=this.shaderPool[t]=[]),o=o[e])i.useProgram(o),this.shaderProgram=o;else{var n=this.fs=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(this.fs,this.getFragmentShaderSource(e)),i.compileShader(this.fs),!i.getShaderParameter(this.fs,i.COMPILE_STATUS))throw"fragment shader error: "+i.getShaderInfoLog(this.fs);var s=this.vs=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(this.vs,this.getVertexShaderSource(t,e)),i.compileShader(this.vs),!i.getShaderParameter(this.vs,i.COMPILE_STATUS))throw"vertex shader error: "+i.getShaderInfoLog(this.vs);var a=this.shaderProgram=i.createProgram();if(a.stackDepth=t,i.attachShader(a,n),i.attachShader(a,s),i.linkProgram(a),!i.getProgramParameter(a,i.LINK_STATUS))throw"Could not initialise shaders.";i.useProgram(a),a.vertexPositionAttribute=i.getAttribLocation(a,"aVertexPosition"),i.enableVertexAttribArray(a.vertexPositionAttribute),a.uColor=i.getUniformLocation(a,"uColor"),a.uSampler=i.getUniformLocation(a,"uSampler"),a.uCropSource=i.getUniformLocation(a,"uCropSource"),a.pMatrix=i.getUniformLocation(a,"pMatrix"),a.uTransforms=[];for(var r=0;t>r;++r)a.uTransforms[r]=i.getUniformLocation(a,"uTransforms["+r+"]");this.shaderPool[t][e]=a}return c[0]=2/this.canvas.width,c[5]=-2/this.canvas.height,i.uniformMatrix4fv(this.shaderProgram.pMatrix,!1,c),i.viewport(0,0,this.canvas.width,this.canvas.height),this.shaderProgram};var d=new Float32Array([0,0,0,0,0,1,0,1,1,1,1,1,1,0,1,0]),c=new Float32Array(16);return c[10]=1,c[11]=1,c[12]=-1,c[13]=1,l.prototype.initBuffers=function(){var t=this.gl;t.rectVertexPositionBuffer=t.createBuffer(),t.rectVertexColorBuffer=t.createBuffer(),t.pathVertexPositionBuffer=t.createBuffer(),t.pathVertexColorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,t.rectVertexPositionBuffer),t.bufferData(t.ARRAY_BUFFER,d,t.STATIC_DRAW)},l.instances=[],l.prototype.postInit=function(){l.instances.push(this)},l.prototype.initCanvas2DAPI=function(){function e(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}function i(t,i,o,n){var s,a,r,l,h;return t=(t%360+360)%360/360,i=i>100?1:i/100,i=0>i?0:i,o=o>100?1:o/100,o=0>o?0:o,0==i?s=a=r=o:(h=.5>o?o*(1+i):o+i-o*i,l=2*o-h,s=e(l,h,t+1/3),a=e(l,h,t),r=e(l,h,t-1/3)),[s,a,r,n]}function o(t){var e,n,s,a,r,l,h=[];if(e=v.exec(t)){if(a=e[1],r=parseFloat(e[8]),a&&isNaN(r)||!a&&!isNaN(r))return!1;l=e[3];for(var d=2;8>d;d+=2){if(n=e[d],s=e[d+1],s!==l)return!1;s?(n=n>100?1:n/100,n=0>n?0:n):(n=n>255?1:n/255,n=0>n?0:n),h.push(n)}h.push(a?r:1)}else if(e=b.exec(t))a=e[1],r=parseFloat(e[5]),h=i(e[2],e[3],e[4],parseFloat(a&&r?r:1));else if(e=w.exec(t)){var c=parseInt(e[1],16);h=[((16711680&c)>>16)/255,((65280&c)>>8)/255,(255&c)/255,1]}else if(e=k.exec(t)){var p="#"+[e[1],e[1],e[2],e[2],e[3],e[3]].join("");h=o(p)}else if(t.toLowerCase()in P)h=o(P[t.toLowerCase()]);else{if("transparent"!==t.toLowerCase())return!1;h=[0,0,0,0]}return h}function n(t){return"rgba("+255*t[0]+", "+255*t[1]+", "+255*t[2]+", "+parseFloat(t[3])+")"}function s(){var t={fillStyle:[S.fillStyle[0],S.fillStyle[1],S.fillStyle[2],S.fillStyle[3]],strokeStyle:[S.strokeStyle[0],S.strokeStyle[1],S.strokeStyle[2],S.strokeStyle[3]],globalAlpha:S.globalAlpha,globalCompositeOperation:S.globalCompositeOperation,lineCap:S.lineCap,lineJoin:S.lineJoin,lineWidth:S.lineWidth,miterLimit:S.miterLimit,shadowColor:S.shadowColor,shadowBlur:S.shadowBlur,shadowOffsetX:S.shadowOffsetX,shadowOffsetY:S.shadowOffsetY,textAlign:S.textAlign,font:S.font,textBaseline:S.textBaseline,imageSmoothingEnabled:S.imageSmoothingEnabled};_.push(t)}function a(){_.length&&(S=_.pop())}function r(t){for(var e=u.transform.m_stack,i=0,o=u.transform.c_stack+1;o>i;++i)f.uniformMatrix3fv(t.uTransforms[i],!1,e[o-1-i])}function l(t,e){this.closed=!1,this.verts=[t,e,0,0]}function d(t){var e=u.transform,i=u.initShaders(e.c_stack+2,0),o=A[t],n=o.verts;f.bindBuffer(f.ARRAY_BUFFER,f.pathVertexPositionBuffer),f.bufferData(f.ARRAY_BUFFER,new Float32Array(n),f.STATIC_DRAW),f.vertexAttribPointer(i.vertexPositionAttribute,4,f.FLOAT,!1,0,0),e.pushMatrix(),r(i),f.uniform4f(i.uColor,S.fillStyle[0],S.fillStyle[1],S.fillStyle[2],S.fillStyle[3]),f.drawArrays(f.TRIANGLE_FAN,0,n.length/4),e.popMatrix()}function c(t){var e=u.transform,i=u.initShaders(e.c_stack+2,0),o=A[t],n=o.verts;f.bindBuffer(f.ARRAY_BUFFER,f.pathVertexPositionBuffer),f.bufferData(f.ARRAY_BUFFER,new Float32Array(n),f.STATIC_DRAW),f.vertexAttribPointer(i.vertexPositionAttribute,4,f.FLOAT,!1,0,0),e.pushMatrix(),r(i),f.uniform4f(i.uColor,S.strokeStyle[0],S.strokeStyle[1],S.strokeStyle[2],S.strokeStyle[3]),o.closed?f.drawArrays(f.LINE_LOOP,0,n.length/4):f.drawArrays(f.LINE_STRIP,0,n.length/4),e.popMatrix()}function p(e){if(this.obj=f.createTexture(),this.index=T.push(this),j.push(e),e.width>u.maxTextureSize||e.height>u.maxTextureSize){var i=document.createElement("canvas");i.width=e.width>u.maxTextureSize?u.maxTextureSize:e.width,i.height=e.height>u.maxTextureSize?u.maxTextureSize:e.height;var o=i.getContext("2d");o.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),e=i}var n=f.LINEAR,s=f.LINEAR_MIPMAP_LINEAR;
S.imageSmoothingEnabled||(n=f.NEAREST,s=f.LINEAR_MIPMAP_NEAREST),f.bindTexture(f.TEXTURE_2D,this.obj),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),t(e.width)&&t(e.height)?(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,s),f.generateMipmap(f.TEXTURE_2D)):f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,n),f.bindTexture(f.TEXTURE_2D,null)}var u=this,f=this.gl,g=document.createElement("canvas");g.width=u.canvas.width,g.height=u.canvas.height;var m=g.getContext("2d"),v=/^rgb(a)?\(\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,?\s*(-?[\d\.]+)?\s*\)$/,b=/^hsl(a)?\(\s*(-?[\d\.]+)\s*,\s*(-?[\d\.]+)%\s*,\s*(-?[\d\.]+)%\s*,?\s*(-?[\d\.]+)?\s*\)$/,w=/^#([0-9A-Fa-f]{6})$/,k=/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/,P={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},S={},_=[];S.fillStyle=[0,0,0,1],Object.defineProperty(f,"fillStyle",{get:function(){return n(S.fillStyle)},set:function(t){S.fillStyle=o(t)||S.fillStyle}}),S.strokeStyle=[0,0,0,1],Object.defineProperty(f,"strokeStyle",{get:function(){return n(S.strokeStyle)},set:function(t){S.strokeStyle=o(t)||drawStyle.strokeStyle}}),f.$lineWidth=f.lineWidth,S.lineWidth=1,Object.defineProperty(f,"lineWidth",{get:function(){return S.lineWidth},set:function(t){t>0&&(f.$lineWidth(t),S.lineWidth=t)}}),S.lineCap="butt",Object.defineProperty(f,"lineCap",{get:function(){return S.lineCap},set:function(t){S.lineCap=t}}),S.lineJoin="miter",Object.defineProperty(f,"lineJoin",{get:function(){return S.lineJoin},set:function(t){S.lineJoin=t}}),S.miterLimit=10,Object.defineProperty(f,"miterLimit",{get:function(){return S.miterLimit},set:function(t){S.miterLimit=t}}),S.shadowOffsetX=0,Object.defineProperty(f,"shadowOffsetX",{get:function(){return S.shadowOffsetX},set:function(t){S.shadowOffsetX=t}}),S.shadowOffsetY=0,Object.defineProperty(f,"shadowOffsetY",{get:function(){return S.shadowOffsetY},set:function(t){S.shadowOffsetY=t}}),S.shadowBlur=0,Object.defineProperty(f,"shadowBlur",{get:function(){return S.shadowBlur},set:function(t){S.shadowBlur=t}}),S.shadowColor="rgba(0, 0, 0, 0.0)",Object.defineProperty(f,"shadowColor",{get:function(){return S.shadowColor},set:function(t){S.shadowColor=t}}),S.font="10px sans-serif",Object.defineProperty(f,"font",{get:function(){return S.font},set:function(t){m.font=t,S.font=t}}),S.textAlign="start",Object.defineProperty(f,"textAlign",{get:function(){return S.textAlign},set:function(t){S.textAlign=t}}),S.textBaseline="alphabetic",Object.defineProperty(f,"textBaseline",{get:function(){return S.textBaseline},set:function(t){S.textBaseline=t}}),S.globalAlpha=1,Object.defineProperty(f,"globalAlpha",{get:function(){return S.globalAlpha},set:function(t){S.globalAlpha=t}}),S.imageSmoothingEnabled=!0,Object.defineProperty(f,"imageSmoothingEnabled",{get:function(){return S.imageSmoothingEnabled},set:function(t){S.imageSmoothingEnabled=!!t}}),S.globalCompositeOperation="source-over",Object.defineProperty(f,"globalCompositeOperation",{get:function(){return S.globalCompositeOperation},set:function(t){S.globalCompositeOperation=t}}),f.fillText=function(t,e,i){m.clearRect(0,0,u.canvas.width,u.canvas.height),m.fillStyle=f.fillStyle,m.fillText(t,e,i),f.drawImage(g,0,0)},f.strokeText=function(){},f.measureText=function(){return 1};var M=document.createElement("canvas"),E=M.getContext("2d");f.save=function(){u.transform.pushMatrix(),s()},f.restore=function(){u.transform.popMatrix(),a()},f.translate=function(t,e){u.transform.translate(t,e)},f.rotate=function(t){u.transform.rotate(t)},f.scale=function(t,e){u.transform.scale(t,e)},f.createImageData=function(t,e){return E.createImageData(t,e)},f.getImageData=function(t,e,i,o){var n=E.createImageData(i,o),s=new Uint8Array(i*o*4);f.readPixels(t,e,i,o,f.RGBA,f.UNSIGNED_BYTE,s);for(var a=4*i,r=o,l=0,h=r/2;h>l;++l)for(var d=0,c=a;c>d;++d){var p=l*a+d,u=(r-l-1)*a+d;n.data[p]=s[u],n.data[u]=s[p]}return n},f.putImageData=function(t,e,i){f.drawImage(t,e,i)},f.transform=function(t,e,i,o,n,s){u.transform.tr(t,e,i,o,n,s)},f.setTransform=function(t,e,i,o,n,s){u.transform.setIdentity(),f.transform.apply(this,arguments)},f.fillRect=function(t,e,i,o){var n=u.transform,s=u.initShaders(n.c_stack+2,0);f.bindBuffer(f.ARRAY_BUFFER,f.rectVertexPositionBuffer),f.vertexAttribPointer(s.vertexPositionAttribute,4,f.FLOAT,!1,0,0),n.pushMatrix(),n.translate(t,e),n.scale(i,o),r(s),f.uniform4f(s.uColor,S.fillStyle[0],S.fillStyle[1],S.fillStyle[2],S.fillStyle[3]),f.drawArrays(f.TRIANGLE_FAN,0,4),n.popMatrix()},f.strokeRect=function(t,e,i,o){var n=u.transform,s=u.initShaders(n.c_stack+2,0);f.bindBuffer(f.ARRAY_BUFFER,f.rectVertexPositionBuffer),f.vertexAttribPointer(s.vertexPositionAttribute,4,f.FLOAT,!1,0,0),n.pushMatrix(),n.translate(t,e),n.scale(i,o),r(s),f.uniform4f(s.uColor,S.strokeStyle[0],S.strokeStyle[1],S.strokeStyle[2],S.strokeStyle[3]),f.drawArrays(f.LINE_LOOP,0,4),n.popMatrix()},f.clearRect=function(t,e,i,o){};var A=[];f.beginPath=function(){A.length=0},f.closePath=function(){if(A.length){var t=A[A.length-1],e=t.verts[0],i=t.verts[1];t.closed=!0;var o=new l(e,i);A.push(o)}},f.moveTo=function(t,e){A.push(new l(t,e))},f.lineTo=function(t,e){A.length?A[A.length-1].verts.push(t,e,0,0):f.moveTo(t,e)},f.quadraticApproximateCount=50,f.quadraticCurveTo=function(t,e,i,o){if(A.length)for(var n,s,a,r,l=A[A.length-1].verts,h=l[l.length-4],d=l[l.length-3],c=0;c<f.quadraticApproximateCount;c++)n=c/f.quadraticApproximateCount,s=1-n,a=s*s*h+2*s*n*t+n*n*i,r=s*s*d+2*s*n*e+n*n*o,l.push(a,r,0,0);else f.moveTo(i,o)},f.bezierApproximateCount=50,f.bezierCurveTo=function(t,e,i,o,n,s){if(A.length)for(var a,r,l,h,d=A[A.length-1].verts,c=d[d.length-4],p=d[d.length-3],u=0;u<f.bezierApproximateCount;u++)a=u/f.bezierApproximateCount,r=1-a,l=r*r*r*c+3*r*r*a*t+3*r*a*a*i+a*a*a*n,h=r*r*r*p+3*r*r*a*e+3*r*a*a*o+a*a*a*s,d.push(l,h,0,0);else f.moveTo(n,s)},f.arcTo=function(){A.length||f.moveTo(x,y)},f.rect=function(t,e,i,o){f.moveTo(t,e),f.lineTo(t+i,e),f.lineTo(t+i,e+o),f.lineTo(t,e+o),f.closePath()},f.arcApproximateCount=100,f.arc=function(t,e,i,o,n,s){if(A.length){var a=A[A.length-1].verts,r=t+i*Math.cos(o),l=e+i*Math.sin(o);for(a.push(r,l,0,0);o>2*Math.PI;)o-=2*Math.PI;for(;n>2*Math.PI;)n-=2*Math.PI;for(;o<2*-Math.PI;)o+=2*Math.PI;for(;n<2*-Math.PI;)n+=2*Math.PI;if(o==n)return;var h,d=1/f.arcApproximateCount,c=f.arcApproximateCount;s&&(n-=2*Math.PI,d=-d);for(var p=o;p>n&&s||n>p&&!s;p+=d)h!=(h=(p*c|0)/c)&&(r=t+i*Math.cos(h),l=e+i*Math.sin(h),a.push(r,l,0,0))}else f.moveTo(r,l)},f.fill=function(){for(var t=0;t<A.length;t++)d(t)},f.stroke=function(){for(var t=0;t<A.length;t++)c(t)},f.clip=function(){},f.isPointInPath=function(){},f.drawFocusRing=function(){};var j=[],T=[];f.drawImage=function(t,e,i,o,n,s,a,l,d){var c=u.transform;c.pushMatrix();var y=h.texture,g=!1;3===arguments.length?(c.translate(e,i),c.scale(t.width,t.height)):5===arguments.length?(c.translate(e,i),c.scale(o,n)):9===arguments.length&&(c.translate(s,a),c.scale(l,d),y|=h.crop,g=!0);var m,v=u.initShaders(c.c_stack+1,y),x=j.indexOf(t);m=-1!==x?T[x]:new p(t),g&&f.uniform4f(v.uCropSource,e/t.width,i/t.height,o/t.width,n/t.height),f.bindBuffer(f.ARRAY_BUFFER,f.rectVertexPositionBuffer),f.vertexAttribPointer(v.vertexPositionAttribute,4,f.FLOAT,!1,0,0),f.bindTexture(f.TEXTURE_2D,m.obj),f.activeTexture(f.TEXTURE0),f.uniform1i(v.uSampler,0),r(v),f.drawArrays(f.TRIANGLE_FAN,0,4),c.popMatrix()},Object.defineProperty(f,"isWebGL",{configurable:!1,enumerable:!0,writable:!1,value:!0})},l});
//# sourceMappingURL=jquery.j2d.all.min.map
