{"version":3,"sources":["jquery.j2d.js"],"names":["root","factory","define","amd","jQuery","WebGL2D","global","Scene","LayersManager","J2D","$","defaults","vector","math","dom","now","dt","io","undefined","pause","frameLimit","sceneStartTime","sceneSkipTime","engine","ready","window","webGL","element","options","j2d","this","layers","scene","gameEngine","Date","setTimeout","update","lastTime","clear","nextJ2dsGameStep","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","prototype","getInfo","name","version","site","info","author","getIO","IOHandler","handler","setWindow","customWindow","start","html","addClass","resume","removeClass","focus","isPlay","enableWebGL","setActiveEngine","getDevice","device","width","parseInt","document","screen","height","resize","innerWidth","innerHeight","vec2df","x","y","vec2di","toInt","number","randomColor","min","max","opacity","random","omitZero","Math","floor","rad","PI","getLayers","getScene","initJQueryPlugin","fn","extend","filter","each","guid","replace","c","r","v","toString","attr","id","tabIndex","data","$array","push","length","isFullScreen","on","e","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement","resizeToFullPage"],"mappings":"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","file":"jquery.j2d.min","sourcesContent":["/**\r\n * J2D (jQuery plugin of the fork j2ds)\r\n *\r\n * @authors Skaner, likerRr, DeVinterX\r\n * @license zlib\r\n * @version 0.1.5a\r\n * @see https://github.com/SkanerSoft/J2ds/commit/501b8993fc41960794572dc481a5f2fe492da349\r\n */\r\n!function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        define('jquery.j2d', ['jquery', 'j2d.webGL2d', 'j2d.scene', 'j2d.layers'], factory);\r\n    } else {\r\n        factory(root.jQuery, root.WebGL2D, null, null);\r\n    }\r\n}(global, function (jQuery, WebGL2D, Scene, LayersManager) {\r\n    var $ = jQuery, J2D;\r\n    'use strict';\r\n\r\n    var defaults = {\r\n        vector: {},\r\n        math: {},\r\n        dom: {},\r\n        now: 0,\r\n        dt: 0,\r\n        io: undefined,\r\n        pause: false,\r\n        frameLimit: 60,\r\n        sceneStartTime: 0,\r\n        sceneSkipTime: 0,\r\n        engine: false,\r\n        ready: false,\r\n        window: window,\r\n\r\n        webGL: false\r\n    };\r\n\r\n    J2D = function J2D(element, options) {\r\n        var j2d = this;\r\n\r\n        j2d.element = element;\r\n        j2d.options = options;\r\n\r\n        j2d.layers = new LayersManager(j2d, WebGL2D);\r\n        j2d.scene = new Scene(j2d);\r\n\r\n        j2d.gameEngine = function () {\r\n            j2d.options.now = Date.now();\r\n\r\n            setTimeout(function () {\r\n                if (!j2d.options.pause) {\r\n                    if (j2d.options.io) {\r\n                        j2d.options.io.update();\r\n                    }\r\n                    j2d.options.dt = (j2d.options.now - j2d.options.lastTime) / 100.0;\r\n                    if (j2d.options.dt > j2d.options.sceneSkipTime) {\r\n                        j2d.options.dt = 0;\r\n                    }\r\n                    j2d.options.sceneStartTime = j2d.options.now;\r\n                    setTimeout(j2d.options.engine, 0);\r\n                    j2d.options.lastTime = j2d.options.now;\r\n                    if (j2d.options.io) {\r\n                        j2d.options.io.clear();\r\n                    }\r\n                }\r\n                nextJ2dsGameStep(j2d.gameEngine);\r\n            }, (j2d.options.frameLimit < 60 ? j2d.options.sceneSkipTime : 0));\r\n        };\r\n\r\n        var nextJ2dsGameStep = (function () {\r\n            return window.requestAnimationFrame ||\r\n                window.webkitRequestAnimationFrame ||\r\n                window.mozRequestAnimationFrame ||\r\n                window.oRequestAnimationFrame ||\r\n                window.msRequestAnimationFrame ||\r\n                function (callback) {\r\n                    window.setTimeout(callback, 1000 / j2d.options.frameLimit);\r\n                };\r\n        })();\r\n    };\r\n\r\n    /** +links getters **/\r\n    J2D.prototype.getInfo = function () {\r\n        return {\r\n            'name': 'jquery.j2d',\r\n            'version': '0.1.5',\r\n            'site': 'https://github.com/fsggs/jquery.j2d',\r\n            'info': 'jquery.j2d - jQuery plugin of the fork j2ds.',\r\n            'author': 'DeVinterX, Skaner(j2ds)'\r\n        };\r\n    };\r\n\r\n    J2D.prototype.getIO = function () {\r\n        return this.options.io;\r\n    };\r\n    /** -links getters **/\r\n\r\n    /** +GameEngine **/\r\n\r\n    J2D.prototype.IOHandler = function (handler) {\r\n        return this.options.io = handler;\r\n    };\r\n\r\n    J2D.prototype.setWindow = function (customWindow) {\r\n        this.window = customWindow ? customWindow : window;\r\n    };\r\n\r\n    // старт игры\r\n    J2D.prototype.start = function (engine, frameLimit) {\r\n        var j2d = this;\r\n\r\n        j2d.options.engine = engine || function () {\r\n            j2d.element.html('Пожалуйста, инициализируйте игровую функцию!');\r\n        };\r\n        j2d.options.frameLimit = frameLimit || 60;\r\n        j2d.options.sceneSkipTime = 1000.0 / j2d.options.frameLimit;\r\n        j2d.options.lastTime = Date.now();\r\n        j2d.options.dt = 0;\r\n        j2d.options.sceneStartTime = j2d.options.lastTime;\r\n\r\n        j2d.gameEngine();\r\n    };\r\n\r\n    J2D.prototype.pause = function () {\r\n        this.options.pause = true;\r\n        this.element.addClass('pause');\r\n    };\r\n\r\n    J2D.prototype.resume = function () {\r\n        this.options.pause = false;\r\n        this.element.removeClass('pause').focus();\r\n    };\r\n\r\n    J2D.prototype.isPlay = function () {\r\n        return !this.options.pause;\r\n    };\r\n\r\n    J2D.prototype.enableWebGL = function () {\r\n        this.options.webGL = true;\r\n    };\r\n\r\n    J2D.prototype.setActiveEngine = function (engine) {\r\n        this.options.engine = engine;\r\n    };\r\n    /** -GameEngine **/\r\n\r\n    /** Device **/\r\n\r\n    J2D.prototype.getDevice = function () {\r\n        return this.device;\r\n    };\r\n\r\n    J2D.prototype.device = {\r\n        width: parseInt($(document).width()) < parseInt(screen.width) ? parseInt($(document).width()) : parseInt(screen.width),\r\n        height: parseInt($(document).height()) < parseInt(screen.height) ? parseInt($(document).height()) : parseInt(screen.height),\r\n\r\n        resize: function () {\r\n            this.width = window.innerWidth;\r\n            this.height = window.innerHeight;\r\n        }\r\n    };\r\n\r\n    /** Vector **/\r\n    J2D.prototype.vector = {\r\n        vec2df: function (x, y) {\r\n            return {x: x, y: y};\r\n        },\r\n        vec2di: function (x, y) {\r\n            return {x: (x >> 0), y: (y >> 0)};\r\n        }\r\n    };\r\n\r\n    /** Math **/\r\n    J2D.prototype.math = {\r\n        toInt: function (number) {\r\n            return number >> 0;\r\n        },\r\n        randomColor: function (min, max, opacity) {\r\n            return 'rgba(' + this.random(min, max) + ', ' + this.random(min, max) + ', ' + this.random(min, max) + ', ' + opacity + ')';\r\n        },\r\n        random: function (min, max, omitZero) {\r\n            var random = (Math.floor(Math.random() * (max - min + 1) + min));\r\n            return (omitZero && random == 0) ? this.random(min, max, omitZero) : random;\r\n        },\r\n        rad: function (number) {\r\n            return number * (Math.PI / 180);\r\n        }\r\n    };\r\n\r\n    /** +Layers **/\r\n    J2D.prototype.getLayers = function () {\r\n        return this.layers;\r\n    };\r\n    /** -Layers **/\r\n\r\n    /** +Scene **/\r\n    J2D.prototype.getScene = function () {\r\n        return this.scene;\r\n    };\r\n    /** -Scene **/\r\n\r\n    J2D.initJQueryPlugin = function () {\r\n        $.fn.j2d = function (options) {\r\n            options = $.extend(true, {}, defaults, options);\r\n\r\n            this.filter('div.canvas:not([guid])').each(function () {\r\n                var guid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n                    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n                    return v.toString(16);\r\n                });\r\n                $(this).attr('guid', guid);\r\n                var id = $(this).attr('id');\r\n                if (typeof id === typeof undefined || id === false) {\r\n                    $(this).attr('id', guid);\r\n                }\r\n                var tabIndex = $(this).attr('tabindex');\r\n                if (typeof tabIndex === typeof undefined || tabIndex === false) {\r\n                    $(this).attr('tabindex', '-1');\r\n                }\r\n                $(this).data('j2d', new J2D($(this), options)).addClass('j2d');\r\n                $(this).focus();\r\n            });\r\n\r\n            var $array = [];\r\n            this.filter('div.canvas[guid]').each(function () {\r\n                $array.push($(this).data('j2d'));\r\n            });\r\n\r\n            if (1 === $array.length) {\r\n                return $(this).data('j2d');\r\n            } else {\r\n                return $array;\r\n            }\r\n        };\r\n\r\n        var isFullScreen = false;\r\n        $(document).on('fullscreenchange webkitfullscreenchange mozfullscreenchange msfullscreenchange', 'div.canvas[guid]', function (e) {\r\n            isFullScreen = !!(document.webkitFullscreenElement\r\n            || document.webkitCurrentFullScreenElement\r\n            || document.mozFullScreenElement\r\n            || document.msFullscreenElement\r\n            );\r\n\r\n            if (!isFullScreen) {\r\n                $(this).data('j2d').scene.resizeToFullPage(isFullScreen);\r\n            }\r\n        });\r\n\r\n        $(document).on('click', 'div.canvas[guid].pause', function () {\r\n            $(this).data('j2d').resume();\r\n        });\r\n\r\n        $(window).on('focus', function () {\r\n            $('div.canvas[guid]').each(function () {\r\n                $(this).data('j2d').resume();\r\n            });\r\n        }).on('blur', function () {\r\n            $('div.canvas[guid]').each(function () {\r\n                $(this).data('j2d').pause();\r\n            });\r\n        });\r\n\r\n        $(window).on('resize', function () {\r\n            $('div.canvas[guid]').each(function () {\r\n                $(this).data('j2d').device.resize();\r\n                if (isFullScreen) {\r\n                    $(this).data('j2d').scene.resizeToFullPage(isFullScreen);\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    return J2D;\r\n});\r\n"],"sourceRoot":"/source/"}