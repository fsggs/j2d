{"version":3,"sources":["jquery.j2d.js"],"names":["root","factory","define","amd","jQuery","global","J2D","$","defaults","vector","math","dom","now","dt","io","undefined","pause","frameLimit","sceneStartTime","sceneSkipTime","engine","ready","window","element","options","j2d","this","init","gameEngine","Date","setTimeout","update","lastTime","clear","nextJ2dsGameStep","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","prototype","getInfo","name","version","site","info","author","getIO","layers","parent","scene","IOHandler","handler","setWindow","customWindow","start","html","setActiveEngine","getDevice","device","width","parseInt","document","screen","height","resize","innerWidth","innerHeight","vec2df","x","y","vec2di","toInt","number","randomColor","min","max","opacity","random","omitZero","Math","floor","rad","PI","getLayers","list","getLayer","id","add","zIndex","layer","layerName","canvas","createElement","context","getContext","shadowColor","style","position","left","top","angle","visible","onContext","fill","color","fillStyle","fillRect","setOpacity","getOpacity","setVisible","display","isVisible","setIndex","clearRect","clearNode","node","isLookScene","pos","viewport","size","append","getScene","enableFullscreen","async","data","call","setGameState","trigger","resizeToFullScreen","fullscreen","tmpCanvas","tmpContext","originalWidth","originalHeight","i","drawImage","scaleToFullScreen","hasOwnProperty","toggleFullScreen","setViewPosition","ceil","setViewFocus","offset","getPosition","viewMove","heigth","cancelClear","initJQueryPlugin","fn","extend","filter","each","addClass","attr","replace","c","r","v","toString","length","on","removeClass"],"mappings":"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","file":"jquery.j2d.min","sourcesContent":["/**\r\n * J2D (jQuery plugin of the fork j2ds)\r\n *\r\n * @authors Skaner, likerRr, DeVinterX\r\n * @license zlib\r\n * @version 0.1.5a\r\n * @see https://github.com/SkanerSoft/J2ds/commit/501b8993fc41960794572dc481a5f2fe492da349\r\n */\r\n!function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        define('jquery.j2d', ['jquery'], factory);\r\n    } else {\r\n        factory(root.jQuery);\r\n    }\r\n}(global, function (jQuery) {\r\n    var $ = jQuery, J2D;\r\n    'use strict';\r\n\r\n    var defaults = {\r\n        vector: {},\r\n        math: {},\r\n        dom: {},\r\n        now: 0,\r\n        dt: 0,\r\n        io: undefined,\r\n        pause: false,\r\n        frameLimit: 60,\r\n        sceneStartTime: 0,\r\n        sceneSkipTime: 0,\r\n        engine: false,\r\n        ready: false,\r\n        window: window\r\n    };\r\n\r\n    J2D = function J2D(element, options) {\r\n        var j2d = this;\r\n\r\n        j2d.element = element;\r\n        j2d.options = options;\r\n\r\n        j2d.init();\r\n\r\n        j2d.gameEngine = function () {\r\n            j2d.options.now = Date.now();\r\n\r\n            setTimeout(function () {\r\n                if (!j2d.options.pause) {\r\n                    if (j2d.options.io) {\r\n                        j2d.options.io.update();\r\n                    }\r\n                    j2d.options.dt = (j2d.options.now - j2d.options.lastTime) / 100.0;\r\n                    if (j2d.options.dt > j2d.options.sceneSkipTime) {\r\n                        j2d.options.dt = 0;\r\n                    }\r\n                    j2d.options.sceneStartTime = j2d.options.now;\r\n                    setTimeout(j2d.options.engine, 0);\r\n                    j2d.options.lastTime = j2d.options.now;\r\n                    if (j2d.options.io) {\r\n                        j2d.options.io.clear();\r\n                    }\r\n                }\r\n                nextJ2dsGameStep(j2d.gameEngine);\r\n            }, (j2d.options.frameLimit < 60 ? j2d.options.sceneSkipTime : 0));\r\n        };\r\n\r\n        var nextJ2dsGameStep = (function () {\r\n            return window.requestAnimationFrame ||\r\n                window.webkitRequestAnimationFrame ||\r\n                window.mozRequestAnimationFrame ||\r\n                window.oRequestAnimationFrame ||\r\n                window.msRequestAnimationFrame ||\r\n                function (callback) {\r\n                    window.setTimeout(callback, 1000 / j2d.options.frameLimit);\r\n                };\r\n        })();\r\n    };\r\n\r\n    /** +links getters **/\r\n    J2D.prototype.getInfo = function () {\r\n        return {\r\n            'name': 'jquery.j2d',\r\n            'version': '0.1.5',\r\n            'site': 'https://github.com/fsggs/jquery.j2d',\r\n            'info': 'jquery.j2d - jQuery plugin of the fork j2ds.',\r\n            'author': 'DeVinterX, Skaner(j2ds)'\r\n        };\r\n    };\r\n\r\n    J2D.prototype.getIO = function () {\r\n        return this.options.io;\r\n    };\r\n    /** -links getters **/\r\n\r\n    /** +GameEngine **/\r\n    J2D.prototype.init = function () {\r\n        if (this.layers) {\r\n            this.layers.parent = this;\r\n        }\r\n        if (this.scene) {\r\n            this.scene.parent = this;\r\n        }\r\n        delete this.init;\r\n    };\r\n\r\n    J2D.prototype.IOHandler = function (handler) {\r\n        return this.options.io = handler;\r\n    };\r\n\r\n    J2D.prototype.setWindow = function (customWindow) {\r\n        this.window = customWindow ? customWindow : window;\r\n    };\r\n\r\n    // старт игры\r\n    J2D.prototype.start = function (engine, frameLimit) {\r\n        var j2d = this;\r\n\r\n        j2d.options.engine = engine || function () {\r\n            j2d.element.html('Пожалуйста, инициализируйте игровую функцию!');\r\n        };\r\n        j2d.options.frameLimit = frameLimit || 60;\r\n        j2d.options.sceneSkipTime = 1000.0 / j2d.options.frameLimit;\r\n        j2d.options.lastTime = Date.now();\r\n        j2d.options.dt = 0;\r\n        j2d.options.sceneStartTime = j2d.options.lastTime;\r\n\r\n        j2d.gameEngine();\r\n    };\r\n\r\n    J2D.prototype.setActiveEngine = function (engine) {\r\n        this.options.engine = engine;\r\n    };\r\n    /** -GameEngine **/\r\n\r\n    /** Device **/\r\n\r\n    J2D.prototype.getDevice = function () {\r\n        return this.device;\r\n    };\r\n\r\n    J2D.prototype.device = {\r\n        width: parseInt($(document).width()) < parseInt(screen.width) ? parseInt($(document).width()) : parseInt(screen.width),\r\n        height: parseInt($(document).height()) < parseInt(screen.height) ? parseInt($(document).height()) : parseInt(screen.height),\r\n\r\n        resize: function () {\r\n            this.width = window.innerWidth;\r\n            this.height = window.innerHeight;\r\n        }\r\n    };\r\n\r\n    /** Vector **/\r\n    J2D.prototype.vector = {\r\n        vec2df: function (x, y) {\r\n            return {x: x, y: y};\r\n        },\r\n        vec2di: function (x, y) {\r\n            return {x: (x >> 0), y: (y >> 0)};\r\n        }\r\n    };\r\n\r\n    /** Math **/\r\n    J2D.prototype.math = {\r\n        toInt: function (number) {\r\n            return number >> 0;\r\n        },\r\n        randomColor: function (min, max, opacity) {\r\n            return 'rgba(' + this.random(min, max) + ', ' + this.random(min, max) + ', ' + this.random(min, max) + ', ' + opacity + ')';\r\n        },\r\n        random: function (min, max, omitZero) {\r\n            var random = (Math.floor(Math.random() * (max - min + 1) + min));\r\n            return (omitZero && random == 0) ? this.random(min, max, omitZero) : random;\r\n        },\r\n        rad: function (number) {\r\n            return number * (Math.PI / 180);\r\n        }\r\n    };\r\n\r\n    /** +Layers **/\r\n    J2D.prototype.getLayers = function () {\r\n        return this.layers;\r\n    };\r\n\r\n    J2D.prototype.layers = {\r\n        parent: undefined,\r\n        list: {}\r\n    };\r\n\r\n    J2D.prototype.layers.getLayer = function (id) {\r\n        return this.list[id];\r\n    };\r\n    J2D.prototype.layers.add = function (id, zIndex) {\r\n        if (this.list[id]) {\r\n            return false;\r\n        }\r\n\r\n        var layer = {};\r\n        var j2d = this.parent;\r\n\r\n        layer.layerName = id;\r\n        layer.canvas = document.createElement('canvas');\r\n        layer.canvas.width = j2d.scene.width;\r\n        layer.canvas.height = j2d.scene.height;\r\n        layer.width = j2d.scene.width;\r\n        layer.height = j2d.scene.height;\r\n        layer.context = layer.canvas.getContext('2d');\r\n        layer.context.shadowColor = 'rgba(0,0,0,0)';\r\n        layer.canvas.style.zIndex = 1000 + zIndex;\r\n        layer.canvas.style.position = 'fixed';\r\n        layer.canvas.style.left = '0';\r\n        layer.canvas.style.top = '0';\r\n        layer.canvas.id = id;\r\n        layer.opacity = 1;\r\n        layer.angle = 0;\r\n        layer.visible = 1;\r\n\r\n        layer.onContext = function (callback) {\r\n            callback(this.context);\r\n        };\r\n\r\n        layer.fill = function (color) {\r\n            this.context.fillStyle = color;\r\n            this.context.fillRect(0, 0, this.width, this.height);\r\n        };\r\n\r\n        layer.setOpacity = function (opacity) {\r\n            this.canvas.style.opacity = opacity;\r\n            this.opacity = opacity;\r\n        };\r\n\r\n        layer.getOpacity = function () {\r\n            return this.opacity;\r\n        };\r\n\r\n        layer.setVisible = function (visible) {\r\n            if (visible) {\r\n                this.canvas.style.display = 'block';\r\n                this.visible = true;\r\n            } else {\r\n                this.canvas.style.display = 'none';\r\n                this.visible = false;\r\n            }\r\n        };\r\n\r\n        layer.isVisible = function () {\r\n            return this.visible;\r\n        };\r\n\r\n        layer.setIndex = function (zIndex) {\r\n            this.canvas.style.zIndex = 1000 + zIndex;\r\n        };\r\n\r\n        layer.clear = function () {\r\n            this.context.clearRect(0, 0, this.width, this.height);\r\n        };\r\n\r\n        layer.clearNode = function (node) {\r\n            if (node.isLookScene()) {\r\n                this.context.clearRect(node.pos.x - j2d.scene.viewport.x, node.pos.y - j2d.scene.viewport.y, node.size.x, node.size.y);\r\n            }\r\n        };\r\n\r\n        layer.clearRect = function (pos, size) {\r\n            this.context.clearRect(pos.x - j2d.scene.viewport.x, pos.y - j2d.scene.viewport.y, size.x, size.y);\r\n        };\r\n\r\n        this.list[id] = layer;\r\n\r\n        if (j2d.options.ready) {\r\n            j2d.element.append(this.list[id].canvas);\r\n        }\r\n\r\n        return layer;\r\n    };\r\n    /** -Layers **/\r\n\r\n    /** +Scene **/\r\n    J2D.prototype.getScene = function () {\r\n        return this.scene;\r\n    };\r\n\r\n    J2D.prototype.scene = {\r\n        parent: undefined,\r\n        enableFullscreen: false,\r\n        layerName: 'sceneNode',\r\n        layers: (parent.layers) ? parent.layers : {}\r\n    };\r\n\r\n    J2D.prototype.scene.async = function (callback, data) {\r\n        setTimeout(callback.call(callback, data), 0);\r\n    };\r\n\r\n    J2D.prototype.scene.setGameState = function (engine) {\r\n        this.parent.setActiveEngine(engine);\r\n        this.parent.element.trigger('changedGameState');\r\n    };\r\n\r\n    J2D.prototype.scene.start = function (engine, frameLimit) {\r\n        if (this.parent.options.io) {\r\n            this.parent.options.io.init();\r\n        }\r\n        this.parent.element.trigger('beforeStart');\r\n        this.parent.start(engine, frameLimit);\r\n        this.parent.element.trigger('afterStart');\r\n    };\r\n\r\n    J2D.prototype.scene.resizeToFullScreen = function (fullscreen) {\r\n        var j2d = this.parent;\r\n        var scene = this;\r\n\r\n        var layer;\r\n        var tmpCanvas = document.createElement('canvas'); // Нужны для копирования содержимого\r\n        var tmpContext = tmpCanvas.getContext('2d');      // При изменении размера\r\n        if (fullscreen) {\r\n            scene.originalWidth = scene.width;\r\n            scene.originalHeight = scene.height;\r\n            scene.width = j2d.device.width;\r\n            scene.height = j2d.device.height;\r\n            for (var i in j2d.layers.list) {\r\n                layer = j2d.layers.list[i];\r\n                tmpCanvas.width = layer.width;\r\n                tmpCanvas.height = layer.height;\r\n                tmpContext.drawImage(layer.canvas, 0, 0);\r\n                layer.canvas.width = scene.width;\r\n                layer.canvas.height = scene.height;\r\n                layer.width = scene.width;\r\n                layer.height = scene.height;\r\n                layer.context.drawImage(tmpCanvas, 0, 0, layer.width, layer.height);\r\n            }\r\n            scene.enableFullscreen = true;\r\n        } else {\r\n            scene.width = scene.originalWidth;\r\n            scene.height = scene.originalHeight;\r\n            for (var i in j2d.layers.list) {\r\n                layer = j2d.layers.list[i];\r\n                layer.width = scene.originalWidth;\r\n                layer.height = scene.originalHeight;\r\n                layer.canvas.width = scene.originalWidth;\r\n                layer.canvas.height = scene.originalHeight;\r\n            }\r\n            scene.enableFullscreen = false;\r\n        }\r\n    };\r\n\r\n    J2D.prototype.scene.scaleToFullScreen = function (fullscreen) {\r\n        var layer, i;\r\n        if (fullscreen) {\r\n            for (i in this.parent.layers.list) {\r\n                if (this.parent.layers.list.hasOwnProperty(i)) {\r\n                    layer = this.parent.layers.list[i].canvas;\r\n                    layer.style.width = this.parent.device.width + 'px';\r\n                    layer.style.height = this.parent.device.height + 'px';\r\n                }\r\n            }\r\n            this.enableFullscreen = true;\r\n            this.parent.element.width(this.parent.device.width).height(this.parent.device.height);\r\n        } else {\r\n            for (i in this.parent.layers.list) {\r\n                if (this.parent.layers.list.hasOwnProperty(i)) {\r\n                    layer = this.parent.layers.list[i].canvas;\r\n                    layer.style.width = this.width + 'px';\r\n                    layer.style.height = this.height + 'px';\r\n                }\r\n            }\r\n            this.enableFullscreen = false;\r\n            this.parent.element.width(this.width).height(this.height);\r\n        }\r\n    };\r\n\r\n    J2D.prototype.scene.toggleFullScreen = function (j2d, data) {\r\n        if (data === undefined) {\r\n            data = {fullscreen: undefined};\r\n        }\r\n        if (!j2d.scene.enableFullscreen || data.fullscreen) {\r\n            j2d.scene.resizeToFullScreen(true);\r\n        } else {\r\n            j2d.scene.resizeToFullScreen(false);\r\n        }\r\n    };\r\n\r\n    // Устанавливает позицию для камеры\r\n    J2D.prototype.scene.setViewPosition = function (position) {\r\n        this.parent.scene.viewport.x = position.x - Math.ceil(this.parent.scene.width / 2);\r\n        this.parent.scene.viewport.y = position.y - Math.ceil(this.parent.scene.height / 2);\r\n    };\r\n\r\n    //! Движение \"камеры\" вслед за объектом\r\n    J2D.prototype.scene.setViewFocus = function (id, offset) {\r\n        this.parent.scene.viewport.x = id.getPosition().x - Math.ceil(this.parent.scene.width / 2) + (offset ? offset.x : 0);\r\n        this.parent.scene.viewport.y = id.getPosition().y - Math.ceil(this.parent.scene.height / 2) + (offset ? offset.y : 0);\r\n    };\r\n\r\n    //! Движение \"камеры\"\r\n    J2D.prototype.scene.viewMove = function (position) {\r\n        this.parent.scene.viewport.x += position.x;\r\n        this.parent.scene.viewport.y += position.y;\r\n    };\r\n\r\n    //! Очистка отрисованного предыдущего кадра сцены\r\n    J2D.prototype.scene.clear = function () {\r\n        this.getLayer().clear();\r\n    };\r\n\r\n    J2D.prototype.scene.getLayer = function () {\r\n        return this.parent.layers.getLayer('sceneNode');\r\n    };\r\n\r\n    // инициализация сцены\r\n    J2D.prototype.scene.init = function (width, heigth) {\r\n        var j2d = this.parent;\r\n        j2d.element.trigger('beforeInit');\r\n\r\n        this.width = this.originalWidth = width;\r\n        this.height = this.originalHeight = heigth;\r\n\r\n        this.parent.element.width(width).height(heigth);\r\n\r\n        j2d.layers.add('sceneNode', 0);\r\n\r\n        this.context = j2d.layers.getLayer('sceneNode').context;\r\n        this.canvas = j2d.layers.getLayer('sceneNode').canvas;\r\n        this.visible = true;\r\n\r\n        this.cancelClear = false;\r\n\r\n        /* Вид \"камеры\" */\r\n        this.viewport = j2d.vector.vec2df(0, 0);\r\n\r\n        j2d.element.trigger('afterInit');\r\n\r\n        $(window).ready(function () {\r\n            for (var i in j2d.layers.list) {\r\n                if (j2d.layers.list.hasOwnProperty(i)) {\r\n                    j2d.element.append(j2d.layers.getLayer(i).canvas);\r\n                }\r\n            }\r\n            j2d.options.ready = true;\r\n            j2d.element.trigger('ready');\r\n        });\r\n    };\r\n    /** -Scene **/\r\n\r\n    J2D.initJQueryPlugin = function () {\r\n        $.fn.j2d = function (options) {\r\n            options = $.extend(true, {}, defaults, options);\r\n\r\n            this.filter('div.canvas:not([guid])').each(function () {\r\n                $(this).data('j2d', new J2D($(this), options)).addClass('j2d');\r\n                $(this).attr('guid', 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n                    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n                    return v.toString(16);\r\n                }));\r\n            });\r\n\r\n            if (1 === $(this).length) {\r\n                return $(this).data('j2d');\r\n            }\r\n        };\r\n\r\n        $(window).on('focus', function () {\r\n            $('div.canvas[guid]').each(function () {\r\n                    $(this).data('j2d').options.pause = false;\r\n                    $(this).addClass('focus');\r\n            });\r\n        }).on('blur', function () {\r\n            $('div.canvas[guid]').each(function () {\r\n                $(this).data('j2d').options.pause = true;\r\n                $(this).removeClass('focus');\r\n            });\r\n        });\r\n\r\n        $(window).on('resize', function () {\r\n            $('div.canvas[guid]').each(function () {\r\n                $(this).data('j2d').device.resize();\r\n            });\r\n        });\r\n    };\r\n\r\n    return J2D;\r\n});\r\n"],"sourceRoot":"/source/"}