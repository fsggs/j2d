{"version":3,"sources":["jquery.j2d.js"],"names":["root","factory","define","amd","jQuery","global","J2D","$","defaults","vector","math","dom","now","dt","io","undefined","pause","frameLimit","sceneStartTime","sceneSkipTime","engine","ready","window","webGL","element","options","j2d","this","init","gameEngine","Date","setTimeout","update","lastTime","clear","nextJ2dsGameStep","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","prototype","getInfo","name","version","site","info","author","getIO","layers","parent","scene","IOHandler","handler","setWindow","customWindow","start","html","addClass","resume","removeClass","focus","isPlay","enableWebGL","setActiveEngine","getDevice","device","width","parseInt","document","screen","height","resize","innerWidth","innerHeight","vec2df","x","y","vec2di","toInt","number","randomColor","min","max","opacity","random","omitZero","Math","floor","rad","PI","getLayers","list","getLayer","id","add","zIndex","layer","layerName","canvas","createElement","context","getContext","shadowColor","style","position","left","top","angle","visible","onContext","fill","color","fillStyle","fillRect","setOpacity","getOpacity","setVisible","display","isVisible","setIndex","clearRect","clearNode","node","isLookScene","pos","viewport","size","append","getScene","enableFullscreen","async","data","call","setGameState","trigger","resizeToFullScreen","fullscreen","tmpCanvas","tmpContext","originalWidth","originalHeight","i","drawImage","scaleToFullScreen","hasOwnProperty","toggleFullScreen","setViewPosition","ceil","setViewFocus","offset","getPosition","viewMove","heigth","cancelClear","initJQueryPlugin","fn","extend","filter","each","guid","replace","c","r","v","toString","attr","tabIndex","length","on"],"mappings":"CAQC,SAAUA,EAAMC,GACS,kBAAXC,SAAyBA,OAAOC,IACvCD,OAAO,cAAe,UAAWD,GAEjCA,EAAQD,EAAKI,SAEnBC,OAAQ,SAAUD,GAChB,GAAgBE,GAAZC,EAAIH,EAGJI,GACAC,UACAC,QACAC,OACAC,IAAK,EACLC,GAAI,EACJC,GAAIC,OACJC,OAAO,EACPC,WAAY,GACZC,eAAgB,EAChBC,cAAe,EACfC,QAAQ,EACRC,OAAO,EACPC,OAAQA,OAERC,OAAO,EA2dX,OAxdAjB,GAAM,SAAakB,EAASC,GACxB,GAAIC,GAAMC,IAEVD,GAAIF,QAAUA,EACdE,EAAID,QAAUA,EAEdC,EAAIE,OAEJF,EAAIG,WAAa,WACbH,EAAID,QAAQb,IAAMkB,KAAKlB,MAEvBmB,WAAW,WACFL,EAAID,QAAQT,QACTU,EAAID,QAAQX,IACZY,EAAID,QAAQX,GAAGkB,SAEnBN,EAAID,QAAQZ,IAAMa,EAAID,QAAQb,IAAMc,EAAID,QAAQQ,UAAY,IACxDP,EAAID,QAAQZ,GAAKa,EAAID,QAAQN,gBAC7BO,EAAID,QAAQZ,GAAK,GAErBa,EAAID,QAAQP,eAAiBQ,EAAID,QAAQb,IACzCmB,WAAWL,EAAID,QAAQL,OAAQ,GAC/BM,EAAID,QAAQQ,SAAWP,EAAID,QAAQb,IAC/Bc,EAAID,QAAQX,IACZY,EAAID,QAAQX,GAAGoB,SAGvBC,EAAiBT,EAAIG,aACrBH,EAAID,QAAQR,WAAa,GAAKS,EAAID,QAAQN,cAAgB,GAGlE,IAAIgB,GAAmB,WACnB,MAAOb,QAAOc,uBACVd,OAAOe,6BACPf,OAAOgB,0BACPhB,OAAOiB,wBACPjB,OAAOkB,yBACP,SAAUC,GACNnB,OAAOS,WAAWU,EAAU,IAAOf,EAAID,QAAQR,iBAM/DX,EAAIoC,UAAUC,QAAU,WACpB,OACIC,KAAQ,aACRC,QAAW,QACXC,KAAQ,sCACRC,KAAQ,+CACRC,OAAU,4BAIlB1C,EAAIoC,UAAUO,MAAQ,WAClB,MAAOtB,MAAKF,QAAQX,IAKxBR,EAAIoC,UAAUd,KAAO,WACbD,KAAKuB,SACLvB,KAAKuB,OAAOC,OAASxB,MAErBA,KAAKyB,QACLzB,KAAKyB,MAAMD,OAASxB,YAEjBA,MAAKC,MAGhBtB,EAAIoC,UAAUW,UAAY,SAAUC,GAChC,MAAO3B,MAAKF,QAAQX,GAAKwC,GAG7BhD,EAAIoC,UAAUa,UAAY,SAAUC,GAChC7B,KAAKL,OAASkC,EAAeA,EAAelC,QAIhDhB,EAAIoC,UAAUe,MAAQ,SAAUrC,EAAQH,GACpC,GAAIS,GAAMC,IAEVD,GAAID,QAAQL,OAASA,GAAU,WAC3BM,EAAIF,QAAQkC,KAAK,iDAErBhC,EAAID,QAAQR,WAAaA,GAAc,GACvCS,EAAID,QAAQN,cAAgB,IAASO,EAAID,QAAQR,WACjDS,EAAID,QAAQQ,SAAWH,KAAKlB,MAC5Bc,EAAID,QAAQZ,GAAK,EACjBa,EAAID,QAAQP,eAAiBQ,EAAID,QAAQQ,SAEzCP,EAAIG,cAGRvB,EAAIoC,UAAU1B,MAAQ,WAClBW,KAAKF,QAAQT,OAAQ,EACrBW,KAAKH,QAAQmC,SAAS,UAG1BrD,EAAIoC,UAAUkB,OAAS,WACnBjC,KAAKF,QAAQT,OAAQ,EACrBW,KAAKH,QAAQqC,YAAY,SAASC,SAGtCxD,EAAIoC,UAAUqB,OAAS,WACnB,OAAQpC,KAAKF,QAAQT,OAGzBV,EAAIoC,UAAUsB,YAAc,WACxBrC,KAAKF,QAAQF,OAAQ,GAGzBjB,EAAIoC,UAAUuB,gBAAkB,SAAU7C,GACtCO,KAAKF,QAAQL,OAASA,GAM1Bd,EAAIoC,UAAUwB,UAAY,WACtB,MAAOvC,MAAKwC,QAGhB7D,EAAIoC,UAAUyB,QACVC,MAAOC,SAAS9D,EAAE+D,UAAUF,SAAWC,SAASE,OAAOH,OAASC,SAAS9D,EAAE+D,UAAUF,SAAWC,SAASE,OAAOH,OAChHI,OAAQH,SAAS9D,EAAE+D,UAAUE,UAAYH,SAASE,OAAOC,QAAUH,SAAS9D,EAAE+D,UAAUE,UAAYH,SAASE,OAAOC,QAEpHC,OAAQ,WACJ9C,KAAKyC,MAAQ9C,OAAOoD,WACpB/C,KAAK6C,OAASlD,OAAOqD,cAK7BrE,EAAIoC,UAAUjC,QACVmE,OAAQ,SAAUC,EAAGC,GACjB,OAAQD,EAAGA,EAAGC,EAAGA,IAErBC,OAAQ,SAAUF,EAAGC,GACjB,OAAQD,EAAIA,GAAK,EAAIC,EAAIA,GAAK,KAKtCxE,EAAIoC,UAAUhC,MACVsE,MAAO,SAAUC,GACb,MAAOA,IAAU,GAErBC,YAAa,SAAUC,EAAKC,EAAKC,GAC7B,MAAO,QAAU1D,KAAK2D,OAAOH,EAAKC,GAAO,KAAOzD,KAAK2D,OAAOH,EAAKC,GAAO,KAAOzD,KAAK2D,OAAOH,EAAKC,GAAO,KAAOC,EAAU,KAE5HC,OAAQ,SAAUH,EAAKC,EAAKG,GACxB,GAAID,GAAUE,KAAKC,MAAMD,KAAKF,UAAYF,EAAMD,EAAM,GAAKA,EAC3D,OAAQI,IAAsB,GAAVD,EAAe3D,KAAK2D,OAAOH,EAAKC,EAAKG,GAAYD,GAEzEI,IAAK,SAAUT,GACX,MAAOA,IAAUO,KAAKG,GAAK,OAKnCrF,EAAIoC,UAAUkD,UAAY,WACtB,MAAOjE,MAAKuB,QAGhB5C,EAAIoC,UAAUQ,QACVC,OAAQpC,OACR8E,SAGJvF,EAAIoC,UAAUQ,OAAO4C,SAAW,SAAUC,GACtC,MAAOpE,MAAKkE,KAAKE,IAErBzF,EAAIoC,UAAUQ,OAAO8C,IAAM,SAAUD,EAAIE,GACrC,GAAItE,KAAKkE,KAAKE,GACV,OAAO,CAGX,IAAIG,MACAxE,EAAMC,KAAKwB,MA2Ef,OAzEA+C,GAAMC,UAAYJ,EAClBG,EAAME,OAAS9B,SAAS+B,cAAc,UACtCH,EAAME,OAAOhC,MAAQ1C,EAAI0B,MAAMgB,MAC/B8B,EAAME,OAAO5B,OAAS9C,EAAI0B,MAAMoB,OAChC0B,EAAM9B,MAAQ1C,EAAI0B,MAAMgB,MACxB8B,EAAM1B,OAAS9C,EAAI0B,MAAMoB,OACzB0B,EAAMI,QAAUJ,EAAME,OAAOG,WAAW,MACxCL,EAAMI,QAAQE,YAAc,gBAC5BN,EAAME,OAAOK,MAAMR,OAAS,IAAOA,EACnCC,EAAME,OAAOK,MAAMC,SAAW,QAC9BR,EAAME,OAAOK,MAAME,KAAO,IAC1BT,EAAME,OAAOK,MAAMG,IAAM,IACzBV,EAAME,OAAOL,GAAKA,EAClBG,EAAMb,QAAU,EAChBa,EAAMW,MAAQ,EACdX,EAAMY,QAAU,EAEhBZ,EAAMa,UAAY,SAAUtE,GACxBA,EAASd,KAAK2E,UAGlBJ,EAAMc,KAAO,SAAUC,GACnBtF,KAAK2E,QAAQY,UAAYD,EACzBtF,KAAK2E,QAAQa,SAAS,EAAG,EAAGxF,KAAKyC,MAAOzC,KAAK6C,SAGjD0B,EAAMkB,WAAa,SAAU/B,GACzB1D,KAAKyE,OAAOK,MAAMpB,QAAUA,EAC5B1D,KAAK0D,QAAUA,GAGnBa,EAAMmB,WAAa,WACf,MAAO1F,MAAK0D,SAGhBa,EAAMoB,WAAa,SAAUR,GACrBA,GACAnF,KAAKyE,OAAOK,MAAMc,QAAU,QAC5B5F,KAAKmF,SAAU,IAEfnF,KAAKyE,OAAOK,MAAMc,QAAU,OAC5B5F,KAAKmF,SAAU,IAIvBZ,EAAMsB,UAAY,WACd,MAAO7F,MAAKmF,SAGhBZ,EAAMuB,SAAW,SAAUxB,GACvBtE,KAAKyE,OAAOK,MAAMR,OAAS,IAAOA,GAGtCC,EAAMhE,MAAQ,WACVP,KAAK2E,QAAQoB,UAAU,EAAG,EAAG/F,KAAKyC,MAAOzC,KAAK6C,SAGlD0B,EAAMyB,UAAY,SAAUC,GACpBA,EAAKC,eACLlG,KAAK2E,QAAQoB,UAAUE,EAAKE,IAAIjD,EAAInD,EAAI0B,MAAM2E,SAASlD,EAAG+C,EAAKE,IAAIhD,EAAIpD,EAAI0B,MAAM2E,SAASjD,EAAG8C,EAAKI,KAAKnD,EAAG+C,EAAKI,KAAKlD,IAI5HoB,EAAMwB,UAAY,SAAUI,EAAKE,GAC7BrG,KAAK2E,QAAQoB,UAAUI,EAAIjD,EAAInD,EAAI0B,MAAM2E,SAASlD,EAAGiD,EAAIhD,EAAIpD,EAAI0B,MAAM2E,SAASjD,EAAGkD,EAAKnD,EAAGmD,EAAKlD,IAGpGnD,KAAKkE,KAAKE,GAAMG,EAEZxE,EAAID,QAAQJ,OACZK,EAAIF,QAAQyG,OAAOtG,KAAKkE,KAAKE,GAAIK,QAG9BF,GAKX5F,EAAIoC,UAAUwF,SAAW,WACrB,MAAOvG,MAAKyB,OAGhB9C,EAAIoC,UAAUU,OACVD,OAAQpC,OACRoH,kBAAkB,EAClBhC,UAAW,YACXjD,OAASC,OAAa,OAAIA,OAAOD,WAGrC5C,EAAIoC,UAAUU,MAAMgF,MAAQ,SAAU3F,EAAU4F,GAC5CtG,WAAWU,EAAS6F,KAAK7F,EAAU4F,GAAO,IAG9C/H,EAAIoC,UAAUU,MAAMmF,aAAe,SAAUnH,GACzCO,KAAKwB,OAAOc,gBAAgB7C,GAC5BO,KAAKwB,OAAO3B,QAAQgH,QAAQ,qBAGhClI,EAAIoC,UAAUU,MAAMK,MAAQ,SAAUrC,EAAQH,GACtCU,KAAKwB,OAAO1B,QAAQX,IACpBa,KAAKwB,OAAO1B,QAAQX,GAAGc,OAE3BD,KAAKwB,OAAO3B,QAAQgH,QAAQ,eAC5B7G,KAAKwB,OAAOM,MAAMrC,EAAQH,GAC1BU,KAAKwB,OAAO3B,QAAQgH,QAAQ,eAGhClI,EAAIoC,UAAUU,MAAMqF,mBAAqB,SAAUC,GAC/C,GAGIxC,GAHAxE,EAAMC,KAAKwB,OACXC,EAAQzB,KAGRgH,EAAYrE,SAAS+B,cAAc,UACnCuC,EAAaD,EAAUpC,WAAW,KACtC,IAAImC,EAAY,CACZtF,EAAMyF,cAAgBzF,EAAMgB,MAC5BhB,EAAM0F,eAAiB1F,EAAMoB,OAC7BpB,EAAMgB,MAAQ1C,EAAIyC,OAAOC,MACzBhB,EAAMoB,OAAS9C,EAAIyC,OAAOK,MAC1B,KAAK,GAAIuE,KAAKrH,GAAIwB,OAAO2C,KACrBK,EAAQxE,EAAIwB,OAAO2C,KAAKkD,GACxBJ,EAAUvE,MAAQ8B,EAAM9B,MACxBuE,EAAUnE,OAAS0B,EAAM1B,OACzBoE,EAAWI,UAAU9C,EAAME,OAAQ,EAAG,GACtCF,EAAME,OAAOhC,MAAQhB,EAAMgB,MAC3B8B,EAAME,OAAO5B,OAASpB,EAAMoB,OAC5B0B,EAAM9B,MAAQhB,EAAMgB,MACpB8B,EAAM1B,OAASpB,EAAMoB,OACrB0B,EAAMI,QAAQ0C,UAAUL,EAAW,EAAG,EAAGzC,EAAM9B,MAAO8B,EAAM1B,OAEhEpB,GAAM+E,kBAAmB,MACtB,CACH/E,EAAMgB,MAAQhB,EAAMyF,cACpBzF,EAAMoB,OAASpB,EAAM0F,cACrB,KAAK,GAAIC,KAAKrH,GAAIwB,OAAO2C,KACrBK,EAAQxE,EAAIwB,OAAO2C,KAAKkD,GACxB7C,EAAM9B,MAAQhB,EAAMyF,cACpB3C,EAAM1B,OAASpB,EAAM0F,eACrB5C,EAAME,OAAOhC,MAAQhB,EAAMyF,cAC3B3C,EAAME,OAAO5B,OAASpB,EAAM0F,cAEhC1F,GAAM+E,kBAAmB,IAIjC7H,EAAIoC,UAAUU,MAAM6F,kBAAoB,SAAUP,GAC9C,GAAIxC,GAAO6C,CACX,IAAIL,EAAY,CACZ,IAAKK,IAAKpH,MAAKwB,OAAOD,OAAO2C,KACrBlE,KAAKwB,OAAOD,OAAO2C,KAAKqD,eAAeH,KACvC7C,EAAQvE,KAAKwB,OAAOD,OAAO2C,KAAKkD,GAAG3C,OACnCF,EAAMO,MAAMrC,MAAQzC,KAAKwB,OAAOgB,OAAOC,MAAQ,KAC/C8B,EAAMO,MAAMjC,OAAS7C,KAAKwB,OAAOgB,OAAOK,OAAS,KAGzD7C,MAAKwG,kBAAmB,EACxBxG,KAAKwB,OAAO3B,QAAQ4C,MAAMzC,KAAKwB,OAAOgB,OAAOC,OAAOI,OAAO7C,KAAKwB,OAAOgB,OAAOK,YAC3E,CACH,IAAKuE,IAAKpH,MAAKwB,OAAOD,OAAO2C,KACrBlE,KAAKwB,OAAOD,OAAO2C,KAAKqD,eAAeH,KACvC7C,EAAQvE,KAAKwB,OAAOD,OAAO2C,KAAKkD,GAAG3C,OACnCF,EAAMO,MAAMrC,MAAQzC,KAAKyC,MAAQ,KACjC8B,EAAMO,MAAMjC,OAAS7C,KAAK6C,OAAS,KAG3C7C,MAAKwG,kBAAmB,EACxBxG,KAAKwB,OAAO3B,QAAQ4C,MAAMzC,KAAKyC,OAAOI,OAAO7C,KAAK6C,UAI1DlE,EAAIoC,UAAUU,MAAM+F,iBAAmB,SAAUzH,EAAK2G,GACrCtH,SAATsH,IACAA,GAAQK,WAAY3H,UAEnBW,EAAI0B,MAAM+E,kBAAoBE,EAAKK,WACpChH,EAAI0B,MAAMqF,oBAAmB,GAE7B/G,EAAI0B,MAAMqF,oBAAmB,IAKrCnI,EAAIoC,UAAUU,MAAMgG,gBAAkB,SAAU1C,GAC5C/E,KAAKwB,OAAOC,MAAM2E,SAASlD,EAAI6B,EAAS7B,EAAIW,KAAK6D,KAAK1H,KAAKwB,OAAOC,MAAMgB,MAAQ,GAChFzC,KAAKwB,OAAOC,MAAM2E,SAASjD,EAAI4B,EAAS5B,EAAIU,KAAK6D,KAAK1H,KAAKwB,OAAOC,MAAMoB,OAAS,IAIrFlE,EAAIoC,UAAUU,MAAMkG,aAAe,SAAUvD,EAAIwD,GAC7C5H,KAAKwB,OAAOC,MAAM2E,SAASlD,EAAIkB,EAAGyD,cAAc3E,EAAIW,KAAK6D,KAAK1H,KAAKwB,OAAOC,MAAMgB,MAAQ,IAAMmF,EAASA,EAAO1E,EAAI,GAClHlD,KAAKwB,OAAOC,MAAM2E,SAASjD,EAAIiB,EAAGyD,cAAc1E,EAAIU,KAAK6D,KAAK1H,KAAKwB,OAAOC,MAAMoB,OAAS,IAAM+E,EAASA,EAAOzE,EAAI,IAIvHxE,EAAIoC,UAAUU,MAAMqG,SAAW,SAAU/C,GACrC/E,KAAKwB,OAAOC,MAAM2E,SAASlD,GAAK6B,EAAS7B,EACzClD,KAAKwB,OAAOC,MAAM2E,SAASjD,GAAK4B,EAAS5B,GAI7CxE,EAAIoC,UAAUU,MAAMlB,MAAQ,WACxBP,KAAKmE,WAAW5D,SAGpB5B,EAAIoC,UAAUU,MAAM0C,SAAW,WAC3B,MAAOnE,MAAKwB,OAAOD,OAAO4C,SAAS,cAIvCxF,EAAIoC,UAAUU,MAAMxB,KAAO,SAAUwC,EAAOsF,GACxC,GAAIhI,GAAMC,KAAKwB,MACfzB,GAAIF,QAAQgH,QAAQ,cAEpB7G,KAAKyC,MAAQzC,KAAKkH,cAAgBzE,EAClCzC,KAAK6C,OAAS7C,KAAKmH,eAAiBY,EAEpC/H,KAAKwB,OAAO3B,QAAQ4C,MAAMA,GAAOI,OAAOkF,GAExChI,EAAIwB,OAAO8C,IAAI,YAAa,GAE5BrE,KAAK2E,QAAU5E,EAAIwB,OAAO4C,SAAS,aAAaQ,QAChD3E,KAAKyE,OAAS1E,EAAIwB,OAAO4C,SAAS,aAAaM,OAC/CzE,KAAKmF,SAAU,EAEfnF,KAAKgI,aAAc,EAGnBhI,KAAKoG,SAAWrG,EAAIjB,OAAOmE,OAAO,EAAG,GAErClD,EAAIF,QAAQgH,QAAQ,aAEpBjI,EAAEe,QAAQD,MAAM,WACZ,IAAK,GAAI0H,KAAKrH,GAAIwB,OAAO2C,KACjBnE,EAAIwB,OAAO2C,KAAKqD,eAAeH,IAC/BrH,EAAIF,QAAQyG,OAAOvG,EAAIwB,OAAO4C,SAASiD,GAAG3C,OAGlD1E,GAAID,QAAQJ,OAAQ,EACpBK,EAAIF,QAAQgH,QAAQ,YAK5BlI,EAAIsJ,iBAAmB,WACnBrJ,EAAEsJ,GAAGnI,IAAM,SAAUD,GAqBjB,MApBAA,GAAUlB,EAAEuJ,QAAO,KAAUtJ,EAAUiB,GAEvCE,KAAKoI,OAAO,0BAA0BC,KAAK,WACvCzJ,EAAEoB,MAAM0G,KAAK,MAAO,GAAI/H,GAAIC,EAAEoB,MAAOF,IAAUkC,SAAS,MACxD,IAAIsG,GAAO,uCAAuCC,QAAQ,QAAS,SAAUC,GACzE,GAAIC,GAAoB,GAAhB5E,KAAKF,SAAgB,EAAG+E,EAAS,KAALF,EAAWC,EAAS,EAAJA,EAAU,CAC9D,OAAOC,GAAEC,SAAS,KAEtB/J,GAAEoB,MAAM4I,KAAK,OAAQN,EACrB,IAAIlE,GAAKxF,EAAEoB,MAAM4I,KAAK,OACJ,mBAAPxE,IAA2BA,KAAO,IACzCxF,EAAEoB,MAAM4I,KAAK,KAAMN,EAEvB,IAAIO,GAAWjK,EAAEoB,MAAM4I,KAAK,aACJ,mBAAbC,IAAiCA,KAAa,IACrDjK,EAAEoB,MAAM4I,KAAK,WAAY,MAE7BhK,EAAEoB,MAAMmC,UAGR,IAAMvD,EAAEoB,MAAM8I,OACPlK,EAAEoB,MAAM0G,KAAK,OADxB,QAKJ9H,EAAE+D,UAAUoG,GAAG,QAAS,yBAA0B,WAC9CnK,EAAEoB,MAAM0G,KAAK,OAAOzE,WAGxBrD,EAAEe,QAAQoJ,GAAG,QAAS,WAClBnK,EAAE,oBAAoByJ,KAAK,WACvBzJ,EAAEoB,MAAM0G,KAAK,OAAOzE,aAEzB8G,GAAG,OAAQ,WACVnK,EAAE,oBAAoByJ,KAAK,WACvBzJ,EAAEoB,MAAM0G,KAAK,OAAOrH,YAI5BT,EAAEe,QAAQoJ,GAAG,SAAU,WACnBnK,EAAE,oBAAoByJ,KAAK,WACvBzJ,EAAEoB,MAAM0G,KAAK,OAAOlE,OAAOM,cAKhCnE","file":"jquery.j2d.min","sourcesContent":["/**\r\n * J2D (jQuery plugin of the fork j2ds)\r\n *\r\n * @authors Skaner, likerRr, DeVinterX\r\n * @license zlib\r\n * @version 0.1.5a\r\n * @see https://github.com/SkanerSoft/J2ds/commit/501b8993fc41960794572dc481a5f2fe492da349\r\n */\r\n!function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        define('jquery.j2d', ['jquery'], factory);\r\n    } else {\r\n        factory(root.jQuery);\r\n    }\r\n}(global, function (jQuery) {\r\n    var $ = jQuery, J2D;\r\n    'use strict';\r\n\r\n    var defaults = {\r\n        vector: {},\r\n        math: {},\r\n        dom: {},\r\n        now: 0,\r\n        dt: 0,\r\n        io: undefined,\r\n        pause: false,\r\n        frameLimit: 60,\r\n        sceneStartTime: 0,\r\n        sceneSkipTime: 0,\r\n        engine: false,\r\n        ready: false,\r\n        window: window,\r\n\r\n        webGL: false\r\n    };\r\n\r\n    J2D = function J2D(element, options) {\r\n        var j2d = this;\r\n\r\n        j2d.element = element;\r\n        j2d.options = options;\r\n\r\n        j2d.init();\r\n\r\n        j2d.gameEngine = function () {\r\n            j2d.options.now = Date.now();\r\n\r\n            setTimeout(function () {\r\n                if (!j2d.options.pause) {\r\n                    if (j2d.options.io) {\r\n                        j2d.options.io.update();\r\n                    }\r\n                    j2d.options.dt = (j2d.options.now - j2d.options.lastTime) / 100.0;\r\n                    if (j2d.options.dt > j2d.options.sceneSkipTime) {\r\n                        j2d.options.dt = 0;\r\n                    }\r\n                    j2d.options.sceneStartTime = j2d.options.now;\r\n                    setTimeout(j2d.options.engine, 0);\r\n                    j2d.options.lastTime = j2d.options.now;\r\n                    if (j2d.options.io) {\r\n                        j2d.options.io.clear();\r\n                    }\r\n                }\r\n                nextJ2dsGameStep(j2d.gameEngine);\r\n            }, (j2d.options.frameLimit < 60 ? j2d.options.sceneSkipTime : 0));\r\n        };\r\n\r\n        var nextJ2dsGameStep = (function () {\r\n            return window.requestAnimationFrame ||\r\n                window.webkitRequestAnimationFrame ||\r\n                window.mozRequestAnimationFrame ||\r\n                window.oRequestAnimationFrame ||\r\n                window.msRequestAnimationFrame ||\r\n                function (callback) {\r\n                    window.setTimeout(callback, 1000 / j2d.options.frameLimit);\r\n                };\r\n        })();\r\n    };\r\n\r\n    /** +links getters **/\r\n    J2D.prototype.getInfo = function () {\r\n        return {\r\n            'name': 'jquery.j2d',\r\n            'version': '0.1.5',\r\n            'site': 'https://github.com/fsggs/jquery.j2d',\r\n            'info': 'jquery.j2d - jQuery plugin of the fork j2ds.',\r\n            'author': 'DeVinterX, Skaner(j2ds)'\r\n        };\r\n    };\r\n\r\n    J2D.prototype.getIO = function () {\r\n        return this.options.io;\r\n    };\r\n    /** -links getters **/\r\n\r\n    /** +GameEngine **/\r\n    J2D.prototype.init = function () {\r\n        if (this.layers) {\r\n            this.layers.parent = this;\r\n        }\r\n        if (this.scene) {\r\n            this.scene.parent = this;\r\n        }\r\n        delete this.init;\r\n    };\r\n\r\n    J2D.prototype.IOHandler = function (handler) {\r\n        return this.options.io = handler;\r\n    };\r\n\r\n    J2D.prototype.setWindow = function (customWindow) {\r\n        this.window = customWindow ? customWindow : window;\r\n    };\r\n\r\n    // старт игры\r\n    J2D.prototype.start = function (engine, frameLimit) {\r\n        var j2d = this;\r\n\r\n        j2d.options.engine = engine || function () {\r\n            j2d.element.html('Пожалуйста, инициализируйте игровую функцию!');\r\n        };\r\n        j2d.options.frameLimit = frameLimit || 60;\r\n        j2d.options.sceneSkipTime = 1000.0 / j2d.options.frameLimit;\r\n        j2d.options.lastTime = Date.now();\r\n        j2d.options.dt = 0;\r\n        j2d.options.sceneStartTime = j2d.options.lastTime;\r\n\r\n        j2d.gameEngine();\r\n    };\r\n\r\n    J2D.prototype.pause = function () {\r\n        this.options.pause = true;\r\n        this.element.addClass('pause');\r\n    };\r\n\r\n    J2D.prototype.resume = function () {\r\n        this.options.pause = false;\r\n        this.element.removeClass('pause').focus();\r\n    };\r\n\r\n    J2D.prototype.isPlay = function () {\r\n        return !this.options.pause;\r\n    };\r\n\r\n    J2D.prototype.enableWebGL = function () {\r\n        this.options.webGL = true;\r\n    };\r\n\r\n    J2D.prototype.setActiveEngine = function (engine) {\r\n        this.options.engine = engine;\r\n    };\r\n    /** -GameEngine **/\r\n\r\n    /** Device **/\r\n\r\n    J2D.prototype.getDevice = function () {\r\n        return this.device;\r\n    };\r\n\r\n    J2D.prototype.device = {\r\n        width: parseInt($(document).width()) < parseInt(screen.width) ? parseInt($(document).width()) : parseInt(screen.width),\r\n        height: parseInt($(document).height()) < parseInt(screen.height) ? parseInt($(document).height()) : parseInt(screen.height),\r\n\r\n        resize: function () {\r\n            this.width = window.innerWidth;\r\n            this.height = window.innerHeight;\r\n        }\r\n    };\r\n\r\n    /** Vector **/\r\n    J2D.prototype.vector = {\r\n        vec2df: function (x, y) {\r\n            return {x: x, y: y};\r\n        },\r\n        vec2di: function (x, y) {\r\n            return {x: (x >> 0), y: (y >> 0)};\r\n        }\r\n    };\r\n\r\n    /** Math **/\r\n    J2D.prototype.math = {\r\n        toInt: function (number) {\r\n            return number >> 0;\r\n        },\r\n        randomColor: function (min, max, opacity) {\r\n            return 'rgba(' + this.random(min, max) + ', ' + this.random(min, max) + ', ' + this.random(min, max) + ', ' + opacity + ')';\r\n        },\r\n        random: function (min, max, omitZero) {\r\n            var random = (Math.floor(Math.random() * (max - min + 1) + min));\r\n            return (omitZero && random == 0) ? this.random(min, max, omitZero) : random;\r\n        },\r\n        rad: function (number) {\r\n            return number * (Math.PI / 180);\r\n        }\r\n    };\r\n\r\n    /** +Layers **/\r\n    J2D.prototype.getLayers = function () {\r\n        return this.layers;\r\n    };\r\n\r\n    J2D.prototype.layers = {\r\n        parent: undefined,\r\n        list: {}\r\n    };\r\n\r\n    J2D.prototype.layers.getLayer = function (id) {\r\n        return this.list[id];\r\n    };\r\n    J2D.prototype.layers.add = function (id, zIndex) {\r\n        if (this.list[id]) {\r\n            return false;\r\n        }\r\n\r\n        var layer = {};\r\n        var j2d = this.parent;\r\n\r\n        layer.layerName = id;\r\n        layer.canvas = document.createElement('canvas');\r\n        layer.canvas.width = j2d.scene.width;\r\n        layer.canvas.height = j2d.scene.height;\r\n        layer.width = j2d.scene.width;\r\n        layer.height = j2d.scene.height;\r\n        layer.context = layer.canvas.getContext('2d');\r\n        layer.context.shadowColor = 'rgba(0,0,0,0)';\r\n        layer.canvas.style.zIndex = 1000 + zIndex;\r\n        layer.canvas.style.position = 'fixed';\r\n        layer.canvas.style.left = '0';\r\n        layer.canvas.style.top = '0';\r\n        layer.canvas.id = id;\r\n        layer.opacity = 1;\r\n        layer.angle = 0;\r\n        layer.visible = 1;\r\n\r\n        layer.onContext = function (callback) {\r\n            callback(this.context);\r\n        };\r\n\r\n        layer.fill = function (color) {\r\n            this.context.fillStyle = color;\r\n            this.context.fillRect(0, 0, this.width, this.height);\r\n        };\r\n\r\n        layer.setOpacity = function (opacity) {\r\n            this.canvas.style.opacity = opacity;\r\n            this.opacity = opacity;\r\n        };\r\n\r\n        layer.getOpacity = function () {\r\n            return this.opacity;\r\n        };\r\n\r\n        layer.setVisible = function (visible) {\r\n            if (visible) {\r\n                this.canvas.style.display = 'block';\r\n                this.visible = true;\r\n            } else {\r\n                this.canvas.style.display = 'none';\r\n                this.visible = false;\r\n            }\r\n        };\r\n\r\n        layer.isVisible = function () {\r\n            return this.visible;\r\n        };\r\n\r\n        layer.setIndex = function (zIndex) {\r\n            this.canvas.style.zIndex = 1000 + zIndex;\r\n        };\r\n\r\n        layer.clear = function () {\r\n            this.context.clearRect(0, 0, this.width, this.height);\r\n        };\r\n\r\n        layer.clearNode = function (node) {\r\n            if (node.isLookScene()) {\r\n                this.context.clearRect(node.pos.x - j2d.scene.viewport.x, node.pos.y - j2d.scene.viewport.y, node.size.x, node.size.y);\r\n            }\r\n        };\r\n\r\n        layer.clearRect = function (pos, size) {\r\n            this.context.clearRect(pos.x - j2d.scene.viewport.x, pos.y - j2d.scene.viewport.y, size.x, size.y);\r\n        };\r\n\r\n        this.list[id] = layer;\r\n\r\n        if (j2d.options.ready) {\r\n            j2d.element.append(this.list[id].canvas);\r\n        }\r\n\r\n        return layer;\r\n    };\r\n    /** -Layers **/\r\n\r\n    /** +Scene **/\r\n    J2D.prototype.getScene = function () {\r\n        return this.scene;\r\n    };\r\n\r\n    J2D.prototype.scene = {\r\n        parent: undefined,\r\n        enableFullscreen: false,\r\n        layerName: 'sceneNode',\r\n        layers: (parent.layers) ? parent.layers : {}\r\n    };\r\n\r\n    J2D.prototype.scene.async = function (callback, data) {\r\n        setTimeout(callback.call(callback, data), 0);\r\n    };\r\n\r\n    J2D.prototype.scene.setGameState = function (engine) {\r\n        this.parent.setActiveEngine(engine);\r\n        this.parent.element.trigger('changedGameState');\r\n    };\r\n\r\n    J2D.prototype.scene.start = function (engine, frameLimit) {\r\n        if (this.parent.options.io) {\r\n            this.parent.options.io.init();\r\n        }\r\n        this.parent.element.trigger('beforeStart');\r\n        this.parent.start(engine, frameLimit);\r\n        this.parent.element.trigger('afterStart');\r\n    };\r\n\r\n    J2D.prototype.scene.resizeToFullScreen = function (fullscreen) {\r\n        var j2d = this.parent;\r\n        var scene = this;\r\n\r\n        var layer;\r\n        var tmpCanvas = document.createElement('canvas'); // Нужны для копирования содержимого\r\n        var tmpContext = tmpCanvas.getContext('2d');      // При изменении размера\r\n        if (fullscreen) {\r\n            scene.originalWidth = scene.width;\r\n            scene.originalHeight = scene.height;\r\n            scene.width = j2d.device.width;\r\n            scene.height = j2d.device.height;\r\n            for (var i in j2d.layers.list) {\r\n                layer = j2d.layers.list[i];\r\n                tmpCanvas.width = layer.width;\r\n                tmpCanvas.height = layer.height;\r\n                tmpContext.drawImage(layer.canvas, 0, 0);\r\n                layer.canvas.width = scene.width;\r\n                layer.canvas.height = scene.height;\r\n                layer.width = scene.width;\r\n                layer.height = scene.height;\r\n                layer.context.drawImage(tmpCanvas, 0, 0, layer.width, layer.height);\r\n            }\r\n            scene.enableFullscreen = true;\r\n        } else {\r\n            scene.width = scene.originalWidth;\r\n            scene.height = scene.originalHeight;\r\n            for (var i in j2d.layers.list) {\r\n                layer = j2d.layers.list[i];\r\n                layer.width = scene.originalWidth;\r\n                layer.height = scene.originalHeight;\r\n                layer.canvas.width = scene.originalWidth;\r\n                layer.canvas.height = scene.originalHeight;\r\n            }\r\n            scene.enableFullscreen = false;\r\n        }\r\n    };\r\n\r\n    J2D.prototype.scene.scaleToFullScreen = function (fullscreen) {\r\n        var layer, i;\r\n        if (fullscreen) {\r\n            for (i in this.parent.layers.list) {\r\n                if (this.parent.layers.list.hasOwnProperty(i)) {\r\n                    layer = this.parent.layers.list[i].canvas;\r\n                    layer.style.width = this.parent.device.width + 'px';\r\n                    layer.style.height = this.parent.device.height + 'px';\r\n                }\r\n            }\r\n            this.enableFullscreen = true;\r\n            this.parent.element.width(this.parent.device.width).height(this.parent.device.height);\r\n        } else {\r\n            for (i in this.parent.layers.list) {\r\n                if (this.parent.layers.list.hasOwnProperty(i)) {\r\n                    layer = this.parent.layers.list[i].canvas;\r\n                    layer.style.width = this.width + 'px';\r\n                    layer.style.height = this.height + 'px';\r\n                }\r\n            }\r\n            this.enableFullscreen = false;\r\n            this.parent.element.width(this.width).height(this.height);\r\n        }\r\n    };\r\n\r\n    J2D.prototype.scene.toggleFullScreen = function (j2d, data) {\r\n        if (data === undefined) {\r\n            data = {fullscreen: undefined};\r\n        }\r\n        if (!j2d.scene.enableFullscreen || data.fullscreen) {\r\n            j2d.scene.resizeToFullScreen(true);\r\n        } else {\r\n            j2d.scene.resizeToFullScreen(false);\r\n        }\r\n    };\r\n\r\n    // Устанавливает позицию для камеры\r\n    J2D.prototype.scene.setViewPosition = function (position) {\r\n        this.parent.scene.viewport.x = position.x - Math.ceil(this.parent.scene.width / 2);\r\n        this.parent.scene.viewport.y = position.y - Math.ceil(this.parent.scene.height / 2);\r\n    };\r\n\r\n    //! Движение \"камеры\" вслед за объектом\r\n    J2D.prototype.scene.setViewFocus = function (id, offset) {\r\n        this.parent.scene.viewport.x = id.getPosition().x - Math.ceil(this.parent.scene.width / 2) + (offset ? offset.x : 0);\r\n        this.parent.scene.viewport.y = id.getPosition().y - Math.ceil(this.parent.scene.height / 2) + (offset ? offset.y : 0);\r\n    };\r\n\r\n    //! Движение \"камеры\"\r\n    J2D.prototype.scene.viewMove = function (position) {\r\n        this.parent.scene.viewport.x += position.x;\r\n        this.parent.scene.viewport.y += position.y;\r\n    };\r\n\r\n    //! Очистка отрисованного предыдущего кадра сцены\r\n    J2D.prototype.scene.clear = function () {\r\n        this.getLayer().clear();\r\n    };\r\n\r\n    J2D.prototype.scene.getLayer = function () {\r\n        return this.parent.layers.getLayer('sceneNode');\r\n    };\r\n\r\n    // инициализация сцены\r\n    J2D.prototype.scene.init = function (width, heigth) {\r\n        var j2d = this.parent;\r\n        j2d.element.trigger('beforeInit');\r\n\r\n        this.width = this.originalWidth = width;\r\n        this.height = this.originalHeight = heigth;\r\n\r\n        this.parent.element.width(width).height(heigth);\r\n\r\n        j2d.layers.add('sceneNode', 0);\r\n\r\n        this.context = j2d.layers.getLayer('sceneNode').context;\r\n        this.canvas = j2d.layers.getLayer('sceneNode').canvas;\r\n        this.visible = true;\r\n\r\n        this.cancelClear = false;\r\n\r\n        /* Вид \"камеры\" */\r\n        this.viewport = j2d.vector.vec2df(0, 0);\r\n\r\n        j2d.element.trigger('afterInit');\r\n\r\n        $(window).ready(function () {\r\n            for (var i in j2d.layers.list) {\r\n                if (j2d.layers.list.hasOwnProperty(i)) {\r\n                    j2d.element.append(j2d.layers.getLayer(i).canvas);\r\n                }\r\n            }\r\n            j2d.options.ready = true;\r\n            j2d.element.trigger('ready');\r\n        });\r\n    };\r\n    /** -Scene **/\r\n\r\n    J2D.initJQueryPlugin = function () {\r\n        $.fn.j2d = function (options) {\r\n            options = $.extend(true, {}, defaults, options);\r\n\r\n            this.filter('div.canvas:not([guid])').each(function () {\r\n                $(this).data('j2d', new J2D($(this), options)).addClass('j2d');\r\n                var guid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n                    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n                    return v.toString(16);\r\n                });\r\n                $(this).attr('guid', guid);\r\n                var id = $(this).attr('id');\r\n                if (typeof id === typeof undefined || id === false) {\r\n                    $(this).attr('id', guid);\r\n                }\r\n                var tabIndex = $(this).attr('tabindex');\r\n                if (typeof tabIndex === typeof undefined || tabIndex === false) {\r\n                    $(this).attr('tabindex', '-1');\r\n                }\r\n                $(this).focus();\r\n            });\r\n\r\n            if (1 === $(this).length) {\r\n                return $(this).data('j2d');\r\n            }\r\n        };\r\n\r\n        $(document).on('click', 'div.canvas[guid].pause', function () {\r\n            $(this).data('j2d').resume();\r\n        });\r\n\r\n        $(window).on('focus', function () {\r\n            $('div.canvas[guid]').each(function () {\r\n                $(this).data('j2d').resume();\r\n            });\r\n        }).on('blur', function () {\r\n            $('div.canvas[guid]').each(function () {\r\n                $(this).data('j2d').pause();\r\n            });\r\n        });\r\n\r\n        $(window).on('resize', function () {\r\n            $('div.canvas[guid]').each(function () {\r\n                $(this).data('j2d').device.resize();\r\n            });\r\n        });\r\n    };\r\n\r\n    return J2D;\r\n});\r\n"],"sourceRoot":"/source/"}