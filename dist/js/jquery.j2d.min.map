{"version":3,"sources":["jquery.j2d.js"],"names":["root","factory","define","amd","jQuery","global","J2D","$","defaults","vector","math","dom","now","dt","io","undefined","pause","frameLimit","sceneStartTime","sceneSkipTime","engine","ready","window","webGL","element","options","j2d","this","init","gameEngine","Date","setTimeout","update","lastTime","clear","nextJ2dsGameStep","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","prototype","getInfo","name","version","site","info","author","getIO","layers","parent","scene","IOHandler","handler","setWindow","customWindow","start","html","addClass","resume","removeClass","focus","isPlay","enableWebGL","setActiveEngine","getDevice","device","width","parseInt","document","screen","height","resize","innerWidth","innerHeight","vec2df","x","y","vec2di","toInt","number","randomColor","min","max","opacity","random","omitZero","Math","floor","rad","PI","getLayers","list","getLayer","id","add","zIndex","layer","layerName","canvas","createElement","context","getContext","shadowColor","style","position","left","top","angle","visible","fillColor","onContext","fill","color","fillStyle","fillRect","setOpacity","getOpacity","setVisible","display","isVisible","setIndex","clearRect","clearNode","node","isLookScene","pos","viewport","size","save","restore","append","getScene","enableFullscreen","i","hasOwnProperty","async","data","call","setGameState","trigger","fullScreen","fullscreen","getElementById","attr","requestFullscreen","webkitRequestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen","exitFullscreen","webkitExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen","resizeToFullPage","originalWidth","originalHeight","scaleToFullScreen","toggleFullScreen","setViewPosition","ceil","setViewFocus","offset","getPosition","viewMove","heigth","cancelClear","initJQueryPlugin","fn","extend","filter","each","guid","replace","c","r","v","toString","tabIndex","length","isFullScreen","on","e","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"],"mappings":"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","file":"jquery.j2d.min","sourcesContent":["/**\r\n * J2D (jQuery plugin of the fork j2ds)\r\n *\r\n * @authors Skaner, likerRr, DeVinterX\r\n * @license zlib\r\n * @version 0.1.5a\r\n * @see https://github.com/SkanerSoft/J2ds/commit/501b8993fc41960794572dc481a5f2fe492da349\r\n */\r\n!function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        define('jquery.j2d', ['jquery'], factory);\r\n    } else {\r\n        factory(root.jQuery);\r\n    }\r\n}(global, function (jQuery) {\r\n    var $ = jQuery, J2D;\r\n    'use strict';\r\n\r\n    var defaults = {\r\n        vector: {},\r\n        math: {},\r\n        dom: {},\r\n        now: 0,\r\n        dt: 0,\r\n        io: undefined,\r\n        pause: false,\r\n        frameLimit: 60,\r\n        sceneStartTime: 0,\r\n        sceneSkipTime: 0,\r\n        engine: false,\r\n        ready: false,\r\n        window: window,\r\n\r\n        webGL: false\r\n    };\r\n\r\n    J2D = function J2D(element, options) {\r\n        var j2d = this;\r\n\r\n        j2d.element = element;\r\n        j2d.options = options;\r\n\r\n        j2d.init();\r\n\r\n        j2d.gameEngine = function () {\r\n            j2d.options.now = Date.now();\r\n\r\n            setTimeout(function () {\r\n                if (!j2d.options.pause) {\r\n                    if (j2d.options.io) {\r\n                        j2d.options.io.update();\r\n                    }\r\n                    j2d.options.dt = (j2d.options.now - j2d.options.lastTime) / 100.0;\r\n                    if (j2d.options.dt > j2d.options.sceneSkipTime) {\r\n                        j2d.options.dt = 0;\r\n                    }\r\n                    j2d.options.sceneStartTime = j2d.options.now;\r\n                    setTimeout(j2d.options.engine, 0);\r\n                    j2d.options.lastTime = j2d.options.now;\r\n                    if (j2d.options.io) {\r\n                        j2d.options.io.clear();\r\n                    }\r\n                }\r\n                nextJ2dsGameStep(j2d.gameEngine);\r\n            }, (j2d.options.frameLimit < 60 ? j2d.options.sceneSkipTime : 0));\r\n        };\r\n\r\n        var nextJ2dsGameStep = (function () {\r\n            return window.requestAnimationFrame ||\r\n                window.webkitRequestAnimationFrame ||\r\n                window.mozRequestAnimationFrame ||\r\n                window.oRequestAnimationFrame ||\r\n                window.msRequestAnimationFrame ||\r\n                function (callback) {\r\n                    window.setTimeout(callback, 1000 / j2d.options.frameLimit);\r\n                };\r\n        })();\r\n    };\r\n\r\n    /** +links getters **/\r\n    J2D.prototype.getInfo = function () {\r\n        return {\r\n            'name': 'jquery.j2d',\r\n            'version': '0.1.5',\r\n            'site': 'https://github.com/fsggs/jquery.j2d',\r\n            'info': 'jquery.j2d - jQuery plugin of the fork j2ds.',\r\n            'author': 'DeVinterX, Skaner(j2ds)'\r\n        };\r\n    };\r\n\r\n    J2D.prototype.getIO = function () {\r\n        return this.options.io;\r\n    };\r\n    /** -links getters **/\r\n\r\n    /** +GameEngine **/\r\n    J2D.prototype.init = function () {\r\n        if (this.layers) {\r\n            this.layers.parent = this;\r\n        }\r\n        if (this.scene) {\r\n            this.scene.parent = this;\r\n        }\r\n        delete this.init;\r\n    };\r\n\r\n    J2D.prototype.IOHandler = function (handler) {\r\n        return this.options.io = handler;\r\n    };\r\n\r\n    J2D.prototype.setWindow = function (customWindow) {\r\n        this.window = customWindow ? customWindow : window;\r\n    };\r\n\r\n    // старт игры\r\n    J2D.prototype.start = function (engine, frameLimit) {\r\n        var j2d = this;\r\n\r\n        j2d.options.engine = engine || function () {\r\n            j2d.element.html('Пожалуйста, инициализируйте игровую функцию!');\r\n        };\r\n        j2d.options.frameLimit = frameLimit || 60;\r\n        j2d.options.sceneSkipTime = 1000.0 / j2d.options.frameLimit;\r\n        j2d.options.lastTime = Date.now();\r\n        j2d.options.dt = 0;\r\n        j2d.options.sceneStartTime = j2d.options.lastTime;\r\n\r\n        j2d.gameEngine();\r\n    };\r\n\r\n    J2D.prototype.pause = function () {\r\n        this.options.pause = true;\r\n        this.element.addClass('pause');\r\n    };\r\n\r\n    J2D.prototype.resume = function () {\r\n        this.options.pause = false;\r\n        this.element.removeClass('pause').focus();\r\n    };\r\n\r\n    J2D.prototype.isPlay = function () {\r\n        return !this.options.pause;\r\n    };\r\n\r\n    J2D.prototype.enableWebGL = function () {\r\n        this.options.webGL = true;\r\n    };\r\n\r\n    J2D.prototype.setActiveEngine = function (engine) {\r\n        this.options.engine = engine;\r\n    };\r\n    /** -GameEngine **/\r\n\r\n    /** Device **/\r\n\r\n    J2D.prototype.getDevice = function () {\r\n        return this.device;\r\n    };\r\n\r\n    J2D.prototype.device = {\r\n        width: parseInt($(document).width()) < parseInt(screen.width) ? parseInt($(document).width()) : parseInt(screen.width),\r\n        height: parseInt($(document).height()) < parseInt(screen.height) ? parseInt($(document).height()) : parseInt(screen.height),\r\n\r\n        resize: function () {\r\n            this.width = window.innerWidth;\r\n            this.height = window.innerHeight;\r\n        }\r\n    };\r\n\r\n    /** Vector **/\r\n    J2D.prototype.vector = {\r\n        vec2df: function (x, y) {\r\n            return {x: x, y: y};\r\n        },\r\n        vec2di: function (x, y) {\r\n            return {x: (x >> 0), y: (y >> 0)};\r\n        }\r\n    };\r\n\r\n    /** Math **/\r\n    J2D.prototype.math = {\r\n        toInt: function (number) {\r\n            return number >> 0;\r\n        },\r\n        randomColor: function (min, max, opacity) {\r\n            return 'rgba(' + this.random(min, max) + ', ' + this.random(min, max) + ', ' + this.random(min, max) + ', ' + opacity + ')';\r\n        },\r\n        random: function (min, max, omitZero) {\r\n            var random = (Math.floor(Math.random() * (max - min + 1) + min));\r\n            return (omitZero && random == 0) ? this.random(min, max, omitZero) : random;\r\n        },\r\n        rad: function (number) {\r\n            return number * (Math.PI / 180);\r\n        }\r\n    };\r\n\r\n    /** +Layers **/\r\n    J2D.prototype.getLayers = function () {\r\n        return this.layers;\r\n    };\r\n\r\n    J2D.prototype.layers = {\r\n        parent: undefined,\r\n        list: {}\r\n    };\r\n\r\n    J2D.prototype.layers.getLayer = function (id) {\r\n        return this.list[id];\r\n    };\r\n    J2D.prototype.layers.add = function (id, zIndex) {\r\n        if (this.list[id]) {\r\n            return false;\r\n        }\r\n\r\n        var layer = {};\r\n        var j2d = this.parent;\r\n\r\n        layer.layerName = id;\r\n        layer.canvas = document.createElement('canvas');\r\n        layer.canvas.width = j2d.scene.width;\r\n        layer.canvas.height = j2d.scene.height;\r\n        layer.width = j2d.scene.width;\r\n        layer.height = j2d.scene.height;\r\n        layer.context = layer.canvas.getContext('2d');\r\n        layer.context.shadowColor = 'rgba(0,0,0,0)';\r\n        layer.canvas.style.zIndex = 1000 + zIndex;\r\n        layer.canvas.style.position = 'absolute';\r\n        layer.canvas.style.left = '0';\r\n        layer.canvas.style.top = '0';\r\n        layer.canvas.id = id;\r\n        layer.opacity = 1;\r\n        layer.angle = 0;\r\n        layer.visible = 1;\r\n\r\n        layer.fillColor = false;\r\n\r\n        layer.onContext = function (callback) {\r\n            callback(this.context);\r\n        };\r\n\r\n        layer.fill = function (color) {\r\n            this.fillColor = color;\r\n            this.context.fillStyle = color;\r\n            this.context.fillRect(0, 0, this.width, this.height);\r\n        };\r\n\r\n        layer.setOpacity = function (opacity) {\r\n            this.canvas.style.opacity = opacity;\r\n            this.opacity = opacity;\r\n        };\r\n\r\n        layer.getOpacity = function () {\r\n            return this.opacity;\r\n        };\r\n\r\n        layer.setVisible = function (visible) {\r\n            if (visible) {\r\n                this.canvas.style.display = 'block';\r\n                this.visible = true;\r\n            } else {\r\n                this.canvas.style.display = 'none';\r\n                this.visible = false;\r\n            }\r\n        };\r\n\r\n        layer.isVisible = function () {\r\n            return this.visible;\r\n        };\r\n\r\n        layer.setIndex = function (zIndex) {\r\n            this.canvas.style.zIndex = 1000 + zIndex;\r\n        };\r\n\r\n        layer.clear = function () {\r\n            this.context.clearRect(0, 0, this.width, this.height);\r\n        };\r\n\r\n        layer.clearNode = function (node) {\r\n            if (node.isLookScene()) {\r\n                this.context.clearRect(node.pos.x - j2d.scene.viewport.x, node.pos.y - j2d.scene.viewport.y, node.size.x, node.size.y);\r\n            }\r\n        };\r\n\r\n        layer.clearRect = function (pos, size) {\r\n            this.context.clearRect(pos.x - j2d.scene.viewport.x, pos.y - j2d.scene.viewport.y, size.x, size.y);\r\n        };\r\n\r\n        layer.resize = function (width, height) {\r\n            this.canvas.width = width;\r\n            this.canvas.height = height;\r\n            this.width = width;\r\n            this.height = height;\r\n\r\n            if (this.fillColor) {\r\n                this.context.save();\r\n\r\n                this.context.fillStyle = this.fillColor;\r\n                this.context.fillRect(0, 0, this.width, this.height);\r\n\r\n                this.context.restore();\r\n            }\r\n        };\r\n\r\n        this.list[id] = layer;\r\n\r\n        if (j2d.options.ready) {\r\n            j2d.element.append(this.list[id].canvas);\r\n        }\r\n\r\n        return layer;\r\n    };\r\n    /** -Layers **/\r\n\r\n    /** +Scene **/\r\n    J2D.prototype.getScene = function () {\r\n        return this.scene;\r\n    };\r\n\r\n    J2D.prototype.scene = {\r\n        parent: undefined,\r\n        enableFullscreen: false,\r\n        layerName: 'sceneNode',\r\n        layers: (parent.layers) ? parent.layers : {}\r\n    };\r\n\r\n    J2D.prototype.scene.resize = function (width, height) {\r\n        var j2d = this.parent;\r\n\r\n        this.width = width;\r\n        this.height = height;\r\n\r\n        for (var i in j2d.layers.list) {\r\n            if (j2d.layers.list.hasOwnProperty(i)) {\r\n                j2d.layers.list[i].resize(width, height);\r\n            }\r\n        }\r\n    };\r\n\r\n    J2D.prototype.scene.async = function (callback, data) {\r\n        setTimeout(callback.call(callback, data), 0);\r\n    };\r\n\r\n    J2D.prototype.scene.setGameState = function (engine) {\r\n        this.parent.setActiveEngine(engine);\r\n        this.parent.element.trigger('changedGameState');\r\n    };\r\n\r\n    J2D.prototype.scene.start = function (engine, frameLimit) {\r\n        if (this.parent.options.io) {\r\n            this.parent.options.io.init();\r\n        }\r\n        this.parent.element.trigger('beforeStart');\r\n        this.parent.start(engine, frameLimit);\r\n        this.parent.element.trigger('afterStart');\r\n    };\r\n\r\n    J2D.prototype.scene.fullScreen = function (fullscreen) {\r\n        var element = document.getElementById(this.parent.element.attr('id'));\r\n\r\n        if (undefined === element.requestFullscreen) {\r\n            element.requestFullscreen = element.webkitRequestFullscreen\r\n            || element.webkitRequestFullScreen\r\n            || element.mozRequestFullScreen\r\n            || element.msRequestFullscreen;\r\n        }\r\n\r\n        if (undefined === document.exitFullscreen) {\r\n            document.exitFullscreen = document.webkitExitFullscreen\r\n            || document.webkitCancelFullScreen\r\n            || document.mozCancelFullScreen\r\n            || document.msExitFullscreen;\r\n        }\r\n        if (fullscreen) {\r\n            element.requestFullscreen();\r\n        } else {\r\n            document.exitFullscreen();\r\n        }\r\n    };\r\n\r\n    J2D.prototype.scene.resizeToFullPage = function (fullscreen) {\r\n        var j2d = this.parent;\r\n        var scene = this;\r\n\r\n        if (fullscreen) {\r\n            scene.originalWidth = scene.width;\r\n            scene.originalHeight = scene.height;\r\n\r\n            scene.resize(j2d.device.width, j2d.device.height);\r\n            scene.enableFullscreen = true;\r\n        } else {\r\n            scene.resize(scene.originalWidth, scene.originalHeight);\r\n            scene.enableFullscreen = false;\r\n        }\r\n    };\r\n\r\n    J2D.prototype.scene.scaleToFullScreen = function (fullscreen) {\r\n        var layer, i;\r\n        if (fullscreen) {\r\n            for (i in this.parent.layers.list) {\r\n                if (this.parent.layers.list.hasOwnProperty(i)) {\r\n                    layer = this.parent.layers.list[i].canvas;\r\n                    layer.style.width = this.parent.device.width + 'px';\r\n                    layer.style.height = this.parent.device.height + 'px';\r\n                }\r\n            }\r\n            this.enableFullscreen = true;\r\n            this.parent.element.width(this.parent.device.width).height(this.parent.device.height);\r\n        } else {\r\n            for (i in this.parent.layers.list) {\r\n                if (this.parent.layers.list.hasOwnProperty(i)) {\r\n                    layer = this.parent.layers.list[i].canvas;\r\n                    layer.style.width = this.width + 'px';\r\n                    layer.style.height = this.height + 'px';\r\n                }\r\n            }\r\n            this.enableFullscreen = false;\r\n            this.parent.element.width(this.width).height(this.height);\r\n        }\r\n    };\r\n\r\n    J2D.prototype.scene.toggleFullScreen = function (j2d, data) {\r\n        if (data === undefined) {\r\n            data = {fullscreen: undefined};\r\n        }\r\n        if (!j2d.scene.enableFullscreen || data.fullscreen) {\r\n            j2d.scene.fullScreen(true);\r\n        } else {\r\n            j2d.scene.fullScreen(false);\r\n        }\r\n    };\r\n\r\n    // Устанавливает позицию для камеры\r\n    J2D.prototype.scene.setViewPosition = function (position) {\r\n        this.parent.scene.viewport.x = position.x - Math.ceil(this.parent.scene.width / 2);\r\n        this.parent.scene.viewport.y = position.y - Math.ceil(this.parent.scene.height / 2);\r\n    };\r\n\r\n    //! Движение \"камеры\" вслед за объектом\r\n    J2D.prototype.scene.setViewFocus = function (id, offset) {\r\n        this.parent.scene.viewport.x = id.getPosition().x - Math.ceil(this.parent.scene.width / 2) + (offset ? offset.x : 0);\r\n        this.parent.scene.viewport.y = id.getPosition().y - Math.ceil(this.parent.scene.height / 2) + (offset ? offset.y : 0);\r\n    };\r\n\r\n    //! Движение \"камеры\"\r\n    J2D.prototype.scene.viewMove = function (position) {\r\n        this.parent.scene.viewport.x += position.x;\r\n        this.parent.scene.viewport.y += position.y;\r\n    };\r\n\r\n    //! Очистка отрисованного предыдущего кадра сцены\r\n    J2D.prototype.scene.clear = function () {\r\n        this.getLayer().clear();\r\n    };\r\n\r\n    J2D.prototype.scene.getLayer = function () {\r\n        return this.parent.layers.getLayer('sceneNode');\r\n    };\r\n\r\n    // инициализация сцены\r\n    J2D.prototype.scene.init = function (width, heigth) {\r\n        var j2d = this.parent;\r\n        j2d.element.trigger('beforeInit');\r\n\r\n        this.width = this.originalWidth = width;\r\n        this.height = this.originalHeight = heigth;\r\n\r\n        this.parent.element.width(width).height(heigth);\r\n\r\n        j2d.layers.add('sceneNode', 0);\r\n\r\n        this.context = j2d.layers.getLayer('sceneNode').context;\r\n        this.canvas = j2d.layers.getLayer('sceneNode').canvas;\r\n        this.visible = true;\r\n\r\n        this.cancelClear = false;\r\n\r\n        /* Вид \"камеры\" */\r\n        this.viewport = j2d.vector.vec2df(0, 0);\r\n\r\n        j2d.element.trigger('afterInit');\r\n\r\n        $(window).ready(function () {\r\n            for (var i in j2d.layers.list) {\r\n                if (j2d.layers.list.hasOwnProperty(i)) {\r\n                    j2d.element.append(j2d.layers.getLayer(i).canvas);\r\n                }\r\n            }\r\n            j2d.options.ready = true;\r\n            j2d.element.trigger('ready');\r\n        });\r\n    };\r\n    /** -Scene **/\r\n\r\n    J2D.initJQueryPlugin = function () {\r\n        $.fn.j2d = function (options) {\r\n            options = $.extend(true, {}, defaults, options);\r\n\r\n            this.filter('div.canvas:not([guid])').each(function () {\r\n                $(this).data('j2d', new J2D($(this), options)).addClass('j2d');\r\n                var guid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n                    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n                    return v.toString(16);\r\n                });\r\n                $(this).attr('guid', guid);\r\n                var id = $(this).attr('id');\r\n                if (typeof id === typeof undefined || id === false) {\r\n                    $(this).attr('id', guid);\r\n                }\r\n                var tabIndex = $(this).attr('tabindex');\r\n                if (typeof tabIndex === typeof undefined || tabIndex === false) {\r\n                    $(this).attr('tabindex', '-1');\r\n                }\r\n                $(this).focus();\r\n            });\r\n\r\n            if (1 === $(this).length) {\r\n                return $(this).data('j2d');\r\n            }\r\n        };\r\n\r\n        var isFullScreen = false;\r\n        $(document).on('fullscreenchange webkitfullscreenchange mozfullscreenchange msfullscreenchange', 'div.canvas[guid]', function (e) {\r\n            isFullScreen = !!(document.webkitFullscreenElement\r\n            || document.webkitCurrentFullScreenElement\r\n            || document.mozFullScreenElement\r\n            || document.msFullscreenElement\r\n            );\r\n\r\n            if (!isFullScreen) {\r\n                $(this).data('j2d').scene.resizeToFullPage(isFullScreen);\r\n            }\r\n        });\r\n\r\n        $(document).on('click', 'div.canvas[guid].pause', function () {\r\n            $(this).data('j2d').resume();\r\n        });\r\n\r\n        $(window).on('focus', function () {\r\n            $('div.canvas[guid]').each(function () {\r\n                $(this).data('j2d').resume();\r\n            });\r\n        }).on('blur', function () {\r\n            $('div.canvas[guid]').each(function () {\r\n                $(this).data('j2d').pause();\r\n            });\r\n        });\r\n\r\n        $(window).on('resize', function () {\r\n            $('div.canvas[guid]').each(function () {\r\n                $(this).data('j2d').device.resize();\r\n                if (isFullScreen) {\r\n                    $(this).data('j2d').scene.resizeToFullPage(isFullScreen);\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    return J2D;\r\n});\r\n"],"sourceRoot":"/source/"}