/**
 * J2D (jQuery Canvas Graphic Engine plugin)
 *
 * @authors DeVinterX, Skaner(j2Ds)
 * @license BSD
 * @version 0.2.0-dev
 */

if (global === undefined) {var global = window || this}
if (typeof define !== 'function' || !define.amd) {global.J2D = true; global.exports = {}}

!function(t,e){"function"==typeof define&&define.amd?define("jquery.j2d",["jquery","core/WebGL2D","core/FrameManager","core/SceneManager","core/LayersManager"],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e(require("jquery"),require("core/WebGL2D"),require("core/FrameManager"),require("core/SceneManager"),require("core/LayersManager")):e(t.jQuery,t.WebGL2D,t.FrameManager,t.SceneManager,t.LayersManager)}("undefined"!=typeof window?window:global,function(t,e,i,o,r){"use strict";var n={id:void 0,io:void 0,deltaTime:0,pause:!1,ready:!1,frameLimit:60,smoothing:!0,webGL:!1},a=function(t,i){this.element=t,this.data=i,this.layers=new r(this,e),this.scene=new o(this,e)};return a.prototype.getIOHandler=function(){return this.data.io},a.prototype.IOHandler=function(t){return this.data.io=t},a.prototype.start=function(t,e){var o=this;t=t||function(){o.element.html("Please init game engine function!"),console.warn("Please init game engine function for "+o.data.id+"!")},i.start(o.data.id,t,{j2d:o,frameLimit:e}),o.data.frameLimit=e,o.element.trigger("start")},a.prototype.stop=function(){i.stop(this.data.id),this.element.trigger("stop")},a.prototype.pause=function(){this.data.io&&this.data.io.flush(),this.data.pause=!0,this.element.addClass("pause"),this.element.trigger("pause")},a.prototype.resume=function(){this.element.removeClass("pause").focus(),this.data.pause=!1,this.data.io&&this.data.io.flush(),this.element.trigger("resume")},a.prototype.isPlay=function(){return!this.data.pause},a.prototype.enableWebGL=function(){this.data.webGL=!0,this.element.addClass("WebGL")},a.prototype.setSmoothing=function(t){this.data.smoothing=!!t},a.prototype.disableWebGL=function(){this.data.webGL=!1,this.element.removeClass("WebGL")},a.prototype.setGameState=function(t){var e=this;t=t||function(){e.element.html("Please set game engine function!"),console.warn("Please set game engine function for "+e.data.id+"!")},i.stop(e.data.id),i.start(e.data.id,t,{j2d:e,frameLimit:e.data.frameLimit})},a.prototype.getLayerManager=function(){return this.layers},a.prototype.getSceneManager=function(){return this.scene},a.prototype.on=function(){},a.prototype.once=function(){},a.prototype.off=function(){},a.prototype.trigger=function(){},a.util={disableSmoothing:function(t){var e=global.navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),i=e?parseInt(e[2],10):!1;t.imageSmoothingEnabled=!1,t.mozImageSmoothingEnabled=!1,t.oImageSmoothingEnabled=!1,i&&29>=i&&(t.webkitImageSmoothingEnabled=!1),t.msImageSmoothingEnabled=!1}},a.prototype.util=a.util,a.initPlugin=function(){if(void 0!==window.j2dPlugin)return null;window.j2dPlugin={pluginInit:!0},t.fn.j2d=function(e){this.filter("div.canvas:not([guid])").each(function(){var e=t.extend(!0,{},n,e),i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)});e.id=i,t(this).attr("guid",i);var o=t(this).attr("id");("undefined"==typeof o||o===!1)&&t(this).attr("id",i);var r=t(this).attr("tabindex");("undefined"==typeof r||r===!1)&&t(this).attr("tabindex","-1"),t(this).data("j2d",new a(t(this),e)).addClass("j2d"),t(this).click().focus()});var i=[];return this.filter("div.canvas[guid]").each(function(){i.push(t(this).data("j2d"))}),1===i.length?t(this).data("j2d"):i};var e=function(){return!!(document.webkitFullscreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement)};t(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){var i=e();i||t("div.canvas[guid]:not(.active)").toggle(!i)}),t(document).on("click","div.canvas[guid].pause",function(){t(this).data("j2d").resume();var e=this;t("div.canvas[guid]:not(.pause-disable):not(:focus)").each(function(){e!==this&&t(this).removeClass("active").data("j2d").pause()}),t("div.canvas[guid].active.pause-disable:not(:focus)").each(function(){e!==this&&t(this).removeClass("active")})}),t(document).on("click touch mouseenter","div.canvas[guid]:not(.resume-by-click):not(:focus)",function(){t(this).addClass("active").focus().data("j2d").resume();var e=this;t("div.canvas[guid]:not(.pause-disable):not(:focus)").each(function(){e!==this&&t(this).removeClass("active").data("j2d").pause()}),t("div.canvas[guid].active.pause-disable:not(:focus)").each(function(){e!==this&&t(this).removeClass("active")})}),t(window).on("focus",function(){t("div.canvas[guid].active").each(function(){t(this).data("j2d").resume()})}).on("blur",function(){t("div.canvas[guid]").each(function(){t(this).data("j2d").pause()})}),t(window).on("resize",function(){t("div.canvas[guid]").each(function(){t(this).data("j2d").device.resize()});e()}),i.pulse()},global.J2D=void 0===global.J2D?a:void 0,a}),function(t,e){"function"==typeof define&&define.amd?define("core/FrameManager",["utils/ArrayMap"],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e(require("utils/ArrayMap")):e(t.ArrayMap)}("undefined"!=typeof window?window:global,function(t){"use strict";var e,i=new t,o=new t,r={frameLimit:60,frameRun:!1,breakAnimationFrame:!1},n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){r.breakAnimationFrame?r.breakAnimationFrame=!1:window.setTimeout(t.call(t,[Date.now()]),1e3/r.frameLimit)}}(),a=function(){return r.breakAnimationFrame=!0,window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame}(),s=function(){};return s.prototype.start=function(t,e,n){var a={j2d:void 0,frameLimit:r.frameLimit,now:0,deltaTime:0,lastTime:0,sceneStartTime:0,sceneSkipTime:0};if(void 0!==n.frameLimit&&n.frameLimit<=r.frameLimit&&(a.frameLimit=n.frameLimit),void 0===n.j2d)throw"j2d not transported to FrameManager.start(id, engine, {... j2d: j2d ...});";a.j2d=n.j2d,a.interval=1e3/a.frameLimit,a.lastTime=Date.now(),i.add(t,e),o.add(t,a),r.frameRun||this.pulse()},s.prototype.stop=function(t){i.remove(t),o.remove(t)},s.prototype.pulse=function(){this.runMainLoop(Date.now())},s.prototype.runMainLoop=function(t,e){if(void 0===e&&(e=this),i.length<=0&&r.frameRun)return r.frameRun=!1,a(this.runMainLoop);r.frameRun=!0;for(var s in i)if(i.hasOwnProperty(s)&&"function"==typeof i[s]){var f=i[s],u=o[s];u.now=Date.now(),u.j2d.data.deltaTime=u.deltaTime=(u.now-u.lastTime)/100,u.j2d.data.io&&!u.j2d.data.pause&&u.j2d.data.io.update(),100*u.deltaTime>u.interval&&(u.lastTime=u.now-100*u.deltaTime%u.interval,u.j2d.data.pause||(u.j2d.data.deltaTime=u.deltaTime,f(t,u))),u.j2d.data.io&&!u.j2d.data.pause&&u.j2d.data.io.clear()}n(function(t){e.runMainLoop(t,e)})},s.prototype.setDefaultFrameLimit=function(t){60>=t&&t>0&&(r.frameLimit=t)},s.Init=function(){return void 0!==window.J2D?window.instanceFrameManager||(window.instanceFrameManager=new s):e||(e=new s)},void 0===window.J2D&&(window.FrameManager=s.Init()),s.Init()}),function(t,e){"function"==typeof define&&define.amd?define("core/LayersManager",[],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e():e()}("undefined"!=typeof window?window:global,function(){"use strict";var t,e=function(e,i){this.j2d=e,this.list={},t=i};return void 0!==global.J2D&&(global.LayersManager=e),e}),function(t,e){"function"==typeof define&&define.amd?define("core/SceneManager",["jquery"],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e(require("jquery")):e(t.jQuery)}("undefined"!=typeof window?window:global,function(t){"use strict";var e,i={width:0,height:0,originalWidth:0,originalHeight:0,originalMargin:0,position:"absolute",top:0,left:0,zIndex:1e3,opacity:1,backgroundColor:!1,frameLimit:60,enableFullScreen:!1},o=function(t,i){var o=this;this.j2d=t,this.canvas=null,this.context=null,e=i,Object.defineProperty(this,"backgroundColor",{get:function(){return o.data.backgroundColor},set:function(t){o.data.backgroundColor=t,o.context.fillStyle=t,o.context.fillRect(0,0,o.data.width,o.data.height)}}),Object.defineProperty(this,"opacity",{get:function(){return o.data.opacity},set:function(t){o.data.opacity=t,o.canvas.style.opacity=t}})};return o.prototype.init=function(e){return this.data=t.extend(!0,{},i,e),this.j2d.trigger("beforeInit"),this.data.originalWidth=this.data.width,this.data.originalHeight=this.data.height,this.data.originalMargin=this.j2d.element.css("margin"),this.j2d.element.width(this.data.width).height(this.data.height),this.initCanvas(),this.j2d.trigger("afterInit"),this},o.prototype.initCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.data.width,this.canvas.height=this.data.height,this.canvas.style.zIndex=this.data.zIndex,this.canvas.style.position=this.data.position,this.canvas.style.left=this.data.left,this.canvas.style.top=this.data.top,this.j2d.data.webGL?(e.enable(this.canvas),this.context=this.canvas.getContext("WebGL-2d")):this.context=this.canvas.getContext("2d"),this.j2d.data.smoothing||this.j2d.util.disableSmoothing(this.context),this.context.shadowColor="rgba(0,0,0,0)",this.data.backgroundColor&&(this.backgroundColor=this.data.backgroundColor),this.data.opacity&&(this.opacity=this.data.opacity),this.j2d.element.append(this.canvas)},o.prototype.start=function(){return this},o.prototype.setGameState=function(t){return this.j2d.setGameState(t),this},void 0!==global.J2D&&(global.SceneManager=o),o}),function(t,e){"function"==typeof define&&define.amd?define("core/WebGL2D",[],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e():e()}("undefined"!=typeof window?window:global,function(){"use strict";function t(t){return t>0&&0===(t-1&t)}function e(t){return this.clearStack(t)}var i={identity:[1,0,0,0,1,0,0,0,1],multiply:function(t,e){var i=t[0],o=t[1],r=t[2],n=t[3],a=t[4],s=t[5],f=t[6],u=t[7],c=t[8],l=e[0],d=e[1],h=e[2],p=e[3],m=e[4],g=e[5],y=e[6],b=e[7],v=e[8];e[0]=l*i+p*o+y*r,e[1]=d*i+m*o+b*r,e[2]=h*i+g*o+v*r,e[3]=l*n+p*a+y*s,e[4]=d*n+m*a+b*s,e[5]=h*n+g*a+v*s,e[6]=l*f+p*u+y*c,e[7]=d*f+m*u+b*c,e[8]=h*f+g*u+v*c},vec2_multiply:function(t,e){var i=[];return i[0]=e[0]*t[0]+e[3]*t[1]+e[6],i[1]=e[1]*t[0]+e[4]*t[1]+e[7],i},transpose:function(t){return[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]}},o=16;e.prototype.clearStack=function(t){this.m_stack=[],this.m_cache=[],this.c_stack=0,this.valid=0,this.result=null;for(var e=0;o>e;e++)this.m_stack[e]=this.getIdentity();void 0!==t?this.m_stack[0]=t:this.setIdentity()},e.prototype.setIdentity=function(){this.m_stack[this.c_stack]=this.getIdentity(),this.valid===this.c_stack&&this.c_stack&&this.valid--},e.prototype.getIdentity=function(){return[1,0,0,0,1,0,0,0,1]},e.prototype.getResult=function(){if(!this.c_stack)return this.m_stack[0];var t=i.identity;this.valid>this.c_stack-1&&(this.valid=this.c_stack-1);for(var e=this.valid;e<this.c_stack+1;e++)t=i.multiply(this.m_stack[e],t),this.m_cache[e]=t;return this.valid=this.c_stack-1,this.result=this.m_cache[this.c_stack],this.result},e.prototype.pushMatrix=function(){this.c_stack++,this.m_stack[this.c_stack]=this.getIdentity()},e.prototype.popMatrix=function(){0!==this.c_stack&&this.c_stack--};var r=e.prototype.getIdentity();e.prototype.translate=function(t,e){r[6]=t,r[7]=e,i.multiply(r,this.m_stack[this.c_stack])};var n=e.prototype.getIdentity();e.prototype.tr=function(t,e,o,r,a,s){n[0]=t,n[1]=e,n[3]=o,n[4]=r,n[6]=a,n[7]=s,i.multiply(n,this.m_stack[this.c_stack])};var a=e.prototype.getIdentity();e.prototype.scale=function(t,e){a[0]=t,a[4]=e,i.multiply(a,this.m_stack[this.c_stack])};var s=e.prototype.getIdentity();e.prototype.rotate=function(t){var e,o;e=Math.sin(-t),o=Math.cos(-t),s[0]=o,s[3]=e,s[1]=-e,s[4]=o,i.multiply(s,this.m_stack[this.c_stack])};var f=global.WebGL2D=function(t,i){this.canvas=t,this.options=i||{},this.gl=void 0,this.fs=void 0,this.vs=void 0,this.shaderProgram=void 0,this.transform=new e,this.shaderPool=[],this.maxTextureSize=void 0,t.gl2d=this,t.$getContext=t.getContext,t.getContext=function(e){return function(i){if(!e.options.force&&"WebGL-2d"!==i||0===t.width||0===t.height)return e.canvas.$getContext(i);if(e.gl)return e.gl;var o=e.gl=e.canvas.$getContext("experimental-webgl");return"undefined"==typeof o||null===o?e.canvas.$getContext("2d"):(e.initShaders(),e.initBuffers(),e.initCanvas2DAPI(),o.enable(o.BLEND),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA),e.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),o)}}(this),this.postInit()};f.enable=function(t,e){return t.gl2d||new f(t,e)};var u={texture:1,crop:2,path:4};f.prototype.getFragmentShaderSource=function(t){var e=["#ifdef GL_ES","precision highp float;","#endif","#define hasTexture "+(t&u.texture?"1":"0"),"#define hasCrop "+(t&u.crop?"1":"0"),"varying vec4 vColor;","#if hasTexture","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","#if hasCrop","uniform vec4 uCropSource;","#endif","#endif","void main(void) {","#if hasTexture","#if hasCrop","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x * uCropSource.z, vTextureCoord.y * uCropSource.w) + uCropSource.xy);","#else","gl_FragColor = texture2D(uSampler, vTextureCoord);","#endif","#else","gl_FragColor = vColor;","#endif","}"].join("\n");return e},f.prototype.getVertexShaderSource=function(t,e){t=t||1;var i=["#define hasTexture "+(e&u.texture?"1":"0"),"attribute vec4 aVertexPosition;","#if hasTexture","varying vec2 vTextureCoord;","#endif","uniform vec4 uColor;","uniform mat3 uTransforms["+t+"];","varying vec4 vColor;","uniform mat4 pMatrix;","mat3 crunchStack(void) {","mat3 result = uTransforms[0];","for (int i = 1; i < "+t+"; ++i) {","result = uTransforms[i] * result;","}","return result;","}","void main(void) {","vec3 position = crunchStack() * vec3(aVertexPosition.x, aVertexPosition.y, 1.0);","gl_Position = pMatrix * vec4(position, 1.0);","vColor = uColor;","#if hasTexture","vTextureCoord = aVertexPosition.zw;","#endif","}"].join("\n");return i},f.prototype.initShaders=function(t,e){var i=this.gl;t=t||1,e=e||0;var o=this.shaderPool[t];if(o||(o=this.shaderPool[t]=[]),o=o[e])i.useProgram(o),this.shaderProgram=o;else{var r=this.fs=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(this.fs,this.getFragmentShaderSource(e)),i.compileShader(this.fs),!i.getShaderParameter(this.fs,i.COMPILE_STATUS))throw"fragment shader error: "+i.getShaderInfoLog(this.fs);var n=this.vs=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(this.vs,this.getVertexShaderSource(t,e)),i.compileShader(this.vs),!i.getShaderParameter(this.vs,i.COMPILE_STATUS))throw"vertex shader error: "+i.getShaderInfoLog(this.vs);var a=this.shaderProgram=i.createProgram();if(a.stackDepth=t,i.attachShader(a,r),i.attachShader(a,n),i.linkProgram(a),!i.getProgramParameter(a,i.LINK_STATUS))throw"Could not initialise shaders.";i.useProgram(a),a.vertexPositionAttribute=i.getAttribLocation(a,"aVertexPosition"),i.enableVertexAttribArray(a.vertexPositionAttribute),a.uColor=i.getUniformLocation(a,"uColor"),a.uSampler=i.getUniformLocation(a,"uSampler"),a.uCropSource=i.getUniformLocation(a,"uCropSource"),a.pMatrix=i.getUniformLocation(a,"pMatrix"),a.uTransforms=[];for(var s=0;t>s;++s)a.uTransforms[s]=i.getUniformLocation(a,"uTransforms["+s+"]");this.shaderPool[t][e]=a}return l[0]=2/this.canvas.width,l[5]=-2/this.canvas.height,i.uniformMatrix4fv(this.shaderProgram.pMatrix,!1,l),i.viewport(0,0,this.canvas.width,this.canvas.height),this.shaderProgram};var c=new Float32Array([0,0,0,0,0,1,0,1,1,1,1,1,1,0,1,0]),l=new Float32Array(16);return l[10]=1,l[11]=1,l[12]=-1,l[13]=1,f.prototype.initBuffers=function(){var t=this.gl;t.rectVertexPositionBuffer=t.createBuffer(),t.rectVertexColorBuffer=t.createBuffer(),t.pathVertexPositionBuffer=t.createBuffer(),t.pathVertexColorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,t.rectVertexPositionBuffer),t.bufferData(t.ARRAY_BUFFER,c,t.STATIC_DRAW)},f.instances=[],f.prototype.postInit=function(){f.instances.push(this)},f.prototype.initCanvas2DAPI=function(){function e(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}function i(t,i,o,r){var n,a,s,f,u;return t=(t%360+360)%360/360,i=i>100?1:i/100,i=0>i?0:i,o=o>100?1:o/100,o=0>o?0:o,0==i?n=a=s=o:(u=.5>o?o*(1+i):o+i-o*i,f=2*o-u,n=e(f,u,t+1/3),a=e(f,u,t),s=e(f,u,t-1/3)),[n,a,s,r]}function o(t){var e,r,n,a,s,f,u=[];if(e=b.exec(t)){if(a=e[1],s=parseFloat(e[8]),a&&isNaN(s)||!a&&!isNaN(s))return!1;f=e[3];for(var c=2;8>c;c+=2){if(r=e[c],n=e[c+1],n!==f)return!1;n?(r=r>100?1:r/100,r=0>r?0:r):(r=r>255?1:r/255,r=0>r?0:r),u.push(r)}u.push(a?s:1)}else if(e=v.exec(t))a=e[1],s=parseFloat(e[5]),u=i(e[2],e[3],e[4],parseFloat(a&&s?s:1));else if(e=w.exec(t)){var l=parseInt(e[1],16);u=[((16711680&l)>>16)/255,((65280&l)>>8)/255,(255&l)/255,1]}else if(e=S.exec(t)){var d="#"+[e[1],e[1],e[2],e[2],e[3],e[3]].join("");u=o(d)}else if(t.toLowerCase()in A)u=o(A[t.toLowerCase()]);else{if("transparent"!==t.toLowerCase())return!1;u=[0,0,0,0]}return u}function r(t){return"rgba("+255*t[0]+", "+255*t[1]+", "+255*t[2]+", "+parseFloat(t[3])+")"}function n(){var t={fillStyle:[T.fillStyle[0],T.fillStyle[1],T.fillStyle[2],T.fillStyle[3]],strokeStyle:[T.strokeStyle[0],T.strokeStyle[1],T.strokeStyle[2],T.strokeStyle[3]],globalAlpha:T.globalAlpha,globalCompositeOperation:T.globalCompositeOperation,lineCap:T.lineCap,lineJoin:T.lineJoin,lineWidth:T.lineWidth,miterLimit:T.miterLimit,shadowColor:T.shadowColor,shadowBlur:T.shadowBlur,shadowOffsetX:T.shadowOffsetX,shadowOffsetY:T.shadowOffsetY,textAlign:T.textAlign,font:T.font,textBaseline:T.textBaseline,imageSmoothingEnabled:T.imageSmoothingEnabled};C.push(t)}function a(){C.length&&(T=C.pop())}function s(t){for(var e=h.transform.m_stack,i=0,o=h.transform.c_stack+1;o>i;++i)p.uniformMatrix3fv(t.uTransforms[i],!1,e[o-1-i])}function f(t,e){this.closed=!1,this.verts=[t,e,0,0]}function c(t){var e=h.transform,i=h.initShaders(e.c_stack+2,0),o=P[t],r=o.verts;p.bindBuffer(p.ARRAY_BUFFER,p.pathVertexPositionBuffer),p.bufferData(p.ARRAY_BUFFER,new Float32Array(r),p.STATIC_DRAW),p.vertexAttribPointer(i.vertexPositionAttribute,4,p.FLOAT,!1,0,0),e.pushMatrix(),s(i),p.uniform4f(i.uColor,T.fillStyle[0],T.fillStyle[1],T.fillStyle[2],T.fillStyle[3]),p.drawArrays(p.TRIANGLE_FAN,0,r.length/4),e.popMatrix()}function l(t){var e=h.transform,i=h.initShaders(e.c_stack+2,0),o=P[t],r=o.verts;p.bindBuffer(p.ARRAY_BUFFER,p.pathVertexPositionBuffer),p.bufferData(p.ARRAY_BUFFER,new Float32Array(r),p.STATIC_DRAW),p.vertexAttribPointer(i.vertexPositionAttribute,4,p.FLOAT,!1,0,0),e.pushMatrix(),s(i),p.uniform4f(i.uColor,T.strokeStyle[0],T.strokeStyle[1],T.strokeStyle[2],T.strokeStyle[3]),o.closed?p.drawArrays(p.LINE_LOOP,0,r.length/4):p.drawArrays(p.LINE_STRIP,0,r.length/4),e.popMatrix()}function d(e){if(this.obj=p.createTexture(),this.index=_.push(this),E.push(e),e.width>h.maxTextureSize||e.height>h.maxTextureSize){var i=document.createElement("canvas");i.width=e.width>h.maxTextureSize?h.maxTextureSize:e.width,i.height=e.height>h.maxTextureSize?h.maxTextureSize:e.height;var o=i.getContext("2d");o.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),e=i}var r=p.LINEAR,n=p.LINEAR_MIPMAP_LINEAR;T.imageSmoothingEnabled||(r=p.NEAREST,n=p.LINEAR_MIPMAP_NEAREST),p.bindTexture(p.TEXTURE_2D,this.obj),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),t(e.width)&&t(e.height)?(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,n),p.generateMipmap(p.TEXTURE_2D)):p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,r),p.bindTexture(p.TEXTURE_2D,null)}var h=this,p=this.gl,m=document.createElement("canvas");m.width=h.canvas.width,m.height=h.canvas.height;var g=m.getContext("2d"),b=/^rgb(a)?\(\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,?\s*(-?[\d\.]+)?\s*\)$/,v=/^hsl(a)?\(\s*(-?[\d\.]+)\s*,\s*(-?[\d\.]+)%\s*,\s*(-?[\d\.]+)%\s*,?\s*(-?[\d\.]+)?\s*\)$/,w=/^#([0-9A-Fa-f]{6})$/,S=/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/,A={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},T={},C=[];T.fillStyle=[0,0,0,1],Object.defineProperty(p,"fillStyle",{get:function(){return r(T.fillStyle)},set:function(t){T.fillStyle=o(t)||T.fillStyle}}),T.strokeStyle=[0,0,0,1],Object.defineProperty(p,"strokeStyle",{get:function(){return r(T.strokeStyle)},set:function(t){T.strokeStyle=o(t)||drawStyle.strokeStyle}}),p.$lineWidth=p.lineWidth,T.lineWidth=1,Object.defineProperty(p,"lineWidth",{get:function(){return T.lineWidth},set:function(t){t>0&&(p.$lineWidth(t),T.lineWidth=t)}}),T.lineCap="butt",Object.defineProperty(p,"lineCap",{get:function(){return T.lineCap},set:function(t){T.lineCap=t}}),T.lineJoin="miter",Object.defineProperty(p,"lineJoin",{get:function(){return T.lineJoin},set:function(t){T.lineJoin=t}}),T.miterLimit=10,Object.defineProperty(p,"miterLimit",{get:function(){return T.miterLimit},set:function(t){T.miterLimit=t}}),T.shadowOffsetX=0,Object.defineProperty(p,"shadowOffsetX",{get:function(){return T.shadowOffsetX},set:function(t){T.shadowOffsetX=t}}),T.shadowOffsetY=0,Object.defineProperty(p,"shadowOffsetY",{get:function(){return T.shadowOffsetY},set:function(t){T.shadowOffsetY=t}}),T.shadowBlur=0,Object.defineProperty(p,"shadowBlur",{get:function(){return T.shadowBlur},set:function(t){T.shadowBlur=t}}),T.shadowColor="rgba(0, 0, 0, 0.0)",Object.defineProperty(p,"shadowColor",{get:function(){return T.shadowColor},set:function(t){T.shadowColor=t}}),T.font="10px sans-serif",Object.defineProperty(p,"font",{get:function(){return T.font},set:function(t){g.font=t,T.font=t}}),T.textAlign="start",Object.defineProperty(p,"textAlign",{get:function(){return T.textAlign},set:function(t){T.textAlign=t}}),T.textBaseline="alphabetic",Object.defineProperty(p,"textBaseline",{get:function(){return T.textBaseline},set:function(t){T.textBaseline=t}}),T.globalAlpha=1,Object.defineProperty(p,"globalAlpha",{get:function(){return T.globalAlpha},set:function(t){T.globalAlpha=t}}),T.imageSmoothingEnabled=!0,Object.defineProperty(p,"imageSmoothingEnabled",{get:function(){return T.imageSmoothingEnabled},set:function(t){T.imageSmoothingEnabled=!!t}}),T.globalCompositeOperation="source-over",Object.defineProperty(p,"globalCompositeOperation",{get:function(){return T.globalCompositeOperation},set:function(t){T.globalCompositeOperation=t}}),p.fillText=function(t,e,i){g.clearRect(0,0,h.canvas.width,h.canvas.height),g.fillStyle=p.fillStyle,g.fillText(t,e,i),p.drawImage(m,0,0)},p.strokeText=function(){},p.measureText=function(){return 1};var j=document.createElement("canvas"),k=j.getContext("2d");p.save=function(){h.transform.pushMatrix(),n()},p.restore=function(){h.transform.popMatrix(),a()},p.translate=function(t,e){h.transform.translate(t,e)},p.rotate=function(t){h.transform.rotate(t)},p.scale=function(t,e){h.transform.scale(t,e)},p.createImageData=function(t,e){return k.createImageData(t,e)},p.getImageData=function(t,e,i,o){var r=k.createImageData(i,o),n=new Uint8Array(i*o*4);p.readPixels(t,e,i,o,p.RGBA,p.UNSIGNED_BYTE,n);for(var a=4*i,s=o,f=0,u=s/2;u>f;++f)for(var c=0,l=a;l>c;++c){var d=f*a+c,h=(s-f-1)*a+c;r.data[d]=n[h],r.data[h]=n[d]}return r},p.putImageData=function(t,e,i){p.drawImage(t,e,i)},p.transform=function(t,e,i,o,r,n){h.transform.tr(t,e,i,o,r,n)},p.setTransform=function(t,e,i,o,r,n){h.transform.setIdentity(),p.transform.apply(this,arguments)},p.fillRect=function(t,e,i,o){var r=h.transform,n=h.initShaders(r.c_stack+2,0);p.bindBuffer(p.ARRAY_BUFFER,p.rectVertexPositionBuffer),p.vertexAttribPointer(n.vertexPositionAttribute,4,p.FLOAT,!1,0,0),r.pushMatrix(),r.translate(t,e),r.scale(i,o),s(n),p.uniform4f(n.uColor,T.fillStyle[0],T.fillStyle[1],T.fillStyle[2],T.fillStyle[3]),p.drawArrays(p.TRIANGLE_FAN,0,4),r.popMatrix()},p.strokeRect=function(t,e,i,o){var r=h.transform,n=h.initShaders(r.c_stack+2,0);p.bindBuffer(p.ARRAY_BUFFER,p.rectVertexPositionBuffer),p.vertexAttribPointer(n.vertexPositionAttribute,4,p.FLOAT,!1,0,0),r.pushMatrix(),r.translate(t,e),r.scale(i,o),s(n),p.uniform4f(n.uColor,T.strokeStyle[0],T.strokeStyle[1],T.strokeStyle[2],T.strokeStyle[3]),p.drawArrays(p.LINE_LOOP,0,4),r.popMatrix()},p.clearRect=function(t,e,i,o){};var P=[];p.beginPath=function(){P.length=0},p.closePath=function(){if(P.length){var t=P[P.length-1],e=t.verts[0],i=t.verts[1];t.closed=!0;var o=new f(e,i);P.push(o)}},p.moveTo=function(t,e){P.push(new f(t,e))},p.lineTo=function(t,e){P.length?P[P.length-1].verts.push(t,e,0,0):p.moveTo(t,e)},p.quadraticApproximateCount=50,p.quadraticCurveTo=function(t,e,i,o){if(P.length)for(var r,n,a,s,f=P[P.length-1].verts,u=f[f.length-4],c=f[f.length-3],l=0;l<p.quadraticApproximateCount;l++)r=l/p.quadraticApproximateCount,n=1-r,a=n*n*u+2*n*r*t+r*r*i,s=n*n*c+2*n*r*e+r*r*o,f.push(a,s,0,0);else p.moveTo(i,o)},p.bezierApproximateCount=50,p.bezierCurveTo=function(t,e,i,o,r,n){if(P.length)for(var a,s,f,u,c=P[P.length-1].verts,l=c[c.length-4],d=c[c.length-3],h=0;h<p.bezierApproximateCount;h++)a=h/p.bezierApproximateCount,s=1-a,f=s*s*s*l+3*s*s*a*t+3*s*a*a*i+a*a*a*r,u=s*s*s*d+3*s*s*a*e+3*s*a*a*o+a*a*a*n,c.push(f,u,0,0);else p.moveTo(r,n)},p.arcTo=function(){P.length||p.moveTo(x,y)},p.rect=function(t,e,i,o){p.moveTo(t,e),p.lineTo(t+i,e),p.lineTo(t+i,e+o),p.lineTo(t,e+o),p.closePath()},p.arcApproximateCount=100,p.arc=function(t,e,i,o,r,n){if(P.length){var a=P[P.length-1].verts,s=t+i*Math.cos(o),f=e+i*Math.sin(o);for(a.push(s,f,0,0);o>2*Math.PI;)o-=2*Math.PI;for(;r>2*Math.PI;)r-=2*Math.PI;for(;o<2*-Math.PI;)o+=2*Math.PI;for(;r<2*-Math.PI;)r+=2*Math.PI;if(o==r)return;var u,c=1/p.arcApproximateCount,l=p.arcApproximateCount;n&&(r-=2*Math.PI,c=-c);for(var d=o;d>r&&n||r>d&&!n;d+=c)u!=(u=(d*l|0)/l)&&(s=t+i*Math.cos(u),f=e+i*Math.sin(u),a.push(s,f,0,0))}else p.moveTo(s,f)},p.fill=function(){for(var t=0;t<P.length;t++)c(t)},p.stroke=function(){for(var t=0;t<P.length;t++)l(t)},p.clip=function(){},p.isPointInPath=function(){},p.drawFocusRing=function(){};var E=[],_=[];p.drawImage=function(t,e,i,o,r,n,a,f,c){var l=h.transform;l.pushMatrix();var m=u.texture,g=!1;3===arguments.length?(l.translate(e,i),l.scale(t.width,t.height)):5===arguments.length?(l.translate(e,i),l.scale(o,r)):9===arguments.length&&(l.translate(n,a),l.scale(f,c),m|=u.crop,g=!0);var y,b=h.initShaders(l.c_stack+1,m),v=E.indexOf(t);y=-1!==v?_[v]:new d(t),g&&p.uniform4f(b.uCropSource,e/t.width,i/t.height,o/t.width,r/t.height),p.bindBuffer(p.ARRAY_BUFFER,p.rectVertexPositionBuffer),p.vertexAttribPointer(b.vertexPositionAttribute,4,p.FLOAT,!1,0,0),p.bindTexture(p.TEXTURE_2D,y.obj),p.activeTexture(p.TEXTURE0),p.uniform1i(b.uSampler,0),s(b),p.drawArrays(p.TRIANGLE_FAN,0,4),l.popMatrix()},Object.defineProperty(p,"isWebGL",{configurable:!1,enumerable:!0,writable:!1,value:!0})},f}),function(t,e){"function"==typeof define&&define.amd?define("utils/ArrayMap",[],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e():e()}("undefined"!=typeof window?window:global,function(){"use strict";var t=function(t){Array.call(this,t)};return t.prototype=Object.create(Array.prototype),t.prototype.constructor=t,t.prototype.equals=function(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var e=0,i=this.length;i>e;e++)if(this[e]instanceof Array&&t[e]instanceof Array){if(!this[e].equals(t[e]))return!1}else if(this[e]!=t[e])return!1;return!0},Object.defineProperty(t.prototype,"equals",{enumerable:!1}),t.prototype.contains=function(t){for(var e=this.length;e--;)if(this[e]===t)return!0;return!1},Object.defineProperty(t.prototype,"contains",{enumerable:!1}),t.prototype.each=function(t){if(!t)return!1;for(var e=!1,i=0;i<this.length;i++)if(0==(e=t(this[i],i)))return e;return e},Object.defineProperty(t.prototype,"each",{enumerable:!1}),t.prototype.add=function(t,e){return this.contains(t)?this[t]=e:(this.push(t),this[t]=e),this},Object.defineProperty(t.prototype,"add",{enumerable:!1}),t.prototype.remove=function(t){for(var e=0;e<this.length;++e)if(this[e]==t)return this.splice(e,1),delete this[t],this;return this},Object.defineProperty(t.prototype,"remove",{enumerable:!1}),"function"==typeof define&&define.amd||(global.ArrayMap=t),t}),function(t,e){"function"==typeof define&&define.amd?define("utils/DeviceUtil",["jquery","utils/Vector2dInteger"],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e(require("jquery"),require("utils/Vector2dInteger")):e(t.jQuery,t.Vector2dInteger)}("undefined"!=typeof window?window:global,function(t,e){"use strict";var i=function(){this.width=parseInt(t(document).width())<parseInt(screen.width)?parseInt(t(document).width()):parseInt(screen.width),this.height=parseInt(t(document).height())<parseInt(screen.height)?parseInt(t(document).height()):parseInt(screen.height)};return i.prototype.reCalculateSize=function(){return this.width=window.innerWidth,this.height=window.innerHeight,this},i.prototype.getWidth=function(){return this.width},i.prototype.getHeight=function(){return this.height},i.prototype.getSize=function(){return new e(this.width,this.height)},void 0===global.J2D&&(global.DeviceUtil=i),i}),function(t,e){"function"==typeof define&&define.amd?define("utils/Exceptions",[],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e():e();
}("undefined"!=typeof window?window:global,function(){"use strict";var t=function(t){Error.call(this),this.message=t,this.toString=function(){return this.message}};t.prototype=Object.create(Error.prototype),t.prototype.constructor=t;var e=function(e){t.call(this,e)};e.prototype=Object.create(t.prototype),e.prototype.constructor=e;var i=function(e){t.call(this,e)};i.prototype=Object.create(t.prototype),i.prototype.constructor=i;var o=function(e){t.call(this,e)};o.prototype=Object.create(t.prototype),o.prototype.constructor=o;var r=function(e){t.call(this,e)};r.prototype=Object.create(t.prototype),r.prototype.constructor=r;var n=function(e){t.call(this,e)};n.prototype=Object.create(t.prototype),n.prototype.constructor=n;var a=function(e){t.call(this,e)};a.prototype=Object.create(t.prototype),a.prototype.constructor=a;var s=function(e){t.call(this,e)};s.prototype=Object.create(t.prototype),s.prototype.constructor=s;var f=function(e){t.call(this,e)};f.prototype=Object.create(t.prototype),f.prototype.constructor=f;var u=function(e){t.call(this,e)};u.prototype=Object.create(t.prototype),u.prototype.constructor=u;var c=function(e){t.call(this,e)};c.prototype=Object.create(t.prototype),c.prototype.constructor=c,"function"==typeof define&&define.amd||(global.Exception=t,global.RuntimeException=e,global.InvalidArgumentException=i,global.BadFunctionCallException=o,global.BadMethodCallException=r,global.LengthException=n,global.LogicException=a,global.OutOfBoundsException=s,global.OutOfRangeException=f,global.RangeException=u,global.UnexpectedValueException=c)}),function(t,e){"function"==typeof define&&define.amd?define("utils/MathUtil",[],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e():e()}("undefined"!=typeof window?window:global,function(){"use strict";var t=function(){};return t.number2Integer=function(t){return t>>0},t.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&t>-9007199254740992&&9007199254740992>t&&Math.floor(t)===t},t.randomColor=function(e,i,o){return"rgba("+t.random(e,i)+", "+t.random(e,i)+", "+t.random(e,i)+", "+o+")"},t.random=function(e,i,o){var r=Math.floor(Math.random()*(i-e+1)+e);return o&&0==r?t.random(e,i,o):r},t.degree2Radian=function(t){return t*(Math.PI/180)},t.radian2Degree=function(t){return t*(180/Math.PI)},void 0===global.J2D&&(global.MathUtil=t),t}),function(t,e){"function"==typeof define&&define.amd?define("utils/Vector2d",[],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e():e()}("undefined"!=typeof window?window:global,function(){"use strict";var t=function(t,e){this.x=t,this.y=e};return t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.getCoordinates=function(){return this},t.prototype.toArray=function(){return[this.x,this.y]},t.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this},t.prototype.toString=function(){return"("+this.x+","+this.y+")"},void 0===global.J2D&&(global.Vector2d=t),t}),function(t,e){"function"==typeof define&&define.amd?define("utils/Vector2dInteger",["utils/Vector2d"],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e(require("utils/Vector2d")):e(t.Vector2d)}("undefined"!=typeof window?window:global,function(t){"use strict";var e=function(e,i){t.call(this,e>>0,i>>0)};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.fromArray=function(t){return this.x=t[0]>>0,this.y=t[1]>>0,this},void 0===global.J2D&&(global.Vector2dInteger=e),e});
//# sourceMappingURL=jquery.j2d.min.map
