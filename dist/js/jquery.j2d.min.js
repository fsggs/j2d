/**
 * J2D (jQuery Canvas Graphic Engine plugin)
 *
 * @authors DeVinterX, Skaner(j2Ds)
 * @license BSD
 * @version 0.2.0-dev
 */

if (global === undefined) {var global = window || this}
if (typeof define !== 'function' || !define.amd) {global.J2D = true; global.exports = {}}

!function(e,t){"function"==typeof define&&define.amd?define("jquery.j2d",["jquery"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery")):t(e.jQuery)}("undefined"!=typeof window?window:global,function(e){"use strict";var t={id:void 0,io:void 0,deltaTime:0,pause:!1,ready:!1,frameLimit:60,smoothing:!0,webGL:!1},i=function(){};return i.initPlugin=function(){if(void 0!==window.j2dPlugin)return null;window.j2dPlugin={pluginInit:!0},e.fn.j2d=function(n){this.filter("div.canvas:not([guid])").each(function(){var n=e.extend(!0,{},t,n),o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)});e(this).attr("guid",o);var r=e(this).attr("id");("undefined"==typeof r||r===!1)&&e(this).attr("id",o);var a=e(this).attr("tabindex");("undefined"==typeof a||a===!1)&&e(this).attr("tabindex","-1"),e(this).data("j2d",new i(o,e(this),n)).addClass("j2d"),e(this).click().focus()});var o=[];return this.filter("div.canvas[guid]").each(function(){o.push(e(this).data("j2d"))}),1===o.length?e(this).data("j2d"):o};var n=function(){return!!(document.webkitFullscreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement)};e(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){var t=n();t||e("div.canvas[guid]:not(.active)").toggle(!t)}),e(document).on("click","div.canvas[guid].pause",function(){e(this).data("j2d").resume();var t=this;e("div.canvas[guid]:not(.pause-disable):not(:focus)").each(function(){t!==this&&e(this).removeClass("active").data("j2d").pause()}),e("div.canvas[guid].active.pause-disable:not(:focus)").each(function(){t!==this&&e(this).removeClass("active")})}),e(document).on("click touch mouseenter","div.canvas[guid]:not(.resume-by-click):not(:focus)",function(){e(this).addClass("active").focus().data("j2d").resume();var t=this;e("div.canvas[guid]:not(.pause-disable):not(:focus)").each(function(){t!==this&&e(this).removeClass("active").data("j2d").pause()}),e("div.canvas[guid].active.pause-disable:not(:focus)").each(function(){t!==this&&e(this).removeClass("active")})}),e(window).on("focus",function(){e("div.canvas[guid].active").each(function(){e(this).data("j2d").resume()})}).on("blur",function(){e("div.canvas[guid]").each(function(){e(this).data("j2d").pause()})}),e(window).on("resize",function(){e("div.canvas[guid]").each(function(){e(this).data("j2d").device.resize()});n()})},global.J2D=void 0===global.J2D?i:void 0,i}),function(e,t){"function"==typeof define&&define.amd?define("core/FrameManager",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e,t=[],i=[],n={frameLimit:60,frameRun:!1,breakAnimationFrame:!1},o=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){n.breakAnimationFrame?n.breakAnimationFrame=!1:window.setTimeout(e.call(e,[Date.now()]),1e3/n.frameLimit)}}(),r=function(){return n.breakAnimationFrame=!0,window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame}(),a=function(){};return a.prototype.start=function(e,o,r){var a={j2d:void 0,frameLimit:n.frameLimit,now:0,deltaTime:0,lastTime:0,sceneStartTime:0,sceneSkipTime:0};if(void 0!==r.frameLimit&&r.frameLimit<=n.frameLimit&&(a.frameLimit=r.frameLimit),void 0===r.j2d)throw"j2d not transported to FrameManager.start(id, engine, {... j2d: j2d ...});";a.j2d=r.j2d,a.interval=1e3/a.frameLimit,a.lastTime=Date.now(),t.add(e,o),i.add(e,a),n.frameRun||this.pulse()},a.prototype.stop=function(e){t.remove(e),i.remove(e)},a.prototype.pulse=function(){this.runMainLoop(Date.now())},a.prototype.runMainLoop=function(e,a){if(void 0===a&&(a=this),t.length<=0&&n.frameRun)return n.frameRun=!1,r(this.runMainLoop);n.frameRun=!0;for(var s in t)if(t.hasOwnProperty(s)&&"function"==typeof t[s]){var c=t[s],l=i[s];l.now=Date.now(),l.j2d.options.deltaTime=l.deltaTime=(l.now-l.lastTime)/100,l.j2d.options.io&&!l.j2d.options.pause&&l.j2d.options.io.update(),100*l.deltaTime>l.interval&&(l.lastTime=l.now-100*l.deltaTime%l.interval,l.j2d.options.pause||(l.j2d.options.deltaTime=l.deltaTime,c(e,l))),l.j2d.options.io&&!l.j2d.options.pause&&l.j2d.options.io.clear()}o(function(e){a.runMainLoop(e,a)})},a.prototype.setDefaultFrameLimit=function(e){60>=e&&e>0&&(n.frameLimit=e)},a.Init=function(){return void 0!==window.J2D?window.instanceFrameManager||(window.instanceFrameManager=new a):e||(e=new a)},void 0===window.J2D&&(window.FrameManager=a),a}),function(e,t){"function"==typeof define&&define.amd?define("core/LayersManager",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e,t=function(t,i){this.parent=t,this.list={},e=i};return t.prototype.getLayer=function(e){return this.list[e]},t.prototype.add=function(t,i){if(this.list[t])return!1;var n={},o=this.parent;return n.layerName=t,n.canvas=document.createElement("canvas"),n.canvas.width=o.scene.width,n.canvas.height=o.scene.height,n.width=o.scene.width,n.height=o.scene.height,o.options.webGL?(e.enable(n.canvas),n.context=n.canvas.getContext("WebGL-2d")):n.context=n.canvas.getContext("2d"),o.options.smoothing?n.smoothing=!0:(n.smoothing=!1,n.disableSmoothing=o.util.disableSmoothing,o.util.disableSmoothing(n.context)),n.context.shadowColor="rgba(0,0,0,0)",n.canvas.style.zIndex=1e3+i,n.canvas.style.position="absolute",n.canvas.style.left="0",n.canvas.style.top="0",n.canvas.id=t,n.opacity=1,n.angle=0,n.visible=1,n.fillColor=!1,n.onContext=function(e){e(this.context)},n.fill=function(e){this.fillColor=e,this.context.fillStyle=e,this.context.fillRect(0,0,this.width,this.height)},n.setOpacity=function(e){this.canvas.style.opacity=e,this.opacity=e},n.getOpacity=function(){return this.opacity},n.setVisible=function(e){e?(this.canvas.style.display="block",this.visible=!0):(this.canvas.style.display="none",this.visible=!1)},n.isVisible=function(){return this.visible},n.setIndex=function(e){this.canvas.style.zIndex=1e3+e},n.clear=function(){this.context.clearRect(0,0,this.width,this.height)},n.clearNode=function(e){e.isLookScene()&&this.context.clearRect(e.pos.x-o.scene.viewport.x,e.pos.y-o.scene.viewport.y,e.size.x,e.size.y)},n.clearRect=function(e,t){this.context.clearRect(e.x-o.scene.viewport.x,e.y-o.scene.viewport.y,t.x,t.y)},n.resize=function(e,t){this.canvas.width=e,this.canvas.height=t,this.width=e,this.height=t,this.fillColor&&(this.context.save(),this.context.fillStyle=this.fillColor,this.context.fillRect(0,0,this.width,this.height),this.context.restore()),this.smoothing||this.disableSmoothing(this.context)},this.list[t]=n,o.options.ready&&o.element.append(this.list[t].canvas),n},void 0!==global.J2D&&(global.LayersManager=t),t}),function(e,t){"function"==typeof define&&define.amd?define("core/SceneManager",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){this.parent=e,this.enableFullscreen=!1,this.layerName="sceneNode",this.layers=parent.layers?parent.layers:{}};return e.prototype.resize=function(e,t){var i=this.parent;this.width=e,this.height=t;for(var n in i.layers.list)i.layers.list.hasOwnProperty(n)&&i.layers.list[n].resize(e,t)},e.prototype.async=function(e,t){setTimeout(e.call(e,t),0)},e.prototype.setGameState=function(e){this.parent.setActiveEngine(e),this.parent.element.trigger("changedGameState")},e.prototype.start=function(e,t){this.parent.options.io&&this.parent.options.io.init(),this.parent.element.trigger("beforeStart"),this.parent.start(e,t),this.parent.element.trigger("afterStart")},e.prototype.fullScreen=function(e){var t=document.getElementById(this.parent.element.attr("id"));void 0===t.requestFullscreen&&(t.requestFullscreen=t.webkitRequestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen),void 0===document.exitFullscreen&&(document.exitFullscreen=document.webkitExitFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen),e?t.requestFullscreen():document.exitFullscreen()},e.prototype.resizeToFullPage=function(e){$("div.canvas[guid]:not(.active)").toggle(e);var t=this.parent,i=this;e?(i.originalWidth=i.width,i.originalHeight=i.height,i.resize(t.device.width,t.device.height),i.enableFullscreen=!0,this.parent.element.width(t.device.width).height(t.device.height).css("margin",0)):(i.resize(i.originalWidth,i.originalHeight),i.enableFullscreen=!1,this.parent.element.width(i.originalWidth).height(i.originalHeight).css("margin",i.originalMargin))},e.prototype.scaleToFullScreen=function(e){$("div.canvas[guid]:not(.active)").toggle(e);var t,i;if(e){for(i in this.parent.layers.list)this.parent.layers.list.hasOwnProperty(i)&&(t=this.parent.layers.list[i].canvas,t.style.width=this.parent.device.width+"px",t.style.height=this.parent.device.height+"px");this.enableFullscreen=!0,this.parent.element.width(this.parent.device.width).height(this.parent.device.height).css("margin",0)}else{for(i in this.parent.layers.list)this.parent.layers.list.hasOwnProperty(i)&&(t=this.parent.layers.list[i].canvas,t.style.width=this.width+"px",t.style.height=this.height+"px");this.enableFullscreen=!1,this.parent.element.width(this.width).height(this.height).css("margin",this.originalMargin)}},e.prototype.toggleFullScreen=function(e,t){void 0===t&&(t={fullscreen:void 0}),!e.scene.enableFullscreen||t.fullscreen?e.scene.fullScreen(!0):e.scene.fullScreen(!1)},e.prototype.setViewPosition=function(e){this.parent.scene.viewport.x=e.x-Math.ceil(this.parent.scene.width/2),this.parent.scene.viewport.y=e.y-Math.ceil(this.parent.scene.height/2)},e.prototype.setViewFocus=function(e,t){this.parent.scene.viewport.x=e.getPosition().x-Math.ceil(this.parent.scene.width/2)+(t?t.x:0),this.parent.scene.viewport.y=e.getPosition().y-Math.ceil(this.parent.scene.height/2)+(t?t.y:0)},e.prototype.viewMove=function(e){this.parent.scene.viewport.x+=e.x,this.parent.scene.viewport.y+=e.y},e.prototype.clear=function(){this.getLayer().clear()},e.prototype.getLayer=function(){return this.parent.layers.getLayer("sceneNode")},e.prototype.init=function(e,t){var i=this.parent;i.element.trigger("beforeInit"),this.width=this.originalWidth=e,this.height=this.originalHeight=t,this.originalMargin=i.element.css("margin"),this.parent.element.width(e).height(t),i.layers.add("sceneNode",0),this.context=i.layers.getLayer("sceneNode").context,this.canvas=i.layers.getLayer("sceneNode").canvas,this.visible=!0,this.cancelClear=!1,this.viewport=i.vector.v2f(0,0),i.element.trigger("afterInit"),$(window).ready(function(){for(var e in i.layers.list)i.layers.list.hasOwnProperty(e)&&i.element.append(i.layers.getLayer(e).canvas);i.options.ready=!0,i.element.trigger("ready")})},void 0!==global.J2D&&(global.SceneManager=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/ArrayMap",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){Array.call(this,e)};return e.prototype=Object.create(Array.prototype),e.prototype.constructor=e,e.prototype.equals=function(e){if(!e)return!1;if(this.length!=e.length)return!1;for(var t=0,i=this.length;i>t;t++)if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].equals(e[t]))return!1}else if(this[t]!=e[t])return!1;return!0},Object.defineProperty(e.prototype,"equals",{enumerable:!1}),e.prototype.contains=function(e){for(var t=this.length;t--;)if(this[t]===e)return!0;return!1},Object.defineProperty(e.prototype,"contains",{enumerable:!1}),e.prototype.each=function(e){if(!e)return!1;for(var t=!1,i=0;i<this.length;i++)if(0==(t=e(this[i],i)))return t;return t},Object.defineProperty(e.prototype,"each",{enumerable:!1}),e.prototype.add=function(e,t){return this.contains(e)?this[e]=t:(this.push(e),this[e]=t),this},Object.defineProperty(e.prototype,"add",{enumerable:!1}),e.prototype.remove=function(e){for(var t=0;t<this.length;++t)if(this[t]==e)return this.splice(t,1),delete this[e],this;return this},Object.defineProperty(e.prototype,"remove",{enumerable:!1}),"function"==typeof define&&define.amd||(global.ArrayMap=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/DeviceUtil",["jquery","utils/Vector2dInteger"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("utils/Vector2dInteger")):t(e.jQuery,e.Vector2dInteger)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var i=function(){this.width=parseInt(e(document).width())<parseInt(screen.width)?parseInt(e(document).width()):parseInt(screen.width),this.height=parseInt(e(document).height())<parseInt(screen.height)?parseInt(e(document).height()):parseInt(screen.height)};return i.prototype.reCalculateSize=function(){return this.width=window.innerWidth,this.height=window.innerHeight,this},i.prototype.getWidth=function(){return this.width},i.prototype.getHeight=function(){return this.height},i.prototype.getSize=function(){return new t(this.width,this.height)},void 0===global.J2D&&(global.DeviceUtil=i),i}),function(e,t){"function"==typeof define&&define.amd?define("utils/Exceptions",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){Error.call(this),this.message=e,this.toString=function(){return this.message}};e.prototype=Object.create(Error.prototype),e.prototype.constructor=e;var t=function(t){e.call(this,t)};t.prototype=Object.create(e.prototype),t.prototype.constructor=t;var i=function(t){e.call(this,t)};i.prototype=Object.create(e.prototype),i.prototype.constructor=i;var n=function(t){e.call(this,t)};n.prototype=Object.create(e.prototype),n.prototype.constructor=n;var o=function(t){e.call(this,t)};o.prototype=Object.create(e.prototype),o.prototype.constructor=o;var r=function(t){e.call(this,t)};r.prototype=Object.create(e.prototype),r.prototype.constructor=r;var a=function(t){e.call(this,t)};a.prototype=Object.create(e.prototype),a.prototype.constructor=a;var s=function(t){e.call(this,t)};s.prototype=Object.create(e.prototype),s.prototype.constructor=s;var c=function(t){e.call(this,t)};c.prototype=Object.create(e.prototype),c.prototype.constructor=c;var l=function(t){e.call(this,t)};l.prototype=Object.create(e.prototype),l.prototype.constructor=l;var u=function(t){e.call(this,t)};u.prototype=Object.create(e.prototype),u.prototype.constructor=u,"function"==typeof define&&define.amd||(global.Exception=e,global.RuntimeException=t,global.InvalidArgumentException=i,global.BadFunctionCallException=n,global.BadMethodCallException=o,global.LengthException=r,global.LogicException=a,global.OutOfBoundsException=s,global.OutOfRangeException=c,global.RangeException=l,global.UnexpectedValueException=u)}),function(e,t){"function"==typeof define&&define.amd?define("utils/MathUtil",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){};return e.number2Integer=function(e){return e>>0},e.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&e>-9007199254740992&&9007199254740992>e&&Math.floor(e)===e},e.randomColor=function(t,i,n){return"rgba("+e.random(t,i)+", "+e.random(t,i)+", "+e.random(t,i)+", "+n+")"},e.random=function(t,i,n){var o=Math.floor(Math.random()*(i-t+1)+t);return n&&0==o?e.random(t,i,n):o},e.degree2Radian=function(e){return e*(Math.PI/180)},e.radian2Degree=function(e){return e*(180/Math.PI)},void 0===global.J2D&&(global.MathUtil=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/Vector2d",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e,t){this.x=e,this.y=t};return e.prototype.getX=function(){return this.x},e.prototype.getY=function(){return this.y},e.prototype.getCoordinates=function(){return this},e.prototype.toArray=function(){return[this.x,this.y]},e.prototype.fromArray=function(e){return this.x=e[0],this.y=e[1],this},e.prototype.toString=function(){return"("+this.x+","+this.y+")"},void 0===global.J2D&&(global.Vector2d=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/Vector2dInteger",["utils/Vector2d"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/Vector2d")):t(e.Vector2d)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t,i){e.call(this,t>>0,i>>0)};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.fromArray=function(e){return this.x=e[0]>>0,this.y=e[1]>>0,this},void 0===global.J2D&&(global.Vector2dInteger=t),t});
//# sourceMappingURL=jquery.j2d.min.map
