/**
 * J2D (jQuery Canvas Graphic Engine plugin)
 *
 * @authors DeVinterX, Skaner(j2Ds)
 * @license BSD
 * @version 0.2.0-dev
 */

if (global === undefined) {var global = window || this}
if (typeof define !== 'function' || !define.amd) {global.J2D = true;}
!function(e,t){"function"==typeof define&&define.amd?define("jquery.j2d",["jquery","core/SceneManager","io/MediaManager","utils/DeviceUtil"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("core/SceneManager"),require("io/MediaManager"),require("utils/DeviceUtil")):t(e.jQuery,e.SceneManager,e.MediaManager,e.DeviceUtil)}("undefined"!=typeof window?window:global,function(e,t,o,n){"use strict";var a=function(e,o){var a=this;this.element=e,this.data=o,this.device=new n,this.scene=new t(this),Object.defineProperty(this,"WebGL",{get:function(){return a.data.webGL},set:function(e){a.data.webGL=!!e,e&&!a.data.webGL?a.element.addClass("WebGL"):!e&&a.data.webGL&&a.element.removeClass("WebGL")}}),Object.defineProperty(this,"smoothing",{get:function(){return a.data.smoothing},set:function(e){a.data.smoothing=!!e}}),Object.defineProperty(this,"io",{get:function(){return a.data.io},set:function(e){return a.data.io=e}}),Object.defineProperty(this,"media",{get:function(){return a.data.media},set:function(e){return a.data.media=e}}),Object.defineProperty(this,"isPlay",{get:function(){return!a.data.pause},set:function(){}})};return a.defaults={id:null,io:null,media:null,deltaTime:0,pause:!1,ready:!1,frameLimit:60,smoothing:!0,webGL:!1},a.prototype.start=function(){this.scene.start(),this.trigger("start")},a.prototype.stop=function(){this.scene.stop(),this.trigger("stop")},a.prototype.pause=function(){this.data.io&&this.data.io.flush(),this.data.pause=!0,this.element.addClass("pause"),this.trigger("pause")},a.prototype.resume=function(){this.element.removeClass("pause").focus(),this.data.pause=!1,this.data.io&&this.data.io.flush(),this.trigger("resume")},a.prototype.getSceneManager=function(){return this.scene},a.prototype.getLayersManager=function(){return this.scene.layersManager},a.prototype.getFrameManager=function(){return this.scene.frameManager},a.prototype.getViewportManager=function(){return this.scene.viewportManager},a.prototype.on=function(){},a.prototype.once=function(){},a.prototype.off=function(){},a.prototype.trigger=function(){},a.util={disableSmoothing:function(e){var t=global.navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),o=t?parseInt(t[2],10):!1;e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,o&&29>=o&&(e.webkitImageSmoothingEnabled=!1),e.msImageSmoothingEnabled=!1}},a.prototype.util=a.util,(a.initPlugin=function(){if(void 0!==window.j2dPlugin)return null;window.j2dPlugin={pluginInit:!0},e.fn.j2d=function(t){this.filter("div.canvas:not([guid])").each(function(){var t=e.extend(!0,{},a.defaults,t),o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,o="x"==e?t:3&t|8;return o.toString(16)});t.id=o,e(this).attr("guid",o);var n=e(this).attr("id");"undefined"!=typeof n&&n!==!1||e(this).attr("id",o);var i=e(this).attr("tabindex");"undefined"!=typeof i&&i!==!1||e(this).attr("tabindex","-1"),e(this).data("j2d",new a(e(this),t)).addClass("j2d"),e(this).click().focus()});var o=[];return this.filter("div.canvas[guid]").each(function(){o.push(e(this).data("j2d"))}),1===o.length?e(this).data("j2d"):o};var t=function(){return!!(document.webkitFullscreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement)};e(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){var o=t();o||(e("div.canvas[guid].active").data("j2d").scene.resizeToFullPage(o),e("div.canvas[guid]:not(.active)").toggle(!o))}),e(document).on("click","div.canvas[guid].pause",function(){e(this).data("j2d").resume();var t=this;e("div.canvas[guid]:not(.pause-disable):not(:focus)").each(function(){t!==this&&e(this).removeClass("active").data("j2d").pause()}),e("div.canvas[guid].active.pause-disable:not(:focus)").each(function(){t!==this&&e(this).removeClass("active")})}),e(document).on("click touch mouseenter","div.canvas[guid]:not(.resume-by-click):not(:focus)",function(){e(this).addClass("active").focus().data("j2d").resume();var t=this;e("div.canvas[guid]:not(.pause-disable):not(:focus)").each(function(){t!==this&&e(this).removeClass("active").data("j2d").pause()}),e("div.canvas[guid].active.pause-disable:not(:focus)").each(function(){t!==this&&e(this).removeClass("active")})}),e(window).on("focus",function(){e("div.canvas[guid].active").each(function(){e(this).data("j2d").resume()})}).on("blur",function(){e("div.canvas[guid]").each(function(){e(this).data("j2d").pause()})}),e(window).on("resize",function(){e("div.canvas[guid]").each(function(){e(this).data("j2d").device.onResize()});var o=t();o&&e("div.canvas[guid].active").data("j2d").scene.resizeToFullPage(o)})})(),void 0!==global.exports&&(global.exports.J2D=a),void 0===global.J2D&&(global.J2D=a),a}),function(e,t){"function"==typeof define&&define.amd?define("core/FrameManager",["utils/ArrayMap"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ArrayMap")):t(e.ArrayMap)}("undefined"!=typeof window?window:global,function(e){"use strict";var t,o=new e,n=new e,a=0,i={frameLimit:60,frameRun:!1,breakAnimationFrame:!1},r=function(){return global.requestAnimationFrame||global.webkitRequestAnimationFrame||global.mozRequestAnimationFrame||global.oRequestAnimationFrame||global.msRequestAnimationFrame||function(e){i.breakAnimationFrame?i.breakAnimationFrame=!1:(a>=Number.MAX_SAFE_INTEGER-1&&(a=0),0===a&&(a=Date.now()),global.setTimeout(e.bind(this,Date.now()-a),1e3/i.frameLimit))}}(),s=function(){return a=0,global.cancelAnimationFrame||global.webkitCancelAnimationFrame||global.mozCancelAnimationFrame||global.oCancelAnimationFrame||global.msCancelAnimationFrame}(),d=function(){};return d.prototype.start=function(e,t,a){var r={j2d:null,frameLimit:i.frameLimit,now:0,deltaTime:0,lastTime:0,sceneStartTime:0,sceneSkipTime:0,asyncUpdate:!0,asyncRender:!0};if(void 0!==a.frameLimit&&a.frameLimit<=i.frameLimit&&(r.frameLimit=a.frameLimit),void 0===a.j2d)throw"j2d not transported to FrameManager.start(id, engine, {... j2d: j2d ...});";return r.j2d=a.j2d,r.interval=1e3/r.frameLimit,r.lastTime=Date.now(),o.add(e,t),n.add(e,r),i.frameRun||this.pulse(),this},d.prototype.stop=function(e){return o.remove(e),n.remove(e),this},d.prototype.pulse=function(){return this.runMainLoop(Date.now()),this},d.prototype.runMainLoop=function(e,t){return void 0===t&&(t=this),o.length<=0&&i.frameRun?(i.breakAnimationFrame=!0,i.frameRun=!1,s(this.runMainLoop)):(i.frameRun=!0,r(function(e){t.runMainLoop(e,t)}),void o.each(function(t){if(o.hasOwnProperty(t)&&"object"==typeof o[t]){var a=o[t],i=n[t];i.now=Date.now(),i.deltaTime=(i.now-i.lastTime)/100,i.j2d.data.io&&!i.j2d.data.pause&&i.j2d.data.io.update(),i.j2d.data.pause||(void 0!==a.update&&"function"==typeof a.update&&(i.asyncUpdate?setTimeout(a.update.bind(this,e,i),0):a.update(e,i)),100*i.deltaTime>i.interval&&(i.lastTime=i.now-100*i.deltaTime%i.interval,void 0!==a.render&&"function"==typeof a.render&&(i.asyncRender?setTimeout(a.render.bind(this,e,i),0):a.render(e,i)))),i.j2d.data.io&&!i.j2d.data.pause&&i.j2d.data.io.clear()}}))},d.prototype.setDefaultFrameLimit=function(e){return 60>=e&&e>0&&(i.frameLimit=e),this},d.Init=function(){return void 0!==global.J2D?global.instanceFrameManager||(global.instanceFrameManager=new d):t||(t=new d)},void 0!==global.exports&&(global.exports.FrameManager=d),void 0===global.J2D&&(global.FrameManager=d),d}),function(e,t){"function"==typeof define&&define.amd?define("core/LayersManager",["utils/ArrayMap","nodes/BaseNode","nodes/CollectionNode"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ArrayMap"),require("nodes/BaseNode"),require("nodes/CollectionNode")):t(e.ArrayMap,e.BaseNode,e.CollectionNode)}("undefined"!=typeof window?window:global,function(e,t,o){"use strict";var n=function(){this.globalCollection=new o({id:"GlobalLayer"}),this.layers=[],this.index=1e3};return n.prototype.addLayer=function(e,t,n){return e=e||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,o="x"==e?t:3&t|8;return o.toString(16)}),void 0===n||n instanceof o?(void 0===t?(t=this.index,this.index++):t+=1e3,n=n||new o({id:e,zIndex:t}),this.globalCollection.add(n,e),this.layers[t]=n,this):void 0},n.prototype.removeLayer=function(e){return delete this.layers[this.globalCollection.get(e).zIndex],this.globalCollection.remove(null,e),this},n.prototype.getLayer=function(e){return this.globalCollection.has(e)?this.globalCollection.get(e):null},n.prototype.setZIndex=function(e,t){return this.globalCollection.has(e)&&(delete this.layers[this.globalCollection.get(e).zIndex],this.globalCollection.get(e).zIndex=t,this.layers[t]=this.globalCollection.get(e)),this},void 0!==global.exports&&(global.exports.LayersManager=n),void 0!==global.J2D&&(global.LayersManager=n),n}),function(e,t){"function"==typeof define&&define.amd?define("core/SceneManager",["jquery","core/WebGL2D","core/FrameManager","core/ViewportManager","core/LayersManager"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("core/WebGL2D"),require("core/FrameManager"),require("core/ViewportManager"),require("core/LayersManager")):t(e.jQuery,e.WebGL2D,e.FrameManager,e.ViewportManager,e.LayersManager)}("undefined"!=typeof window?window:global,function(e,t,o,n,a){"use strict";var i=function(e){var t=this;this.j2d=e,this.canvas=null,this.context=null,this.frameManager=o.Init(),this.layersManager=new a,this.viewportManager=new n,this.initLayers(),Object.defineProperty(this,"backgroundColor",{get:function(){return t.data.backgroundColor},set:function(e){t.data.backgroundColor=e,t.context.fillStyle=e,t.context.fillRect(0,0,t.data.width,t.data.height)}}),Object.defineProperty(this,"opacity",{get:function(){return t.data.opacity},set:function(e){t.data.opacity=e,t.canvas.style.opacity=e}}),Object.defineProperty(this,"visible",{get:function(){return t.data.visible},set:function(e){t.data.visible=!!e,t.canvas.style.display=e?"block":"none"}}),Object.defineProperty(this,"zIndex",{get:function(){return 1e3-t.data.zIndex},set:function(e){t.data.zIndex=1e3+e,t.canvas.style.zIndex=1e3+e}}),Object.defineProperty(this,"viewport",{get:function(){return t.data.viewport},set:function(){}})};i.defaults={width:0,height:0,originalWidth:0,originalHeight:0,originalMargin:0,visible:!0,position:"absolute",top:0,left:0,zIndex:1e3,opacity:1,backgroundColor:!1,frameLimit:60,enableFullScreen:!1,viewport:{x:0,y:0},gameState:function(){this.id="DefaultGameState"}},i.prototype.fixGameStateRender=function(){var e=this;return"function"==typeof this.data.gameState&&void 0===this.data.gameState.prototype.render&&(this.data.gameState.prototype.render=function(t,o){e.clear().fillBackground().render(o)}),this},i.prototype.init=function(t){return this.data=e.extend(!0,{},i.defaults,t),this.j2d.trigger("beforeInit"),this.data.originalWidth=this.data.width,this.data.originalHeight=this.data.height,this.data.originalMargin=this.j2d.element.css("margin"),this.j2d.element.width(this.data.width).height(this.data.height),this.initCanvas(),this.viewportManager.setScreen({x:this.data.width,y:this.data.height}).setDefaultViewport({offset:{x:0,y:0},size:{x:this.data.width,y:this.data.height},scale:1,angle:0}),this.j2d.trigger("afterInit"),this},i.prototype.initLayers=function(){return this.layersManager.getLayer("scene")||this.layersManager.addLayer("scene",0),this},i.prototype.initCanvas=function(){return 0===e(this.j2d.element.selector+" canvas").length&&(this.canvas=document.createElement("canvas"),this.canvas.width=this.data.width,this.canvas.height=this.data.height,this.canvas.style.zIndex=this.data.zIndex,this.canvas.style.position=this.data.position,this.canvas.style.left=this.data.left,this.canvas.style.top=this.data.top,this.j2d.data.webGL?(t.enable(this.canvas),this.context=this.canvas.getContext("WebGL-2d")):this.context=this.canvas.getContext("2d"),this.j2d.data.smoothing||this.j2d.util.disableSmoothing(this.context),this.context.shadowColor="rgba(0,0,0,0)",this.data.backgroundColor&&(this.backgroundColor=this.data.backgroundColor),this.data.opacity&&(this.opacity=this.data.opacity),this.data.visible&&(this.visible=this.data.visible),this.data.zIndex&&(this.zIndex=1e3-this.data.zIndex),this.j2d.element.append(this.canvas)),this},i.prototype.clear=function(e,t){return void 0!==e&&void 0!==t?this.context.clearRect(e.x-this.viewport.x,e.y-this.viewport.y,t.x,t.y):this.context.clearRect(0,0,this.data.width,this.data.height),this},i.prototype.resize=function(e,t){return this.canvas.width=this.data.width=e,this.canvas.height=this.data.height=t,this.data.backgroundColor&&(this.context.save(),this.clear(),this.backgroundColor=this.data.backgroundColor,this.context.restore()),this.j2d.data.smoothing||this.j2d.util.disableSmoothing(this.context),this},i.prototype.setGameState=function(e){return this.data.gameState=e||function(){console.warn("Error in game state function!")},this.frameManager.stop(this.j2d.data.id),this.fixGameStateRender(),this.frameManager.start(this.j2d.data.id,new this.data.gameState,{j2d:this.j2d,frameLimit:this.data.frameLimit}),this.j2d.trigger("changedGameState"),this},i.prototype.async=function(e,t){return setTimeout(e.call(e,t),0),this},i.prototype.start=function(){return this.j2d.data.io&&this.j2d.data.io.init(),this.j2d.trigger("beforeStart"),this.frameManager.stop(this.j2d.data.id),this.fixGameStateRender(),this.frameManager.start(this.j2d.data.id,new this.data.gameState,{j2d:this.j2d,frameLimit:this.data.frameLimit}),this.j2d.trigger("afterStart"),this},i.prototype.stop=function(){return this.frameManager.stop(this.j2d.data.id),this},i.prototype.fullScreen=function(e){var t=document.getElementById(this.j2d.element.attr("id"));return void 0===t.requestFullscreen&&(t.requestFullscreen=t.webkitRequestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen),void 0===document.exitFullscreen&&(document.exitFullscreen=document.webkitExitFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen),e?t.requestFullscreen():document.exitFullscreen(),this},i.prototype.resizeToFullPage=function(t){e("div.canvas[guid]:not(.active)").toggle(t);var o=this.j2d,n=this;return t?(n.data.originalWidth=n.data.width,n.data.originalHeight=n.data.height,n.resize(o.device.width,o.device.height),n.data.enableFullscreen=!0,o.element.width(o.device.width).height(o.device.height).css("margin",0),n.viewportManager.setScreen({x:o.device.width,y:o.device.height}).setOffset({x:-(o.device.width-n.data.originalWidth)/2,y:-(o.device.height-n.data.originalHeight)/2})):(n.resize(n.data.originalWidth,n.data.originalHeight),n.data.enableFullscreen=!1,o.element.width(n.data.originalWidth).height(n.data.originalHeight).css("margin",n.data.originalMargin),n.viewportManager.setScreen({x:n.data.originalWidth,y:n.data.originalHeight}).setOffset({x:0,y:0})),this},i.prototype.toggleFullScreen=function(e,t){return void 0===t&&(t={fullscreen:!1}),!e.scene.enableFullscreen||t.fullscreen?e.scene.fullScreen(!0):e.scene.fullScreen(!1),this},i.prototype.getSceneLayer=function(){return this.layersManager.getLayer("scene")},i.prototype.fillBackground=function(){return this.data.backgroundColor&&(this.backgroundColor=this.data.backgroundColor),this},i.prototype.render=function(e){var t=this;return t.layersManager.layers.forEach(function(o,n){t.layersManager.layers[n].render(t.context,t.viewportManager.getViewport(),t.layersManager.globalCollection,e||{})}),this},i.prototype.add=function(e,t){return this.layersManager.globalCollection.has("scene")&&this.layersManager.globalCollection.get("scene").add(e,t),this},i.prototype.remove=function(e,t){return this.layersManager.globalCollection.has("scene")&&this.layersManager.globalCollection.get("scene").remove(e,t),this},i.prototype.registerCamera=function(e){return this.viewportManager.addCamera(e.data.id,e),this};var r=function(e){return e.viewportManager.setViewport(new Vector2d(0,0),new Vector2d(e.data.width,e.data.height)),e};return i.prototype.updateViewport=function(e){return void 0===e?r(this):(this.viewportManager.updateViewport(e.data.id),this)},void 0!==global.exports&&(global.exports.SceneManager=i),void 0!==global.J2D&&(global.SceneManager=i),i}),function(e,t){"function"==typeof define&&define.amd?define("core/ViewportManager",["utils/ArrayMap","nodes/CameraNode","utils/Vector2d"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ArrayMap"),require("nodes/CameraNode"),require("utils/Vector2d")):t(e.ArrayMap,e.CameraNode,e.Vector2d)}("undefined"!=typeof window?window:global,function(e,t,o){"use strict";var n=function(e,t){var o={offset:{x:0,y:0},size:{x:0,y:0},scale:1,angle:t.angle};return o.offset.x=e.offsetX+t.offset.x,o.offset.y=e.offsetY+t.offset.y,o.size.x=e.x<t.size.x?e.x:t.size.x,o.size.y=e.y<t.size.y?e.y:t.size.y,o.scale=t.scale*((e.x/t.size.x+e.y/t.size.y)/2),o},a=function(){this.cameras=new e,this.camera="No active cameras",this.screen={x:0,y:0,offsetX:0,offsetY:0},this.init=!1,this.data={offset:{x:0,y:0},size:{x:0,y:0},scale:1,angle:0}};return a.prototype.setScreen=function(e){if("object"==typeof e){if(e instanceof Array&&2==e.length)return this.screen={x:e[0],y:e[1],offsetX:this.screen.offsetX,offsetY:this.screen.offsetY},this;void 0!==e.x&&void 0!==e.y&&(this.screen={x:e.x,y:e.y,offsetX:this.screen.offsetX,offsetY:this.screen.offsetY})}return this},a.prototype.setOffset=function(e){if("object"==typeof e){if(e instanceof Array&&2==e.length)return this.screen={x:this.screen.x,y:this.screen.y,offsetX:e[0],offsetY:e[1]},this;void 0!==e.x&&void 0!==e.y&&(this.screen={x:this.screen.x,y:this.screen.y,offsetX:e.x,offsetY:e.y})}return this},a.prototype.addCamera=function(e,o){return o instanceof t?(this.cameras.add(e,o),this):void 0},a.prototype.removeCamera=function(e){return this.cameras.remove(e),this.camera==e&&(this.camera="No active cameras",this.data={offset:{x:0,y:0},size:{x:0,y:0},scale:1,angle:0}),this},a.prototype.updateViewport=function(e){return void 0!==this.cameras[e]&&this.cameras[e]instanceof t&&(this.data=this.cameras[e].getCameraViewport(this.screen,n)),this},a.prototype.setViewport=function(e,t){return void 0!==e&&"object"==typeof e&&e instanceof o&&(this.data.offset=e.getVector()),void 0!==t&&"object"==typeof t&&t instanceof o&&(this.data.size=t.getVector()),this.data=n(this.screen,this.data),this},a.prototype.setDefaultViewport=function(e){return this.init||(this.data=e,this.init=!0),this},a.prototype.getViewport=function(){return this.data},void 0!==global.exports&&(global.exports.ViewportManager=a),void 0!==global.J2D&&(global.ViewportManager=a),a}),function(e,t){"function"==typeof define&&define.amd?define("core/WebGL2D",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";function e(e){return e>0&&0===(e-1&e)}function t(e){return this.clearStack(e)}var o={identity:[1,0,0,0,1,0,0,0,1],multiply:function(e,t){var o=e[0],n=e[1],a=e[2],i=e[3],r=e[4],s=e[5],d=e[6],u=e[7],l=e[8],c=t[0],f=t[1],p=t[2],h=t[3],g=t[4],y=t[5],m=t[6],v=t[7],b=t[8];t[0]=c*o+h*n+m*a,t[1]=f*o+g*n+v*a,t[2]=p*o+y*n+b*a,t[3]=c*i+h*r+m*s,t[4]=f*i+g*r+v*s,t[5]=p*i+y*r+b*s,t[6]=c*d+h*u+m*l,t[7]=f*d+g*u+v*l,t[8]=p*d+y*u+b*l},vec2_multiply:function(e,t){var o=[];return o[0]=t[0]*e[0]+t[3]*e[1]+t[6],o[1]=t[1]*e[0]+t[4]*e[1]+t[7],o},transpose:function(e){return[e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]]}},n=16;t.prototype.clearStack=function(e){this.m_stack=[],this.m_cache=[],this.c_stack=0,this.valid=0,this.result=null;for(var t=0;n>t;t++)this.m_stack[t]=this.getIdentity();void 0!==e?this.m_stack[0]=e:this.setIdentity()},t.prototype.setIdentity=function(){this.m_stack[this.c_stack]=this.getIdentity(),this.valid===this.c_stack&&this.c_stack&&this.valid--},t.prototype.getIdentity=function(){return[1,0,0,0,1,0,0,0,1]},t.prototype.getResult=function(){if(!this.c_stack)return this.m_stack[0];var e=o.identity;this.valid>this.c_stack-1&&(this.valid=this.c_stack-1);for(var t=this.valid;t<this.c_stack+1;t++)e=o.multiply(this.m_stack[t],e),this.m_cache[t]=e;return this.valid=this.c_stack-1,this.result=this.m_cache[this.c_stack],this.result},t.prototype.pushMatrix=function(){this.c_stack++,this.m_stack[this.c_stack]=this.getIdentity()},t.prototype.popMatrix=function(){0!==this.c_stack&&this.c_stack--};var a=t.prototype.getIdentity();t.prototype.translate=function(e,t){a[6]=e,a[7]=t,o.multiply(a,this.m_stack[this.c_stack])};var i=t.prototype.getIdentity();t.prototype.tr=function(e,t,n,a,r,s){i[0]=e,i[1]=t,i[3]=n,i[4]=a,i[6]=r,i[7]=s,o.multiply(i,this.m_stack[this.c_stack])};var r=t.prototype.getIdentity();t.prototype.scale=function(e,t){r[0]=e,r[4]=t,o.multiply(r,this.m_stack[this.c_stack])};var s=t.prototype.getIdentity();t.prototype.rotate=function(e){var t,n;t=Math.sin(-e),n=Math.cos(-e),s[0]=n,s[3]=t,s[1]=-t,s[4]=n,o.multiply(s,this.m_stack[this.c_stack])};var d=global.WebGL2D=function(e,o){this.canvas=e,this.options=o||{},this.gl=void 0,this.fs=void 0,this.vs=void 0,this.shaderProgram=void 0,this.transform=new t,this.shaderPool=[],this.maxTextureSize=void 0,e.gl2d=this,e.$getContext=e.getContext,e.getContext=function(t){return function(o){if(!t.options.force&&"WebGL-2d"!==o||0===e.width||0===e.height)return t.canvas.$getContext(o);if(t.gl)return t.gl;var n=t.gl=t.canvas.$getContext("experimental-webgl");return"undefined"==typeof n||null===n?t.canvas.$getContext("2d"):(t.initShaders(),t.initBuffers(),t.initCanvas2DAPI(),n.enable(n.BLEND),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),t.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),n)}}(this),this.postInit()};d.enable=function(e,t){return e.gl2d||new d(e,t)};var u={texture:1,crop:2,path:4};d.prototype.getFragmentShaderSource=function(e){var t=["#ifdef GL_ES","precision highp float;","#endif","#define hasTexture "+(e&u.texture?"1":"0"),"#define hasCrop "+(e&u.crop?"1":"0"),"varying vec4 vColor;","#if hasTexture","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","#if hasCrop","uniform vec4 uCropSource;","#endif","#endif","void main(void) {","#if hasTexture","#if hasCrop","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x * uCropSource.z, vTextureCoord.y * uCropSource.w) + uCropSource.xy);","#else","gl_FragColor = texture2D(uSampler, vTextureCoord);","#endif","#else","gl_FragColor = vColor;","#endif","}"].join("\n");return t},d.prototype.getVertexShaderSource=function(e,t){e=e||1;var o=["#define hasTexture "+(t&u.texture?"1":"0"),"attribute vec4 aVertexPosition;","#if hasTexture","varying vec2 vTextureCoord;","#endif","uniform vec4 uColor;","uniform mat3 uTransforms["+e+"];","varying vec4 vColor;","uniform mat4 pMatrix;","mat3 crunchStack(void) {","mat3 result = uTransforms[0];","for (int i = 1; i < "+e+"; ++i) {","result = uTransforms[i] * result;","}","return result;","}","void main(void) {","vec3 position = crunchStack() * vec3(aVertexPosition.x, aVertexPosition.y, 1.0);","gl_Position = pMatrix * vec4(position, 1.0);","vColor = uColor;","#if hasTexture","vTextureCoord = aVertexPosition.zw;","#endif","}"].join("\n");return o},d.prototype.initShaders=function(e,t){var o=this.gl;e=e||1,t=t||0;var n=this.shaderPool[e];if(n||(n=this.shaderPool[e]=[]),n=n[t])o.useProgram(n),this.shaderProgram=n;else{var a=this.fs=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(this.fs,this.getFragmentShaderSource(t)),o.compileShader(this.fs),!o.getShaderParameter(this.fs,o.COMPILE_STATUS))throw"fragment shader error: "+o.getShaderInfoLog(this.fs);var i=this.vs=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(this.vs,this.getVertexShaderSource(e,t)),o.compileShader(this.vs),!o.getShaderParameter(this.vs,o.COMPILE_STATUS))throw"vertex shader error: "+o.getShaderInfoLog(this.vs);var r=this.shaderProgram=o.createProgram();if(r.stackDepth=e,o.attachShader(r,a),o.attachShader(r,i),o.linkProgram(r),!o.getProgramParameter(r,o.LINK_STATUS))throw"Could not initialise shaders.";o.useProgram(r),r.vertexPositionAttribute=o.getAttribLocation(r,"aVertexPosition"),o.enableVertexAttribArray(r.vertexPositionAttribute),r.uColor=o.getUniformLocation(r,"uColor"),r.uSampler=o.getUniformLocation(r,"uSampler"),r.uCropSource=o.getUniformLocation(r,"uCropSource"),r.pMatrix=o.getUniformLocation(r,"pMatrix"),r.uTransforms=[];for(var s=0;e>s;++s)r.uTransforms[s]=o.getUniformLocation(r,"uTransforms["+s+"]");this.shaderPool[e][t]=r}return c[0]=2/this.canvas.width,c[5]=-2/this.canvas.height,o.uniformMatrix4fv(this.shaderProgram.pMatrix,!1,c),o.viewport(0,0,this.canvas.width,this.canvas.height),this.shaderProgram};var l=new Float32Array([0,0,0,0,0,1,0,1,1,1,1,1,1,0,1,0]),c=new Float32Array(16);return c[10]=1,c[11]=1,c[12]=-1,c[13]=1,d.prototype.initBuffers=function(){var e=this.gl;e.rectVertexPositionBuffer=e.createBuffer(),e.rectVertexColorBuffer=e.createBuffer(),e.pathVertexPositionBuffer=e.createBuffer(),e.pathVertexColorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,e.rectVertexPositionBuffer),e.bufferData(e.ARRAY_BUFFER,l,e.STATIC_DRAW)},d.instances=[],d.prototype.postInit=function(){d.instances.push(this)},d.prototype.initCanvas2DAPI=function(){function t(e,t,o){return 0>o&&(o+=1),o>1&&(o-=1),1/6>o?e+6*(t-e)*o:.5>o?t:2/3>o?e+(t-e)*(2/3-o)*6:e}function o(e,o,n,a){var i,r,s,d,u;return e=(e%360+360)%360/360,o=o>100?1:o/100,o=0>o?0:o,n=n>100?1:n/100,n=0>n?0:n,0==o?i=r=s=n:(u=.5>n?n*(1+o):n+o-n*o,d=2*n-u,i=t(d,u,e+1/3),r=t(d,u,e),s=t(d,u,e-1/3)),[i,r,s,a]}function n(e){var t,a,i,r,s,d,u=[];if(t=v.exec(e)){if(r=t[1],s=parseFloat(t[8]),r&&isNaN(s)||!r&&!isNaN(s))return!1;d=t[3];for(var l=2;8>l;l+=2){if(a=t[l],i=t[l+1],i!==d)return!1;i?(a=a>100?1:a/100,a=0>a?0:a):(a=a>255?1:a/255,a=0>a?0:a),u.push(a)}u.push(r?s:1)}else if(t=b.exec(e))r=t[1],s=parseFloat(t[5]),u=o(t[2],t[3],t[4],parseFloat(r&&s?s:1));else if(t=w.exec(e)){var c=parseInt(t[1],16);u=[((16711680&c)>>16)/255,((65280&c)>>8)/255,(255&c)/255,1]}else if(t=E.exec(e)){var f="#"+[t[1],t[1],t[2],t[2],t[3],t[3]].join("");u=n(f)}else if(e.toLowerCase()in _)u=n(_[e.toLowerCase()]);else{if("transparent"!==e.toLowerCase())return!1;u=[0,0,0,0]}return u}function a(e){return"rgba("+255*e[0]+", "+255*e[1]+", "+255*e[2]+", "+parseFloat(e[3])+")"}function i(){var e={fillStyle:[M.fillStyle[0],M.fillStyle[1],M.fillStyle[2],M.fillStyle[3]],strokeStyle:[M.strokeStyle[0],M.strokeStyle[1],M.strokeStyle[2],M.strokeStyle[3]],globalAlpha:M.globalAlpha,globalCompositeOperation:M.globalCompositeOperation,lineCap:M.lineCap,lineJoin:M.lineJoin,lineWidth:M.lineWidth,miterLimit:M.miterLimit,shadowColor:M.shadowColor,shadowBlur:M.shadowBlur,shadowOffsetX:M.shadowOffsetX,shadowOffsetY:M.shadowOffsetY,textAlign:M.textAlign,font:M.font,textBaseline:M.textBaseline,imageSmoothingEnabled:M.imageSmoothingEnabled};S.push(e)}function r(){S.length&&(M=S.pop())}function s(e){for(var t=p.transform.m_stack,o=0,n=p.transform.c_stack+1;n>o;++o)h.uniformMatrix3fv(e.uTransforms[o],!1,t[n-1-o])}function d(e,t){this.closed=!1,this.verts=[e,t,0,0]}function l(e){var t=p.transform,o=p.initShaders(t.c_stack+2,0),n=j[e],a=n.verts;h.bindBuffer(h.ARRAY_BUFFER,h.pathVertexPositionBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(a),h.STATIC_DRAW),h.vertexAttribPointer(o.vertexPositionAttribute,4,h.FLOAT,!1,0,0),t.pushMatrix(),s(o),h.uniform4f(o.uColor,M.fillStyle[0],M.fillStyle[1],M.fillStyle[2],M.fillStyle[3]),h.drawArrays(h.TRIANGLE_FAN,0,a.length/4),t.popMatrix()}function c(e){var t=p.transform,o=p.initShaders(t.c_stack+2,0),n=j[e],a=n.verts;h.bindBuffer(h.ARRAY_BUFFER,h.pathVertexPositionBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(a),h.STATIC_DRAW),h.vertexAttribPointer(o.vertexPositionAttribute,4,h.FLOAT,!1,0,0),t.pushMatrix(),s(o),h.uniform4f(o.uColor,M.strokeStyle[0],M.strokeStyle[1],M.strokeStyle[2],M.strokeStyle[3]),n.closed?h.drawArrays(h.LINE_LOOP,0,a.length/4):h.drawArrays(h.LINE_STRIP,0,a.length/4),t.popMatrix()}function f(t){if(this.obj=h.createTexture(),this.index=k.push(this),C.push(t),t.width>p.maxTextureSize||t.height>p.maxTextureSize){var o=document.createElement("canvas");o.width=t.width>p.maxTextureSize?p.maxTextureSize:t.width,o.height=t.height>p.maxTextureSize?p.maxTextureSize:t.height;var n=o.getContext("2d");n.drawImage(t,0,0,t.width,t.height,0,0,o.width,o.height),t=o}var a=h.LINEAR,i=h.LINEAR_MIPMAP_LINEAR;M.imageSmoothingEnabled||(a=h.NEAREST,i=h.LINEAR_MIPMAP_NEAREST),h.bindTexture(h.TEXTURE_2D,this.obj),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,a),e(t.width)&&e(t.height)?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,i),h.generateMipmap(h.TEXTURE_2D)):h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a),h.bindTexture(h.TEXTURE_2D,null)}var p=this,h=this.gl,g=document.createElement("canvas");g.width=p.canvas.width,g.height=p.canvas.height;var m=g.getContext("2d"),v=/^rgb(a)?\(\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,?\s*(-?[\d\.]+)?\s*\)$/,b=/^hsl(a)?\(\s*(-?[\d\.]+)\s*,\s*(-?[\d\.]+)%\s*,\s*(-?[\d\.]+)%\s*,?\s*(-?[\d\.]+)?\s*\)$/,w=/^#([0-9A-Fa-f]{6})$/,E=/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/,_={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",
steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},M={},S=[];M.fillStyle=[0,0,0,1],Object.defineProperty(h,"fillStyle",{get:function(){return a(M.fillStyle)},set:function(e){M.fillStyle=n(e)||M.fillStyle}}),M.strokeStyle=[0,0,0,1],Object.defineProperty(h,"strokeStyle",{get:function(){return a(M.strokeStyle)},set:function(e){M.strokeStyle=n(e)||drawStyle.strokeStyle}}),h.$lineWidth=h.lineWidth,M.lineWidth=1,Object.defineProperty(h,"lineWidth",{get:function(){return M.lineWidth},set:function(e){e>0&&(h.$lineWidth(e),M.lineWidth=e)}}),M.lineCap="butt",Object.defineProperty(h,"lineCap",{get:function(){return M.lineCap},set:function(e){M.lineCap=e}}),M.lineJoin="miter",Object.defineProperty(h,"lineJoin",{get:function(){return M.lineJoin},set:function(e){M.lineJoin=e}}),M.miterLimit=10,Object.defineProperty(h,"miterLimit",{get:function(){return M.miterLimit},set:function(e){M.miterLimit=e}}),M.shadowOffsetX=0,Object.defineProperty(h,"shadowOffsetX",{get:function(){return M.shadowOffsetX},set:function(e){M.shadowOffsetX=e}}),M.shadowOffsetY=0,Object.defineProperty(h,"shadowOffsetY",{get:function(){return M.shadowOffsetY},set:function(e){M.shadowOffsetY=e}}),M.shadowBlur=0,Object.defineProperty(h,"shadowBlur",{get:function(){return M.shadowBlur},set:function(e){M.shadowBlur=e}}),M.shadowColor="rgba(0, 0, 0, 0.0)",Object.defineProperty(h,"shadowColor",{get:function(){return M.shadowColor},set:function(e){M.shadowColor=e}}),M.font="10px sans-serif",Object.defineProperty(h,"font",{get:function(){return M.font},set:function(e){m.font=e,M.font=e}}),M.textAlign="start",Object.defineProperty(h,"textAlign",{get:function(){return M.textAlign},set:function(e){M.textAlign=e}}),M.textBaseline="alphabetic",Object.defineProperty(h,"textBaseline",{get:function(){return M.textBaseline},set:function(e){M.textBaseline=e}}),M.globalAlpha=1,Object.defineProperty(h,"globalAlpha",{get:function(){return M.globalAlpha},set:function(e){M.globalAlpha=e}}),M.imageSmoothingEnabled=!0,Object.defineProperty(h,"imageSmoothingEnabled",{get:function(){return M.imageSmoothingEnabled},set:function(e){M.imageSmoothingEnabled=!!e}}),M.globalCompositeOperation="source-over",Object.defineProperty(h,"globalCompositeOperation",{get:function(){return M.globalCompositeOperation},set:function(e){M.globalCompositeOperation=e}}),h.fillText=function(e,t,o){m.clearRect(0,0,p.canvas.width,p.canvas.height),m.fillStyle=h.fillStyle,m.fillText(e,t,o),h.drawImage(g,0,0)},h.strokeText=function(){},h.measureText=function(){return 1};var A=document.createElement("canvas"),P=A.getContext("2d");h.save=function(){p.transform.pushMatrix(),i()},h.restore=function(){p.transform.popMatrix(),r()},h.translate=function(e,t){p.transform.translate(e,t)},h.rotate=function(e){p.transform.rotate(e)},h.scale=function(e,t){p.transform.scale(e,t)},h.createImageData=function(e,t){return P.createImageData(e,t)},h.getImageData=function(e,t,o,n){var a=P.createImageData(o,n),i=new Uint8Array(o*n*4);h.readPixels(e,t,o,n,h.RGBA,h.UNSIGNED_BYTE,i);for(var r=4*o,s=n,d=0,u=s/2;u>d;++d)for(var l=0,c=r;c>l;++l){var f=d*r+l,p=(s-d-1)*r+l;a.data[f]=i[p],a.data[p]=i[f]}return a},h.putImageData=function(e,t,o){h.drawImage(e,t,o)},h.transform=function(e,t,o,n,a,i){p.transform.tr(e,t,o,n,a,i)},h.setTransform=function(e,t,o,n,a,i){p.transform.setIdentity(),h.transform.apply(this,arguments)},h.fillRect=function(e,t,o,n){var a=p.transform,i=p.initShaders(a.c_stack+2,0);h.bindBuffer(h.ARRAY_BUFFER,h.rectVertexPositionBuffer),h.vertexAttribPointer(i.vertexPositionAttribute,4,h.FLOAT,!1,0,0),a.pushMatrix(),a.translate(e,t),a.scale(o,n),s(i),h.uniform4f(i.uColor,M.fillStyle[0],M.fillStyle[1],M.fillStyle[2],M.fillStyle[3]),h.drawArrays(h.TRIANGLE_FAN,0,4),a.popMatrix()},h.strokeRect=function(e,t,o,n){var a=p.transform,i=p.initShaders(a.c_stack+2,0);h.bindBuffer(h.ARRAY_BUFFER,h.rectVertexPositionBuffer),h.vertexAttribPointer(i.vertexPositionAttribute,4,h.FLOAT,!1,0,0),a.pushMatrix(),a.translate(e,t),a.scale(o,n),s(i),h.uniform4f(i.uColor,M.strokeStyle[0],M.strokeStyle[1],M.strokeStyle[2],M.strokeStyle[3]),h.drawArrays(h.LINE_LOOP,0,4),a.popMatrix()},h.clearRect=function(e,t,o,n){};var j=[];h.beginPath=function(){j.length=0},h.closePath=function(){if(j.length){var e=j[j.length-1],t=e.verts[0],o=e.verts[1];e.closed=!0;var n=new d(t,o);j.push(n)}},h.moveTo=function(e,t){j.push(new d(e,t))},h.lineTo=function(e,t){j.length?j[j.length-1].verts.push(e,t,0,0):h.moveTo(e,t)},h.quadraticApproximateCount=50,h.quadraticCurveTo=function(e,t,o,n){if(j.length)for(var a,i,r,s,d=j[j.length-1].verts,u=d[d.length-4],l=d[d.length-3],c=0;c<h.quadraticApproximateCount;c++)a=c/h.quadraticApproximateCount,i=1-a,r=i*i*u+2*i*a*e+a*a*o,s=i*i*l+2*i*a*t+a*a*n,d.push(r,s,0,0);else h.moveTo(o,n)},h.bezierApproximateCount=50,h.bezierCurveTo=function(e,t,o,n,a,i){if(j.length)for(var r,s,d,u,l=j[j.length-1].verts,c=l[l.length-4],f=l[l.length-3],p=0;p<h.bezierApproximateCount;p++)r=p/h.bezierApproximateCount,s=1-r,d=s*s*s*c+3*s*s*r*e+3*s*r*r*o+r*r*r*a,u=s*s*s*f+3*s*s*r*t+3*s*r*r*n+r*r*r*i,l.push(d,u,0,0);else h.moveTo(a,i)},h.arcTo=function(){j.length||h.moveTo(x,y)},h.rect=function(e,t,o,n){h.moveTo(e,t),h.lineTo(e+o,t),h.lineTo(e+o,t+n),h.lineTo(e,t+n),h.closePath()},h.arcApproximateCount=100,h.arc=function(e,t,o,n,a,i){if(j.length){var r=j[j.length-1].verts,s=e+o*Math.cos(n),d=t+o*Math.sin(n);for(r.push(s,d,0,0);n>2*Math.PI;)n-=2*Math.PI;for(;a>2*Math.PI;)a-=2*Math.PI;for(;n<2*-Math.PI;)n+=2*Math.PI;for(;a<2*-Math.PI;)a+=2*Math.PI;if(n==a)return;var u,l=1/h.arcApproximateCount,c=h.arcApproximateCount;i&&(a-=2*Math.PI,l=-l);for(var f=n;f>a&&i||a>f&&!i;f+=l)u!=(u=(f*c|0)/c)&&(s=e+o*Math.cos(u),d=t+o*Math.sin(u),r.push(s,d,0,0))}else h.moveTo(s,d)},h.fill=function(){for(var e=0;e<j.length;e++)l(e)},h.stroke=function(){for(var e=0;e<j.length;e++)c(e)},h.clip=function(){},h.isPointInPath=function(){},h.drawFocusRing=function(){};var C=[],k=[];h.drawImage=function(e,t,o,n,a,i,r,d,l){var c=p.transform;c.pushMatrix();var g=u.texture,y=!1;3===arguments.length?(c.translate(t,o),c.scale(e.width,e.height)):5===arguments.length?(c.translate(t,o),c.scale(n,a)):9===arguments.length&&(c.translate(i,r),c.scale(d,l),g|=u.crop,y=!0);var m,v=p.initShaders(c.c_stack+1,g),b=C.indexOf(e);m=-1!==b?k[b]:new f(e),y&&h.uniform4f(v.uCropSource,t/e.width,o/e.height,n/e.width,a/e.height),h.bindBuffer(h.ARRAY_BUFFER,h.rectVertexPositionBuffer),h.vertexAttribPointer(v.vertexPositionAttribute,4,h.FLOAT,!1,0,0),h.bindTexture(h.TEXTURE_2D,m.obj),h.activeTexture(h.TEXTURE0),h.uniform1i(v.uSampler,0),s(v),h.drawArrays(h.TRIANGLE_FAN,0,4),c.popMatrix()},Object.defineProperty(h,"isWebGL",{configurable:!1,enumerable:!0,writable:!1,value:!0})},void 0!==global.exports&&(global.exports.WebGL2D=d),d}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/BadFunctionCallException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(e){Error.call(this),this.message=e,this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,void 0!==global.exports&&(global.exports.BadFunctionCallException=t),"function"==typeof define&&define.amd||(global.BadFunctionCallException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/BadMethodCallException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(e){Error.call(this),this.message=e,this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,void 0!==global.exports&&(global.exports.BadMethodCallException=t),"function"==typeof define&&define.amd||(global.BadMethodCallException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/Exception",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){Error.call(this),this.message=e,this.toString=function(){return this.message}};return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,void 0!==global.exports&&(global.exports.Exception=e),"function"==typeof define&&define.amd||(global.Exception=e),e}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/InvalidArgumentException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(e){Error.call(this),this.message=e,this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,void 0!==global.exports&&(global.exports.InvalidArgumentException=t),"function"==typeof define&&define.amd||(global.InvalidArgumentException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/LengthException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(e){Error.call(this),this.message=e,this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,void 0!==global.exports&&(global.exports.LengthException=t),"function"==typeof define&&define.amd||(global.LengthException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/LogicException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(e){Error.call(this),this.message=e,this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,void 0!==global.exports&&(global.exports.LogicException=t),"function"==typeof define&&define.amd||(global.LogicException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/OutOfBoundsException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(e){Error.call(this),this.message=e,this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,void 0!==global.exports&&(global.exports.OutOfBoundsException=t),"function"==typeof define&&define.amd||(global.OutOfBoundsException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/OutOfRangeException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(e){Error.call(this),this.message=e,this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,void 0!==global.exports&&(global.exports.OutOfRangeException=t),"function"==typeof define&&define.amd||(global.OutOfRangeException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/RangeException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(e){Error.call(this),this.message=e,this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,void 0!==global.exports&&(global.exports.RangeException=t),"function"==typeof define&&define.amd||(global.RangeException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/RuntimeException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(e){Error.call(this),this.message=e,this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,void 0!==global.exports&&(global.exports.RuntimeException=t),"function"==typeof define&&define.amd||(global.RuntimeException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/UnexpectedValueException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(e){Error.call(this),this.message=e,this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,void 0!==global.exports&&(global.exports.UnexpectedValueException=t),"function"==typeof define&&define.amd||(global.UnexpectedValueException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("io/InputManager",["jquery","utils/ArrayMap"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("utils/ArrayMap")):t(e.jQuery,e.ArrayMap)}("undefined"!=typeof window?window:global,function($,ArrayMap){"use strict";function getKey(e,t){return Object.keys(e).filter(function(o){return e[o]===t})[0]}var InputManager=function(e){this.j2d=e,this.id=e.data.id,this.element=e.element,this.data={mouse:{startPosition:{x:0,y:0},currentPosition:{x:0,y:0},previousDistance:0,distance:0},viewport:{position:{x:0,y:0}},enabled:!1,enableAdditionalData:!1,keysPressed:new ArrayMap,writeMode:!1,timePressed:0,preventAll:!1,cursor:{enabled:!1,image:"auto"}},this.keyMap={FULLSCREEN:[[InputManager.key.KEY_CTRL,InputManager.key.KEY_F11],"j2d.scene.toggleFullScreen",{}]}},checkKeyMap=function(e,enableCallback){void 0===enableCallback&&(enableCallback=!0);var j2d=e.data.manager.j2d,manager=e.data.manager,keyCode=e.which,keyMap=e.data.manager.keyMap;for(var index in keyMap)if(keyMap.hasOwnProperty(index)){var value=keyMap[index];if(!$.isArray(value[0])&&value[0]===keyCode&&value[1])return"string"==typeof value[1]&&(value[1]=eval("("+value[1]+")")),"function"==typeof value[1]&&enableCallback&&value[1](j2d,value[2]),!0;if($.isArray(value[0])&&manager.data.keysPressed.equals(value[0])&&value[1])return"string"==typeof value[1]&&(value[1]=eval("("+value[1]+")")),"function"==typeof value[1]&&enableCallback&&value[1](j2d,value[2]),!0}return!1},events={onMouseClick:function(e){var t=e.data.manager;if(!t.data.enabled||!t.j2d.isPlay||!t.j2d.element.hasClass("active"))return!0;var o=t.data.keysPressed,n=getKey(InputManager.key,e.which)||"KEY_UNKNOWN_"+e.which,a=t.data.mouse;2!==e.data.event?(0===e.data.event?(-1===$.inArray(InputManager.key[n],o)&&(o.push(InputManager.key[n]),t.data.enableAdditionalData&&(a.startPosition.x=e.pageX,a.startPosition.y=e.pageY,a.distance=0,t.data.timePressed=e.timeStamp)),(checkKeyMap(e,!1)||t.data.preventAll)&&e.preventDefault()):((checkKeyMap(e)||t.data.preventAll)&&e.preventDefault(),t.data.enableAdditionalData&&(a.previousDistance=a.distance,a.startPosition.x=0,a.startPosition.y=0),o.splice(o.indexOf(InputManager.key[n]),1)),t.element.trigger(0===e.data.event?"mouseKeyDown":"mouseKeyUp",{keyCode:n})):checkKeyMap(e,!1)&&e.preventDefault()},onMouseWheel:function(e){var t=e.data.manager;if(!t.data.enabled||!t.j2d.isPlay||!t.j2d.element.hasClass("active"))return!0;var o=t.data.keysPressed,n=e.originalEvent.wheelDelta/120>0?getKey(InputManager.key,4):getKey(InputManager.key,5);e.which=e.originalEvent.wheelDelta/120>0?4:5,-1===$.inArray(InputManager.key[n],o)&&o.push(InputManager.key[n]),(checkKeyMap(e)||t.data.preventAll)&&(e.preventDefault(),t.fixMouseWheel()),t.element.trigger("mouseWheel",{keyCode:n})},mouseWheelCancel:function(e,t){e.splice(e.indexOf(InputManager.key[t]),1)},onMouseMove:function(e){var t=e.data.manager,o=e.data.manager.data.mouse;t.data.mouse.currentPosition.x=e.pageX,t.data.mouse.currentPosition.y=e.pageY,e.data.manager.data.enableAdditionalData&&(o.distance=Math.sqrt(Math.pow(o.currentPosition.x-o.startPosition.x,2)+Math.pow(o.currentPosition.y-o.startPosition.y,2)).toFixed(1))},onKeyboardPress:function(e){var t=e.data.manager;if(!t.data.enabled||!t.j2d.isPlay||!t.element.hasClass("active"))return!0;var o=t.data.keysPressed,n=getKey(InputManager.key,e.which)||"KEY_UNKNOWN_"+e.which;if(2===e.data.event&&!0===t.data.writeMode){var a=String.fromCharCode(e.which||e.keyCode);e.preventDefault(),t.element.focus().trigger("keyboardCharPress",{key:e.which||e.keyCode,keyCode:n,"char":a})}2!==e.data.event&&!1===t.data.writeMode&&(0===e.data.event?(-1===$.inArray(InputManager.key[n],o)&&(o.push(InputManager.key[n]),t.data.enableAdditionalData&&(t.data.timePressed=e.timeStamp)),(checkKeyMap(e,!1)||t.data.preventAll)&&e.preventDefault()):((checkKeyMap(e)||t.data.preventAll)&&e.preventDefault(),o.splice(o.indexOf(InputManager.key[n]),1)),t.element.trigger(0===e.data.event?"keyboardKeyDown":"keyboardKeyUp",{keyCode:n,key:e.which||e.keyCode})),2!==e.data.event&&!0===t.data.writeMode&&t.element.trigger(0===e.data.event?"keyboardKeyDown":"keyboardKeyUp",{keyCode:n,key:e.which||e.keyCode})},onTouchTap:function(e){var t=e.data.manager;if(!t.data.enabled||!t.j2d.isPlay||!t.j2d.element.hasClass("active"))return!0;var o=t.data.keysPressed,n=getKey(InputManager.key,e.which+1)||"KEY_UNKNOWN_"+e.which,a=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],i=t.data.mouse;0===e.data.event?(-1===$.inArray(InputManager.key[n],o)&&(o.push(InputManager.key[n]),t.data.enableAdditionalData&&(i.startPosition.x=a.pageX,i.startPosition.y=a.pageY,i.distance=0,t.data.timePressed=e.timeStamp)),(checkKeyMap(e,!1)||t.data.preventAll)&&e.preventDefault()):((checkKeyMap(e)||t.data.preventAll)&&e.preventDefault(),t.data.enableAdditionalData&&(i.previousDistance=i.distance,i.startPosition.x=0,i.startPosition.y=0),o.splice(o.indexOf(InputManager.key[n]),1)),t.element.trigger(0===e.data.event?"mouseKeyDown":"mouseKeyUp",{keyCode:n})},onTouchMove:function(e){var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],o=e.data.manager.data.mouse;o.currentPosition.x=t.pageX.toFixed(0),o.currentPosition.y=t.pageY.toFixed(0),e.data.manager.data.enableAdditionalData&&(o.distance=Math.sqrt(Math.pow(o.currentPosition.x-o.startPosition.x,2)+Math.pow(o.currentPosition.y-o.startPosition.y,2)).toFixed(1))}},bindEvents=function(e){var t="[guid="+e.id+"]";$(document).on("contextmenu",t,{manager:e,event:2},events.onMouseClick),$(document).on("mousedown",t,{manager:e,event:0},events.onMouseClick),$(document).on("mouseup",t,{manager:e,event:1},events.onMouseClick),$(document).on("mousewheel",t,{manager:e},events.onMouseWheel),$(document).on("mousemove",t,{manager:e},events.onMouseMove),$(document).on("keydown",null,{manager:e,event:0},events.onKeyboardPress),$(document).on("keyup",null,{manager:e,event:1},events.onKeyboardPress),$(document).on("keypress",null,{manager:e,event:2},events.onKeyboardPress),$(document).on("touchstart",t,{manager:e,event:0},events.onTouchTap),$(document).on("touchend",t,{manager:e,event:1},events.onTouchTap),$(document).on("touchmove ",t,{manager:e},events.onTouchMove)},unbindEvents=function(e){var t="[guid="+e.id+"]";$(document).off("contextmenu",t,{manager:e,event:1},events.onMouseClick),$(document).off("mousedown",t,{manager:e,event:0},events.onMouseClick),$(document).off("mouseup",t,{manager:e,event:1},events.onMouseClick),$(document).off("mousewheel",t,{manager:e},events.onMouseWheel),$(document).off("mousemove",t,{manager:e},events.onMouseMove),$(document).off("keydown",null,{manager:e,event:0},events.onKeyboardPress),$(document).off("keyup",null,{manager:e,event:1},events.onKeyboardPress),$(document).off("keypress",null,{manager:e,event:2},events.onKeyboardPress),$(document).off("touchstart",t,{manager:e,event:0},events.onTouchTap),$(document).off("touchend",t,{manager:e,event:1},events.onTouchTap),$(document).off("touchmove ",t,{manager:e},events.onTouchMove)};InputManager.prototype.init=function(){return!this.data.enabled&&global.j2dPlugin.pluginInit&&(bindEvents(this),this.data.enabled=!0),this},InputManager.prototype.update=function(){if(!this.data.enabled)return!1;var e=this.j2d.scene.canvas.offsetWidth/this.j2d.scene.width,t=this.j2d.scene.canvas.offsetHeight/this.j2d.scene.height,o=this.data.mouse.currentPosition.x/e,n=this.data.mouse.currentPosition.y/t,a=this.element.offset();return this.data.viewport.x=this.j2d.scene.viewport.x+o-a.left,this.data.viewport.y=this.j2d.scene.viewport.y+n-a.top,!0},InputManager.prototype.flush=function(){return this.data.keysPressed.length=0,this},InputManager.prototype.clear=function(){return this},InputManager.prototype.fixMouseWheel=function(){var e=this.data.keysPressed;return-1!==$.inArray(InputManager.key.SCROLL_MOUSE_UP,e)?events.mouseWheelCancel(e,InputManager.key.SCROLL_MOUSE_UP):-1!==$.inArray(InputManager.key.SCROLL_MOUSE_DOWN,e)&&events.mouseWheelCancel(e,InputManager.key.SCROLL_MOUSE_DOWN),this},InputManager.prototype.enable=function(){return this.data.enabled||(this.data.enabled=!1),this},InputManager.prototype.disable=function(){return this.data.enabled&&(this.data.enabled=!1),this},InputManager.prototype.load=function(e){var t=JSON.stringify(this.keyMap);return this.keyMap=JSON.parse(e),t},InputManager.prototype.save=function(){return JSON.stringify(this.keyMap)},InputManager.prototype.setKeys=function(e){return this.keyMap=$.extend(!0,{},this.keyMap,e),this};var getPressData=function(e,t){return e.data.enableAdditionalData?{keyList:t,time:Date.now()-e.data.timePressed}:!0};return InputManager.prototype.getMouseMoveDistance=function(){return this.data.enableAdditionalData?{current:this.data.mouse.distance,previous:this.data.mouse.previousDistance}:0},InputManager.prototype.checkPressedKeyList=function(e){return $.isArray(e)?e.length!==this.data.keysPressed.length?!1:this.data.keysPressed.equals(e)?(this.fixMouseWheel(),getPressData(this,e)):(this.fixMouseWheel(),!1):isNaN(e)?!1:-1!==this.data.keysPressed.indexOf(e)?(this.fixMouseWheel(),getPressData(this,e)):(this.fixMouseWheel(),!1)},InputManager.prototype.checkPressedKeyMap=function(e){if(void 0===this.keyMap[e])return!1;var t=this.keyMap[e][0];return this.checkPressedKeyList(t)},InputManager.prototype.setWriteMode=function(e){return this.data.writeMode=!!e,this},InputManager.prototype.isWriteMode=function(){return!!this.data.writeMode},InputManager.prototype.setCursorImage=function(e){return this.data.cursor.image='url("'+e+'"), auto',$(this.element).css("cursor",this.data.cursor.image),this},InputManager.prototype.toggleCursor=function(e){return void 0!==e?this.data.cursor.enable=!!e:this.data.cursor.enable=!this.data.cursor.enable,this.data.cursor.enable?$(this.element).css("cursor",this.data.cursor.image):(this.data.cursor.image=$(this.j2d.element).css("cursor"),$(this.element).css("cursor","none")),this},InputManager.prototype.isCursorVisible=function(){return!!this.data.cursor.enable},InputManager.key={KEY_MOUSE_LEFT:1,KEY_MOUSE_MIDDLE:2,KEY_MOUSE_RIGHT:3,SCROLL_MOUSE_UP:4,SCROLL_MOUSE_DOWN:5,KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_BREAK:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE_BAR:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_LEFT_WINDOW_KEY:91,KEY_RIGHT_WINDOW_KEY:92,KEY_SELECT_KEY:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SUBTRACT:109,KEY_DECIMAL_POINT:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_SEMI_COLON:186,KEY_EQUAL_SIGN:187,KEY_COMMA:188,KEY_DASH:189,KEY_PERIOD:190,KEY_FORWARD_SLASH:191,KEY_GRAVE_ACCENT:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_SINGLE_QUOTE:222,KEY_LEFT_COMMAND:224,KEY_RIGHT_COMMAND:224},void 0!==global.exports&&(global.exports.InputManager=InputManager),void 0!==global.J2D&&(global.InputManager=InputManager),InputManager}),function(e,t){"function"==typeof define&&define.amd?define("io/MediaManager",["jquery","utils/ArrayMap","utils/Events","media/Audio","media/Sound"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("utils/ArrayMap"),require("utils/Events"),require("media/Audio"),require("media/Sound")):t(e.jQuery,e.ArrayMap,e.Events,e.Audio,e.Sound)}("undefined"!=typeof window?window:global,function(e,t,o,n,a){"use strict";var i=global.Audio,r=!1,s=!1;try{var d=global.AudioContext||global.webkitAudioContext;r=new d}catch(u){console.warn("Web Audio API is not supported in your browser")}try{s=!!new i}catch(u){console.warn("HTML5 Audio is not supported in your browser")}if(r){var l=void 0===r.createGain?r.createGainNode():r.createGain();l.gain.value=1,l.connect(r.destination)}var c=function(n,a){void 0===a&&(a={});var d=this;if(this.j2d=n,this.data=e.extend(!0,{},c.defaults,a),this.events=new o,this.media=new t,this.media.add("sounds",new t),this.media.add("audios",new t),this.media.add("videos",new t),this.volume=100*this.data.volume,this.iOSEnabled=!1,r||s){var u=new i;this.data.codecs={mp3:!!u.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!u.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!u.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!u.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(u.canPlayType("audio/x-m4a;")||u.canPlayType("audio/m4a;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(u.canPlayType("audio/x-mp4;")||u.canPlayType("audio/mp4;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")},u=null}Object.defineProperty(this,"volume",{get:function(){return 100*d.data.volume},set:function(e){if(d.data.volume=parseFloat(e/100),e>=0&&1>=e)if(r)l.gain.value=d.data.volume;else{var t=d.media.get("sounds");for(var o in t)if(t.hasOwnProperty(o)&&!t[o].webAudio)for(var n=0;n<t[o].audioNode.length;n++)t[o].audioNode[n].volume=t[o].volume*d.data.volume;t=null}}}),Object.defineProperty(this,"muted",{get:function(){return!!d.data.muted},set:function(e){if(d.data.muted=!!e,r)l.gain.value=d.data.muted?0:d.data.volume;else{var t=d.media.get("sounds");for(var o in t)if(t.hasOwnProperty(o)&&t[o].webAudio===!1)for(var n=0;n<t[o].audioNode.length;n++)t[o].audioNode[n].muted=d.data.muted;t=null}}}),Object.defineProperty(this,"iOSEnable",{get:function(){return!!d.data.iOSAutoEnable},set:function(e){if(r&&(d.iOSEnabled||!/iPhone|iPad|iPod/i.test(navigator.userAgent)))return e;d.iOSEnabled=!1;var t=function(){var e=r.createBuffer(1,1,22050),o=r.createBufferSource();o.buffer=e,o.connect(r.destination),void 0===o.start?o.noteOn(0):o.start(0),setTimeout(function(){o.playbackState!==o.PLAYING_STATE&&o.playbackState!==o.FINISHED_STATE||(d.iOSEnabled=!0,d.data.iOSAutoEnable=!1,global.removeEventListener("touchend",t,!1))},0)};global.addEventListener("touchend",t,!1)}}),Object.defineProperty(this,"isSupportAudio",{get:function(){return!r&&!s}})};return c.defaults={volume:1,muted:!1,codecs:{},iOSAutoEnable:!0},c.prototype.getAudioContext=function(){return r},c.prototype.getMasterGain=function(){return l},c.prototype.mute=function(){return this.muted=!0,this},c.prototype.unMute=function(){return this.muted=!1,this},c.prototype.isSupportCodec=function(e){return!!this.data.codecs[e]},c.prototype.addSound=function(e){return new a(e,this),this},c.prototype.addAudio=function(e){return new n(e,this),this},c.prototype.addVideo=function(e){return this},c.prototype.sound=function(e){return this.media.get("sounds").get(e)},c.prototype.audio=function(e){return this.media.get("audios").get(e)},c.prototype.video=function(e){return this.media.get("videos").get(e)},c.prototype.removeSound=function(e){return this.media.get("sounds").contains(e)&&(this.media.get("sounds").get(e).stop(),this.media.get("sounds").remove(e)),this},c.prototype.removeAudio=function(e){return this.media.get("audios").contains(e)&&(this.media.get("audios").get(e).stop(),this.media.get("audios").remove(e)),this},c.prototype.removeVideo=function(e){return this.media.get("videos").contains(e)&&(this.media.get("videos").get(e).stop(),this.media.get("videos").remove(e)),this},void 0!==global.exports&&(global.exports.MediaManager=c),void 0!==global.J2D&&(global.MediaManager=c),c}),function(e,t){"function"==typeof define&&define.amd?define("media/Audio",["utils/UUID","utils/Events"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/UUID"),require("utils/Events")):t(e.UUID,e.Events)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var o={},n=global.Audio,a=function(o,n){var i=this;i.manager=void 0!==n?n:null,i.events=i.manager?i.manager.events:new t,i.data=$.extend(!0,{},a.defaults,o),i.audioNode=[],null===i.data.id&&(i.data.id=e.generate()),i.manager&&i.manager.media.get("audios").add(i.data.id,i),i.load()};return a.defaults={id:null,src:[],format:null,autoPlay:!1,duration:0,loop:!1,sprite:{},volume:1,muted:!1,pos3d:[0,0,-.5],loaded:!1,onEndTimer:[]},a.prototype._load=function(e){var t=new n;t.addEventListener("error",function(){console.error({type:t.error?t.error.code:0})},!1),e.audioNode.push(t),t.src=e.data.src,t.pos=0,t.preload="auto",t.volume=e.manager?e.manager.muted?0:e.data.volume*(e.manager.volume/100):e.data.muted?0:e.data.volume;var o=function(){e.data.duration=Math.ceil(10*t.duration)/10,0===Object.getOwnPropertyNames(e.data.sprite).length&&(e.data.sprite={"default":[0,1e3*e.data.duration]}),e.data.loaded||(e.data.loaded=!0,e.events.trigger("load")),e.data.autoPlay&&e.play(),t.removeEventListener("canplaythrough",o,!1)};return t.addEventListener("canplaythrough",o,!1),t.load(),e},a.prototype.load=function(){var e=this,t="",o="";if(e.manager&&e.manager.isSupportAudio)return console.warn("No audio support."),!1;var n=function(e,t){if(t)return t;var o=/^data:audio\/([^;,]+);/i.exec(e);return o||(o=/\.([^.]+)$/.exec(e.split("?",1)[0])),o?o[1].toLowerCase():(console.warn("Could not extract format from passed URLs, please add format"),null)};if(e.data.src instanceof Array){for(var a=0;a<e.data.src.length&&(t=e.data.src[a],o=n(e.data.src[a],e.data.format),null===o);a++);e.data.src=t}else{if("string"!=typeof e.data.src)return console.warn("Unknown audio source"),!1;o=n(e.data.src,e.data.format)}return e.manager&&e.manager.isSupportCodec[o]?(console.warn("Codec not support"),!1):e._load(e)},a.prototype._unload=function(e){e.src=""},a.prototype.unload=function(){for(var e=this,t=e.audioNode,n=0;n<e.audioNode.length;n++)t[n].paused||(e.stop(t[n].id),e.events.trigger("end",t[n].id)),
e._unload(t[n]);for(n=0;n<e.data.onEndTimer.length;n++)clearTimeout(e.data.onEndTimer[n].timer);if(e.manager){var a=this.manager.get("audios"),i=a.indexOf(e);null!==i&&i>=0&&a.splice(i,1)}delete o[e.data.src],e=null},a.prototype.src=function(e){var t=this;return e&&(t.stop(),t.data.src=e,t.data.loaded=!1,t.load()),null},a.prototype.play=function(e,t){var o=this;return"function"==typeof e&&(t=e),e&&"function"!=typeof e||(e="default"),o.data.loaded?o.data.sprite[e]?(o._inactiveNode(o,function(n){n.sprite=e;var a,i=n.pos>0?n.pos:o.data.sprite[e][0]/1e3,r=o.data.sprite[e][1]/1e3-(i-o.data.sprite[e][0]/1e3),s=!(!o.data.loop&&!o.data.sprite[e][2]),d="string"==typeof t?t:Math.round(Date.now()*Math.random())+"";return function(){var t={id:d,sprite:e,loop:s};a=setTimeout(function(){s?o.stop(t.id).play(e,t.id):o.stop(t.id),o.events.trigger("end",d)},r/o.data.rate*1e3),o.data.onEndTimer.push({timer:a,id:t.id})}(),4===n.readyState||!n.readyState&&navigator.isCocoonJS?(n.id=d,n.currentTime=i,n.muted=o.manager?o.manager.muted||n.muted:o.data.muted||n.muted,n.volume=o.manager?o.data.volume*(o.manager.volume/100):o.data.volume,setTimeout(function(){n.play()},0),o.events.trigger("play"),"function"==typeof t&&t(d),o):(o._clearEndTimer(d),function(){var o=o,a=e,i=t,r=n,s=function(){o.play(a,i),r.removeEventListener("canplaythrough",s,!1)};r.addEventListener("canplaythrough",s,!1)}(),o)}),o):("function"==typeof t&&t(),o):(o.events.on("load",function(){o.play(e,t)}),o)},a.prototype._pause=function(e){return e.pause(),!1},a.prototype.pause=function(e){var t=this;if(!t.data.loaded)return t.events.on("play",function(){t.pause(e)}),t;t._clearEndTimer(t,e);var o=e?t._nodeById(e):t._activeNode(t);if(o){o.pos=t.pos(null,e);var n=t._pause(o);if(n)return t}return t.events.trigger("pause"),t},a.prototype._stop=function(e){return isNaN(e.duration)||(e.pause(),e.currentTime=0),!1},a.prototype.stop=function(e){var t=this;if(!t.data.loaded)return t.events.on("play",function(){t.stop(e)}),t;t._clearEndTimer(t,e);var o=e?t._nodeById(t,e):t._activeNode(t);if(o){o.pos=0;var n=t._stop(o);if(n)return t}return t},a.prototype._mute=function(e){e.muted=!0},a.prototype.mute=function(e){var t=this;if(!t.data.loaded)return t.events.on("play",function(){t.mute(e)}),t;var o=e?t._nodeById(e):t._activeNode(t);return o&&t._mute(),t},a.prototype._unMute=function(e){e.muted=!1},a.prototype.unMute=function(e){var t=this;if(!t.data.loaded)return t.events.on("play",function(){t.unMute(e)}),t;var o=e?t._nodeById(e):t._activeNode(t);return o&&t._unMute(),t},a.prototype._volume=function(e,t){e.volume=t},a.prototype.volume=function(e,t){var o=this;if(e=parseFloat(e),e>=0&&1>=e){if(o.data.volume=e,!o.data.loaded)return o.events.on("play",function(){o.volume(e,t)}),o;var n=t?o._nodeById(t):o._activeNode(o);return n&&(e=o.manager?e*(o.manager.volume/100):o.data.volume,o._volume(e)),o}return o.data.volume},a.prototype.loop=function(e){var t=this;return"boolean"==typeof e?(t.data.loop=e,t):t.data.loop},a.prototype.sprite=function(e){var t=this;return"object"==typeof e?(t.data.sprite=e,t):t.data.sprite},a.prototype._position=function(e,t){return e.currentTime},a.prototype.pos=function(e,t){var o=this;if(!o.data.loaded)return o.events.on("load",function(){o.pos(e)}),"number"==typeof e?o:o.data.pos||0;e=parseFloat(e);var n=t?o._nodeById(t):o._activeNode(o);if(n)return e>=0?(o.pause(t),n.pos=e,o.play(n.sprite,t),o):o._position(n,!1);if(e>=0)return o;for(var a=0;a<o.audioNode.length;a++)if(o.audioNode[a].paused&&4===o.audioNode[a].readyState)return o._position(o.audioNode[a],!0)},a.prototype._pos3d=function(e,t,o,n){return null},a.prototype.pos3d=function(e,t,o,n){var a=this;if(t="undefined"!=typeof t&&t?t:0,o="undefined"!=typeof o&&o?o:-.5,!a.data.loaded)return a.events.on("play",function(){a.pos3d(e,t,o,n)}),a;if(!(e>=0||0>e))return a.data.pos3d;var i=n?a._nodeById(n):a._activeNode(a);return a._pos3d(i,e,t,o),a},a.prototype._nodeById=function(e,t){for(var o=e.audioNode[0],n=0;n<e.audioNode.length;n++)if(e.audioNode[n].id===t){o=e.audioNode[n];break}return o},a.prototype._clearEndTimer=function(e,t){for(var o=-1,n=0;n<e.data.onEndTimer.length;n++)if(e.data.onEndTimer[n].id===t){o=n;break}var a=e.data.onEndTimer[o];a&&(clearTimeout(a.timer),e.data.onEndTimer.splice(o,1))},a.prototype._activeNode=function(e){for(var t=null,o=0;o<e.audioNode.length;o++)if(!e.audioNode[o].paused){t=e.audioNode[o];break}return e._drainPool(e),t},a.prototype._inactiveNode=function(e,t){for(var o=null,n=0;n<e.audioNode.length;n++)if(e.audioNode[n].paused&&4===e.audioNode[n].readyState){t(e.audioNode[n]),o=!0;break}if(e._drainPool(e),!o){e.load();var a=e.audioNode[e.audioNode.length-1],i=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",r=function(){a.removeEventListener(i,r,!1),t(a)};a.addEventListener(i,r,!1)}},a.prototype._drainPool=function(e){for(var t=0,o=0;o<e.audioNode.length;o++)e.audioNode[o].paused&&t++;for(o=e.audioNode.length-1;o>=0&&!(5>=t);o--)e.audioNode[o].paused&&(e.audioNode.splice(o,1),t--)},void 0!==global.exports&&(global.exports.Audio=a),void 0!==global.J2D&&(global.Audio=a),a}),function(e,t){"function"==typeof define&&define.amd?define("media/Sound",["utils/UUID","utils/Events","media/Audio"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/UUID"),require("utils/Events"),require("media/Audio")):t(e.UUID,e.Events,e.Audio)}("undefined"!=typeof window?window:global,function(e,t,o){"use strict";function n(){return a?(i=void 0===a.createGain?a.createGainNode():a.createGain(),i.gain.value=1,i.connect(a.destination),i):null}var a,i,r={},s=function(r,d){var u=this;o.call(this,r,d),u.manager=d,u.events=u.manager?u.manager.events:new t,u.data=$.extend(!0,{},s.defaults,r),u.audioNode=[],a=d?d.getAudioContext():new(global.AudioContext||global.webkitAudioContext),i=d?d.getMasterGain():n(),null===u.data.id&&(u.data.id=e.generate()),a&&u.data.buffer&&_setupAudioNode(u),u.manager&&a&&u.manager.data.iOSAutoEnable&&(u.manager.iOSEnable=!0),u.manager&&u.manager.media.get("sounds").add(u.data.id,u),u.load()};s.defaults={id:null,src:[],format:null,autoPlay:!1,duration:0,loop:!1,sprite:{},volume:1,muted:!1,pos3d:[0,0,-.5],rate:1,loaded:!1,buffer:!1,model:null,onEndTimer:[]},s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype._load=function(e){return d(e,e.data.src),e},s.prototype._unload=function(e){e.disconnect(0)},s.prototype.play=function(e,t){var o=this;return"function"==typeof e&&(t=e),e&&"function"!=typeof e||(e="default"),o.data.loaded?o.data.sprite[e]?(o._inactiveNode(o,function(n){n.sprite=e;var i=n.pos>0?n.pos:o.data.sprite[e][0]/1e3,r=o.data.sprite[e][1]/1e3-n.pos;n.pos>0&&(i=o.data.sprite[e][0]/1e3+i);var s,d=!(!o.data.loop&&!o.data.sprite[e][2]),u="string"==typeof t?t:Math.round(Date.now()*Math.random())+"";!function(){var t={id:u,sprite:e,loop:d};s=setTimeout(function(){a&&!d&&(o._nodeById(o,t.id).paused=!0,o._nodeById(o,t.id).pos=0,o._clearEndTimer(o,t.id)),o.events.trigger("end",u)},r/o.data.rate*1e3),o.data.onEndTimer.push({timer:s,id:t.id})}();var l=o.data.sprite[e][0]/1e3,f=o.data.sprite[e][1]/1e3;return n.id=u,n.paused=!1,c(o,[d,l,f],u),o.data.playStart=a.currentTime,n.gain.value=o.data.volume,"undefined"==typeof n.bufferSource.start?d?n.bufferSource.noteGrainOn(0,i,86400):n.bufferSource.noteGrainOn(0,i,r):d?n.bufferSource.start(0,i,86400):n.bufferSource.start(0,i,r),o.events.trigger("play"),"function"==typeof t&&t(u),o}),o):("function"==typeof t&&t(),o):(o.events.on("load",function(){o.play(e,t)}),o)},s.prototype._pause=function(e){return!e.bufferSource||e.paused?!0:(e.paused=!0,void 0==e.bufferSource.stop?e.bufferSource.noteOff(0):e.bufferSource.stop(0),!1)},s.prototype._stop=function(e){return!e.bufferSource||e.paused?!0:(e.paused=!0,"undefined"==typeof e.bufferSource.stop?e.bufferSource.noteOff(0):e.bufferSource.stop(0),!1)},s.prototype._mute=function(e){e.gain.value=0},s.prototype._unMute=function(e){e.gain.value=this.data.volume},s.prototype._volume=function(e,t){e.gain.value=t},s.prototype._position=function(e,t){return void 0!==t&&1==t?e.pos:e.pos+(a.currentTime-this.data.playStart)},s.prototype._pos3d=function(e,t,o,n){e&&(this.data.pos3d=[t,o,n],e.panner.setPosition(t,o,n),e.panner.panningModel=this.data.model||"HRTF")},s.prototype._setupAudioNode=function(){var e=this,t=e.audioNode,o=e.audioNode.length;return t[o]=void 0===a.createGain?a.createGainNode():a.createGain(),t[o].gain.value=e.data.volume,t[o].paused=!0,t[o].pos=0,t[o].readyState=4,t[o].connect(i),t[o].panner=a.createPanner(),t[o].panner.panningModel=e.data.model||"equalpower",t[o].panner.setPosition(e.data.pos3d[0],e.data.pos3d[1],e.data.pos3d[2]),t[o].panner.connect(t[o]),t[o]},s.prototype._inactiveNode=function(e,t){for(var o=null,n=0;n<e.audioNode.length;n++)if(e.audioNode[n].paused&&4===e.audioNode[n].readyState){t(e.audioNode[n]),o=!0;break}if(e._drainPool(e),!o){var a=e._setupAudioNode();t(a)}},s.prototype._drainPool=function(e){for(var t=0,o=0;o<e.audioNode.length;o++)e.audioNode[o].paused&&t++;for(o=e.audioNode.length-1;o>=0&&!(5>=t);o--)e.audioNode[o].paused&&(a&&e.audioNode[o].disconnect(0),e.audioNode.splice(o,1),t--)};var d=function(e,t){if(t in r)return e.data.duration=r[t].duration,void l(e);if(/^data:[^;]+;base64,/.test(t)){for(var o=atob(t.split(",")[1]),n=new Uint8Array(o.length),i=0;i<o.length;++i)n[i]=o.charCodeAt(i);u(n.buffer,e,t)}else{var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer",s.onload=function(){u(s.response,e,t)},s.onerror=function(){a&&(e.data.buffer=!0,e.audioNode=[],delete e.gainNode,delete r[t],e.load())};try{s.send()}catch(d){s.onerror()}}},u=function(e,t,o){a.decodeAudioData(e,function(e){e&&(r[o]=e,l(t,e))},function(e){t.events.trigger("loaderror",e)})},l=function(e,t){e.data.duration=t?t.duration:e.data.duration,0===Object.getOwnPropertyNames(e.data.sprite).length&&(e.data.sprite={"default":[0,1e3*e.data.duration]}),e.data.loaded||(e.data.loaded=!0,e.events.trigger("load")),e.data.autoPlay&&e.play()},c=function(e,t,o){var n=e._nodeById(e,o);n.bufferSource=a.createBufferSource(),n.bufferSource.buffer=r[e.data.src],n.bufferSource.connect(n.panner),n.bufferSource.loop=t[0],t[0]&&(n.bufferSource.loopStart=t[1],n.bufferSource.loopEnd=t[1]+t[2]),n.bufferSource.playbackRate.value=e.data.rate};return void 0!==global.exports&&(global.exports.Sound=s),void 0!==global.J2D&&(global.Sound=s),s}),function(e,t){"function"==typeof define&&define.amd?define("media/Video",["jquery","utils/ArrayMap"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("utils/ArrayMap")):t(e.jQuery,e.ArrayMap)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var o=function(){};return void 0!==global.exports&&(global.exports.Video=o),void 0!==global.J2D&&(global.Video=o),o}),function(e,t){"function"==typeof define&&define.amd?define("nodes/BaseNode",["jquery","utils/Vector2d"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("utils/Vector2d")):t(e.jQuery,e.Vector2d)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var o=function(t){var n=this;this.data=e.extend(!0,{},o.defaults,t),null===this.data.id&&(this.data.id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,o="x"==e?t:3&t|8;return o.toString(16)})),Object.defineProperty(this,"opacity",{get:function(){return n.data.opacity},set:function(e){n.data.opacity=e}}),Object.defineProperty(this,"visible",{get:function(){return n.data.visible},set:function(e){n.data.visible=!!e}}),Object.defineProperty(this,"angle",{get:function(){return n.data.angle},set:function(e){n.data.angle=e%360}}),Object.defineProperty(this,"scale",{get:function(){return n.data.scale},set:function(e){n.data.scale=e}}),Object.defineProperty(this,"cache",{get:function(){return n.data.enabledCache},set:function(e){n.data.enabledCache=!!e}})};return o.defaults={id:null,type:"BaseNode",position:{x:0,y:0},size:{x:0,y:0},offset:{x:0,y:0},visible:!0,angle:0,scale:1,opacity:1,cache:null,enabledCache:!1},o.prototype.getPosition=function(){return new t(this.data.position.x,this.data.position.y)},o.prototype.setPosition=function(e){return void 0!==e&&e instanceof t&&(this.data.position=e.getVector()),this},o.prototype.getSize=function(){return new t(this.data.size.x,this.data.size.y)},o.prototype.setSize=function(e){return void 0!==e&&e instanceof t&&(this.data.size=e.getVector()),this},o.prototype.getOffset=function(){return new t(this.data.offset.x,this.data.offset.y)},o.prototype.setOffset=function(e){return void 0!==e&&e instanceof t&&(this.data.offset=e.getVector()),this},o.prototype.render=function(e,t,o,n){return this},void 0!==global.exports&&(global.exports.BaseNode=o),void 0!==global.J2D&&(global.BaseNode=o),o}),function(e,t){"function"==typeof define&&define.amd?define("nodes/CameraNode",["jquery","nodes/BaseNode"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("nodes/BaseNode")):t(e.jQuery,e.BaseNode)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var o=function(n){t.call(this,e.extend(!0,{},o.defaults,n))};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.defaults={type:"CameraNode"},o.prototype.getCameraViewport=function(e,t){return t(e,{offset:this.data.position,size:this.data.size,angle:this.data.angle,scale:this.data.scale})},o.prototype.render=function(e,t,o,n){return this},void 0!==global.exports&&(global.exports.CameraNode=o),void 0!==global.J2D&&(global.CameraNode=o),o}),function(e,t){"function"==typeof define&&define.amd?define("nodes/CollectionNode",["jquery","nodes/BaseNode","utils/ArrayMap"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("nodes/BaseNode"),require("utils/ArrayMap")):t(e.jQuery,e.BaseNode,e.ArrayMap)}("undefined"!=typeof window?window:global,function(e,t,o){"use strict";var n=function(a){var i=this;t.call(this,e.extend(!0,{},n.defaults,a)),null===this.data.collection&&(this.data.collection=new o),Object.defineProperty(this,"zIndex",{get:function(){return 1e3-i.data.zIndex},set:function(e){i.data.zIndex=1e3+e}})};return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.defaults={type:"CollectionNode",collection:null,zIndex:1e3},n.prototype.add=function(e,o){return e instanceof t&&(o=o||e.data.id,this.data.collection.add(o,e)),this},n.prototype.remove=function(e,o){return e instanceof t&&this.data.collection.remove(this.data.collection[e.data.id]),"string"==typeof o&&null===e&&this.data.collection.remove(o),this},n.prototype.has=function(e){return void 0!==this.data.collection[e]},n.prototype.get=function(e){return void 0!==this.data.collection[e]?this.data.collection[e]:!1},n.prototype.flush=function(){return this.data.collection.length=0,this},n.prototype.render=function(e,o,n,a){var i=this;return 0!==this.data.collection.length&&this.data.collection.each(function(r){i.data.collection.hasOwnProperty(r)&&i.data.collection[r]instanceof t&&i.data.collection[r].render(e,o,n,a)}),this},void 0!==global.exports&&(global.exports.CollectionNode=n),void 0!==global.J2D&&(global.CollectionNode=n),n}),function(e,t){"function"==typeof define&&define.amd?define("nodes/RectNode",["jquery","nodes/BaseNode","utils/MathUtil"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("nodes/BaseNode"),require("utils/MathUtil")):t(e.jQuery,e.BaseNode,e.MathUtil)}("undefined"!=typeof window?window:global,function(e,t,o){"use strict";var n=function(o){t.call(this,e.extend(!0,{},n.defaults,o))};return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.defaults={type:"RectNode",color:"#000000"},n.prototype.getColor=function(){return this.data.color},n.prototype.setColor=function(e){return this.data.color=e,this},n.prototype.draw=function(e,t,n,a){if(this.data.visible){if(1!==this.data.opacity){var i=e.globalAlpha;e.globalAlpha=this.options.opacity}(this.data.angle||0!==t.angle)&&(e.save(),e.translate(this.getPosition().x-t.offset.x,this.getPosition().y-t.offset.y),e.rotate(o.degree2Radian(this.data.angle+t.angle)),e.translate(-(this.getPosition().x-t.offset.x),-(this.getPosition().y-t.offset.y))),e.fillStyle=this.data.color,e.lineWidth=0,e.fillRect(this.data.position.x-t.offset.x,this.data.position.y-t.offset.y,this.data.size.x*this.data.scale*t.scale,this.data.size.y*this.data.scale*t.scale),(this.data.angle||0!==t.angle)&&e.restore(),1!==this.data.opacity&&(e.globalAlpha=i)}return null},n.prototype.render=function(e,t,o,n){return this.draw(e,t,o,n),this},void 0!==global.exports&&(global.exports.RectNode=n),void 0!==global.J2D&&(global.RectNode=n),n}),function(e,t){"function"==typeof define&&define.amd?define("utils/ArrayMap",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){Array.call(this,e)};return e.prototype=Object.create(Array.prototype),e.prototype.constructor=e,e.prototype.last=function(){return this[this.length-1]},e.prototype.equals=function(e){if(!e)return!1;if(this.length!=e.length)return!1;for(var t=0,o=this.length;o>t;t++)if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].equals(e[t]))return!1}else if(this[t]!=e[t])return!1;return!0},Object.defineProperty(e.prototype,"equals",{enumerable:!1}),e.prototype.contains=function(e){for(var t=this.length;t--;)if(this[t]===e)return!0;return!1},Object.defineProperty(e.prototype,"contains",{enumerable:!1}),e.prototype.each=function(e){if(!e)return!1;for(var t=!1,o=0;o<this.length;o++)if(0==(t=e(this[o],o)))return t;return t},Object.defineProperty(e.prototype,"each",{enumerable:!1}),e.prototype.add=function(e,t){return this.contains(e)?this[e]=t:(this.push(e),this[e]=t),this},Object.defineProperty(e.prototype,"add",{enumerable:!1}),e.prototype.get=function(e){return this.contains(e)?this[e]:null},Object.defineProperty(e.prototype,"get",{enumerable:!1}),e.prototype.remove=function(e){for(var t=0;t<this.length;++t)if(this[t]==e)return this.splice(t,1),delete this[e],this;return this},Object.defineProperty(e.prototype,"remove",{enumerable:!1}),void 0!==global.exports&&(global.exports.ArrayMap=e),"function"==typeof define&&define.amd||(global.ArrayMap=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/DeviceUtil",["jquery","utils/Vector2dInteger"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("utils/Vector2dInteger")):t(e.jQuery,e.Vector2dInteger)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var o=function(){this.width=parseInt(e(document).width())<parseInt(screen.width)?parseInt(e(document).width()):parseInt(screen.width),this.height=parseInt(e(document).height())<parseInt(screen.height)?parseInt(e(document).height()):parseInt(screen.height)};return o.prototype.onResize=function(){return this.width=window.innerWidth,this.height=window.innerHeight,this},o.prototype.getWidth=function(){return this.width},o.prototype.getHeight=function(){return this.height},o.prototype.getSize=function(){return new t(this.width,this.height)},void 0!==global.exports&&(global.exports.DeviceUtil=o),void 0===global.J2D&&(global.DeviceUtil=o),o}),function(e,t){"function"==typeof define&&define.amd?define("utils/Events",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){var e,t;this.flush=function(o){void 0!==o?(void 0!==e[o]&&(e[o]=new Array),void 0!==t[o]&&(t[o]=new Array)):(t=new Array,e=new Array)},this.flush(),this.on=function(t,o){if(void 0!==e[t]){var n=e[t];-1===n.indexOf(o)&&n.push(o)}else e[t]=new Array,e[t].push(o)},this.once=function(e,o){if(void 0!==t[e]){var n=t[e];-1===n.indexOf(o)&&n.push(o)}else t[e]=new Array,t[e].push(o)},this.off=function(o,n){if(void 0!==t[o]){var a=e[o];-1!==a.indexOf(n)&&a.splice(a.indexOf(n))}},this.trigger=function(o,n){var a,i;if(void 0!==e[o])for(a=e[o],i=0;i<a.length;i++)a[i].call(a[i],n);if(void 0!==t[o]){for(a=t[o],i=0;i<a.length;i++)a[i].call(a[i],n);this.flush(o)}}};return void 0!==global.exports&&(exports.Events=e),void 0===global.J2D&&(global.Events=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/MathUtil",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){};return e.number2Integer=function(e){return e>>0},e.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&e>-9007199254740992&&9007199254740992>e&&Math.floor(e)===e},e.randomColor=function(t,o,n){return"rgba("+e.random(t,o)+", "+e.random(t,o)+", "+e.random(t,o)+", "+n+")"},e.random=function(t,o,n){var a=Math.floor(Math.random()*(o-t+1)+t);return n&&0==a?e.random(t,o,n):a},e.degree2Radian=function(e){return e*(Math.PI/180)},e.radian2Degree=function(e){return e*(180/Math.PI)},void 0!==global.exports&&(global.exports.MathUtil=e),void 0===global.J2D&&(global.MathUtil=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/UUID",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){};return e.generate=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,o="x"==e?t:3&t|8;return o.toString(16)})},void 0!==global.exports&&(global.exports.UUID=e),void 0===global.J2D&&(global.UUID=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/Vector2d",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e,t){this.x=e,this.y=t};return e.prototype.getX=function(){return this.x},e.prototype.getY=function(){return this.y},e.prototype.getVector=function(){return{x:this.x,y:this.y}},e.prototype.toArray=function(){return[this.x,this.y]},e.prototype.fromArray=function(e){return this.x=e[0],this.y=e[1],this},e.prototype.toString=function(){return"("+this.x+","+this.y+")"},void 0!==global.exports&&(global.exports.Vector2d=e),void 0===global.J2D&&(global.Vector2d=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/Vector2dInteger",["utils/Vector2d"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/Vector2d")):t(e.Vector2d)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t,o){e.call(this,t>>0,o>>0)};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.fromArray=function(e){return this.x=e[0]>>0,this.y=e[1]>>0,this},void 0!==global.exports&&(exports.Vector2dInteger=t),void 0===global.J2D&&(global.Vector2dInteger=t),t});
//# sourceMappingURL=jquery.j2d.min.map
