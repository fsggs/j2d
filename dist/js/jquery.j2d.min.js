!function(t,e){"function"==typeof define&&define.amd?define("jquery.j2d",["jquery","j2d.webGL2d","j2d.scene","j2d.layers"],e):e(t.jQuery,t.WebGL2D,null,null)}(global,function(t,e,n,i){var o,s=t,r={vector:{},math:{},dom:{},now:0,dt:0,io:void 0,pause:!1,frameLimit:60,sceneStartTime:0,sceneSkipTime:0,engine:!1,ready:!1,window:window,webGL:!1};return o=function(t,o){var s=this;s.element=t,s.options=o,s.layers=new i(s,e),s.scene=new n(s),s.gameEngine=function(){s.options.now=Date.now(),setTimeout(function(){s.options.pause||(s.options.io&&s.options.io.update(),s.options.dt=(s.options.now-s.options.lastTime)/100,s.options.dt>s.options.sceneSkipTime&&(s.options.dt=0),s.options.sceneStartTime=s.options.now,setTimeout(s.options.engine,0),s.options.lastTime=s.options.now,s.options.io&&s.options.io.clear()),r(s.gameEngine)},s.options.frameLimit<60?s.options.sceneSkipTime:0)};var r=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/s.options.frameLimit)}}()},o.prototype.getInfo=function(){return{name:"jquery.j2d",version:"0.1.5",site:"https://github.com/fsggs/jquery.j2d",info:"jquery.j2d - jQuery plugin of the fork j2ds.",author:"DeVinterX, Skaner(j2ds)"}},o.prototype.getIO=function(){return this.options.io},o.prototype.IOHandler=function(t){return this.options.io=t},o.prototype.setWindow=function(t){this.window=t?t:window},o.prototype.start=function(t,e){var n=this;n.options.engine=t||function(){n.element.html("Пожалуйста, инициализируйте игровую функцию!")},n.options.frameLimit=e||60,n.options.sceneSkipTime=1e3/n.options.frameLimit,n.options.lastTime=Date.now(),n.options.dt=0,n.options.sceneStartTime=n.options.lastTime,n.gameEngine()},o.prototype.pause=function(){this.options.pause=!0,this.element.addClass("pause")},o.prototype.resume=function(){this.options.pause=!1,this.element.removeClass("pause").focus()},o.prototype.isPlay=function(){return!this.options.pause},o.prototype.enableWebGL=function(){this.options.webGL=!0},o.prototype.setActiveEngine=function(t){this.options.engine=t},o.prototype.getDevice=function(){return this.device},o.prototype.device={width:parseInt(s(document).width())<parseInt(screen.width)?parseInt(s(document).width()):parseInt(screen.width),height:parseInt(s(document).height())<parseInt(screen.height)?parseInt(s(document).height()):parseInt(screen.height),resize:function(){this.width=window.innerWidth,this.height=window.innerHeight}},o.prototype.vector={vec2df:function(t,e){return{x:t,y:e}},vec2di:function(t,e){return{x:t>>0,y:e>>0}}},o.prototype.math={toInt:function(t){return t>>0},randomColor:function(t,e,n){return"rgba("+this.random(t,e)+", "+this.random(t,e)+", "+this.random(t,e)+", "+n+")"},random:function(t,e,n){var i=Math.floor(Math.random()*(e-t+1)+t);return n&&0==i?this.random(t,e,n):i},rad:function(t){return t*(Math.PI/180)}},o.prototype.getLayers=function(){return this.layers},o.prototype.getScene=function(){return this.scene},o.initJQueryPlugin=function(){s.fn.j2d=function(t){t=s.extend(!0,{},r,t),this.filter("div.canvas:not([guid])").each(function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)});s(this).attr("guid",e);var n=s(this).attr("id");("undefined"==typeof n||n===!1)&&s(this).attr("id",e);var i=s(this).attr("tabindex");("undefined"==typeof i||i===!1)&&s(this).attr("tabindex","-1"),s(this).data("j2d",new o(s(this),t)).addClass("j2d"),s(this).focus()});var e=[];return this.filter("div.canvas[guid]").each(function(){e.push(s(this).data("j2d"))}),1===e.length?s(this).data("j2d"):e};var t=!1;s(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange msfullscreenchange","div.canvas[guid]",function(e){t=!!(document.webkitFullscreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement),t||s(this).data("j2d").scene.resizeToFullPage(t)}),s(document).on("click","div.canvas[guid].pause",function(){s(this).data("j2d").resume()}),s(window).on("focus",function(){s("div.canvas[guid]").each(function(){s(this).data("j2d").resume()})}).on("blur",function(){s("div.canvas[guid]").each(function(){s(this).data("j2d").pause()})}),s(window).on("resize",function(){s("div.canvas[guid]").each(function(){s(this).data("j2d").device.resize(),t&&s(this).data("j2d").scene.resizeToFullPage(t)})})},o});