/**
 * j2D (JavaScript 2D Engine)
 *
 * @authors DeVinterX, Skaner(j2Ds)
 * @license BSD
 * @version 0.2.0-dev
 */

if (global === undefined) {
    var global = window || this
}
if (typeof define !== 'function' || !define.amd) {
    global.j2d = {
        core: {},
        exceptions: {},
        io: {},
        loaders: {},
        media: {},
        nodes: {},
        states: {},
        transitions: {utils: {}},
        utils: {}
    };
}
!function(e,t){"function"==typeof define&&define.amd?define("j2d",["core/SceneManager","utils/DeviceUtil","utils/ObjectUtil","utils/UUID","utils/SystemConsole","utils/ArrayMap"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("core/SceneManager"),require("utils/DeviceUtil"),require("utils/ObjectUtil"),require("utils/UUID"),require("utils/SystemConsole"),require("utils/ArrayMap")):t(e.j2d.core.SceneManager,e.j2d.utils.DeviceUtil,e.j2d.utils.ObjectUtil,e.j2d.utils.UUID,e.j2d.utils.SystemConsole,e.j2d.utils.ArrayMap)}("undefined"!=typeof window?window:global,function(e,t,o,n,i,a){"use strict";var r=function(o,n){var a=this;this.element=o,this.data=n,this.device=new t,this.scene=new e(this),this.Log=new i,Object.defineProperty(this,"WebGL",{get:function(){return a.data.webGL},set:function(e){a.data.webGL=!!e,e&&!a.data.webGL?a.element.classList.add("WebGL"):!e&&a.data.webGL&&a.element.classList.remove("WebGL")}}),Object.defineProperty(this,"smoothing",{get:function(){return a.data.smoothing},set:function(e){a.data.smoothing=!!e}}),Object.defineProperty(this,"io",{get:function(){return a.data.io},set:function(e){return a.data.io=e}}),Object.defineProperty(this,"media",{get:function(){return a.data.media},set:function(e){return a.data.media=e}}),Object.defineProperty(this,"isPlay",{get:function(){return!a.data.pause},set:function(){}})};return r.VERSION="0.2.0-dev",r.defaults={id:null,io:null,media:null,deltaTime:0,pause:!1,ready:!1,frameLimit:60,smoothing:!0,webGL:!1},r.prototype.start=function(){this.scene.start(),this.trigger("start")},r.prototype.stop=function(){this.scene.stop(),this.trigger("stop")},r.prototype.pause=function(){this.data.io&&this.data.io.flush(),this.data.pause=!0,this.element.classList.add("pause"),this.trigger("pause")},r.prototype.resume=function(){this.element.classList.remove("pause"),this.element.focus(),this.data.pause=!1,this.data.io&&this.data.io.flush(),this.trigger("resume")},r.prototype.getSceneManager=function(){return this.scene},r.prototype.getLayersManager=function(){return this.scene.layersManager},r.prototype.getFrameManager=function(){return this.scene.frameManager},r.prototype.getViewportManager=function(){return this.scene.viewportManager},r.prototype.getGameStatesManager=function(){return this.scene.gameStatesManager},r.prototype.on=function(){},r.prototype.once=function(){},r.prototype.off=function(){},r.prototype.trigger=function(){},r.prototype.log=function(e,t){this.Log.log(e,t)},r.util={disableSmoothing:function(e){var t=global.navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),o=!!t&&parseInt(t[2],10);e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,o&&o<=29&&(e.webkitImageSmoothingEnabled=!1),e.msImageSmoothingEnabled=!1}},r.prototype.util=r.util,r.stack=new a,r.initEngine=function(e,t){function i(){var e;return this.classList.contains("pause")?(e=r.stack.get(this.getAttribute("guid")),e&&e.resume(),u(this)):!this.classList.contains("resume-by-click")&&this.classList.contains(":focus")&&(this.classList.add("active"),this.focus(),e=r.stack.get(this.getAttribute("guid")),e&&e.resume(),u(this)),!0}var a=[];if("string"==typeof e)a=global.document.querySelectorAll(e);else{if(!("object"==typeof e&&void 0!==jQuery&&e instanceof jQuery))return null;a=e.get()}var s=[];Array.prototype.forEach.call(a,function(e){e.hasAttribute("guid")||s.push(e)}),s.forEach(function(e){var t=o.extend(!0,{},r.defaults,t);t.id=n.generate(),e.setAttribute("guid",t.id);var i=e.getAttribute("id");void 0!==i&&null!==i||e.setAttribute("guid",t.id);var a=e.getAttribute("tabindex");void 0!==a&&null!==a&&a!==!1||e.setAttribute("tabindex","-1"),e.classList.contains("j2d")||e.classList.add("j2d"),r.stack.add(t.id,new r(e,t)),e.click(),e.focus()});var u=function(e){var t,o;t=global.document.querySelectorAll("div.canvas[guid]:not(.pause-disable):not(:focus)"),Array.prototype.forEach.call(t,function(t){e!==t&&(t.classList.remove("active"),o=r.stack.get(t.getAttribute("guid")),o&&o.pause())}),t=global.document.querySelectorAll("div.canvas[guid].active.pause-disable:not(:focus)"),Array.prototype.forEach.call(t,function(t){e!==t&&t.classList.remove("active")})},d=[];return a=global.document.querySelectorAll(".j2d[guid]"),Array.prototype.forEach.call(a,function(e){d.push(r.stack.get(e.getAttribute("guid"))),e.addEventListener("click",i),e.addEventListener("touch",i),e.addEventListener("mouseenter",i)}),1===d.length?d[0]:d},r.prototype.initEngine=r.initEngine,(r.initPlugin=function(){function e(){var e=n();if(!e){var t,o;t=global.document.querySelector(".j2d[guid].active"),t&&(o=r.stack.get(t.getAttribute("guid"))),o&&o.scene.resizeToFullPage(e),t=global.document.querySelector(".j2d[guid]:not(.active)"),t&&(o=r.stack.get(t.getAttribute("guid"))),o&&o.toggle(!e)}}if(void 0!==global.j2dPlugin)return null;global.j2dPlugin={pluginInit:!0,stack:new a},(new i).logSystem("j2D v."+r.VERSION,"https://github.com/fsggs/j2d"),void 0!==jQuery&&(jQuery.fn.j2d=function(e){return r.initEngine(this,e)}),global.j2dPlugin.initEngine=r.initEngine;var t=global.navigator.userAgent.match(/Firefox\/([0-9]+)\./),o=!!t&&parseInt(t[2],10),n=function(){return!!(global.document.webkitFullscreenElement||global.document.webkitCurrentFullScreenElement||o&&o<47?global.document.mozFullScreenElement:global.document.fullscreenElement||global.document.msFullscreenElement)},s=global.document.querySelector("html");s.classList.contains("j2d")||(global.document.addEventListener("fullscreenchange",e),global.document.addEventListener("webkitfullscreenchange",e),global.document.addEventListener("mozfullscreenchange",e),global.document.addEventListener("MSFullscreenChange",e),global.addEventListener("focus",function(){var e,t;e=global.document.querySelector(".j2d[guid].active:not(.resume-by-click)"),e&&(t=r.stack.get(e.getAttribute("guid"))),t&&t.resume()}),global.addEventListener("blur",function(){var e,t;e=global.document.querySelectorAll(".j2d[guid]:not(.pause-disable)"),Array.prototype.forEach.call(e,function(e){e&&(t=r.stack.get(e.getAttribute("guid"))),t&&t.pause()})}),global.addEventListener("resize",function(){r.stack.forEach(function(e){r.stack[e].device.onResize()});var e=n();if(e){var t,o;t=global.document.querySelector(".j2d[guid].active"),t&&(o=r.stack.get(t.getAttribute("guid"))),o&&o.scene.resizeToFullPage(e)}return!0}),s.classList.add("j2d"))})(),"object"==typeof module&&"object"==typeof module.exports&&(module.exports.EngineJ2D=r),void 0!==global.j2d&&(global.j2d.EngineJ2D=r),r}),function(e,t){"function"==typeof define&&define.amd?define("core/FrameManager",["utils/ArrayMap","transitions/Tween"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ArrayMap"),require("transitions/Tween")):t(e.j2d.utils.ArrayMap,e.j2d.transitions.Tween)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var o,n=new e,i=new e,a=0,r={frameLimit:60,frameRun:!1,breakAnimationFrame:!1},s=function(){return global.requestAnimationFrame||global.webkitRequestAnimationFrame||global.mozRequestAnimationFrame||global.oRequestAnimationFrame||global.msRequestAnimationFrame||function(e){r.breakAnimationFrame?r.breakAnimationFrame=!1:(a>=Number.MAX_SAFE_INTEGER-1&&(a=0),0===a&&(a=void 0===global.performance?Date.now():global.performance.now()),global.setTimeout(e.bind(this,void 0===global.performance?Date.now()-a:global.performance.now()-a),1e3/r.frameLimit))}}(),u=function(){return a=0,global.cancelAnimationFrame||global.webkitCancelAnimationFrame||global.mozCancelAnimationFrame||global.oCancelAnimationFrame||global.msCancelAnimationFrame}(),d=function(){};return d.prototype.start=function(e,t,o){var a={j2d:null,frameLimit:r.frameLimit,now:0,deltaTime:0,lastTime:0,sceneStartTime:0,sceneSkipTime:0,asyncUpdate:!0,asyncRender:!0};if(void 0!==o.frameLimit&&o.frameLimit<=r.frameLimit&&(a.frameLimit=o.frameLimit),void 0===o.j2d)throw"j2d not transported to FrameManager.start(id, engine, {... j2d: j2d ...});";return a.j2d=o.j2d,a.interval=1e3/a.frameLimit,a.lastTime=Date.now(),n.add(e,t),i.add(e,a),r.frameRun||this.pulse(),this},d.prototype.stop=function(e){return n.remove(e),i.remove(e),this},d.prototype.pulse=function(){return this.runMainLoop(Date.now()),this},d.prototype.runMainLoop=function(e,o){return void 0===o&&(o=this),n.length<=0&&r.frameRun?(r.breakAnimationFrame=!0,r.frameRun=!1,u(this.runMainLoop)):(r.frameRun=!0,s(function(e){o.runMainLoop(e,o)}),void n.each(function(o){if(n.hasOwnProperty(o)&&"object"==typeof n[o]){var a=n[o],r=i[o];r.now=Date.now(),r.deltaTime=(r.now-r.lastTime)/100,r.j2d.data.io&&!r.j2d.data.pause&&r.j2d.data.io.update(),r.j2d.data.pause||(void 0!==a.update&&"function"==typeof a.update&&(r.asyncUpdate?(setTimeout(a.update.bind(a,e,r),0),setTimeout(t.update.bind(this,e),0)):(a.update(e,r),t.update(e))),100*r.deltaTime>r.interval&&(r.lastTime=r.now-100*r.deltaTime%r.interval,void 0!==a.render&&"function"==typeof a.render&&(r.asyncRender?setTimeout(a.render.bind(a,e,r),0):a.render(e,r)))),r.j2d.data.io&&!r.j2d.data.pause&&r.j2d.data.io.clear()}}))},d.prototype.setDefaultFrameLimit=function(e){return e<=60&&e>0&&(r.frameLimit=e),this},d.Init=function(){return void 0!==global.j2d?global.instanceFrameManager||(global.instanceFrameManager=new d):o||(o=new d)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.FrameManager=d),void 0!==global.j2d&&(global.j2d.core.FrameManager=d),d}),function(e,t){"function"==typeof define&&define.amd?define("core/GameStatesManager",["utils/ObjectUtil","utils/ArrayMap","states/DefaultGameState","states/BaseGameState"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ObjectUtil"),require("utils/ArrayMap"),require("states/DefaultGameState"),require("states/BaseGameState")):t(e.j2d.utils.ObjectUtil,e.j2d.utils.ArrayMap,e.j2d.states.DefaultGameState,e.j2d.states.BaseGameState)}("undefined"!=typeof window?window:global,function(e,t,o,n){"use strict";var i=function(t,n){var a=this;a.data=e.extend(!0,{},i.defaults,t),a.add(new o),a.sceneCallback=n,Object.defineProperty(this,"state",{get:function(){return a.data.currentState},set:function(e){a.data.currentState=e}})};return i.defaults={previousState:null,currentState:0,states:new t},i.prototype.getState=function(e){return void 0===e?this.getCurrent():this.data.states.contains(e)?this.data.states[e]:null},i.prototype.getPreviousState=function(){return this.data.states.get(this.data.states[this.data.previousState])},i.prototype.getNextState=function(){return void 0!==this.data.states[this.state+1]?this.data.states.get(this.data.states[this.state+1]):null},i.prototype.getCurrent=function(){return this.data.states.get(this.data.states[this.data.currentState])},i.prototype.setState=function(e){return this.data.states.contains(e)&&(this.data.previousState=this.data.currentState,this.data.currentState=this.data.states.indexOf(e),this.sceneCallback(e)),this},i.prototype.setNextState=function(){return void 0!==this.data.states[this.state+1]&&(this.data.previousState=this.data.currentState,this.data.currentState=this.state+1,this.sceneCallback(this.data.states[this.state])),this},i.prototype.setPreviousState=function(){if(void 0!==this.data.states[this.data.previousState]){var e=this.data.previousState;this.data.previousState=this.data.currentState,this.data.currentState=e,this.sceneCallback(this.data.states[e])}return this},i.prototype.add=function(e,t){return void 0===t&&(t=e.data.id),!this.data.states.contains(t)&&e instanceof n&&this.data.states.add(t,e),this},i.prototype.remove=function(e){return this.data.states.contains(e)&&this.data.states.remove(e),this},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.GameStatesManager=i),void 0!==global.j2d&&(global.j2d.states.GameStatesManager=i),i}),function(e,t){"function"==typeof define&&define.amd?define("core/LayersManager",["utils/ArrayMap","nodes/BaseNode","nodes/CollectionNode","utils/UUID"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ArrayMap"),require("nodes/BaseNode"),require("nodes/CollectionNode"),require("utils/UUID")):t(e.j2d.utils.ArrayMap,e.j2d.nodes.BaseNode,e.j2d.nodes.CollectionNode,e.j2d.utils.UUID)}("undefined"!=typeof window?window:global,function(e,t,o,n){"use strict";var i=function(){this.globalCollection=new o({id:"GlobalLayer"}),this.layers=[],this.index=1e3};return i.prototype.addLayer=function(e,t,i){if(e=e||n.generate(),void 0===i||i instanceof o)return void 0===t?(t=this.index,this.index++):t+=1e3,i=i||new o({id:e,zIndex:t}),this.globalCollection.add(i,e),this.layers[t]=i,this},i.prototype.removeLayer=function(e){return delete this.layers[this.globalCollection.get(e).zIndex],this.globalCollection.remove(null,e),this},i.prototype.getLayer=function(e){return this.globalCollection.has(e)?this.globalCollection.get(e):null},i.prototype.setZIndex=function(e,t){return this.globalCollection.has(e)&&(delete this.layers[this.globalCollection.get(e).zIndex],this.globalCollection.get(e).zIndex=t,this.layers[t]=this.globalCollection.get(e)),this},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.LayersManager=i),void 0!==global.j2d&&(global.j2d.core.LayersManager=i),i}),function(e,t){"function"==typeof define&&define.amd?define("core/SceneManager",["utils/ObjectUtil","core/WebGL2D","core/FrameManager","core/ViewportManager","core/LayersManager","core/GameStatesManager"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ObjectUtil"),require("core/WebGL2D"),require("core/FrameManager"),require("core/ViewportManager"),require("core/LayersManager"),require("core/GameStatesManager")):t(e.j2d.utils.ObjectUtil,e.WebGL2D,e.j2d.core.FrameManager,e.j2d.core.ViewportManager,e.j2d.core.LayersManager,e.j2d.states.GameStatesManager)}("undefined"!=typeof window?window:global,function(e,t,o,n,i,a){"use strict";var r=function(e){var t=this;this.setGameCallback=this.setGameCallback.bind(this),this.start=this.start.bind(this),this.j2d=e,this.canvas=null,this.context=null,this.frameManager=o.Init(),this.layersManager=new i,this.viewportManager=new n,this.gameStatesManager=new a({},this.setGameCallback),this.initLayers(),Object.defineProperty(this,"backgroundColor",{get:function(){return t.data.backgroundColor},set:function(e){t.data.backgroundColor=e,t.context.fillStyle=e,t.context.fillRect(0,0,t.data.width,t.data.height)}}),Object.defineProperty(this,"opacity",{get:function(){return t.data.opacity},set:function(e){t.data.opacity=e,t.canvas.style.opacity=e}}),Object.defineProperty(this,"visible",{get:function(){return t.data.visible},set:function(e){t.data.visible=!!e,t.canvas.style.display=e?"block":"none"}}),Object.defineProperty(this,"zIndex",{get:function(){return 1e3-t.data.zIndex},set:function(e){t.data.zIndex=1e3+e,t.canvas.style.zIndex=1e3+e}}),Object.defineProperty(this,"viewport",{get:function(){return t.data.viewport},set:function(){}})};r.defaults={width:0,height:0,originalWidth:0,originalHeight:0,originalMargin:0,visible:!0,position:"absolute",top:0,left:0,zIndex:1e3,opacity:1,backgroundColor:!1,frameLimit:60,enableFullScreen:!1,viewport:{x:0,y:0}},r.prototype.patchGameStateRender=function(e){var t=this,o=e.constructor;return"function"==typeof o&&void 0===o.prototype.render&&(o.prototype.render=function(e,o){return t.clear().fillBackground().render(o),!0}),o},r.prototype.init=function(t){return this.data=e.extend(!0,{},r.defaults,t),this.j2d.trigger("beforeInit"),this.data.originalWidth=this.data.width,this.data.originalHeight=this.data.height,this.data.originalMargin=getComputedStyle(this.j2d.element).margin,this.j2d.element.style.width=this.data.width+"px",this.j2d.element.style.height=this.data.height+"px",this.initCanvas(),this.viewportManager.setScreen({x:this.data.width,y:this.data.height}).setDefaultViewport({offset:{x:0,y:0},size:{x:this.data.width,y:this.data.height},scale:1,angle:0}),this.j2d.trigger("afterInit"),this},r.prototype.initLayers=function(){return this.layersManager.getLayer("scene")||this.layersManager.addLayer("scene",0),this},r.prototype.initCanvas=function(){return 0===document.querySelectorAll('.j2d[guid="'+this.j2d.data.id+'"] canvas').length&&(this.canvas=document.createElement("canvas"),this.canvas.width=this.data.width,this.canvas.height=this.data.height,this.canvas.style.zIndex=this.data.zIndex,this.canvas.style.position=this.data.position,this.canvas.style.left=this.data.left,this.canvas.style.top=this.data.top,this.j2d.data.webGL?(t.enable(this.canvas),this.context=this.canvas.getContext("WebGL-2d")):this.context=this.canvas.getContext("2d"),this.j2d.data.smoothing||this.j2d.util.disableSmoothing(this.context),this.context.shadowColor="rgba(0,0,0,0)",this.data.backgroundColor&&(this.backgroundColor=this.data.backgroundColor),this.data.opacity&&(this.opacity=this.data.opacity),this.data.visible&&(this.visible=this.data.visible),this.data.zIndex&&(this.zIndex=1e3-this.data.zIndex),this.j2d.element.appendChild(this.canvas)),this},r.prototype.clear=function(e,t){return void 0!==e&&void 0!==t?this.context.clearRect(e.x-this.viewport.x,e.y-this.viewport.y,t.x,t.y):this.context.clearRect(0,0,this.data.width,this.data.height),this},r.prototype.resize=function(e,t){return this.canvas.width=this.data.width=e,this.canvas.height=this.data.height=t,this.data.backgroundColor&&(this.context.save(),this.clear(),this.backgroundColor=this.data.backgroundColor,this.context.restore()),this.j2d.data.smoothing||this.j2d.util.disableSmoothing(this.context),this},r.prototype.setGameCallback=function(e){var t=this;t.data.gameState=e||"init_j2d",t.frameManager.stop(t.j2d.data.id);var o=t.patchGameStateRender(t.gameStatesManager.getState(e)),n=new o(t.gameStatesManager,{});return n.init({callback:function(){n.load({callback:function(){t.frameManager.start(t.j2d.data.id,n,{j2d:t.j2d,frameLimit:t.data.frameLimit}),t.j2d.trigger("changedGameState"),t.gameStatesManager.getPreviousState().unload()}})}}),this},r.prototype.async=function(e,t){return setTimeout(e.call(e,t),0),this},r.prototype.start=function(){var e=this;e.j2d.data.io&&e.j2d.data.io.init(),e.j2d.trigger("beforeStart"),e.frameManager.stop(e.j2d.data.id);var t=e.patchGameStateRender(e.gameStatesManager.getCurrent()),o=new t(e.gameStatesManager,{});return o.init({callback:function(){o.load({callback:function(){e.frameManager.start(e.j2d.data.id,o,{j2d:e.j2d,frameLimit:e.data.frameLimit}),e.j2d.trigger("afterStart")}})}}),e},r.prototype.stop=function(){return this.frameManager.stop(this.j2d.data.id),this},r.prototype.fullScreen=function(e){var t=document.getElementById(this.j2d.element.attr("id"));return void 0===t.requestFullscreen&&(t.requestFullscreen=t.webkitRequestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen),void 0===document.exitFullscreen&&(document.exitFullscreen=document.webkitExitFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen),e?t.requestFullscreen():document.exitFullscreen(),this},r.prototype.resizeToFullPage=function(e){var t=this.j2d,o=this;return e?(o.data.originalWidth=o.data.width,o.data.originalHeight=o.data.height,o.resize(t.device.width,t.device.height),o.data.enableFullscreen=!0,t.element.style.width=t.device.width+"px",t.element.style.height=t.device.height+"px",t.element.style.margin=0,o.viewportManager.setScreen({x:t.device.width,y:t.device.height}).setOffset({x:-(t.device.width-o.data.originalWidth)/2,y:-(t.device.height-o.data.originalHeight)/2})):(o.resize(o.data.originalWidth,o.data.originalHeight),o.data.enableFullscreen=!1,t.element.style.width=o.data.originalWidth+"px",t.element.style.height=o.data.originalHeight+"px",t.element.style.margin=o.data.originalMargin,o.viewportManager.setScreen({x:o.data.originalWidth,y:o.data.originalHeight}).setOffset({x:0,y:0})),this},r.prototype.toggleFullScreen=function(e,t){return void 0===t&&(t={fullscreen:!1}),!e.scene.enableFullscreen||t.fullscreen?e.scene.fullScreen(!0):e.scene.fullScreen(!1),this},r.prototype.getSceneLayer=function(){return this.layersManager.getLayer("scene")},r.prototype.fillBackground=function(){return this.data.backgroundColor&&(this.backgroundColor=this.data.backgroundColor),this},r.prototype.render=function(e){var t=this;return t.layersManager.layers.forEach(function(o,n){t.layersManager.layers[n].render(t.context,t.viewportManager.getViewport(),t.layersManager.globalCollection,e||{})}),this},r.prototype.add=function(e,t){return this.layersManager.globalCollection.has("scene")&&this.layersManager.globalCollection.get("scene").add(e,t),this},r.prototype.remove=function(e,t){return this.layersManager.globalCollection.has("scene")&&this.layersManager.globalCollection.get("scene").remove(e,t),this},r.prototype.registerCamera=function(e){return this.viewportManager.addCamera(e.data.id,e),this};var s=function(e){return e.viewportManager.setViewport(new Vector2d(0,0),new Vector2d(e.data.width,e.data.height)),e};return r.prototype.updateViewport=function(e){return void 0===e?s(this):(this.viewportManager.updateViewport(e.data.id),this)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.SceneManager=r),void 0!==global.j2d&&(global.j2d.core.SceneManager=r),r}),function(e,t){"function"==typeof define&&define.amd?define("core/ViewportManager",["utils/ArrayMap","nodes/CameraNode","utils/Vector2d"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ArrayMap"),require("nodes/CameraNode"),require("utils/Vector2d")):t(e.j2d.utils.ArrayMap,e.j2d.nodes.CameraNode,e.j2d.utils.Vector2d)}("undefined"!=typeof window?window:global,function(e,t,o){"use strict";var n=function(e,t){var o={offset:{x:0,y:0},size:{x:0,y:0},scale:1,angle:t.angle};return o.offset.x=e.offsetX+t.offset.x,o.offset.y=e.offsetY+t.offset.y,o.size.x=e.x<t.size.x?e.x:t.size.x,o.size.y=e.y<t.size.y?e.y:t.size.y,o.scale=t.scale*((e.x/t.size.x+e.y/t.size.y)/2),o},i=function(){this.cameras=new e,this.camera="No active cameras",this.screen={x:0,y:0,offsetX:0,offsetY:0},this.init=!1,this.data={offset:{x:0,y:0},size:{x:0,y:0},scale:1,angle:0}};return i.prototype.setScreen=function(e){if("object"==typeof e){if(e instanceof Array&&2==e.length)return this.screen={x:e[0],y:e[1],offsetX:this.screen.offsetX,offsetY:this.screen.offsetY},this;void 0!==e.x&&void 0!==e.y&&(this.screen={x:e.x,y:e.y,offsetX:this.screen.offsetX,offsetY:this.screen.offsetY})}return this},i.prototype.setOffset=function(e){if("object"==typeof e){if(e instanceof Array&&2==e.length)return this.screen={x:this.screen.x,y:this.screen.y,offsetX:e[0],offsetY:e[1]},this;void 0!==e.x&&void 0!==e.y&&(this.screen={x:this.screen.x,y:this.screen.y,offsetX:e.x,offsetY:e.y})}return this},i.prototype.addCamera=function(e,o){if(o instanceof t)return this.cameras.add(e,o),this},i.prototype.removeCamera=function(e){return this.cameras.remove(e),this.camera==e&&(this.camera="No active cameras",this.data={offset:{x:0,y:0},size:{x:0,y:0},scale:1,angle:0}),this},i.prototype.updateViewport=function(e){return void 0!==this.cameras[e]&&this.cameras[e]instanceof t&&(this.data=this.cameras[e].getCameraViewport(this.screen,n)),this},i.prototype.setViewport=function(e,t){return void 0!==e&&"object"==typeof e&&e instanceof o&&(this.data.offset=e.getVector()),void 0!==t&&"object"==typeof t&&t instanceof o&&(this.data.size=t.getVector()),this.data=n(this.screen,this.data),this},i.prototype.setDefaultViewport=function(e){return this.init||(this.data=e,this.init=!0),this},i.prototype.getViewport=function(){return this.data},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.ViewportManager=i),void 0!==global.j2d&&(global.j2d.core.ViewportManager=i),i}),function(e,t){"function"==typeof define&&define.amd?define("core/WebGL2D",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";function e(e){return e>0&&0===(e-1&e)}function t(e){return this.clearStack(e)}var o={identity:[1,0,0,0,1,0,0,0,1],multiply:function(e,t){var o=e[0],n=e[1],i=e[2],a=e[3],r=e[4],s=e[5],u=e[6],d=e[7],l=e[8],c=t[0],f=t[1],p=t[2],h=t[3],y=t[4],g=t[5],m=t[6],b=t[7],v=t[8];t[0]=c*o+h*n+m*i,t[1]=f*o+y*n+b*i,t[2]=p*o+g*n+v*i,t[3]=c*a+h*r+m*s,t[4]=f*a+y*r+b*s,t[5]=p*a+g*r+v*s,t[6]=c*u+h*d+m*l,t[7]=f*u+y*d+b*l,t[8]=p*u+g*d+v*l},vec2_multiply:function(e,t){var o=[];return o[0]=t[0]*e[0]+t[3]*e[1]+t[6],o[1]=t[1]*e[0]+t[4]*e[1]+t[7],o},transpose:function(e){return[e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]]}},n=16;t.prototype.clearStack=function(e){this.m_stack=[],this.m_cache=[],this.c_stack=0,this.valid=0,this.result=null;for(var t=0;t<n;t++)this.m_stack[t]=this.getIdentity();void 0!==e?this.m_stack[0]=e:this.setIdentity()},t.prototype.setIdentity=function(){this.m_stack[this.c_stack]=this.getIdentity(),this.valid===this.c_stack&&this.c_stack&&this.valid--},t.prototype.getIdentity=function(){return[1,0,0,0,1,0,0,0,1]},t.prototype.getResult=function(){if(!this.c_stack)return this.m_stack[0];var e=o.identity;this.valid>this.c_stack-1&&(this.valid=this.c_stack-1);for(var t=this.valid;t<this.c_stack+1;t++)e=o.multiply(this.m_stack[t],e),this.m_cache[t]=e;return this.valid=this.c_stack-1,this.result=this.m_cache[this.c_stack],this.result},t.prototype.pushMatrix=function(){this.c_stack++,this.m_stack[this.c_stack]=this.getIdentity()},t.prototype.popMatrix=function(){0!==this.c_stack&&this.c_stack--};var i=t.prototype.getIdentity();t.prototype.translate=function(e,t){i[6]=e,i[7]=t,o.multiply(i,this.m_stack[this.c_stack])};var a=t.prototype.getIdentity();t.prototype.tr=function(e,t,n,i,r,s){a[0]=e,a[1]=t,a[3]=n,a[4]=i,a[6]=r,a[7]=s,o.multiply(a,this.m_stack[this.c_stack])};var r=t.prototype.getIdentity();t.prototype.scale=function(e,t){r[0]=e,r[4]=t,o.multiply(r,this.m_stack[this.c_stack])};var s=t.prototype.getIdentity();t.prototype.rotate=function(e){var t,n;t=Math.sin(-e),n=Math.cos(-e),s[0]=n,s[3]=t,s[1]=-t,s[4]=n,o.multiply(s,this.m_stack[this.c_stack])};var u=global.WebGL2D=function(e,o){this.canvas=e,this.options=o||{},this.gl=void 0,this.fs=void 0,this.vs=void 0,this.shaderProgram=void 0,this.transform=new t,this.shaderPool=[],this.maxTextureSize=void 0,e.gl2d=this,e.$getContext=e.getContext,e.getContext=function(t){return function(o){if(!t.options.force&&"WebGL-2d"!==o||0===e.width||0===e.height)return t.canvas.$getContext(o);if(t.gl)return t.gl;var n=t.gl=t.canvas.$getContext("experimental-webgl");return"undefined"==typeof n||null===n?t.canvas.$getContext("2d"):(t.initShaders(),t.initBuffers(),t.initCanvas2DAPI(),n.enable(n.BLEND),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),t.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),n)}}(this),this.postInit()};u.enable=function(e,t){return e.gl2d||new u(e,t)};var d={texture:1,crop:2,path:4};u.prototype.getFragmentShaderSource=function(e){var t=["#ifdef GL_ES","precision highp float;","#endif","#define hasTexture "+(e&d.texture?"1":"0"),"#define hasCrop "+(e&d.crop?"1":"0"),"varying vec4 vColor;","#if hasTexture","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","#if hasCrop","uniform vec4 uCropSource;","#endif","#endif","void main(void) {","#if hasTexture","#if hasCrop","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x * uCropSource.z, vTextureCoord.y * uCropSource.w) + uCropSource.xy);","#else","gl_FragColor = texture2D(uSampler, vTextureCoord);","#endif","#else","gl_FragColor = vColor;","#endif","}"].join("\n");return t},u.prototype.getVertexShaderSource=function(e,t){e=e||1;var o=["#define hasTexture "+(t&d.texture?"1":"0"),"attribute vec4 aVertexPosition;","#if hasTexture","varying vec2 vTextureCoord;","#endif","uniform vec4 uColor;","uniform mat3 uTransforms["+e+"];","varying vec4 vColor;","uniform mat4 pMatrix;","mat3 crunchStack(void) {","mat3 result = uTransforms[0];","for (int i = 1; i < "+e+"; ++i) {","result = uTransforms[i] * result;","}","return result;","}","void main(void) {","vec3 position = crunchStack() * vec3(aVertexPosition.x, aVertexPosition.y, 1.0);","gl_Position = pMatrix * vec4(position, 1.0);","vColor = uColor;","#if hasTexture","vTextureCoord = aVertexPosition.zw;","#endif","}"].join("\n");return o},u.prototype.initShaders=function(e,t){var o=this.gl;e=e||1,t=t||0;var n=this.shaderPool[e];if(n||(n=this.shaderPool[e]=[]),n=n[t])o.useProgram(n),this.shaderProgram=n;else{var i=this.fs=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(this.fs,this.getFragmentShaderSource(t)),o.compileShader(this.fs),!o.getShaderParameter(this.fs,o.COMPILE_STATUS))throw"fragment shader error: "+o.getShaderInfoLog(this.fs);var a=this.vs=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(this.vs,this.getVertexShaderSource(e,t)),o.compileShader(this.vs),!o.getShaderParameter(this.vs,o.COMPILE_STATUS))throw"vertex shader error: "+o.getShaderInfoLog(this.vs);var r=this.shaderProgram=o.createProgram();if(r.stackDepth=e,o.attachShader(r,i),o.attachShader(r,a),o.linkProgram(r),!o.getProgramParameter(r,o.LINK_STATUS))throw"Could not initialise shaders.";o.useProgram(r),r.vertexPositionAttribute=o.getAttribLocation(r,"aVertexPosition"),o.enableVertexAttribArray(r.vertexPositionAttribute),r.uColor=o.getUniformLocation(r,"uColor"),r.uSampler=o.getUniformLocation(r,"uSampler"),r.uCropSource=o.getUniformLocation(r,"uCropSource"),r.pMatrix=o.getUniformLocation(r,"pMatrix"),r.uTransforms=[];for(var s=0;s<e;++s)r.uTransforms[s]=o.getUniformLocation(r,"uTransforms["+s+"]");this.shaderPool[e][t]=r}return c[0]=2/this.canvas.width,c[5]=-2/this.canvas.height,o.uniformMatrix4fv(this.shaderProgram.pMatrix,!1,c),o.viewport(0,0,this.canvas.width,this.canvas.height),this.shaderProgram};var l=new Float32Array([0,0,0,0,0,1,0,1,1,1,1,1,1,0,1,0]),c=new Float32Array(16);return c[10]=1,c[11]=1,c[12]=-1,c[13]=1,u.prototype.initBuffers=function(){var e=this.gl;e.rectVertexPositionBuffer=e.createBuffer(),e.rectVertexColorBuffer=e.createBuffer(),e.pathVertexPositionBuffer=e.createBuffer(),e.pathVertexColorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,e.rectVertexPositionBuffer),e.bufferData(e.ARRAY_BUFFER,l,e.STATIC_DRAW)},u.instances=[],u.prototype.postInit=function(){u.instances.push(this)},u.prototype.initCanvas2DAPI=function(){function t(e,t,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?e+6*(t-e)*o:o<.5?t:o<2/3?e+(t-e)*(2/3-o)*6:e}function o(e,o,n,i){var a,r,s,u,d;return e=(e%360+360)%360/360,o=o>100?1:o/100,o=o<0?0:o,n=n>100?1:n/100,n=n<0?0:n,0==o?a=r=s=n:(d=n<.5?n*(1+o):n+o-n*o,u=2*n-d,a=t(u,d,e+1/3),r=t(u,d,e),s=t(u,d,e-1/3)),[a,r,s,i]}function n(e){var t,i,a,r,s,u,d=[];if(t=b.exec(e)){if(r=t[1],s=parseFloat(t[8]),r&&isNaN(s)||!r&&!isNaN(s))return!1;u=t[3];for(var l=2;l<8;l+=2){if(i=t[l],a=t[l+1],a!==u)return!1;a?(i=i>100?1:i/100,i=i<0?0:i):(i=i>255?1:i/255,i=i<0?0:i),d.push(i)}d.push(r?s:1)}else if(t=v.exec(e))r=t[1],s=parseFloat(t[5]),d=o(t[2],t[3],t[4],parseFloat(r&&s?s:1));else if(t=j.exec(e)){var c=parseInt(t[1],16);d=[((16711680&c)>>16)/255,((65280&c)>>8)/255,(255&c)/255,1]}else if(t=w.exec(e)){var f="#"+[t[1],t[1],t[2],t[2],t[3],t[3]].join("");d=n(f)}else if(e.toLowerCase()in E)d=n(E[e.toLowerCase()]);else{if("transparent"!==e.toLowerCase())return!1;d=[0,0,0,0]}return d}function i(e){return"rgba("+255*e[0]+", "+255*e[1]+", "+255*e[2]+", "+parseFloat(e[3])+")"}function a(){var e={fillStyle:[S.fillStyle[0],S.fillStyle[1],S.fillStyle[2],S.fillStyle[3]],strokeStyle:[S.strokeStyle[0],S.strokeStyle[1],S.strokeStyle[2],S.strokeStyle[3]],globalAlpha:S.globalAlpha,globalCompositeOperation:S.globalCompositeOperation,lineCap:S.lineCap,lineJoin:S.lineJoin,lineWidth:S.lineWidth,miterLimit:S.miterLimit,shadowColor:S.shadowColor,shadowBlur:S.shadowBlur,shadowOffsetX:S.shadowOffsetX,shadowOffsetY:S.shadowOffsetY,textAlign:S.textAlign,font:S.font,textBaseline:S.textBaseline,imageSmoothingEnabled:S.imageSmoothingEnabled};M.push(e)}function r(){M.length&&(S=M.pop());
}function s(e){for(var t=p.transform.m_stack,o=0,n=p.transform.c_stack+1;o<n;++o)h.uniformMatrix3fv(e.uTransforms[o],!1,t[n-1-o])}function u(e,t){this.closed=!1,this.verts=[e,t,0,0]}function l(e){var t=p.transform,o=p.initShaders(t.c_stack+2,0),n=k[e],i=n.verts;h.bindBuffer(h.ARRAY_BUFFER,h.pathVertexPositionBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(i),h.STATIC_DRAW),h.vertexAttribPointer(o.vertexPositionAttribute,4,h.FLOAT,!1,0,0),t.pushMatrix(),s(o),h.uniform4f(o.uColor,S.fillStyle[0],S.fillStyle[1],S.fillStyle[2],S.fillStyle[3]),h.drawArrays(h.TRIANGLE_FAN,0,i.length/4),t.popMatrix()}function c(e){var t=p.transform,o=p.initShaders(t.c_stack+2,0),n=k[e],i=n.verts;h.bindBuffer(h.ARRAY_BUFFER,h.pathVertexPositionBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(i),h.STATIC_DRAW),h.vertexAttribPointer(o.vertexPositionAttribute,4,h.FLOAT,!1,0,0),t.pushMatrix(),s(o),h.uniform4f(o.uColor,S.strokeStyle[0],S.strokeStyle[1],S.strokeStyle[2],S.strokeStyle[3]),n.closed?h.drawArrays(h.LINE_LOOP,0,i.length/4):h.drawArrays(h.LINE_STRIP,0,i.length/4),t.popMatrix()}function f(t){if(this.obj=h.createTexture(),this.index=P.push(this),O.push(t),t.width>p.maxTextureSize||t.height>p.maxTextureSize){var o=document.createElement("canvas");o.width=t.width>p.maxTextureSize?p.maxTextureSize:t.width,o.height=t.height>p.maxTextureSize?p.maxTextureSize:t.height;var n=o.getContext("2d");n.drawImage(t,0,0,t.width,t.height,0,0,o.width,o.height),t=o}var i=h.LINEAR,a=h.LINEAR_MIPMAP_LINEAR;S.imageSmoothingEnabled||(i=h.NEAREST,a=h.LINEAR_MIPMAP_NEAREST),h.bindTexture(h.TEXTURE_2D,this.obj),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),e(t.width)&&e(t.height)?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a),h.generateMipmap(h.TEXTURE_2D)):h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,i),h.bindTexture(h.TEXTURE_2D,null)}var p=this,h=this.gl,g=document.createElement("canvas");g.width=p.canvas.width,g.height=p.canvas.height;var m=g.getContext("2d"),b=/^rgb(a)?\(\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,?\s*(-?[\d\.]+)?\s*\)$/,v=/^hsl(a)?\(\s*(-?[\d\.]+)\s*,\s*(-?[\d\.]+)%\s*,\s*(-?[\d\.]+)%\s*,?\s*(-?[\d\.]+)?\s*\)$/,j=/^#([0-9A-Fa-f]{6})$/,w=/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/,E={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},S={},M=[];S.fillStyle=[0,0,0,1],Object.defineProperty(h,"fillStyle",{get:function(){return i(S.fillStyle)},set:function(e){S.fillStyle=n(e)||S.fillStyle}}),S.strokeStyle=[0,0,0,1],Object.defineProperty(h,"strokeStyle",{get:function(){return i(S.strokeStyle)},set:function(e){S.strokeStyle=n(e)||drawStyle.strokeStyle}}),h.$lineWidth=h.lineWidth,S.lineWidth=1,Object.defineProperty(h,"lineWidth",{get:function(){return S.lineWidth},set:function(e){e>0&&(h.$lineWidth(e),S.lineWidth=e)}}),S.lineCap="butt",Object.defineProperty(h,"lineCap",{get:function(){return S.lineCap},set:function(e){S.lineCap=e}}),S.lineJoin="miter",Object.defineProperty(h,"lineJoin",{get:function(){return S.lineJoin},set:function(e){S.lineJoin=e}}),S.miterLimit=10,Object.defineProperty(h,"miterLimit",{get:function(){return S.miterLimit},set:function(e){S.miterLimit=e}}),S.shadowOffsetX=0,Object.defineProperty(h,"shadowOffsetX",{get:function(){return S.shadowOffsetX},set:function(e){S.shadowOffsetX=e}}),S.shadowOffsetY=0,Object.defineProperty(h,"shadowOffsetY",{get:function(){return S.shadowOffsetY},set:function(e){S.shadowOffsetY=e}}),S.shadowBlur=0,Object.defineProperty(h,"shadowBlur",{get:function(){return S.shadowBlur},set:function(e){S.shadowBlur=e}}),S.shadowColor="rgba(0, 0, 0, 0.0)",Object.defineProperty(h,"shadowColor",{get:function(){return S.shadowColor},set:function(e){S.shadowColor=e}}),S.font="10px sans-serif",Object.defineProperty(h,"font",{get:function(){return S.font},set:function(e){m.font=e,S.font=e}}),S.textAlign="start",Object.defineProperty(h,"textAlign",{get:function(){return S.textAlign},set:function(e){S.textAlign=e}}),S.textBaseline="alphabetic",Object.defineProperty(h,"textBaseline",{get:function(){return S.textBaseline},set:function(e){S.textBaseline=e}}),S.globalAlpha=1,Object.defineProperty(h,"globalAlpha",{get:function(){return S.globalAlpha},set:function(e){S.globalAlpha=e}}),S.imageSmoothingEnabled=!0,Object.defineProperty(h,"imageSmoothingEnabled",{get:function(){return S.imageSmoothingEnabled},set:function(e){S.imageSmoothingEnabled=!!e}}),S.globalCompositeOperation="source-over",Object.defineProperty(h,"globalCompositeOperation",{get:function(){return S.globalCompositeOperation},set:function(e){S.globalCompositeOperation=e}}),h.fillText=function(e,t,o){m.clearRect(0,0,p.canvas.width,p.canvas.height),m.fillStyle=h.fillStyle,m.fillText(e,t,o),h.drawImage(g,0,0)},h.strokeText=function(){},h.measureText=function(){return 1};var A=document.createElement("canvas"),_=A.getContext("2d");h.save=function(){p.transform.pushMatrix(),a()},h.restore=function(){p.transform.popMatrix(),r()},h.translate=function(e,t){p.transform.translate(e,t)},h.rotate=function(e){p.transform.rotate(e)},h.scale=function(e,t){p.transform.scale(e,t)},h.createImageData=function(e,t){return _.createImageData(e,t)},h.getImageData=function(e,t,o,n){var i=_.createImageData(o,n),a=new Uint8Array(o*n*4);h.readPixels(e,t,o,n,h.RGBA,h.UNSIGNED_BYTE,a);for(var r=4*o,s=n,u=0,d=s/2;u<d;++u)for(var l=0,c=r;l<c;++l){var f=u*r+l,p=(s-u-1)*r+l;i.data[f]=a[p],i.data[p]=a[f]}return i},h.putImageData=function(e,t,o){h.drawImage(e,t,o)},h.transform=function(e,t,o,n,i,a){p.transform.tr(e,t,o,n,i,a)},h.setTransform=function(e,t,o,n,i,a){p.transform.setIdentity(),h.transform.apply(this,arguments)},h.fillRect=function(e,t,o,n){var i=p.transform,a=p.initShaders(i.c_stack+2,0);h.bindBuffer(h.ARRAY_BUFFER,h.rectVertexPositionBuffer),h.vertexAttribPointer(a.vertexPositionAttribute,4,h.FLOAT,!1,0,0),i.pushMatrix(),i.translate(e,t),i.scale(o,n),s(a),h.uniform4f(a.uColor,S.fillStyle[0],S.fillStyle[1],S.fillStyle[2],S.fillStyle[3]),h.drawArrays(h.TRIANGLE_FAN,0,4),i.popMatrix()},h.strokeRect=function(e,t,o,n){var i=p.transform,a=p.initShaders(i.c_stack+2,0);h.bindBuffer(h.ARRAY_BUFFER,h.rectVertexPositionBuffer),h.vertexAttribPointer(a.vertexPositionAttribute,4,h.FLOAT,!1,0,0),i.pushMatrix(),i.translate(e,t),i.scale(o,n),s(a),h.uniform4f(a.uColor,S.strokeStyle[0],S.strokeStyle[1],S.strokeStyle[2],S.strokeStyle[3]),h.drawArrays(h.LINE_LOOP,0,4),i.popMatrix()},h.clearRect=function(e,t,o,n){};var k=[];h.beginPath=function(){k.length=0},h.closePath=function(){if(k.length){var e=k[k.length-1],t=e.verts[0],o=e.verts[1];e.closed=!0;var n=new u(t,o);k.push(n)}},h.moveTo=function(e,t){k.push(new u(e,t))},h.lineTo=function(e,t){k.length?k[k.length-1].verts.push(e,t,0,0):h.moveTo(e,t)},h.quadraticApproximateCount=50,h.quadraticCurveTo=function(e,t,o,n){if(k.length)for(var i,a,r,s,u=k[k.length-1].verts,d=u[u.length-4],l=u[u.length-3],c=0;c<h.quadraticApproximateCount;c++)i=c/h.quadraticApproximateCount,a=1-i,r=a*a*d+2*a*i*e+i*i*o,s=a*a*l+2*a*i*t+i*i*n,u.push(r,s,0,0);else h.moveTo(o,n)},h.bezierApproximateCount=50,h.bezierCurveTo=function(e,t,o,n,i,a){if(k.length)for(var r,s,u,d,l=k[k.length-1].verts,c=l[l.length-4],f=l[l.length-3],p=0;p<h.bezierApproximateCount;p++)r=p/h.bezierApproximateCount,s=1-r,u=s*s*s*c+3*s*s*r*e+3*s*r*r*o+r*r*r*i,d=s*s*s*f+3*s*s*r*t+3*s*r*r*n+r*r*r*a,l.push(u,d,0,0);else h.moveTo(i,a)},h.arcTo=function(){k.length||h.moveTo(x,y)},h.rect=function(e,t,o,n){h.moveTo(e,t),h.lineTo(e+o,t),h.lineTo(e+o,t+n),h.lineTo(e,t+n),h.closePath()},h.arcApproximateCount=100,h.arc=function(e,t,o,n,i,a){if(k.length){var r=k[k.length-1].verts,s=e+o*Math.cos(n),u=t+o*Math.sin(n);for(r.push(s,u,0,0);n>2*Math.PI;)n-=2*Math.PI;for(;i>2*Math.PI;)i-=2*Math.PI;for(;n<2*-Math.PI;)n+=2*Math.PI;for(;i<2*-Math.PI;)i+=2*Math.PI;if(n==i)return;var d,l=1/h.arcApproximateCount,c=h.arcApproximateCount;a&&(i-=2*Math.PI,l=-l);for(var f=n;f>i&&a||f<i&&!a;f+=l)d!=(d=(f*c|0)/c)&&(s=e+o*Math.cos(d),u=t+o*Math.sin(d),r.push(s,u,0,0))}else h.moveTo(s,u)},h.fill=function(){for(var e=0;e<k.length;e++)l(e)},h.stroke=function(){for(var e=0;e<k.length;e++)c(e)},h.clip=function(){},h.isPointInPath=function(){},h.drawFocusRing=function(){};var O=[],P=[];h.drawImage=function(e,t,o,n,i,a,r,u,l){var c=p.transform;c.pushMatrix();var y=d.texture,g=!1;3===arguments.length?(c.translate(t,o),c.scale(e.width,e.height)):5===arguments.length?(c.translate(t,o),c.scale(n,i)):9===arguments.length&&(c.translate(a,r),c.scale(u,l),y|=d.crop,g=!0);var m,b=p.initShaders(c.c_stack+1,y),v=O.indexOf(e);m=v!==-1?P[v]:new f(e),g&&h.uniform4f(b.uCropSource,t/e.width,o/e.height,n/e.width,i/e.height),h.bindBuffer(h.ARRAY_BUFFER,h.rectVertexPositionBuffer),h.vertexAttribPointer(b.vertexPositionAttribute,4,h.FLOAT,!1,0,0),h.bindTexture(h.TEXTURE_2D,m.obj),h.activeTexture(h.TEXTURE0),h.uniform1i(b.uSampler,0),s(b),h.drawArrays(h.TRIANGLE_FAN,0,4),c.popMatrix()},Object.defineProperty(h,"isWebGL",{configurable:!1,enumerable:!0,writable:!1,value:!0})},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.WebGL2D=u),u}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/BadFunctionCallException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.j2d.exceptions.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t){e.call(this,t),this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,"object"==typeof module&&"object"==typeof module.exports&&(module.exports.BadFunctionCallException=t),void 0!==global.j2d&&(global.j2d.exceptions.BadFunctionCallException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/BadMethodCallException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.j2d.exceptions.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t){e.call(this,t),this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,"object"==typeof module&&"object"==typeof module.exports&&(module.exports.BadMethodCallException=t),void 0!==global.j2d&&(global.j2d.exceptions.BadMethodCallException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/Exception",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){Error.call(this,e),this.message=e,this.toString=function(){return this.message}};return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Exception=e),void 0!==global.j2d&&(global.j2d.exceptions.Exception=e),e}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/InvalidArgumentException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.j2d.exceptions.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t){e.call(this,t),this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,"object"==typeof module&&"object"==typeof module.exports&&(module.exports.InvalidArgumentException=t),void 0!==global.j2d&&(global.j2d.exceptions.InvalidArgumentException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/LengthException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.j2d.exceptions.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t){e.call(this,t),this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,"object"==typeof module&&"object"==typeof module.exports&&(module.exports.LengthException=t),void 0!==global.j2d&&(global.j2d.exceptions.LengthException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/LogicException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.j2d.exceptions.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t){e.call(this,t),this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,"object"==typeof module&&"object"==typeof module.exports&&(module.exports.LogicException=t),void 0!==global.j2d&&(global.j2d.exceptions.LogicException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/OutOfBoundsException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.j2d.exceptions.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t){e.call(this,t),this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,"object"==typeof module&&"object"==typeof module.exports&&(module.exports.OutOfBoundsException=t),void 0!==global.j2d&&(global.j2d.exceptions.OutOfBoundsException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/OutOfRangeException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.j2d.exceptions.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t){e.call(this,t),this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,"object"==typeof module&&"object"==typeof module.exports&&(module.exports.OutOfRangeException=t),void 0!==global.j2d&&(global.j2d.exceptions.OutOfRangeException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/RangeException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.j2d.exceptions.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t){e.call(this,t),this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,"object"==typeof module&&"object"==typeof module.exports&&(module.exports.RangeException=t),void 0!==global.j2d&&(global.j2d.exceptions.RangeException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/RuntimeException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.j2d.exceptions.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t){e.call(this,t),this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,"object"==typeof module&&"object"==typeof module.exports&&(module.exports.RuntimeException=t),void 0!==global.j2d&&(global.j2d.exceptions.RuntimeException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("exceptions/UnexpectedValueException",["exceptions/Exception"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("exceptions/Exception")):t(e.j2d.exceptions.Exception)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t){e.call(this,t),this.toString=function(){return this.message}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,"object"==typeof module&&"object"==typeof module.exports&&(module.exports.UnexpectedValueException=t),void 0!==global.j2d&&(global.j2d.exceptions.UnexpectedValueException=t),t}),function(e,t){"function"==typeof define&&define.amd?define("io/InputManager",["jquery","utils/ArrayMap","utils/Vector2d"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("utils/ArrayMap"),require("utils/Vector2d")):t(e.jQuery,e.j2d.utils.ArrayMap,e.j2d.utils.Vector2d)}("undefined"!=typeof window?window:global,function($,ArrayMap,Vector2d){"use strict";function getKey(e,t){return Object.keys(e).filter(function(o){return e[o]===t})[0]}var InputManager=function(e){this.j2d=e,this.id=e.data.id,this.element=e.element,this.data={mouse:{startPosition:{x:0,y:0},currentPosition:{x:0,y:0},previousDistance:0,distance:0},viewport:{position:{x:0,y:0}},enabled:!1,enableAdditionalData:!1,keysPressed:new ArrayMap,writeMode:!1,timePressed:0,preventAll:!1,cursor:{enabled:!1,image:"auto"}},this.keyMap={FULLSCREEN:[[InputManager.key.KEY_CTRL,InputManager.key.KEY_F11],"j2d.scene.toggleFullScreen",{}]}},checkKeyMap=function(e,enableCallback){void 0===enableCallback&&(enableCallback=!0);var j2d=e.data.manager.j2d,manager=e.data.manager,keyCode=e.which,keyMap=e.data.manager.keyMap;for(var index in keyMap)if(keyMap.hasOwnProperty(index)){var value=keyMap[index];if(!$.isArray(value[0])&&value[0]===keyCode&&value[1])return"string"==typeof value[1]&&(value[1]=eval("("+value[1]+")")),"function"==typeof value[1]&&enableCallback&&value[1](j2d,value[2]),!0;if($.isArray(value[0])&&manager.data.keysPressed.equals(value[0])&&value[1])return"string"==typeof value[1]&&(value[1]=eval("("+value[1]+")")),"function"==typeof value[1]&&enableCallback&&value[1](j2d,value[2]),!0}return!1},events={onMouseClick:function(e){var t=e.data.manager;if(!t.data.enabled||!t.j2d.isPlay||!t.j2d.element.hasClass("active"))return!0;var o=t.data.keysPressed,n=getKey(InputManager.key,e.which)||"KEY_UNKNOWN_"+e.which,i=t.data.mouse;2!==e.data.event?(0===e.data.event?(-1===$.inArray(InputManager.key[n],o)&&(o.push(InputManager.key[n]),t.data.enableAdditionalData&&(i.startPosition.x=e.pageX,i.startPosition.y=e.pageY,i.distance=0,t.data.timePressed=e.timeStamp)),(checkKeyMap(e,!1)||t.data.preventAll)&&e.preventDefault()):((checkKeyMap(e)||t.data.preventAll)&&e.preventDefault(),t.data.enableAdditionalData&&(i.previousDistance=i.distance,i.startPosition.x=0,i.startPosition.y=0),o.splice(o.indexOf(InputManager.key[n]),1)),t.element.trigger(0===e.data.event?"mouseKeyDown":"mouseKeyUp",{keyCode:n})):checkKeyMap(e,!1)&&e.preventDefault()},onMouseWheel:function(e){var t=e.data.manager;if(!t.data.enabled||!t.j2d.isPlay||!t.j2d.element.hasClass("active"))return!0;var o=t.data.keysPressed,n=e.originalEvent.wheelDelta/120>0?getKey(InputManager.key,4):getKey(InputManager.key,5);e.which=e.originalEvent.wheelDelta/120>0?4:5,-1===$.inArray(InputManager.key[n],o)&&o.push(InputManager.key[n]),(checkKeyMap(e)||t.data.preventAll)&&(e.preventDefault(),t.fixMouseWheel()),t.element.trigger("mouseWheel",{keyCode:n})},mouseWheelCancel:function(e,t){e.splice(e.indexOf(InputManager.key[t]),1)},onMouseMove:function(e){var t=e.data.manager,o=e.data.manager.data.mouse;t.data.mouse.currentPosition.x=e.pageX,t.data.mouse.currentPosition.y=e.pageY,e.data.manager.data.enableAdditionalData&&(o.distance=Math.sqrt(Math.pow(o.currentPosition.x-o.startPosition.x,2)+Math.pow(o.currentPosition.y-o.startPosition.y,2)).toFixed(1))},onKeyboardPress:function(e){var t=e.data.manager;if(!t.data.enabled||!t.j2d.isPlay||!t.element.hasClass("active"))return!0;var o=t.data.keysPressed,n=getKey(InputManager.key,e.which)||"KEY_UNKNOWN_"+e.which;if(2===e.data.event&&!0===t.data.writeMode){var i=String.fromCharCode(e.which||e.keyCode);e.preventDefault(),t.element.focus().trigger("keyboardCharPress",{key:e.which||e.keyCode,keyCode:n,"char":i})}2!==e.data.event&&!1===t.data.writeMode&&(0===e.data.event?(-1===$.inArray(InputManager.key[n],o)&&(o.push(InputManager.key[n]),t.data.enableAdditionalData&&(t.data.timePressed=e.timeStamp)),(checkKeyMap(e,!1)||t.data.preventAll)&&e.preventDefault()):((checkKeyMap(e)||t.data.preventAll)&&e.preventDefault(),o.splice(o.indexOf(InputManager.key[n]),1)),t.element.trigger(0===e.data.event?"keyboardKeyDown":"keyboardKeyUp",{keyCode:n,key:e.which||e.keyCode})),2!==e.data.event&&!0===t.data.writeMode&&t.element.trigger(0===e.data.event?"keyboardKeyDown":"keyboardKeyUp",{keyCode:n,key:e.which||e.keyCode})},onTouchTap:function(e){var t=e.data.manager;if(!t.data.enabled||!t.j2d.isPlay||!t.j2d.element.hasClass("active"))return!0;var o=t.data.keysPressed,n=getKey(InputManager.key,e.which+1)||"KEY_UNKNOWN_"+e.which,i=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],a=t.data.mouse;0===e.data.event?(-1===$.inArray(InputManager.key[n],o)&&(o.push(InputManager.key[n]),t.data.enableAdditionalData&&(a.startPosition.x=i.pageX,a.startPosition.y=i.pageY,a.distance=0,t.data.timePressed=e.timeStamp)),(checkKeyMap(e,!1)||t.data.preventAll)&&e.preventDefault()):((checkKeyMap(e)||t.data.preventAll)&&e.preventDefault(),t.data.enableAdditionalData&&(a.previousDistance=a.distance,a.startPosition.x=0,a.startPosition.y=0),o.splice(o.indexOf(InputManager.key[n]),1)),t.element.trigger(0===e.data.event?"mouseKeyDown":"mouseKeyUp",{keyCode:n})},onTouchMove:function(e){var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],o=e.data.manager.data.mouse;o.currentPosition.x=t.pageX.toFixed(0),o.currentPosition.y=t.pageY.toFixed(0),e.data.manager.data.enableAdditionalData&&(o.distance=Math.sqrt(Math.pow(o.currentPosition.x-o.startPosition.x,2)+Math.pow(o.currentPosition.y-o.startPosition.y,2)).toFixed(1))}},bindEvents=function(e){var t="[guid="+e.id+"]";$(document).on("contextmenu",t,{manager:e,event:2},events.onMouseClick),$(document).on("mousedown",t,{manager:e,event:0},events.onMouseClick),$(document).on("mouseup",t,{manager:e,event:1},events.onMouseClick),$(document).on("mousewheel",t,{manager:e},events.onMouseWheel),$(document).on("mousemove",t,{manager:e},events.onMouseMove),$(document).on("keydown",null,{manager:e,event:0},events.onKeyboardPress),$(document).on("keyup",null,{manager:e,event:1},events.onKeyboardPress),$(document).on("keypress",null,{manager:e,event:2},events.onKeyboardPress),$(document).on("touchstart",t,{manager:e,event:0},events.onTouchTap),$(document).on("touchend",t,{manager:e,event:1},events.onTouchTap),$(document).on("touchmove ",t,{manager:e},events.onTouchMove)},unbindEvents=function(e){var t="[guid="+e.id+"]";$(document).off("contextmenu",t,{manager:e,event:1},events.onMouseClick),$(document).off("mousedown",t,{manager:e,event:0},events.onMouseClick),$(document).off("mouseup",t,{manager:e,event:1},events.onMouseClick),$(document).off("mousewheel",t,{manager:e},events.onMouseWheel),$(document).off("mousemove",t,{manager:e},events.onMouseMove),$(document).off("keydown",null,{manager:e,event:0},events.onKeyboardPress),$(document).off("keyup",null,{manager:e,event:1},events.onKeyboardPress),$(document).off("keypress",null,{manager:e,event:2},events.onKeyboardPress),$(document).off("touchstart",t,{manager:e,event:0},events.onTouchTap),$(document).off("touchend",t,{manager:e,event:1},events.onTouchTap),$(document).off("touchmove ",t,{manager:e},events.onTouchMove)};InputManager.prototype.init=function(){return!this.data.enabled&&global.j2dPlugin.pluginInit&&(bindEvents(this),this.data.enabled=!0),this},InputManager.prototype.update=function(){if(!this.data.enabled)return!1;var e=this.j2d.scene.canvas.offsetWidth/this.j2d.scene.data.width,t=this.j2d.scene.canvas.offsetHeight/this.j2d.scene.data.height,o=this.data.mouse.currentPosition.x/e,n=this.data.mouse.currentPosition.y/t,i=this.element.offset();return this.data.viewport.x=this.j2d.scene.viewport.x+o-i.left,this.data.viewport.y=this.j2d.scene.viewport.y+n-i.top,!0},InputManager.prototype.flush=function(){return this.data.keysPressed.length=0,this},InputManager.prototype.clear=function(){return this},InputManager.prototype.fixMouseWheel=function(){var e=this.data.keysPressed;return-1!==$.inArray(InputManager.key.SCROLL_MOUSE_UP,e)?events.mouseWheelCancel(e,InputManager.key.SCROLL_MOUSE_UP):-1!==$.inArray(InputManager.key.SCROLL_MOUSE_DOWN,e)&&events.mouseWheelCancel(e,InputManager.key.SCROLL_MOUSE_DOWN),this},InputManager.prototype.enable=function(){return this.data.enabled||(this.data.enabled=!1),this},InputManager.prototype.disable=function(){return this.data.enabled&&(this.data.enabled=!1),this},InputManager.prototype.load=function(e){var t=JSON.stringify(this.keyMap);return this.keyMap=JSON.parse(e),t},InputManager.prototype.save=function(){return JSON.stringify(this.keyMap)},InputManager.prototype.setKeys=function(e){return this.keyMap=$.extend(!0,{},this.keyMap,e),this};var getPressData=function(e,t){return!e.data.enableAdditionalData||{keyList:t,time:Date.now()-e.data.timePressed}};return InputManager.prototype.getMouseMoveDistance=function(){return this.data.enableAdditionalData?{current:this.data.mouse.distance,previous:this.data.mouse.previousDistance}:0},InputManager.prototype.checkPressedKeyList=function(e){return $.isArray(e)?e.length===this.data.keysPressed.length&&(this.data.keysPressed.equals(e)?(this.fixMouseWheel(),getPressData(this,e)):(this.fixMouseWheel(),!1)):!isNaN(e)&&(-1!==this.data.keysPressed.indexOf(e)?(this.fixMouseWheel(),getPressData(this,e)):(this.fixMouseWheel(),!1))},InputManager.prototype.checkPressedKeyMap=function(e){if(void 0===this.keyMap[e])return!1;var t=this.keyMap[e][0];return this.checkPressedKeyList(t)},InputManager.prototype.getPosition=function(){return new Vector2d(this.data.viewport.x+.5,this.data.viewport.y+.3)},InputManager.prototype.setWriteMode=function(e){return this.data.writeMode=!!e,this},InputManager.prototype.isWriteMode=function(){return!!this.data.writeMode},InputManager.prototype.setCursorImage=function(e){return this.data.cursor.image='url("'+e+'"), auto',$(this.element).css("cursor",this.data.cursor.image),this},InputManager.prototype.toggleCursor=function(e){return void 0!==e?this.data.cursor.enable=!!e:this.data.cursor.enable=!this.data.cursor.enable,this.data.cursor.enable?$(this.element).css("cursor",this.data.cursor.image):(this.data.cursor.image=$(this.j2d.element).css("cursor"),$(this.element).css("cursor","none")),this},InputManager.prototype.isCursorVisible=function(){return!!this.data.cursor.enable},InputManager.key={KEY_MOUSE_LEFT:1,KEY_MOUSE_MIDDLE:2,KEY_MOUSE_RIGHT:3,SCROLL_MOUSE_UP:4,SCROLL_MOUSE_DOWN:5,KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_BREAK:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE_BAR:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_LEFT_WINDOW_KEY:91,KEY_RIGHT_WINDOW_KEY:92,KEY_SELECT_KEY:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SUBTRACT:109,KEY_DECIMAL_POINT:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_SEMI_COLON:186,KEY_EQUAL_SIGN:187,KEY_COMMA:188,KEY_DASH:189,KEY_PERIOD:190,KEY_FORWARD_SLASH:191,KEY_GRAVE_ACCENT:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_SINGLE_QUOTE:222,KEY_LEFT_COMMAND:224,KEY_RIGHT_COMMAND:224},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.InputManager=InputManager),void 0!==global.j2d&&(global.j2d.io.InputManager=InputManager),InputManager}),function(e,t){"function"==typeof define&&define.amd?define("io/MediaManager",["utils/ObjectUtil","utils/ArrayMap","utils/Events","media/Audio","media/Sound"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ObjectUtil"),require("utils/ArrayMap"),require("utils/Events"),require("media/Audio"),require("media/Sound")):t(e.j2d.utils.ObjectUtil,e.j2d.utils.ArrayMap,e.j2d.utils.Events,e.j2d.media.Audio,e.j2d.media.Sound)}("undefined"!=typeof window?window:global,function(e,t,o,n,i){"use strict";var a=global.Audio,r=!1,s=!1;try{var u=global.AudioContext||global.webkitAudioContext;r=new u}catch(d){console.warn("Web Audio API is not supported in your browser")}try{s=!!new a}catch(d){console.warn("HTML5 Audio is not supported in your browser")}if(r){var l=void 0===r.createGain?r.createGainNode():r.createGain();l.gain.value=1,l.connect(r.destination)}var c=function(n,i){void 0===i&&(i={});var u=this;if(this.j2d=n,this.data=e.extend(!0,{},c.defaults,i),this.events=new o,this.media=new t,this.media.add("sounds",new t),this.media.add("audios",new t),
this.media.add("videos",new t),this.volume=100*this.data.volume,this.iOSEnabled=!1,r||s){var d=new a;this.data.codecs={mp3:!!d.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!d.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")},d=null}Object.defineProperty(this,"volume",{get:function(){return 100*u.data.volume},set:function(e){if(u.data.volume=parseFloat(e/100),e>=0&&e<=1)if(r)l.gain.value=u.data.volume;else{var t=u.media.get("sounds");for(var o in t)if(t.hasOwnProperty(o)&&!t[o].webAudio)for(var n=0;n<t[o].audioNode.length;n++)t[o].audioNode[n].volume=t[o].volume*u.data.volume;t=null}}}),Object.defineProperty(this,"muted",{get:function(){return!!u.data.muted},set:function(e){if(u.data.muted=!!e,r)l.gain.value=u.data.muted?0:u.data.volume;else{var t=u.media.get("sounds");for(var o in t)if(t.hasOwnProperty(o)&&t[o].webAudio===!1)for(var n=0;n<t[o].audioNode.length;n++)t[o].audioNode[n].muted=u.data.muted;t=null}}}),Object.defineProperty(this,"iOSEnable",{get:function(){return!!u.data.iOSAutoEnable},set:function(e){if(r&&(u.iOSEnabled||!/iPhone|iPad|iPod/i.test(navigator.userAgent)))return e;u.iOSEnabled=!1;var t=function(){var e=r.createBuffer(1,1,22050),o=r.createBufferSource();o.buffer=e,o.connect(r.destination),void 0===o.start?o.noteOn(0):o.start(0),setTimeout(function(){o.playbackState!==o.PLAYING_STATE&&o.playbackState!==o.FINISHED_STATE||(u.iOSEnabled=!0,u.data.iOSAutoEnable=!1,global.removeEventListener("touchend",t,!1))},0)};global.addEventListener("touchend",t,!1)}}),Object.defineProperty(this,"isSupportAudio",{get:function(){return!r&&!s}})};return c.defaults={volume:1,muted:!1,codecs:{},iOSAutoEnable:!0},c.prototype.getAudioContext=function(){return r},c.prototype.getMasterGain=function(){return l},c.prototype.mute=function(){return this.muted=!0,this},c.prototype.unMute=function(){return this.muted=!1,this},c.prototype.isSupportCodec=function(e){return!!this.data.codecs[e]},c.prototype.addSound=function(e){return new i(e,this),this},c.prototype.addAudio=function(e){return new n(e,this),this},c.prototype.addVideo=function(e){return this},c.prototype.sound=function(e){return this.media.get("sounds").get(e)},c.prototype.audio=function(e){return this.media.get("audios").get(e)},c.prototype.video=function(e){return this.media.get("videos").get(e)},c.prototype.removeSound=function(e){return this.media.get("sounds").contains(e)&&(this.media.get("sounds").get(e).stop(),this.media.get("sounds").remove(e)),this},c.prototype.removeAudio=function(e){return this.media.get("audios").contains(e)&&(this.media.get("audios").get(e).stop(),this.media.get("audios").remove(e)),this},c.prototype.removeVideo=function(e){return this.media.get("videos").contains(e)&&(this.media.get("videos").get(e).stop(),this.media.get("videos").remove(e)),this},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.MediaManager=c),void 0!==global.j2d&&(global.j2d.io.MediaManager=c),c}),function(e,t){"function"==typeof define&&define.amd?define("loaders/AssetsLoader",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){this.progress=0};return e.prototype.getProgress=function(){return this.progress},e.prototype.load=function(){},e.prototype.isLoaded=function(e){},e.prototype.dispose=function(e){},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.AssetsLoader=e),void 0!==global.j2d&&(global.j2d.loaders.AssetsLoader=e),e}),function(e,t){"function"==typeof define&&define.amd?define("nodes/AnimatedNode",["utils/ObjectUtil","nodes/BaseNode","utils/Vector2d","transitions/Tween"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ObjectUtil"),require("nodes/BaseNode"),require("utils/Vector2d"),require("transitions/Tween")):t(e.j2d.utils.ObjectUtil,e.j2d.nodes.BaseNode,e.j2d.utils.Vector2d,e.j2d.transitions.Tween)}("undefined"!=typeof window?window:global,function(e,t,o,n){"use strict";var i=function(o){t.call(this,e.extend(!0,{},i.defaults,o))};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.defaults={type:"AnimatedNode"},i.prototype.moveTo=function(e,i,a){if(void 0!==i&&"number"==typeof i||(i=1e3),"object"==typeof e){var r=new n(this);e instanceof o?(a&&(i=o.getDistance(this.getPosition(),e)/i),r.to({position:{x:e.getVector().x,y:e.getVector().y}},i)):e instanceof t&&(a&&(i=o.getDistance(this.getPosition(),e.getPosition())/i),r.to({position:{x:e.getPosition().getVector().x,y:e.getPosition().getVector().y}},i)),r.start()}},i.prototype.resizeTo=function(e,i,a){if(void 0!==i&&"number"==typeof i||(i=1e3),"object"==typeof position){var r=new n(this);e instanceof o?(a&&(i=o.getDistance(this.getSize(),e)/i),r.to({size:{x:e.getVector().x,y:e.getVector().y}},i)):e instanceof t&&(a&&(i=o.getDistance(this.getSize(),e.getSize())/i),r.to({size:{x:e.getSize().getVector().x,y:e.getSize().getVector().y}},i)),r.start()}},i.prototype.rotateTo=function(e,i){void 0!==i&&"number"==typeof i||(i=1e3);var a=new n(this);"number"==typeof e?a.to({angle:e%360},i):"object"==typeof e&&e instanceof t&&a.to({angle:o.getAngle(e.getPosition(),this.getPosition())},i),a.start()},i.prototype.turn=function(e){void 0!==e&&"number"==typeof e||(e=1),this.angle+=e},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.AnimatedNode=i),void 0!==global.j2d&&(global.j2d.nodes.AnimatedNode=i),i}),function(e,t){"function"==typeof define&&define.amd?define("nodes/BaseNode",["utils/ObjectUtil","utils/Vector2d","utils/UUID"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ObjectUtil"),require("utils/Vector2d"),require("utils/UUID")):t(e.j2d.utils.ObjectUtil,e.j2d.utils.Vector2d,e.j2d.utils.UUID)}("undefined"!=typeof window?window:global,function(e,t,o){"use strict";var n=function(t){var i=this;this.data=e.extend(!0,{},n.defaults,t),null===this.data.id&&(this.data.id=o.generate()),Object.defineProperty(this,"opacity",{get:function(){return i.data.opacity},set:function(e){i.data.opacity=e}}),Object.defineProperty(this,"visible",{get:function(){return i.data.visible},set:function(e){i.data.visible=!!e}}),Object.defineProperty(this,"angle",{get:function(){return i.data.angle},set:function(e){i.data.angle=e%360}}),Object.defineProperty(this,"scale",{get:function(){return i.data.scale},set:function(e){i.data.scale=e}}),Object.defineProperty(this,"cache",{get:function(){return i.data.enabledCache},set:function(e){i.data.enabledCache=!!e}})};return n.defaults={id:null,type:"BaseNode",position:{x:0,y:0},size:{x:0,y:0},offset:{x:0,y:0},visible:!0,angle:0,scale:1,opacity:1,cache:null,enabledCache:!1},n.prototype["import"]=function(t){this.data=e.extend(!0,{},this.data,t)},n.prototype["export"]=function(){return this.data},n.prototype.getPosition=function(){return new t(this.data.position.x,this.data.position.y)},n.prototype.setPosition=function(e){return void 0!==e&&(e instanceof t?this.data.position=e.getVector():e instanceof n&&(this.data.position=e.getPosition().getVector())),this},n.prototype.getSize=function(){return new t(this.data.size.x,this.data.size.y)},n.prototype.setSize=function(e){return void 0!==e&&(e instanceof t?this.data.size=e.getVector():e instanceof n&&(this.data.size=e.getSize().getVector())),this},n.prototype.getOffset=function(){return new t(this.data.offset.x,this.data.offset.y)},n.prototype.setOffset=function(e){return void 0!==e&&(e instanceof t?this.data.offset=e.getVector():e instanceof n&&(this.data.offset=e.getOffset().getVector())),this},n.prototype.render=function(e,t,o,n){return this},n.prototype.inViewport=function(e){return!(this.data.position.x>e.offset.x+e.size.x||this.data.position.x+e.size.x<e.offset.x||this.data.position.y>e.offset.y+e.size.y||this.data.position.y+e.size.y<e.offset.y)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.BaseNode=n),void 0!==global.j2d&&(global.j2d.nodes.BaseNode=n),n}),function(e,t){"function"==typeof define&&define.amd?define("nodes/CameraNode",["utils/ObjectUtil","nodes/BaseNode","nodes/AnimatedNode"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ObjectUtil"),require("nodes/BaseNode"),require("nodes/AnimatedNode")):t(e.j2d.utils.ObjectUtil,e.j2d.nodes.BaseNode,e.j2d.nodes.AnimatedNode)}("undefined"!=typeof window?window:global,function(e,t,o){"use strict";var n=function(t){o.call(this,e.extend(!0,{},n.defaults,t))};return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.defaults={type:"CameraNode"},n.prototype.getCameraViewport=function(e,t){return t(e,{offset:this.data.position,size:this.data.size,angle:this.data.angle,scale:this.data.scale})},n.prototype.render=function(e,t,o,n){return this},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.CameraNode=n),void 0!==global.j2d&&(global.j2d.nodes.CameraNode=n),n}),function(e,t){"function"==typeof define&&define.amd?define("nodes/CollectionNode",["utils/ObjectUtil","nodes/BaseNode","nodes/AnimatedNode","utils/ArrayMap"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ObjectUtil"),require("nodes/BaseNode"),require("nodes/AnimatedNode"),require("utils/ArrayMap")):t(e.j2d.utils.ObjectUtil,e.j2d.nodes.BaseNode,e.j2d.nodes.AnimatedNode,e.j2d.utils.ArrayMap)}("undefined"!=typeof window?window:global,function(e,t,o,n){"use strict";var i=function(t){var a=this;o.call(this,e.extend(!0,{},i.defaults,t)),null===this.data.collection&&(this.data.collection=new n),Object.defineProperty(this,"zIndex",{get:function(){return 1e3-a.data.zIndex},set:function(e){a.data.zIndex=1e3+e}})};return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.defaults={type:"CollectionNode",collection:null,zIndex:1e3},i.prototype.add=function(e,o){return e instanceof t&&(o=o||e.data.id,this.data.collection.add(o,e)),this},i.prototype.remove=function(e,o){return e instanceof t&&this.data.collection.remove(this.data.collection[e.data.id]),"string"==typeof o&&null===e&&this.data.collection.remove(o),this},i.prototype.has=function(e){return void 0!==this.data.collection[e]},i.prototype.get=function(e){return void 0!==this.data.collection[e]&&this.data.collection[e]},i.prototype.flush=function(){return this.data.collection.length=0,this},i.prototype.render=function(e,o,n,i){var a=this;return 0!==this.data.collection.length&&this.data.collection.each(function(r){a.data.collection.hasOwnProperty(r)&&a.data.collection[r]instanceof t&&a.data.collection[r].render(e,o,n,i)}),this},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.CollectionNode=i),void 0!==global.j2d&&(global.j2d.nodes.CollectionNode=i),i}),function(e,t){"function"==typeof define&&define.amd?define("nodes/RectNode",["utils/ObjectUtil","nodes/BaseNode","nodes/AnimatedNode","utils/MathUtil"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ObjectUtil"),require("nodes/BaseNode"),require("nodes/AnimatedNode"),require("utils/MathUtil")):t(e.j2d.utils.ObjectUtil,e.j2d.nodes.BaseNode,e.j2d.nodes.AnimatedNode,e.j2d.utils.MathUtil)}("undefined"!=typeof window?window:global,function(e,t,o,n){"use strict";var i=function(t){o.call(this,e.extend(!0,{},i.defaults,t))};return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.defaults={type:"RectNode",color:"#000000"},i.prototype.getColor=function(){return this.data.color},i.prototype.setColor=function(e){return this.data.color=e,this},i.prototype.draw=function(e,t,o,i){if(this.data.visible&&this.inViewport(t)){if(1!==this.data.opacity){var a=e.globalAlpha;e.globalAlpha=this.data.opacity}(this.data.angle||0!==t.angle)&&(e.save(),e.translate(this.getPosition().x-t.offset.x,this.getPosition().y-t.offset.y),e.rotate(n.degree2Radian(this.data.angle+t.angle)),e.translate(-(this.getPosition().x-t.offset.x),-(this.getPosition().y-t.offset.y))),e.fillStyle=this.data.color,e.lineWidth=0,e.fillRect(this.data.position.x-t.offset.x,this.data.position.y-t.offset.y,this.data.size.x*this.data.scale*t.scale,this.data.size.y*this.data.scale*t.scale),(this.data.angle||0!==t.angle)&&e.restore(),1!==this.data.opacity&&(e.globalAlpha=a)}return null},i.prototype.render=function(e,t,o,n){return this.draw(e,t,o,n),this},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.RectNode=i),void 0!==global.j2d&&(global.j2d.nodes.RectNode=i),i}),function(e,t){"function"==typeof define&&define.amd?define("media/Audio",["utils/ObjectUtil","utils/UUID","utils/Events"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ObjectUtil"),require("utils/UUID"),require("utils/Events")):t(e.j2d.utils.ObjectUtil,e.j2d.utils.UUID,e.j2d.utils.Events)}("undefined"!=typeof window?window:global,function(e,t,o){"use strict";var n={},i=global.Audio,a=function(n,i){var r=this;r.manager=void 0!==i?i:null,r.events=r.manager?r.manager.events:new o,r.data=e.extend(!0,{},a.defaults,n),r.audioNode=[],null===r.data.id&&(r.data.id=t.generate()),r.manager&&r.manager.media.get("audios").add(r.data.id,r),r.load()};return a.defaults={id:null,src:[],format:null,autoPlay:!1,duration:0,loop:!1,sprite:{},volume:1,muted:!1,pos3d:[0,0,-.5],loaded:!1,onEndTimer:[]},a.prototype._load=function(e){var t=new i;t.addEventListener("error",function(){console.error({type:t.error?t.error.code:0})},!1),e.audioNode.push(t),t.src=e.data.src,t.pos=0,t.preload="auto",t.volume=e.manager?e.manager.muted?0:e.data.volume*(e.manager.volume/100):e.data.muted?0:e.data.volume;var o=function(){e.data.duration=Math.ceil(10*t.duration)/10,0===Object.getOwnPropertyNames(e.data.sprite).length&&(e.data.sprite={"default":[0,1e3*e.data.duration]}),e.data.loaded||(e.data.loaded=!0,e.events.trigger("load")),e.data.autoPlay&&e.play(),t.removeEventListener("canplaythrough",o,!1)};return t.addEventListener("canplaythrough",o,!1),t.load(),e},a.prototype.load=function(){var e=this,t="",o="";if(e.manager&&e.manager.isSupportAudio)return console.warn("No audio support."),!1;var n=function(e,t){if(t)return t;var o=/^data:audio\/([^;,]+);/i.exec(e);return o||(o=/\.([^.]+)$/.exec(e.split("?",1)[0])),o?o[1].toLowerCase():(console.warn("Could not extract format from passed URLs, please add format"),null)};if(e.data.src instanceof Array){for(var i=0;i<e.data.src.length&&(t=e.data.src[i],o=n(e.data.src[i],e.data.format),null===o);i++);e.data.src=t}else{if("string"!=typeof e.data.src)return console.warn("Unknown audio source"),!1;o=n(e.data.src,e.data.format)}return e.manager&&e.manager.isSupportCodec[o]?(console.warn("Codec not support"),!1):e._load(e)},a.prototype._unload=function(e){e.src=""},a.prototype.unload=function(){for(var e=this,t=e.audioNode,o=0;o<e.audioNode.length;o++)t[o].paused||(e.stop(t[o].id),e.events.trigger("unload",t[o].id)),e._unload(t[o]);for(o=0;o<e.data.onEndTimer.length;o++)clearTimeout(e.data.onEndTimer[o].timer);if(e.manager){var i=this.manager.get("audios"),a=i.indexOf(e);null!==a&&a>=0&&i.splice(a,1)}delete n[e.data.src],e=null},a.prototype.src=function(e){var t=this;return e&&(t.stop(),t.data.src=e,t.data.loaded=!1,t.load()),null},a.prototype.play=function(e,t){var o=this;return"function"==typeof e&&(t=e),e&&"function"!=typeof e||(e="default"),o.data.loaded?o.data.sprite[e]?(o._inactiveNode(o,function(n){n.sprite=e;var i,a=n.pos>0?n.pos:o.data.sprite[e][0]/1e3,r=o.data.sprite[e][1]/1e3-(a-o.data.sprite[e][0]/1e3),s=!(!o.data.loop&&!o.data.sprite[e][2]),u="string"==typeof t?t:Math.round(Date.now()*Math.random())+"";return function(){var t={id:u,sprite:e,loop:s};i=setTimeout(function(){s?o.stop(t.id).play(e,t.id):o.stop(t.id),o.events.trigger("unload",u)},r/o.data.rate*1e3),o.data.onEndTimer.push({timer:i,id:t.id})}(),4===n.readyState||!n.readyState&&navigator.isCocoonJS?(n.id=u,n.currentTime=a,n.muted=o.manager?o.manager.muted||n.muted:o.data.muted||n.muted,n.volume=o.manager?o.data.volume*(o.manager.volume/100):o.data.volume,setTimeout(function(){n.play()},0),o.events.trigger("play"),"function"==typeof t&&t(u),o):(o._clearEndTimer(u),function(){var o=o,i=e,a=t,r=n,s=function(){o.play(i,a),r.removeEventListener("canplaythrough",s,!1)};r.addEventListener("canplaythrough",s,!1)}(),o)}),o):("function"==typeof t&&t(),o):(o.events.on("load",function(){o.play(e,t)}),o)},a.prototype._pause=function(e){return e.pause(),!1},a.prototype.pause=function(e){var t=this;if(!t.data.loaded)return t.events.on("play",function(){t.pause(e)}),t;t._clearEndTimer(t,e);var o=e?t._nodeById(e):t._activeNode(t);if(o){o.pos=t.pos(null,e);var n=t._pause(o);if(n)return t}return t.events.trigger("pause"),t},a.prototype._stop=function(e){return isNaN(e.duration)||(e.pause(),e.currentTime=0),!1},a.prototype.stop=function(e){var t=this;if(!t.data.loaded)return t.events.on("play",function(){t.stop(e)}),t;t._clearEndTimer(t,e);var o=e?t._nodeById(t,e):t._activeNode(t);if(o){o.pos=0;var n=t._stop(o);if(n)return t}return t},a.prototype._mute=function(e){e.muted=!0},a.prototype.mute=function(e){var t=this;if(!t.data.loaded)return t.events.on("play",function(){t.mute(e)}),t;var o=e?t._nodeById(e):t._activeNode(t);return o&&t._mute(),t},a.prototype._unMute=function(e){e.muted=!1},a.prototype.unMute=function(e){var t=this;if(!t.data.loaded)return t.events.on("play",function(){t.unMute(e)}),t;var o=e?t._nodeById(e):t._activeNode(t);return o&&t._unMute(),t},a.prototype._volume=function(e,t){e.volume=t},a.prototype.volume=function(e,t){var o=this;if(e=parseFloat(e),e>=0&&e<=1){if(o.data.volume=e,!o.data.loaded)return o.events.on("play",function(){o.volume(e,t)}),o;var n=t?o._nodeById(t):o._activeNode(o);return n&&(e=o.manager?e*(o.manager.volume/100):o.data.volume,o._volume(e)),o}return o.data.volume},a.prototype.loop=function(e){var t=this;return"boolean"==typeof e?(t.data.loop=e,t):t.data.loop},a.prototype.sprite=function(e){var t=this;return"object"==typeof e?(t.data.sprite=e,t):t.data.sprite},a.prototype._position=function(e,t){return e.currentTime},a.prototype.pos=function(e,t){var o=this;if(!o.data.loaded)return o.events.on("load",function(){o.pos(e)}),"number"==typeof e?o:o.data.pos||0;e=parseFloat(e);var n=t?o._nodeById(t):o._activeNode(o);if(n)return e>=0?(o.pause(t),n.pos=e,o.play(n.sprite,t),o):o._position(n,!1);if(e>=0)return o;for(var i=0;i<o.audioNode.length;i++)if(o.audioNode[i].paused&&4===o.audioNode[i].readyState)return o._position(o.audioNode[i],!0)},a.prototype._pos3d=function(e,t,o,n){return null},a.prototype.pos3d=function(e,t,o,n){var i=this;if(t="undefined"!=typeof t&&t?t:0,o="undefined"!=typeof o&&o?o:-.5,!i.data.loaded)return i.events.on("play",function(){i.pos3d(e,t,o,n)}),i;if(!(e>=0||e<0))return i.data.pos3d;var a=n?i._nodeById(n):i._activeNode(i);return i._pos3d(a,e,t,o),i},a.prototype._nodeById=function(e,t){for(var o=e.audioNode[0],n=0;n<e.audioNode.length;n++)if(e.audioNode[n].id===t){o=e.audioNode[n];break}return o},a.prototype._clearEndTimer=function(e,t){for(var o=-1,n=0;n<e.data.onEndTimer.length;n++)if(e.data.onEndTimer[n].id===t){o=n;break}var i=e.data.onEndTimer[o];i&&(clearTimeout(i.timer),e.data.onEndTimer.splice(o,1))},a.prototype._activeNode=function(e){for(var t=null,o=0;o<e.audioNode.length;o++)if(!e.audioNode[o].paused){t=e.audioNode[o];break}return e._drainPool(e),t},a.prototype._inactiveNode=function(e,t){for(var o=null,n=0;n<e.audioNode.length;n++)if(e.audioNode[n].paused&&4===e.audioNode[n].readyState){t(e.audioNode[n]),o=!0;break}if(e._drainPool(e),!o){e.load();var i=e.audioNode[e.audioNode.length-1],a=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",r=function(){i.removeEventListener(a,r,!1),t(i)};i.addEventListener(a,r,!1)}},a.prototype._drainPool=function(e){for(var t=0,o=0;o<e.audioNode.length;o++)e.audioNode[o].paused&&t++;for(o=e.audioNode.length-1;o>=0&&!(t<=5);o--)e.audioNode[o].paused&&(e.audioNode.splice(o,1),t--)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Audio=a),void 0!==global.j2d&&(global.j2d.media.Audio=a),a}),function(e,t){"function"==typeof define&&define.amd?define("media/Sound",["utils/ObjectUtil","utils/UUID","utils/Events","media/Audio"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ObjectUtil"),require("utils/UUID"),require("utils/Events"),require("media/Audio")):t(e.j2d.utils.ObjectUtil,e.UUID,e.Events,e.Audio)}("undefined"!=typeof window?window:global,function(e,t,o,n){"use strict";function i(){return a?(r=void 0===a.createGain?a.createGainNode():a.createGain(),r.gain.value=1,r.connect(a.destination),r):null}var a,r,s={},u=function(s,d){var l=this;n.call(this,s,d),l.manager=d,l.events=l.manager?l.manager.events:new o,l.data=e.extend(!0,{},u.defaults,s),l.audioNode=[],a=d?d.getAudioContext():new(global.AudioContext||global.webkitAudioContext),r=d?d.getMasterGain():i(),null===l.data.id&&(l.data.id=t.generate()),a&&l.data.buffer&&_setupAudioNode(l),l.manager&&a&&l.manager.data.iOSAutoEnable&&(l.manager.iOSEnable=!0),l.manager&&l.manager.media.get("sounds").add(l.data.id,l),l.load()};u.defaults={id:null,src:[],format:null,autoPlay:!1,duration:0,loop:!1,sprite:{},volume:1,muted:!1,pos3d:[0,0,-.5],rate:1,loaded:!1,buffer:!1,model:null,onEndTimer:[]},u.prototype=Object.create(n.prototype),u.prototype.constructor=u,u.prototype._load=function(e){return d(e,e.data.src),e},u.prototype._unload=function(e){e.disconnect(0)},u.prototype.play=function(e,t){var o=this;return"function"==typeof e&&(t=e),e&&"function"!=typeof e||(e="default"),o.data.loaded?o.data.sprite[e]?(o._inactiveNode(o,function(n){n.sprite=e;var i=n.pos>0?n.pos:o.data.sprite[e][0]/1e3,r=o.data.sprite[e][1]/1e3-n.pos;n.pos>0&&(i=o.data.sprite[e][0]/1e3+i);var s,u=!(!o.data.loop&&!o.data.sprite[e][2]),d="string"==typeof t?t:Math.round(Date.now()*Math.random())+"";!function(){var t={id:d,sprite:e,loop:u};s=setTimeout(function(){a&&!u&&(o._nodeById(o,t.id).paused=!0,o._nodeById(o,t.id).pos=0,o._clearEndTimer(o,t.id)),o.events.trigger("unload",d)},r/o.data.rate*1e3),o.data.onEndTimer.push({timer:s,id:t.id})}();var l=o.data.sprite[e][0]/1e3,c=o.data.sprite[e][1]/1e3;return n.id=d,n.paused=!1,f(o,[u,l,c],d),o.data.playStart=a.currentTime,n.gain.value=o.data.volume,"undefined"==typeof n.bufferSource.start?u?n.bufferSource.noteGrainOn(0,i,86400):n.bufferSource.noteGrainOn(0,i,r):u?n.bufferSource.start(0,i,86400):n.bufferSource.start(0,i,r),o.events.trigger("play"),"function"==typeof t&&t(d),o}),o):("function"==typeof t&&t(),o):(o.events.on("load",function(){o.play(e,t)}),o)},u.prototype._pause=function(e){return!(e.bufferSource&&!e.paused)||(e.paused=!0,void 0==e.bufferSource.stop?e.bufferSource.noteOff(0):e.bufferSource.stop(0),!1)},u.prototype._stop=function(e){return!(e.bufferSource&&!e.paused)||(e.paused=!0,"undefined"==typeof e.bufferSource.stop?e.bufferSource.noteOff(0):e.bufferSource.stop(0),!1)},u.prototype._mute=function(e){e.gain.value=0},u.prototype._unMute=function(e){e.gain.value=this.data.volume},u.prototype._volume=function(e,t){e.gain.value=t},u.prototype._position=function(e,t){return void 0!==t&&1==t?e.pos:e.pos+(a.currentTime-this.data.playStart)},u.prototype._pos3d=function(e,t,o,n){e&&(this.data.pos3d=[t,o,n],e.panner.setPosition(t,o,n),e.panner.panningModel=this.data.model||"HRTF")},u.prototype._setupAudioNode=function(){var e=this,t=e.audioNode,o=e.audioNode.length;return t[o]=void 0===a.createGain?a.createGainNode():a.createGain(),t[o].gain.value=e.data.volume,t[o].paused=!0,t[o].pos=0,t[o].readyState=4,t[o].connect(r),t[o].panner=a.createPanner(),t[o].panner.panningModel=e.data.model||"equalpower",t[o].panner.setPosition(e.data.pos3d[0],e.data.pos3d[1],e.data.pos3d[2]),t[o].panner.connect(t[o]),t[o]},u.prototype._inactiveNode=function(e,t){for(var o=null,n=0;n<e.audioNode.length;n++)if(e.audioNode[n].paused&&4===e.audioNode[n].readyState){t(e.audioNode[n]),o=!0;break}if(e._drainPool(e),!o){var i=e._setupAudioNode();t(i)}},u.prototype._drainPool=function(e){for(var t=0,o=0;o<e.audioNode.length;o++)e.audioNode[o].paused&&t++;for(o=e.audioNode.length-1;o>=0&&!(t<=5);o--)e.audioNode[o].paused&&(a&&e.audioNode[o].disconnect(0),e.audioNode.splice(o,1),t--)};var d=function(e,t){if(t in s)return e.data.duration=s[t].duration,void c(e);if(/^data:[^;]+;base64,/.test(t)){for(var o=atob(t.split(",")[1]),n=new Uint8Array(o.length),i=0;i<o.length;++i)n[i]=o.charCodeAt(i);l(n.buffer,e,t)}else{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){l(r.response,e,t)},r.onerror=function(){a&&(e.data.buffer=!0,e.audioNode=[],delete e.gainNode,delete s[t],e.load())};try{r.send()}catch(u){r.onerror()}}},l=function(e,t,o){a.decodeAudioData(e,function(e){e&&(s[o]=e,c(t,e))},function(e){t.events.trigger("loaderror",e)})},c=function(e,t){e.data.duration=t?t.duration:e.data.duration,0===Object.getOwnPropertyNames(e.data.sprite).length&&(e.data.sprite={"default":[0,1e3*e.data.duration]}),e.data.loaded||(e.data.loaded=!0,e.events.trigger("load")),e.data.autoPlay&&e.play()},f=function(e,t,o){var n=e._nodeById(e,o);n.bufferSource=a.createBufferSource(),n.bufferSource.buffer=s[e.data.src],n.bufferSource.connect(n.panner),n.bufferSource.loop=t[0],t[0]&&(n.bufferSource.loopStart=t[1],n.bufferSource.loopEnd=t[1]+t[2]),n.bufferSource.playbackRate.value=e.data.rate};return"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Sound=u),void 0!==global.j2d&&(global.j2d.media.Sound=u),u}),function(e,t){"function"==typeof define&&define.amd?define("media/Video",["utils/ArrayMap"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ArrayMap")):t(e.ArrayMap)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(){};return"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Video=t),void 0!==global.j2d&&(global.j2d.media.Video=t),t}),function(e,t){"function"==typeof define&&define.amd?define("states/BaseGameState",["utils/ObjectUtil","utils/ArrayMap","utils/Events","utils/UUID"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ObjectUtil"),require("utils/ArrayMap"),require("utils/Events"),require("utils/UUID")):t(e.j2d.utils.ObjectUtil,e.j2d.utils.ArrayMap,e.j2d.utils.Events,e.j2d.utils.UUID)}("undefined"!=typeof window?window:global,function(e,t,o,n){"use strict";var i=function(t,a){var r=this;void 0===a&&(a={}),void 0===a&&(a={}),a.currentState=0,void 0!==a.id&&null!==a.id||(a.id=n.generate()),r.data=e.extend(!0,{},i.defaults,a),r.gsm=t,r.loader=null,r.events=new o,Object.defineProperty(this,"id",{get:function(){return r.data.id},set:function(e){r.data.id=e}})};return i.defaults={id:"BaseState",currentState:0},i.STATE={STATE_NOT_LOADED:0,STATE_INIT:1,STATE_LOAD:2,STATE_UPDATE:3,STATE_RENDER:4,STATE_UNLOAD:5},i.prototype.init=function(e){return"object"==typeof e&&void 0!==e.callback&&e.callback(),!0},i.prototype.load=function(e){return"object"==typeof e&&void 0!==e.callback&&e.callback(),!0},i.prototype.update=function(e,t){return!0},i.prototype.render=function(e,t){return!0},i.prototype.unload=function(e){return"object"==typeof e&&void 0!==e.callback&&e.callback(),!0},i.prototype.on=function(e,t){return this.events.on(e,t)},i.prototype.off=function(e,t){return this.events.off(e,t)},i.prototype.once=function(e,t){return this.events.once(e,t)},i.prototype.flush=function(e){return this.events.flush(e)},i.prototype.trigger=function(e,t){return this.events.trigger(e,t)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.BaseGameState=i),void 0!==global.j2d&&(global.j2d.states.BaseGameState=i),i}),function(e,t){"function"==typeof define&&define.amd?define("states/DefaultGameState",["states/BaseGameState"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("states/BaseGameState")):t(e.j2d.states.BaseGameState)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t,o){void 0===o&&(o={}),o.id="init_j2d",e.call(this,t,o)};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.update=function(e,t){return setTimeout(function(){this.gsm.setNextState()}.bind(this),1e3),!0},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.DefaultGameState=t),void 0!==global.j2d&&(global.j2d.states.DefaultGameState=t),t}),function(e,t){"function"==typeof define&&define.amd?define("transitions/Tween",["utils/ObjectUtil","nodes/BaseNode","utils/Events","transitions/utils/Easing","transitions/utils/Interpolation"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ObjectUtil"),require("nodes/BaseNode"),require("utils/Events"),require("transitions/utils/Easing"),require("transitions/utils/Interpolation")):t(e.j2d.utils.ObjectUtil,e.j2d.nodes.BaseNode,e.j2d.utils.Events,e.j2d.transitions.utils.Easing,e.j2d.transitions.utils.Interpolation)}("undefined"!=typeof window?window:global,function(e,t,o,n,i){"use strict";var a=[],r=function(t,n){var i=this;i.data=e.extend(!0,{},r.defaults,n),i.node=t,i.events=new o,i.state={}};r.defaults={currentStateAnimation:0,tweenStateStack:[],tweenStateTimings:[],chainedTweensStack:[],isAnimated:!1,isStarted:!1,startTime:null,delayTime:0,defaultDuration:1e3},r.stateDefaults={data:null,duration:1e3,delay:0,easing:"linear",interpolation:"linear"};var s=function(t){return void 0!==t&&"object"==typeof t?e.extend(!0,{},r.stateDefaults,t):r.stateDefaults};r.prototype.to=function(e,t){var o=this;if(!o.data.isStarted){"number"==typeof t&&(t={data:t});var n="number"!=typeof t?s(t):t;return void 0!==t&&"number"==typeof t&&(n.duration=t),o.data.tweenStateStack.push([e,n]),o}},r.prototype.update=function(e){var t=this,o=t.data.tweenStateStack[t.data.currentStateAnimation+1];if(e<t.data.startTime||void 0===o)return!0;t.data.isStarted||(t.events.trigger("start",[t.node]),t.data.isStarted=!0);var i=t.data.tweenStateStack[t.data.currentStateAnimation],a=t.getStateTimeDuration(t.data.currentStateAnimation,!0),s=(e-(t.data.startTime+a))/o[1].duration;if(s=s>1?1:s,t.node["import"](r.util.animateTween(i[0],o[0],n.get(o[1].easing)(s))),t.events.trigger("update",[t.node]),1===s){if(!(t.data.currentStateAnimation<t.data.tweenStateStack.length)){t.events.trigger("complete",[t.node]);for(var u=0;u<t.data.chainedTweensStack.length;u++)t.data.chainedTweensStack[u].start(t.data.startTime+t.getStateTimeDuration(t.data.currentStateAnimation-1,!0));return!1}t.data.currentStateAnimation++}return!0};var u=function(e){var t=[];return e.forEach(function(e){t.push(e[1].duration)}),t};r.prototype.getStateTimeDuration=function(e,t){if(void 0!==e&&null!==e||(e=this.data.currentStateAnimation),void 0===t&&(t=!1),void 0===this.data.tweenStateTimings[e])return 0;if(t){for(var o=0,n=1;n<=e;n++)o+=this.data.tweenStateTimings[n];return o}return this.data.tweenStateTimings[e]};var d=function(t,o){var n=[t],i=1,a=[t],s=0,u=0;return o.forEach(function(e){if("object"!=typeof e[0]||e[0]instanceof Array){if("string"==typeof e[0]){var t=0;switch(e[0]){case"delay":s=e[1].data;break;case"delayAll":u=e[1].data;break;case"repeat":for(t=0;t<e[1].data;t++)a.push(a[i]),i++;break;case"repeatAll":for(t=0;t<e[1].data;t++)a.concat(a),i++;break;case"yoyo":case"reverse":for(t=0;t<e[1].data;t++)void 0!==a[i-1]&&(a.push([r.util.reverseProperties(a[i-1][0]),a[i-1][1]]),i++);break;case"yoyoAll":case"reverseAll":for(t=0;t<e[1].data;t++)for(var o=a.slice(0),n=o.length,d=0;d<n;d++){
var l=n-d-1;void 0!==o[l]&&(a.push([r.util.reverseProperties(o[l][0]),o[l][1]]),i++)}}}}else 0!==s?(e[1].delay=s,s=0):0!==u&&(e[1].delay=u),a.push([e[0],e[1]]),i++}),i=0,a.shift(),a.forEach(function(t){"object"!=typeof t[0]||t[0]instanceof Array||(n.push([r.util.calculateProperties(n[i][0],e.extend(!0,{},n[i][0],t[0])),t[1]]),i++)}),n};return r.prototype.start=function(e){var t=this;return void 0===e&&(e=global.performance.now()),t.data.isAnimated=!0,t.data.isStarted||(t.data.isStarted=!0,t.state=[r.util.cleanProperties(t.node.data),r.stateDefaults],t.data.tweenStateStack=d(t.state,t.data.tweenStateStack),t.data.tweenStateTimings=u(t.data.tweenStateStack)),t.data.startTime=e+t.data.delayTime,r.add(t)},r.prototype.stop=function(){var e=this;return e.data.isAnimated?(e.data.isAnimated=!1,e.events.trigger("stop",[e.node]),e.stopChainedTweens(),r.remove(e)):this},r.prototype.stopChainedTweens=function(){for(var e=this,t=0;t<e.data.chainedTweensStack.length;t++)e.data.chainedTweensStack[t].stop();return e},r.prototype.delay=function(e){return void 0===e&&(e=1e3),this.to("delay",e),this},r.prototype.delayAll=function(e){return void 0===e&&(e=1e3),this.to("delayAll",e),this},r.prototype.repeat=function(e){return void 0===e&&(e=1),this.to("repeat",e),this},r.prototype.repeatAll=function(e){return void 0===e&&(e=1),this.to("repeatAll",e),this},r.prototype.yoyo=function(e){return void 0===e&&(e=1),this.to("yoyo",e),this},r.prototype.reverse=function(e){return void 0===e&&(e=1),this.to("reverse",e),this},r.prototype.yoyoAll=function(e){return void 0===e&&(e=1),this.to("yoyoAll",e),this},r.prototype.reverseAll=function(e){return void 0===e&&(e=1),this.to("reverseAll",e),this},r.prototype.on=function(e,t){return this.events.on(e,t)},r.prototype.off=function(e,t){return this.events.off(e,t)},r.prototype.once=function(e,t){return this.events.once(e,t)},r.prototype.flush=function(e){return this.events.flush(e)},r.prototype.trigger=function(e,t){return this.events.trigger(e,t)},r.get=function(e){return void 0===e?a:a[e]},r.add=function(e){return a.push(e),e},r.remove=function(e){var t=a.indexOf(e);return t!==-1&&a.splice(t,1),e},r.flush=function(){a=[]},r.update=function(e){if(0===a.length)return!1;for(var t=0;t<a.length;)a[t].update(e)?t++:a.splice(t,1);return!0},r.util={animateTween:function(e,t,o){var n,i,a={};for(n in t)t.hasOwnProperty(n)&&e.hasOwnProperty(n)&&(i=null,"number"==typeof t[n]?i=e[n]===t[n]?e[n]:e[n]+(t[n]-e[n])*o:"object"==typeof t[n]&&(i=this.animateTween(e[n],t[n],o)),null!==i&&(a[n]=i));return Object.keys(a).length>0?a:null},cleanProperties:function(e){var t,o,n={};for(t in e)e.hasOwnProperty(t)&&"id"!==t&&(o=null,"string"==typeof e[t]&&!isNaN(e[t])||"number"==typeof e[t]?o=e[t]:"object"==typeof e[t]&&(o=this.cleanProperties(e[t])),null!==o&&(n[t]=o));return Object.keys(n).length>0?n:null},reverseProperties:function(e){var t,o,n={};for(t in e)e.hasOwnProperty(t)&&"id"!==t&&(o=null,"string"!=typeof e[t]||isNaN(e[t])?"number"==typeof e[t]?o=e[t]:"object"==typeof e[t]&&(o=this.reverseProperties(e[t])):o=Number(parseFloat(e[t])*-1).toString(),null!==o&&(n[t]=o));return Object.keys(n).length>0?n:null},calculateProperties:function(e,t){var o,n,i={};for(o in t)t.hasOwnProperty(o)&&e.hasOwnProperty(o)&&"id"!==o&&(n=null,"string"!=typeof t[o]||isNaN(t[o])||"number"!=typeof e[o]?"number"!=typeof t[o]||"string"!=typeof e[o]||isNaN(e[o])?"number"==typeof t[o]&&"number"==typeof e[o]?n=t[o]:"object"==typeof t[o]&&(n=this.calculateProperties(e[o],t[o])):n=t[o]-parseFloat(e[o]):n=e[o]+parseFloat(t[o]),null!==n&&(i[o]=n));return Object.keys(i).length>0?i:null}},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Tween=r),void 0!==global.j2d&&(global.j2d.transitions.Tween=r),r}),function(e,t){"function"==typeof define&&define.amd?define("utils/ArrayMap",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){Array.call(this,e)};return e.prototype=Object.create(Array.prototype),e.prototype.constructor=e,e.prototype.last=function(){return this[this.length-1]},e.prototype.equals=function(e){if(!e)return!1;if(this.length!=e.length)return!1;for(var t=0,o=this.length;t<o;t++)if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].equals(e[t]))return!1}else if(this[t]!=e[t])return!1;return!0},Object.defineProperty(e.prototype,"equals",{enumerable:!1}),e.prototype.contains=function(e){for(var t=this.length;t--;)if(this[t]===e)return!0;return!1},Object.defineProperty(e.prototype,"contains",{enumerable:!1}),e.prototype.each=function(e){if(!e)return!1;for(var t=!1,o=0;o<this.length;o++)if(0==(t=e(this[o],o)))return t;return t},Object.defineProperty(e.prototype,"each",{enumerable:!1}),e.prototype.add=function(e,t){return this.contains(e)?this[e]=t:(this.push(e),this[e]=t),this},Object.defineProperty(e.prototype,"add",{enumerable:!1}),e.prototype.get=function(e){return this.contains(e)?this[e]:null},Object.defineProperty(e.prototype,"get",{enumerable:!1}),e.prototype.remove=function(e){for(var t=0;t<this.length;++t)if(this[t]==e)return this.splice(t,1),delete this[e],this;return this},Object.defineProperty(e.prototype,"remove",{enumerable:!1}),"object"==typeof module&&"object"==typeof module.exports&&(module.exports.ArrayMap=e),void 0!==global.j2d&&(global.j2d.utils.ArrayMap=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/DeviceUtil",["utils/Vector2dInteger"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/Vector2dInteger")):t(e.j2d.utils.Vector2dInteger)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(){var e=parseInt(Math.max(document.documentElement.clientWidth,document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth)),t=parseInt(Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight));this.width=e<parseInt(screen.width)?e:parseInt(screen.width),this.height=t<parseInt(screen.height)?t:parseInt(screen.height)};return t.prototype.onResize=function(){return this.width=window.innerWidth,this.height=window.innerHeight,this},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.getSize=function(){return new e(this.width,this.height)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.DeviceUtil=t),void 0!==global.j2d&&(global.j2d.utils.DeviceUtil=t),t}),function(e,t){"function"==typeof define&&define.amd?define("utils/Events",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){var e,t;this.flush=function(o){void 0!==o?(void 0!==e[o]&&(e[o]=new Array),void 0!==t[o]&&(t[o]=new Array)):(t=new Array,e=new Array)},this.flush(),this.on=function(t,o){if(void 0!==e[t]){var n=e[t];n.indexOf(o)===-1&&n.push(o)}else e[t]=new Array,e[t].push(o)},this.once=function(e,o){if(void 0!==t[e]){var n=t[e];n.indexOf(o)===-1&&n.push(o)}else t[e]=new Array,t[e].push(o)},this.off=function(o,n){if(void 0!==t[o]){var i=e[o];i.indexOf(n)!==-1&&i.splice(i.indexOf(n))}},this.trigger=function(o,n){var i,a;if(void 0!==e[o])for(i=e[o],a=0;a<i.length;a++)i[a].call(i[a],n);if(void 0!==t[o]){for(i=t[o],a=0;a<i.length;a++)i[a].call(i[a],n);this.flush(o)}}};return"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Events=e),void 0!==global.j2d&&(global.j2d.utils.Events=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/MathUtil",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){};return e.number2Integer=function(e){return e>>0},e.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&e>-9007199254740992&&e<9007199254740992&&Math.floor(e)===e},e.randomColor=function(t,o,n){return"rgba("+e.random(t,o)+", "+e.random(t,o)+", "+e.random(t,o)+", "+n+")"},e.random=function(t,o,n){var i=Math.floor(Math.random()*(o-t+1)+t);return n&&0==i?e.random(t,o,n):i},e.degree2Radian=function(e){return e*(Math.PI/180)},e.radian2Degree=function(e){return e*(180/Math.PI)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.MathUtil=e),void 0!==global.j2d&&(global.j2d.utils.MathUtil=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/ObjectUtil",["utils/ArrayMap"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/ArrayMap")):t(e.j2d.utils.ArrayMap)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(){};return t.extend=function(){var e=Array.prototype.slice.call(arguments),o=!1;"boolean"==typeof e[0]&&(o=e[0],e.splice(0,1));for(var n=e[0]||function(){return void 0!==e[1]&&null!==e[1]&&"object"==typeof e[1]?Object.create(e[1]):{}}(),i=1;i<e.length;i++){var a=e[i];if(a)for(var r in a)a.hasOwnProperty(r)&&("object"==typeof a[r]&&null!==a[r]?n[r]=o?t.extend(o,n[r],a[r]):a[r]:n[r]=a[r])}return n},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.ObjectUtil=t),void 0!==global.j2d&&(global.j2d.utils.ObjectUtil=t),t}),function(e,t){"function"==typeof define&&define.amd?define("utils/SystemConsole",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){this.css=function(e){return"background: "+e+";background-repeat: no-repeat;color: #1df9a8;line-height: 16pxpadding: 3px 0"},this.link=function(e){return"background: "+e+";background-repeat: no-repeat;font-size: 12px;color: #446d96;line-height: 14px"}};return e.prototype.logSystem=function(e,t){return console.log("%c %c %c %s %c %c %c %c%s",this.css("#5C6166"),this.css("#4F5357"),this.css("#313335"),e,this.css("#4F5357"),this.css("#5C6166"),this.link("none"),this.link("none"),t)},e.prototype.log=function(e,t){var o="";switch("string"==typeof t&&(t=t.toLowerCase()),t){case"info":t="INFO",o="background: #308AE4; color: #fff; padding: 1px 4px";break;case"warn":case"warning":t="WARNING",o="background: #f7a148; color: #fff; padding: 1px 4px";break;case"error":t="ERROR",o="background: #DB5252; color: #fff; padding: 1px 4px";break;case"network":t="NETWORK",o="background: #7D2998; color: #fff; padding: 1px 4px";break;case"debug":case void 0:default:t="DEBUG",o="background: #ADADAD; color: #fff; padding: 1px 4px"}return console.log("%c%s",o,t,e)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.SystemConsole=e),void 0!==global.j2d&&(global.j2d.utils.SystemConsole=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/UUID",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){};return e.generate=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,o="x"==e?t:3&t|8;return o.toString(16)})},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.UUID=e),void 0!==global.j2d&&(global.j2d.utils.UUID=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/Vector2d",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e,t){this.x=e,this.y=t};return e.prototype.getX=function(){return this.x},e.prototype.getY=function(){return this.y},e.prototype.getVector=function(){return{x:this.x,y:this.y}},e.prototype.toArray=function(){return[this.x,this.y]},e.prototype.fromArray=function(e){return this.x=e[0],this.y=e[1],this},e.prototype.toString=function(){return"("+this.x+","+this.y+")"},e.getDistance=function(e,t){return Math.sqrt(Math.pow(t.getVector().x-e.getVector().x,2)+Math.pow(t.getVector().y-e.getVector().y,2))},e.getAngle=function(e,t){return Math.atan2(t.getVector().y-e.getVector().y,t.getVector().x-e.getVector().x)*(180/Math.PI)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Vector2d=e),void 0!==global.j2d&&(global.j2d.utils.Vector2d=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/Vector2dInteger",["utils/Vector2d"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/Vector2d")):t(e.j2d.utils.Vector2d)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(t,o){e.call(this,t>>0,o>>0)};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.fromArray=function(e){return this.x=e[0]>>0,this.y=e[1]>>0,this},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Vector2dInteger=t),void 0!==global.j2d&&(global.j2d.utils.Vector2dInteger=t),t}),function(e,t){"function"==typeof define&&define.amd?define("transitions/utils/Easing",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e,t={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,o=.1,n=.4;return 0===e?0:1===e?1:(!o||o<1?(o=1,t=n/4):t=n*Math.asin(1/o)/(2*Math.PI),-(o*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/n)))},Out:function(e){var t,o=.1,n=.4;return 0===e?0:1===e?1:(!o||o<1?(o=1,t=n/4):t=n*Math.asin(1/o)/(2*Math.PI),o*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/n)+1)},InOut:function(e){var t,o=.1,n=.4;return 0===e?0:1===e?1:(!o||o<1?(o=1,t=n/4):t=n*Math.asin(1/o)/(2*Math.PI),(e*=2)<1?-.5*(o*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/n)):o*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/n)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-Tween.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*Tween.Easing.Bounce.In(2*e):.5*Tween.Easing.Bounce.Out(2*e-1)+.5}}};return t.get=function(t){if(void 0!==e[t])return e[t]},t.register=function(t,o){e[t]=o},e={linear:t.Linear.None,"quadratic-in":t.Quadratic.In,"quadratic-out":t.Quadratic.Out,"quadratic-in-out":t.Quadratic.InOut,"cubic-in":t.Cubic.In,"cubic-out":t.Cubic.Out,"cubic-in-out":t.Cubic.InOut,"quartic-in":t.Quartic.In,"quartic-out":t.Quartic.Out,"quartic-in-out":t.Quartic.InOut,"quintic-in":t.Quintic.In,"quintic-out":t.Quintic.Out,"quintic-in-out":t.Quintic.InOut,"sinusoidal-in":t.Sinusoidal.In,"sinusoidal-out":t.Sinusoidal.Out,"sinusoidal-in-out":t.Sinusoidal.InOut,"exponential-in":t.Exponential.In,"exponential-out":t.Exponential.Out,"exponential-in-out":t.Exponential.InOut,"circular-in":t.Circular.In,"circular-out":t.Circular.Out,"circular-in-out":t.Circular.InOut,"elastic-in":t.Elastic.In,"elastic-out":t.Elastic.Out,"elastic-in-out":t.Elastic.InOut,"back-in":t.Back.In,"back-out":t.Back.Out,"back-in-out":t.Back.InOut,"bounce-in":t.Bounce.In,"bounce-out":t.Bounce.Out,"bounce-in-out":t.Bounce.InOut},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Easing=t),void 0!==global.j2d&&(global.j2d.transitions.utils.Easing=t),t}),function(e,t){"function"==typeof define&&define.amd?define("transitions/utils/Interpolation",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e,t={Linear:function(e,o){var n=e.length-1,i=n*o,a=Math.floor(i),r=t.Utils.Linear;return o<0?r(e[0],e[1],i):o>1?r(e[n],e[n-1],n-i):r(e[a],e[a+1>n?n:a+1],i-a)},Bezier:function(e,o){for(var n=0,i=e.length-1,a=Math.pow,r=t.Utils.Bernstein,s=0;s<=i;s++)n+=a(1-o,i-s)*a(o,s)*e[s]*r(i,s);return n},CatmullRom:function(e,o){var n=e.length-1,i=n*o,a=Math.floor(i),r=t.Utils.CatmullRom;return e[0]===e[n]?(o<0&&(a=Math.floor(i=n*(1+o))),r(e[(a-1+n)%n],e[a],e[(a+1)%n],e[(a+2)%n],i-a)):o<0?e[0]-(r(e[0],e[0],e[1],e[1],-i)-e[0]):o>1?e[n]-(r(e[n],e[n],e[n-1],e[n-1],i-n)-e[n]):r(e[a?a-1:0],e[a],e[n<a+1?n:a+1],e[n<a+2?n:a+2],i-a)}};return t.Utils={Linear:function(e,t,o){return(t-e)*o+e},Bernstein:function(e,o){var n=t.Utils.Factorial;return n(e)/n(o)/n(e-o)},Factorial:function(){var e=[1];return function(t){var o=1;if(e[t])return e[t];for(var n=t;n>1;n--)o*=n;return e[t]=o,o}}(),CatmullRom:function(e,t,o,n,i){var a=.5*(o-e),r=.5*(n-t),s=i*i,u=i*s;return(2*t-2*o+a+r)*u+(-3*t+3*o-2*a-r)*s+a*i+t}},t.get=function(t){if(void 0!==e[t])return e[t]},t.register=function(t,o){e[t]=o},e={linear:t.Linear,bezier:t.Bezier,"catmull-rom":t.CatmullRom},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Interpolation=t),void 0!==global.j2d&&(global.j2d.transitions.utils.Interpolation=t),t});
//# sourceMappingURL=j2d.min.map
