{"version":3,"sources":["j2d/j2d.scene.js"],"names":["define","Scene","j2d","this","parent","enableFullscreen","layerName","layers","prototype","resize","width","height","i","list","hasOwnProperty","async","callback","data","setTimeout","call","setGameState","engine","setActiveEngine","element","trigger","start","frameLimit","options","io","init","fullScreen","fullscreen","document","getElementById","attr","undefined","requestFullscreen","webkitRequestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen","exitFullscreen","webkitExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen","resizeToFullPage","scene","originalWidth","originalHeight","device","scaleToFullScreen","layer","canvas","style","toggleFullScreen","setViewPosition","position","viewport","x","Math","ceil","y","setViewFocus","id","offset","getPosition","viewMove","clear","getLayer","heigth","add","context","visible","cancelClear","vector","vec2df","$","window","ready","append"],"mappings":"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","file":"j2d/j2d.scene.min","sourcesContent":["/**\r\n * J2D (jQuery plugin of the fork j2ds)\r\n *\r\n * @authors Skaner, likerRr, DeVinterX\r\n * @license zlib\r\n * @version 0.1.5a\r\n * @see https://github.com/SkanerSoft/J2ds/commit/d91880bd189a29b364cc6fd2a3af069f139c5f8a\r\n */\r\n\r\ndefine('j2d.scene', [], function () {\r\n    \"use strict\";\r\n\r\n    var Scene = function (j2d) {\r\n        this.parent = j2d;\r\n        this.enableFullscreen = false;\r\n        this.layerName = 'sceneNode';\r\n        this.layers = (parent.layers) ? parent.layers : {};\r\n    };\r\n\r\n    Scene.prototype.resize = function (width, height) {\r\n        var j2d = this.parent;\r\n\r\n        this.width = width;\r\n        this.height = height;\r\n\r\n        for (var i in j2d.layers.list) {\r\n            if (j2d.layers.list.hasOwnProperty(i)) {\r\n                j2d.layers.list[i].resize(width, height);\r\n            }\r\n        }\r\n    };\r\n\r\n    Scene.prototype.async = function (callback, data) {\r\n        setTimeout(callback.call(callback, data), 0);\r\n    };\r\n\r\n    Scene.prototype.setGameState = function (engine) {\r\n        this.parent.setActiveEngine(engine);\r\n        this.parent.element.trigger('changedGameState');\r\n    };\r\n\r\n    Scene.prototype.start = function (engine, frameLimit) {\r\n        if (this.parent.options.io) {\r\n            this.parent.options.io.init();\r\n        }\r\n        this.parent.element.trigger('beforeStart');\r\n        this.parent.start(engine, frameLimit);\r\n        this.parent.element.trigger('afterStart');\r\n    };\r\n\r\n    Scene.prototype.fullScreen = function (fullscreen) {\r\n        var element = document.getElementById(this.parent.element.attr('id'));\r\n\r\n        if (undefined === element.requestFullscreen) {\r\n            element.requestFullscreen = element.webkitRequestFullscreen\r\n            || element.webkitRequestFullScreen\r\n            || element.mozRequestFullScreen\r\n            || element.msRequestFullscreen;\r\n        }\r\n\r\n        if (undefined === document.exitFullscreen) {\r\n            document.exitFullscreen = document.webkitExitFullscreen\r\n            || document.webkitCancelFullScreen\r\n            || document.mozCancelFullScreen\r\n            || document.msExitFullscreen;\r\n        }\r\n        if (fullscreen) {\r\n            element.requestFullscreen();\r\n        } else {\r\n            document.exitFullscreen();\r\n        }\r\n    };\r\n\r\n    Scene.prototype.resizeToFullPage = function (fullscreen) {\r\n        var j2d = this.parent;\r\n        var scene = this;\r\n\r\n        if (fullscreen) {\r\n            scene.originalWidth = scene.width;\r\n            scene.originalHeight = scene.height;\r\n\r\n            scene.resize(j2d.device.width, j2d.device.height);\r\n            scene.enableFullscreen = true;\r\n        } else {\r\n            scene.resize(scene.originalWidth, scene.originalHeight);\r\n            scene.enableFullscreen = false;\r\n        }\r\n    };\r\n\r\n    Scene.prototype.scaleToFullScreen = function (fullscreen) {\r\n        var layer, i;\r\n        if (fullscreen) {\r\n            for (i in this.parent.layers.list) {\r\n                if (this.parent.layers.list.hasOwnProperty(i)) {\r\n                    layer = this.parent.layers.list[i].canvas;\r\n                    layer.style.width = this.parent.device.width + 'px';\r\n                    layer.style.height = this.parent.device.height + 'px';\r\n                }\r\n            }\r\n            this.enableFullscreen = true;\r\n            this.parent.element.width(this.parent.device.width).height(this.parent.device.height);\r\n        } else {\r\n            for (i in this.parent.layers.list) {\r\n                if (this.parent.layers.list.hasOwnProperty(i)) {\r\n                    layer = this.parent.layers.list[i].canvas;\r\n                    layer.style.width = this.width + 'px';\r\n                    layer.style.height = this.height + 'px';\r\n                }\r\n            }\r\n            this.enableFullscreen = false;\r\n            this.parent.element.width(this.width).height(this.height);\r\n        }\r\n    };\r\n\r\n    Scene.prototype.toggleFullScreen = function (j2d, data) {\r\n        if (data === undefined) {\r\n            data = {fullscreen: undefined};\r\n        }\r\n        if (!j2d.scene.enableFullscreen || data.fullscreen) {\r\n            j2d.scene.fullScreen(true);\r\n        } else {\r\n            j2d.scene.fullScreen(false);\r\n        }\r\n    };\r\n\r\n    // Устанавливает позицию для камеры\r\n    Scene.prototype.setViewPosition = function (position) {\r\n        this.parent.scene.viewport.x = position.x - Math.ceil(this.parent.scene.width / 2);\r\n        this.parent.scene.viewport.y = position.y - Math.ceil(this.parent.scene.height / 2);\r\n    };\r\n\r\n    //! Движение \"камеры\" вслед за объектом\r\n    Scene.prototype.setViewFocus = function (id, offset) {\r\n        this.parent.scene.viewport.x = id.getPosition().x - Math.ceil(this.parent.scene.width / 2) + (offset ? offset.x : 0);\r\n        this.parent.scene.viewport.y = id.getPosition().y - Math.ceil(this.parent.scene.height / 2) + (offset ? offset.y : 0);\r\n    };\r\n\r\n    //! Движение \"камеры\"\r\n    Scene.prototype.viewMove = function (position) {\r\n        this.parent.scene.viewport.x += position.x;\r\n        this.parent.scene.viewport.y += position.y;\r\n    };\r\n\r\n    //! Очистка отрисованного предыдущего кадра сцены\r\n    Scene.prototype.clear = function () {\r\n        this.getLayer().clear();\r\n    };\r\n\r\n    Scene.prototype.getLayer = function () {\r\n        return this.parent.layers.getLayer('sceneNode');\r\n    };\r\n\r\n    // инициализация сцены\r\n    Scene.prototype.init = function (width, heigth) {\r\n        var j2d = this.parent;\r\n        j2d.element.trigger('beforeInit');\r\n\r\n        this.width = this.originalWidth = width;\r\n        this.height = this.originalHeight = heigth;\r\n\r\n        this.parent.element.width(width).height(heigth);\r\n\r\n        j2d.layers.add('sceneNode', 0);\r\n\r\n        this.context = j2d.layers.getLayer('sceneNode').context;\r\n        this.canvas = j2d.layers.getLayer('sceneNode').canvas;\r\n        this.visible = true;\r\n\r\n        this.cancelClear = false;\r\n\r\n        /* Вид \"камеры\" */\r\n        this.viewport = j2d.vector.vec2df(0, 0);\r\n\r\n        j2d.element.trigger('afterInit');\r\n\r\n        $(window).ready(function () {\r\n            for (var i in j2d.layers.list) {\r\n                if (j2d.layers.list.hasOwnProperty(i)) {\r\n                    j2d.element.append(j2d.layers.getLayer(i).canvas);\r\n                }\r\n            }\r\n            j2d.options.ready = true;\r\n            j2d.element.trigger('ready');\r\n        });\r\n    };\r\n\r\n    return Scene;\r\n});\r\n"],"sourceRoot":"/source/"}