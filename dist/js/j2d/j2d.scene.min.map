{"version":3,"sources":["j2d.scene.js","j2d/j2d.scene.js"],"names":["root","factory","define","amd","global","Scene","j2d","this","parent","enableFullscreen","layerName","layers","prototype","resize","width","height","i","list","hasOwnProperty","async","callback","data","setTimeout","call","setGameState","engine","setActiveEngine","element","trigger","start","frameLimit","options","io","init","fullScreen","fullscreen","document","getElementById","attr","undefined","requestFullscreen","webkitRequestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen","exitFullscreen","webkitExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen","resizeToFullPage","$","toggle","scene","originalWidth","originalHeight","device","css","originalMargin","scaleToFullScreen","layer","canvas","style","toggleFullScreen","setViewPosition","position","viewport","x","Math","ceil","y","setViewFocus","id","offset","getPosition","viewMove","clear","getLayer","heigth","add","context","visible","cancelClear","vector","vec2df","window","ready","append","J2D"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CCFC,SAAUA,EAAMC,GACS,kBAAXC,SAAyBA,OAAOC,IACvCD,OAAO,eAAiBD,GAExBA,KAENG,OAAQ,WACN,YAEA,IAAIC,GAAQ,SAAUC,GAClBC,KAAKC,OAASF,EACdC,KAAKE,kBAAmB,EACxBF,KAAKG,UAAY,YACjBH,KAAKI,OAAUH,OAAa,OAAIA,OAAOG,UAoL3C,OAjLAN,GAAMO,UAAUC,OAAS,SAAUC,EAAOC,GACtC,GAAIT,GAAMC,KAAKC,MAEfD,MAAKO,MAAQA,EACbP,KAAKQ,OAASA,CAEd,KAAK,GAAIC,KAAKV,GAAIK,OAAOM,KACjBX,EAAIK,OAAOM,KAAKC,eAAeF,IAC/BV,EAAIK,OAAOM,KAAKD,GAAGH,OAAOC,EAAOC,IAK7CV,EAAMO,UAAUO,MAAQ,SAAUC,EAAUC,GACxCC,WAAWF,EAASG,KAAKH,EAAUC,GAAO,IAG9ChB,EAAMO,UAAUY,aAAe,SAAUC,GACrClB,KAAKC,OAAOkB,gBAAgBD,GAC5BlB,KAAKC,OAAOmB,QAAQC,QAAQ,qBAGhCvB,EAAMO,UAAUiB,MAAQ,SAAUJ,EAAQK,GAClCvB,KAAKC,OAAOuB,QAAQC,IACpBzB,KAAKC,OAAOuB,QAAQC,GAAGC,OAE3B1B,KAAKC,OAAOmB,QAAQC,QAAQ,eAC5BrB,KAAKC,OAAOqB,MAAMJ,EAAQK,GAC1BvB,KAAKC,OAAOmB,QAAQC,QAAQ,eAGhCvB,EAAMO,UAAUsB,WAAa,SAAUC,GACnC,GAAIR,GAAUS,SAASC,eAAe9B,KAAKC,OAAOmB,QAAQW,KAAK,MAE3DC,UAAcZ,EAAQa,oBACtBb,EAAQa,kBAAoBb,EAAQc,yBACjCd,EAAQe,yBACRf,EAAQgB,sBACRhB,EAAQiB,qBAGXL,SAAcH,SAASS,iBACvBT,SAASS,eAAiBT,SAASU,sBAChCV,SAASW,wBACTX,SAASY,qBACTZ,SAASa,kBAEZd,EACAR,EAAQa,oBAERJ,SAASS,kBAIjBxC,EAAMO,UAAUsC,iBAAmB,SAAUf,GACzCgB,EAAE,iCAAiCC,OAAOjB,EAE1C,IAAI7B,GAAMC,KAAKC,OACX6C,EAAQ9C,IAER4B,IACAkB,EAAMC,cAAgBD,EAAMvC,MAC5BuC,EAAME,eAAiBF,EAAMtC,OAE7BsC,EAAMxC,OAAOP,EAAIkD,OAAO1C,MAAOR,EAAIkD,OAAOzC,QAC1CsC,EAAM5C,kBAAmB,EAEzBF,KAAKC,OAAOmB,QAAQb,MAAMR,EAAIkD,OAAO1C,OAAOC,OAAOT,EAAIkD,OAAOzC,QAAQ0C,IAAI,SAAU,KAEpFJ,EAAMxC,OAAOwC,EAAMC,cAAeD,EAAME,gBACxCF,EAAM5C,kBAAmB,EAEzBF,KAAKC,OAAOmB,QAAQb,MAAMuC,EAAMC,eAAevC,OAAOsC,EAAME,gBAAgBE,IAAI,SAAUJ,EAAMK,kBAIxGrD,EAAMO,UAAU+C,kBAAoB,SAAUxB,GAC1CgB,EAAE,iCAAiCC,OAAOjB,EAE1C,IAAIyB,GAAO5C,CACX,IAAImB,EAAY,CACZ,IAAKnB,IAAKT,MAAKC,OAAOG,OAAOM,KACrBV,KAAKC,OAAOG,OAAOM,KAAKC,eAAeF,KACvC4C,EAAQrD,KAAKC,OAAOG,OAAOM,KAAKD,GAAG6C,OACnCD,EAAME,MAAMhD,MAAQP,KAAKC,OAAOgD,OAAO1C,MAAQ,KAC/C8C,EAAME,MAAM/C,OAASR,KAAKC,OAAOgD,OAAOzC,OAAS,KAGzDR,MAAKE,kBAAmB,EACxBF,KAAKC,OAAOmB,QAAQb,MAAMP,KAAKC,OAAOgD,OAAO1C,OAAOC,OAAOR,KAAKC,OAAOgD,OAAOzC,QAAQ0C,IAAI,SAAU,OACjG,CACH,IAAKzC,IAAKT,MAAKC,OAAOG,OAAOM,KACrBV,KAAKC,OAAOG,OAAOM,KAAKC,eAAeF,KACvC4C,EAAQrD,KAAKC,OAAOG,OAAOM,KAAKD,GAAG6C,OACnCD,EAAME,MAAMhD,MAAQP,KAAKO,MAAQ,KACjC8C,EAAME,MAAM/C,OAASR,KAAKQ,OAAS,KAG3CR,MAAKE,kBAAmB,EACxBF,KAAKC,OAAOmB,QAAQb,MAAMP,KAAKO,OAAOC,OAAOR,KAAKQ,QAAQ0C,IAAI,SAAUlD,KAAKmD,kBAIrFrD,EAAMO,UAAUmD,iBAAmB,SAAUzD,EAAKe,GACjCkB,SAATlB,IACAA,GAAQc,WAAYI,UAEnBjC,EAAI+C,MAAM5C,kBAAoBY,EAAKc,WACpC7B,EAAI+C,MAAMnB,YAAW,GAErB5B,EAAI+C,MAAMnB,YAAW,IAK7B7B,EAAMO,UAAUoD,gBAAkB,SAAUC,GACxC1D,KAAKC,OAAO6C,MAAMa,SAASC,EAAIF,EAASE,EAAIC,KAAKC,KAAK9D,KAAKC,OAAO6C,MAAMvC,MAAQ,GAChFP,KAAKC,OAAO6C,MAAMa,SAASI,EAAIL,EAASK,EAAIF,KAAKC,KAAK9D,KAAKC,OAAO6C,MAAMtC,OAAS,IAIrFV,EAAMO,UAAU2D,aAAe,SAAUC,EAAIC,GACzClE,KAAKC,OAAO6C,MAAMa,SAASC,EAAIK,EAAGE,cAAcP,EAAIC,KAAKC,KAAK9D,KAAKC,OAAO6C,MAAMvC,MAAQ,IAAM2D,EAASA,EAAON,EAAI,GAClH5D,KAAKC,OAAO6C,MAAMa,SAASI,EAAIE,EAAGE,cAAcJ,EAAIF,KAAKC,KAAK9D,KAAKC,OAAO6C,MAAMtC,OAAS,IAAM0D,EAASA,EAAOH,EAAI,IAIvHjE,EAAMO,UAAU+D,SAAW,SAAUV,GACjC1D,KAAKC,OAAO6C,MAAMa,SAASC,GAAKF,EAASE,EACzC5D,KAAKC,OAAO6C,MAAMa,SAASI,GAAKL,EAASK,GAI7CjE,EAAMO,UAAUgE,MAAQ,WACpBrE,KAAKsE,WAAWD,SAGpBvE,EAAMO,UAAUiE,SAAW,WACvB,MAAOtE,MAAKC,OAAOG,OAAOkE,SAAS,cAIvCxE,EAAMO,UAAUqB,KAAO,SAAUnB,EAAOgE,GACpC,GAAIxE,GAAMC,KAAKC,MACfF,GAAIqB,QAAQC,QAAQ,cAEpBrB,KAAKO,MAAQP,KAAK+C,cAAgBxC,EAClCP,KAAKQ,OAASR,KAAKgD,eAAiBuB,EACpCvE,KAAKmD,eAAiBpD,EAAIqB,QAAQ8B,IAAI,UAEtClD,KAAKC,OAAOmB,QAAQb,MAAMA,GAAOC,OAAO+D,GAExCxE,EAAIK,OAAOoE,IAAI,YAAa,GAE5BxE,KAAKyE,QAAU1E,EAAIK,OAAOkE,SAAS,aAAaG,QAChDzE,KAAKsD,OAASvD,EAAIK,OAAOkE,SAAS,aAAahB,OAC/CtD,KAAK0E,SAAU,EAEf1E,KAAK2E,aAAc,EAGnB3E,KAAK2D,SAAW5D,EAAI6E,OAAOC,OAAO,EAAG,GAErC9E,EAAIqB,QAAQC,QAAQ,aAEpBuB,EAAEkC,QAAQC,MAAM,WACZ,IAAK,GAAItE,KAAKV,GAAIK,OAAOM,KACjBX,EAAIK,OAAOM,KAAKC,eAAeF,IAC/BV,EAAIqB,QAAQ4D,OAAOjF,EAAIK,OAAOkE,SAAS7D,GAAG6C,OAGlDvD,GAAIyB,QAAQuD,OAAQ,EACpBhF,EAAIqB,QAAQC,QAAQ,YAITW,SAAfnC,OAAOoF,MAAmBpF,OAAOC,MAAQA,GACtCA","file":"j2d/j2d.scene.js","sourcesContent":[null,"/**\r\n * J2D (jQuery plugin of the fork j2ds)\r\n *\r\n * @authors Skaner, likerRr, DeVinterX\r\n * @license zlib\r\n * @version 0.1.5a\r\n * @see https://github.com/SkanerSoft/J2ds/commit/d91880bd189a29b364cc6fd2a3af069f139c5f8a\r\n */\r\n\r\n!function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        define('j2d.scene', [], factory);\r\n    } else {\r\n        factory();\r\n    }\r\n}(global, function () {\r\n    \"use strict\";\r\n\r\n    var Scene = function (j2d) {\r\n        this.parent = j2d;\r\n        this.enableFullscreen = false;\r\n        this.layerName = 'sceneNode';\r\n        this.layers = (parent.layers) ? parent.layers : {};\r\n    };\r\n\r\n    Scene.prototype.resize = function (width, height) {\r\n        var j2d = this.parent;\r\n\r\n        this.width = width;\r\n        this.height = height;\r\n\r\n        for (var i in j2d.layers.list) {\r\n            if (j2d.layers.list.hasOwnProperty(i)) {\r\n                j2d.layers.list[i].resize(width, height);\r\n            }\r\n        }\r\n    };\r\n\r\n    Scene.prototype.async = function (callback, data) {\r\n        setTimeout(callback.call(callback, data), 0);\r\n    };\r\n\r\n    Scene.prototype.setGameState = function (engine) {\r\n        this.parent.setActiveEngine(engine);\r\n        this.parent.element.trigger('changedGameState');\r\n    };\r\n\r\n    Scene.prototype.start = function (engine, frameLimit) {\r\n        if (this.parent.options.io) {\r\n            this.parent.options.io.init();\r\n        }\r\n        this.parent.element.trigger('beforeStart');\r\n        this.parent.start(engine, frameLimit);\r\n        this.parent.element.trigger('afterStart');\r\n    };\r\n\r\n    Scene.prototype.fullScreen = function (fullscreen) {\r\n        var element = document.getElementById(this.parent.element.attr('id'));\r\n\r\n        if (undefined === element.requestFullscreen) {\r\n            element.requestFullscreen = element.webkitRequestFullscreen\r\n            || element.webkitRequestFullScreen\r\n            || element.mozRequestFullScreen\r\n            || element.msRequestFullscreen;\r\n        }\r\n\r\n        if (undefined === document.exitFullscreen) {\r\n            document.exitFullscreen = document.webkitExitFullscreen\r\n            || document.webkitCancelFullScreen\r\n            || document.mozCancelFullScreen\r\n            || document.msExitFullscreen;\r\n        }\r\n        if (fullscreen) {\r\n            element.requestFullscreen();\r\n        } else {\r\n            document.exitFullscreen();\r\n        }\r\n    };\r\n\r\n    Scene.prototype.resizeToFullPage = function (fullscreen) {\r\n        $('div.canvas[guid]:not(.active)').toggle(fullscreen);\r\n\r\n        var j2d = this.parent;\r\n        var scene = this;\r\n\r\n        if (fullscreen) {\r\n            scene.originalWidth = scene.width;\r\n            scene.originalHeight = scene.height;\r\n\r\n            scene.resize(j2d.device.width, j2d.device.height);\r\n            scene.enableFullscreen = true;\r\n\r\n            this.parent.element.width(j2d.device.width).height(j2d.device.height).css('margin', 0);\r\n        } else {\r\n            scene.resize(scene.originalWidth, scene.originalHeight);\r\n            scene.enableFullscreen = false;\r\n\r\n            this.parent.element.width(scene.originalWidth).height(scene.originalHeight).css('margin', scene.originalMargin);\r\n        }\r\n    };\r\n\r\n    Scene.prototype.scaleToFullScreen = function (fullscreen) {\r\n        $('div.canvas[guid]:not(.active)').toggle(fullscreen);\r\n\r\n        var layer, i;\r\n        if (fullscreen) {\r\n            for (i in this.parent.layers.list) {\r\n                if (this.parent.layers.list.hasOwnProperty(i)) {\r\n                    layer = this.parent.layers.list[i].canvas;\r\n                    layer.style.width = this.parent.device.width + 'px';\r\n                    layer.style.height = this.parent.device.height + 'px';\r\n                }\r\n            }\r\n            this.enableFullscreen = true;\r\n            this.parent.element.width(this.parent.device.width).height(this.parent.device.height).css('margin', 0);\r\n        } else {\r\n            for (i in this.parent.layers.list) {\r\n                if (this.parent.layers.list.hasOwnProperty(i)) {\r\n                    layer = this.parent.layers.list[i].canvas;\r\n                    layer.style.width = this.width + 'px';\r\n                    layer.style.height = this.height + 'px';\r\n                }\r\n            }\r\n            this.enableFullscreen = false;\r\n            this.parent.element.width(this.width).height(this.height).css('margin', this.originalMargin);\r\n        }\r\n    };\r\n\r\n    Scene.prototype.toggleFullScreen = function (j2d, data) {\r\n        if (data === undefined) {\r\n            data = {fullscreen: undefined};\r\n        }\r\n        if (!j2d.scene.enableFullscreen || data.fullscreen) {\r\n            j2d.scene.fullScreen(true);\r\n        } else {\r\n            j2d.scene.fullScreen(false);\r\n        }\r\n    };\r\n\r\n    // Устанавливает позицию для камеры\r\n    Scene.prototype.setViewPosition = function (position) {\r\n        this.parent.scene.viewport.x = position.x - Math.ceil(this.parent.scene.width / 2);\r\n        this.parent.scene.viewport.y = position.y - Math.ceil(this.parent.scene.height / 2);\r\n    };\r\n\r\n    //! Движение \"камеры\" вслед за объектом\r\n    Scene.prototype.setViewFocus = function (id, offset) {\r\n        this.parent.scene.viewport.x = id.getPosition().x - Math.ceil(this.parent.scene.width / 2) + (offset ? offset.x : 0);\r\n        this.parent.scene.viewport.y = id.getPosition().y - Math.ceil(this.parent.scene.height / 2) + (offset ? offset.y : 0);\r\n    };\r\n\r\n    //! Движение \"камеры\"\r\n    Scene.prototype.viewMove = function (position) {\r\n        this.parent.scene.viewport.x += position.x;\r\n        this.parent.scene.viewport.y += position.y;\r\n    };\r\n\r\n    //! Очистка отрисованного предыдущего кадра сцены\r\n    Scene.prototype.clear = function () {\r\n        this.getLayer().clear();\r\n    };\r\n\r\n    Scene.prototype.getLayer = function () {\r\n        return this.parent.layers.getLayer('sceneNode');\r\n    };\r\n\r\n    // инициализация сцены\r\n    Scene.prototype.init = function (width, heigth) {\r\n        var j2d = this.parent;\r\n        j2d.element.trigger('beforeInit');\r\n\r\n        this.width = this.originalWidth = width;\r\n        this.height = this.originalHeight = heigth;\r\n        this.originalMargin = j2d.element.css('margin');\r\n\r\n        this.parent.element.width(width).height(heigth);\r\n\r\n        j2d.layers.add('sceneNode', 0);\r\n\r\n        this.context = j2d.layers.getLayer('sceneNode').context;\r\n        this.canvas = j2d.layers.getLayer('sceneNode').canvas;\r\n        this.visible = true;\r\n\r\n        this.cancelClear = false;\r\n\r\n        /* Вид \"камеры\" */\r\n        this.viewport = j2d.vector.vec2df(0, 0);\r\n\r\n        j2d.element.trigger('afterInit');\r\n\r\n        $(window).ready(function () {\r\n            for (var i in j2d.layers.list) {\r\n                if (j2d.layers.list.hasOwnProperty(i)) {\r\n                    j2d.element.append(j2d.layers.getLayer(i).canvas);\r\n                }\r\n            }\r\n            j2d.options.ready = true;\r\n            j2d.element.trigger('ready');\r\n        });\r\n    };\r\n\r\n    if (global.J2D !== undefined) global.Scene = Scene;\r\n    return Scene;\r\n});\r\n"],"sourceRoot":"/source/"}