define("j2d.text",["jquery.j2d","j2d.base"],function(t,i){"use strict";t.prototype.scene.addTextNode||(t.prototype.scene.addTextNode=function(t,i,e,h,n,o,l){return new s(this.parent,t,i,e,h,n,o,l)});var s=function(t,s,e,h,n,o,l,x){i.call(this,t,s,t.vector.vec2df(0,0)),this.vAlign="top",this.hAlign="left",this.color=n?n:"black",this.family=o?o:"sans-serif",this.sizePx=h?h:20,this.box.offset.y=this.j2d.math.toInt(.26*this.sizePx),this.box.size.y=-this.j2d.math.toInt(.26*this.sizePx),this.lineWidth=l?l:0,this.colorL=x?x:"black",this.font=this.sizePx+"px "+this.family,this.fullText=e,this.maxWidth=0,this.lines=e.split("\n"),this.j2d.scene.context.font=this.font;for(var a=0,r=this.lines.length;r>a;a+=1)this.maxWidth=this.maxWidth<this.j2d.scene.context.measureText(this.lines[a]).width?this.j2d.scene.context.measureText(this.lines[a]).width:this.maxWidth;this.size.x=this.maxWidth,this.size.y=this.lines.length*this.sizePx};return s.prototype=Object.create(i.prototype),s.prototype.constructor=s,s.prototype.setSize=function(t){this.sizePx=t,this.font=this.sizePx+"px "+this.family,this.j2d.scene.context.font=this.font,this.box.offset.y=this.j2d.math.toInt(.26*this.sizePx),this.box.size.y=-this.j2d.math.toInt(.26*this.sizePx);for(var i=0,s=this.lines.length;s>i;i+=1)this.maxWidth=this.maxWidth<this.j2d.scene.context.measureText(this.lines[i]).width?this.j2d.scene.context.measureText(this.lines[i]).width:this.maxWidth;this.size.x=this.maxWidth,this.size.y=this.lines.length*this.sizePx},s.prototype.getSize=function(){return this.sizePx},s.prototype.drawSimpleText=function(t,i,s,e){var h=this.layer.context;h.fillStyle=s?s:this.color,h.textAlign=this.hAlign,h.textBaseline=this.vAlign,h.font=this.font,h.lineWidth=this.lineWidth,h.strokeStyle=e?e:this.colorL;var n=t.split("\n");i=i?i:this.pos;for(var o=0,l=n.length;l>o;o+=1)this.lineWidth&&h.strokeText(n[o],i.x,i.y+this.sizePx*o),h.fillText(n[o],i.x,i.y+this.sizePx*o);h.lineWidth=0,h.strokeStyle="black"},s.prototype.getText=function(){return this.fullText},s.prototype.setText=function(t){this.fullText=t,this.maxWidth=0,this.lines=t.split("\n"),this.j2d.scene.context.font=this.font,this.box.offset.y=this.j2d.math.toInt(.26*this.sizePx),this.box.size.y=-this.j2d.math.toInt(.26*this.sizePx);for(var i=0,s=this.lines.length;s>i;i+=1)this.maxWidth=this.maxWidth<this.j2d.scene.context.measureText(this.lines[i]).width?this.j2d.scene.context.measureText(this.lines[i]).width:this.maxWidth;this.size.x=this.maxWidth,this.size.y=this.lines.length*this.sizePx},s.prototype.draw=function(){var t=this.layer.context;if(this.visible&&this.isLookScene()){if(1!=this.alpha){var i=t.globalAlpha;t.globalAlpha=this.alpha}this.angle&&(t.save(),t.translate(this.getPosition().x-this.j2d.scene.viewport.x,this.getPosition().y-this.j2d.scene.viewport.y),t.rotate(this.j2d.math.rad(this.angle)),t.translate(-(this.getPosition().x-this.j2d.scene.viewport.x),-(this.getPosition().y-this.j2d.scene.viewport.y))),t.fillStyle=this.color,t.textAlign=this.hAlign,t.textBaseline=this.vAlign,t.font=this.font,t.lineWidth=this.lineWidth,t.strokeStyle=this.colorL;for(var s=0,e=this.lines.length;e>s;s+=1)this.lineWidth&&t.strokeText(this.lines[s],this.pos.x,this.pos.y+this.sizePx*s),t.fillText(this.lines[s],this.pos.x,this.pos.y+this.sizePx*s);t.lineWidth=0,t.strokeStyle="black",this.angle&&t.restore(),1!=this.alpha&&(t.globalAlpha=i)}},s});