define("j2d.text",["jquery.j2d","j2d.base","j2d.scene"],function(t,i,s){"use strict";s.prototype.addTextNode||(s.prototype.addTextNode=function(t,i,s,n,e,h,p){return new o(this.parent,t,i,s,n,e,h,p)});var o=function(t,s,o,n,e,h,p,l){i.call(this,t,s,t.vector.vec2df(0,0)),this.nodeName="TextNode",this.mergeOptions({vAlign:"top",hAlign:"left",color:e?e:"black",family:h?h:"sans-serif",sizePx:n?n:20,box:{offset:{y:this.j2d.math.toInt(.26*this.sizePx)},size:{y:-this.j2d.math.toInt(.26*this.sizePx)}},lineWidth:p?p:0,colorL:l?l:"black",fullText:o,maxWidth:0,lines:o.split("\n")}),this.options.font=this.options.sizePx+"px "+this.options.family,this.j2d.scene.context.font=this.options.font;for(var x=0,a=this.options.lines.length;a>x;x+=1)this.options.maxWidth=this.options.maxWidth<this.j2d.scene.context.measureText(this.options.lines[x]).width?this.j2d.scene.context.measureText(this.options.lines[x]).width:this.options.maxWidth;this.options.size.x=this.options.maxWidth,this.options.size.y=this.options.lines.length*this.options.sizePx};return o.prototype=Object.create(i.prototype),o.prototype.constructor=o,o.prototype.setSize=function(t){this.options.sizePx=t,this.options.font=this.options.sizePx+"px "+this.options.family,this.j2d.scene.context.font=this.options.font,this.options.box.offset.y=this.j2d.math.toInt(.26*this.options.sizePx),this.options.box.size.y=-this.j2d.math.toInt(.26*this.options.sizePx);for(var i=0,s=this.options.lines.length;s>i;i+=1)this.options.maxWidth=this.options.maxWidth<this.j2d.scene.context.measureText(this.options.lines[i]).width?this.j2d.scene.context.measureText(this.options.lines[i]).width:this.options.maxWidth;this.options.size.x=this.options.maxWidth,this.options.size.y=this.options.lines.length*this.options.sizePx},o.prototype.getSize=function(){return this.options.sizePx},o.prototype.drawSimpleText=function(t,i,s,o){var n=this.layer.context;n.fillStyle=s?s:this.options.color,n.textAlign=this.options.hAlign,n.textBaseline=this.options.vAlign,n.font=this.options.font,n.lineWidth=this.options.lineWidth,n.strokeStyle=o?o:this.options.colorL;var e=t.split("\n");i=i?i:this.options.position;for(var h=0,p=e.length;p>h;h+=1)this.options.lineWidth&&n.strokeText(e[h],i.x,i.y+this.options.sizePx*h),n.fillText(e[h],i.x,i.y+this.options.sizePx*h);n.lineWidth=0,n.strokeStyle="black"},o.prototype.getText=function(){return this.options.fullText},o.prototype.setText=function(t){this.options.fullText=t,this.options.maxWidth=0,this.options.lines=t.split("\n"),this.j2d.scene.context.font=this.options.font,this.options.box.offset.y=this.j2d.math.toInt(.26*this.options.sizePx),this.options.box.size.y=-this.j2d.math.toInt(.26*this.options.sizePx);for(var i=0,s=this.options.lines.length;s>i;i+=1)this.options.maxWidth=this.options.maxWidth<this.j2d.scene.context.measureText(this.options.lines[i]).width?this.j2d.scene.context.measureText(this.options.lines[i]).width:this.options.maxWidth;this.options.size.x=this.options.maxWidth,this.options.size.y=this.options.lines.length*this.options.sizePx},o.prototype.draw=function(){var t=this.layer.context;if(this.options.visible&&this.isLookScene()){if(1!=this.options.alpha){var i=t.globalAlpha;t.globalAlpha=this.options.alpha}this.options.angle&&(t.save(),t.translate(this.getPosition().x-this.j2d.scene.viewport.x,this.getPosition().y-this.j2d.scene.viewport.y),t.rotate(this.j2d.math.rad(this.options.angle)),t.translate(-(this.getPosition().x-this.j2d.scene.viewport.x),-(this.getPosition().y-this.j2d.scene.viewport.y))),t.fillStyle=this.options.color,t.textAlign=this.options.hAlign,t.textBaseline=this.options.vAlign,t.font=this.options.font,t.lineWidth=this.options.lineWidth,t.strokeStyle=this.options.colorL;for(var s=0,o=this.options.lines.length;o>s;s+=1)this.options.lineWidth&&t.strokeText(this.options.lines[s],this.options.position.x,this.options.position.y+this.options.sizePx*s),t.fillText(this.options.lines[s],this.options.position.x,this.options.position.y+this.options.sizePx*s);t.lineWidth=0,t.strokeStyle="black",this.options.angle&&t.restore(),1!=this.options.alpha&&(t.globalAlpha=i)}},o});