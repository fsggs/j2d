define("j2d.base",["jquery.j2d","j2d.scene"],function(t,i){"use strict";i.prototype.addBaseNode||(i.prototype.addBaseNode=function(t,i){return new o(this.parent,t,i)});var o=function(t,i,o){this.j2d=t,this.layer=t.scene,this.options={visible:!0,alpha:1,position:i,size:o,parent:!1,angle:0,box:{offset:{x:0,y:0},size:{x:0,y:0}}}};return o.prototype.mergeOptions=function(t,i){void 0===i&&(i=this.options);for(var o in t)if(t.hasOwnProperty(o))try{t[o].constructor==Object?i[o]=this.mergeOptions(t[o],i[o]):i[o]=t[o]}catch(s){i[o]=t[o]}return i},o.prototype.saveJSON=function(){JSON.stringify({data:this.options})},o.prototype.loadJSON=function(t){},o.prototype.resizeBox=function(t,i){this.options.box.offset=t,this.options.box.size=i},o.prototype.setLayer=function(t){this.layer=t?this.j2d.layers.getLayer(t):this.j2d.scene},o.prototype.getLayer=function(){return this.layer},o.prototype.setVisible=function(t){this.options.visible=t},o.prototype.isVisible=function(){return this.options.visible},o.prototype.setAlpha=function(t){0>t&&(t=0),t>1&&(t=1),this.options.alpha=t},o.prototype.getAlpha=function(t){return this.options.alpha},o.prototype.moveTo=function(t,i){i=i?i:1,this.move(this.j2d.vector.vec2df((t.x-this.getPosition().x)/i,(t.y-this.getPosition().y)/i))},o.prototype.setPosition=function(t){this.options.position=this.j2d.vector.vec2df(t.x-Math.ceil(this.options.size.x/2),t.y-Math.ceil(this.options.size.y/2))},o.prototype.move=function(t){this.options.position.x+=t.x,this.options.position.y+=t.y},o.prototype.getPosition=function(){return this.j2d.vector.vec2df(this.options.position.x+Math.ceil(this.options.size.x/2),this.options.position.y+Math.ceil(this.options.size.y/2))},o.prototype.setSize=function(t){this.options.size=t},o.prototype.getSize=function(){return this.options.size},o.prototype.setParent=function(t){this.parent=t},o.prototype.getDistance=function(t){return Math.ceil(Math.sqrt(Math.pow(t.getPosition().x-this.getPosition().x,2)+Math.pow(t.getPosition().y-this.getPosition().y,2)))},o.prototype.getDistanceXY=function(t){return this.j2d.vector.vec2df(Math.abs(t.getPosition().x-this.getPosition().x),Math.abs(t.getPosition().y-this.getPosition().y))},o.prototype.isIntersect=function(t){var i={x1:this.options.position.x+this.options.box.offset.x,x2:t.options.position.x+t.options.box.offset.x,y1:this.options.position.y+this.options.box.offset.y,y2:t.options.position.y+t.options.box.offset.y},o={x1:this.options.size.x+this.options.box.size.x,x2:t.options.size.x+t.options.box.size.x,y1:this.options.size.y+this.options.box.size.y,y2:t.options.size.y+t.options.box.size.y};return i.y1+o.y1>=i.y2&&i.x1+o.x1>=i.x2&&i.x1<i.x2+o.x2&&i.y1<i.y2+o.y2},o.prototype.isCollision=function(t){var i=!1;return this.getDistanceXY(t).x<this.options.size.x/2+t.options.size.x/2&&this.getDistanceXY(t).y<this.options.size.y/2+t.options.size.y/2&&(i=!0),i},o.prototype.isLookScene=function(){var t=!0;return(this.options.position.x>this.j2d.scene.viewport.x+this.j2d.scene.width||this.options.position.x+this.options.size.x<this.j2d.scene.viewport.x||this.options.position.y>this.j2d.scene.viewport.y+this.j2d.scene.height||this.options.position.y+this.options.size.y<this.j2d.scene.viewport.y)&&(t=!1),t},o.prototype.turn=function(t){this.options.angle=this.options.angle%360,this.options.angle+=t},o.prototype.setRotation=function(t){this.options.angle=t%360},o.prototype.getRotation=function(t){return this.options.angle},o.prototype.isOutScene=function(){return{x:this.options.position.x+this.options.size.x>=this.j2d.scene.viewport.x+this.j2d.scene.width?1:this.options.position.x<=this.j2d.scene.viewport.x?-1:0,y:this.options.position.y+this.options.size.y>=this.j2d.scene.viewport.y+this.j2d.scene.height?1:this.options.position.y<=this.j2d.scene.viewport.y?-1:0,all:this.x||this.y}},o.prototype.moveDir=function(t){this.options.position.x+=t*Math.cos(this.j2d.math.rad(this.options.angle)),this.options.position.y+=t*Math.sin(this.j2d.math.rad(this.options.angle))},o.prototype.drawBox=function(){var t=this.layer.context;this.options.angle&&(t.save(),t.translate(this.getPosition().x-this.j2d.scene.viewport.x,this.getPosition().y-this.j2d.scene.viewport.y),t.rotate(this.j2d.math.rad(this.options.angle)),t.translate(-(this.getPosition().x-this.j2d.scene.viewport.x),-(this.getPosition().y-this.j2d.scene.viewport.y))),t.lineWidth=2,t.strokeStyle="black",t.lineCap="round",t.beginPath(),t.rect(this.options.position.x-this.j2d.scene.viewport.x,this.options.position.y-this.j2d.scene.viewport.y,this.options.size.x,this.options.size.y),t.stroke(),t.strokeStyle="yellow",t.beginPath(),t.rect(this.options.box.offset.x+this.options.position.x-this.j2d.scene.viewport.x,this.options.box.offset.y+this.options.position.y-this.j2d.scene.viewport.y,this.options.box.size.x+this.options.size.x,this.options.box.size.y+this.options.size.y),t.stroke(),t.lineCap="butt",this.options.angle&&t.restore()},o});