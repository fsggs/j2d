define("j2d.sprite",["jquery.j2d","j2d.base"],function(t,i){"use strict";t.prototype.scene.addSpriteNode||(t.prototype.scene.addSpriteNode=function(t,i,s){return new e(this.parent,t,i,s)});var e=function(t,e,s,a){i.call(this,t,e,s),this.tmpSpeed=0,this.frame=0,this.animation=a,this.flip={x:!1,y:!1}};return e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.setFlip=function(t,i){this.flip={x:t,y:i}},e.prototype.draw=function(t){this.visible&&this.isLookScene()&&(t=t||1,this.frame>this.animation.frameCount&&(this.frame=0),this.drawFrame(this.frame+1),this.tmpSpeed>t?(this.frame+=1,this.tmpSpeed=0):this.tmpSpeed+=1)},e.prototype.drawFrame=function(t){var i=this.layer.context;if(this.visible&&this.isLookScene()){if(1!=this.alpha){var e=i.globalAlpha;i.globalAlpha=this.alpha}i.lineWidth=0,(this.angle||this.flip.x||this.flip.y)&&(i.save(),i.translate(this.getPosition().x-this.j2d.scene.view.x,this.getPosition().y-this.j2d.scene.view.y),i.rotate(this.j2d.math.rad(this.angle)),i.scale(this.flip.x?-1:1,this.flip.y?-1:1),i.translate(-(this.getPosition().x-this.j2d.scene.view.x),-(this.getPosition().y-this.j2d.scene.view.y))),t=t?t-1:0,i.drawImage(this.animation.imageMap.img,this.animation.sourceX+this.animation.sourceW*t,this.animation.sourceY,this.animation.sourceW,this.animation.sourceH,this.pos.x-this.j2d.scene.view.x,this.pos.y-this.j2d.scene.view.y,this.size.x,this.size.y),(this.angle||this.flip.x||this.flip.y)&&i.restore(),1!=this.alpha&&(i.globalAlpha=e)}},e.prototype.setAnimation=function(t){this.animation!=t&&(this.animation=t)},e});