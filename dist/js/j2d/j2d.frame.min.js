define("j2d.frame",["vanilla.override"],function(){"use strict";var i,e=[],n=[],t={frameLimit:60,frameRun:!1,breakAnimationFrame:!1},o=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i){t.breakAnimationFrame?t.breakAnimationFrame=!1:window.setTimeout(i.call(i,[Date.now()]),1e3/t.frameLimit)}}(),a=function(){return t.breakAnimationFrame=!0,window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame}(),r=function(){};return r.prototype.start=function(i,o,a){var r={j2d:void 0,frameLimit:t.frameLimit,now:0,deltaTime:0,lastTime:0,sceneStartTime:0,sceneSkipTime:0};if(void 0!==a.frameLimit&&a.frameLimit<=t.frameLimit&&(r.frameLimit=a.frameLimit),void 0===a.j2d)throw"j2d not transported to FrameManager.start(id, engine, {... j2d: j2d ...});";r.j2d=a.j2d,r.interval=1e3/r.frameLimit,r.lastTime=Date.now(),e.add(i,o),n.add(i,r),t.frameRun||this.pulse()},r.prototype.stop=function(i){e.remove(i),n.remove(i)},r.prototype.pulse=function(){this.runMainLoop(Date.now())},r.prototype.runMainLoop=function(i,r){if(void 0===r&&(r=this),e.length<=0&&t.frameRun)return t.frameRun=!1,a(this.runMainLoop);t.frameRun=!0;for(var m in e)if(e.hasOwnProperty(m)&&"function"==typeof e[m]){var d=e[m],u=n[m];u.now=Date.now(),u.j2d.options.deltaTime=u.deltaTime=(u.now-u.lastTime)/100,u.j2d.options.io&&u.j2d.options.io.update(),100*u.deltaTime>u.interval&&(u.lastTime=u.now-100*u.deltaTime%u.interval,u.j2d.options.pause||(u.j2d.options.deltaTime=u.deltaTime,d(i,u))),u.j2d.options.io&&u.j2d.options.io.clear()}o(function(i){r.runMainLoop(i,r)})},r.prototype.setDefaultFrameLimit=function(i){60>=i&&i>0&&(t.frameLimit=i)},r.Init=function(){return i||(i=new r)},r.Init()});