{"version":3,"sources":["j2d.frame.js","j2d/j2d.frame.js"],"names":["root","factory","define","amd","global","instance","engineStack","dataStack","options","frameLimit","frameRun","breakAnimationFrame","requestAnimationFrame","window","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","call","Date","now","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","oCancelAnimationFrame","msCancelAnimationFrame","FrameManager","prototype","start","name","engine","params","data","j2d","undefined","deltaTime","lastTime","sceneStartTime","sceneSkipTime","interval","add","this","pulse","stop","remove","runMainLoop","timestamp","frameManager","length","index","hasOwnProperty","io","pause","update","clear","setDefaultFrameLimit","Init","J2D","instanceFrameManager"],"mappings":"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","file":"j2d/j2d.frame.js","sourcesContent":[null,"/**\r\n * J2D (jQuery plugin of the fork j2ds)\r\n *\r\n * @authors DeVinterX\r\n * @license BSD\r\n * @version 0.1.5a\r\n */\r\n\r\n!function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        define('j2d.frame', ['vanilla.override'], factory);\r\n    } else {\r\n        factory();\r\n    }\r\n}(global, function () {\r\n    \"use strict\";\r\n\r\n    var instance;\r\n    var engineStack = [], dataStack = [];\r\n\r\n    var options = {\r\n        frameLimit: 60,\r\n        frameRun: false,\r\n        breakAnimationFrame: false\r\n    };\r\n\r\n    var requestAnimationFrame = (function () {\r\n        return window.requestAnimationFrame ||\r\n            window.webkitRequestAnimationFrame ||\r\n            window.mozRequestAnimationFrame ||\r\n            window.oRequestAnimationFrame ||\r\n            window.msRequestAnimationFrame ||\r\n            function (callback) {\r\n                if (!options.breakAnimationFrame) {\r\n                    window.setTimeout(callback.call(callback, [\r\n                        Date.now() //TODO:: fix this\r\n                    ]), 1000.0 / options.frameLimit);\r\n                } else {\r\n                    options.breakAnimationFrame = false\r\n                }\r\n            };\r\n    })();\r\n\r\n    var cancelAnimationFrame = (function () {\r\n        options.breakAnimationFrame = true;\r\n\r\n        return window.cancelAnimationFrame ||\r\n            window.webkitCancelAnimationFrame ||\r\n            window.mozCancelAnimationFrame ||\r\n            window.oCancelAnimationFrame ||\r\n            window.msCancelAnimationFrame;\r\n    })();\r\n\r\n\r\n    var FrameManager = function () {\r\n    };\r\n\r\n    FrameManager.prototype.start = function (name, engine, params) {\r\n        var data = {\r\n            j2d: undefined,\r\n            frameLimit: options.frameLimit,\r\n            now: 0,\r\n            deltaTime: 0,\r\n            lastTime: 0,\r\n            sceneStartTime: 0,\r\n            sceneSkipTime: 0\r\n        };\r\n\r\n        if (params.frameLimit !== undefined && params.frameLimit <= options.frameLimit) data.frameLimit = params.frameLimit;\r\n\r\n        if (params.j2d !== undefined) {\r\n            data.j2d = params.j2d;\r\n        } else {\r\n            throw 'j2d not transported to FrameManager.start(id, engine, {... j2d: j2d ...});';\r\n        }\r\n\r\n        data.interval = 1000.0 / data.frameLimit;\r\n        data.lastTime = Date.now();\r\n\r\n        engineStack.add(name, engine);\r\n        dataStack.add(name, data);\r\n        if (!options.frameRun) this.pulse();\r\n    };\r\n\r\n    FrameManager.prototype.stop = function (name) {\r\n        engineStack.remove(name);\r\n        dataStack.remove(name);\r\n    };\r\n\r\n    FrameManager.prototype.pulse = function () {\r\n        this.runMainLoop(Date.now());\r\n    };\r\n\r\n    FrameManager.prototype.runMainLoop = function (timestamp, frameManager) {\r\n        if (frameManager === undefined) frameManager = this;\r\n\r\n        if (engineStack.length <= 0 && options.frameRun) {\r\n            options.frameRun = false;\r\n            return cancelAnimationFrame(this.runMainLoop);\r\n        }\r\n        options.frameRun = true;\r\n\r\n        for (var index in engineStack) {\r\n            if (engineStack.hasOwnProperty(index) && 'function' === typeof engineStack[index]) {\r\n                var engine = engineStack[index];\r\n                var data = dataStack[index];\r\n\r\n                data.now = Date.now();\r\n                data.j2d.options.deltaTime = data.deltaTime = (data.now - data.lastTime) / 100.0;\r\n\r\n                if (data.j2d.options.io && !data.j2d.options.pause) data.j2d.options.io.update();\r\n                if ((data.deltaTime * 100.0) > data.interval) {\r\n                    data.lastTime = data.now - ((data.deltaTime * 100.0) % data.interval);\r\n\r\n                    if (!data.j2d.options.pause) {\r\n                        data.j2d.options.deltaTime = data.deltaTime;\r\n\r\n                        engine(timestamp, data);\r\n\r\n                    }\r\n                }\r\n                if (data.j2d.options.io && !data.j2d.options.pause) data.j2d.options.io.clear();\r\n            }\r\n        }\r\n\r\n        requestAnimationFrame(function (timestamp) {\r\n            frameManager.runMainLoop(timestamp, frameManager);\r\n        });\r\n    };\r\n\r\n    FrameManager.prototype.setDefaultFrameLimit = function (frameLimit) {\r\n        if (frameLimit <= 60 && frameLimit > 0) {\r\n            options.frameLimit = frameLimit\r\n        }\r\n    };\r\n\r\n    /* Singleton */\r\n    FrameManager.Init = function () {\r\n        if (window.J2D !== undefined) {\r\n            return window.instanceFrameManager || (window.instanceFrameManager = new FrameManager());\r\n        } else {\r\n            return instance || (instance = new FrameManager());\r\n        }\r\n    };\r\n\r\n    if (window.J2D !== undefined) window.FrameManager = FrameManager.Init();\r\n    return FrameManager.Init();\r\n});\r\n"],"sourceRoot":"/source/"}