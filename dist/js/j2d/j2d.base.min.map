{"version":3,"sources":["j2d/j2d.base.js"],"names":["define","J2D","Scene","prototype","addBaseNode","pos","size","BaseNode","this","parent","j2d","visible","alpha","angle","layer","scene","box","offset","x","y","resizeBox","setLayer","layers","getLayer","setVisible","isVisible","setAlpha","getAlpha","moveTo","to","t","move","vector","vec2df","getPosition","setPosition","Math","ceil","setSize","getSize","setParent","id","getDistance","sqrt","pow","getDistanceXY","abs","isIntersect","x1","x2","y1","y2","isCollision","result","isLookScene","yes","viewport","width","height","turn","setRotation","getRotation","isOutScene","o","all","moveDir","speed","cos","math","rad","sin","drawBox","context","save","translate","rotate","lineWidth","strokeStyle","lineCap","beginPath","rect","stroke","restore"],"mappings":"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","file":"j2d/j2d.base.min","sourcesContent":["/**\r\n * J2D (jQuery plugin of the fork j2ds)\r\n *\r\n * @authors Skaner, likerRr, DeVinterX\r\n * @license zlib\r\n * @version 0.1.4\r\n * @see https://github.com/SkanerSoft/J2ds/commit/501b8993fc41960794572dc481a5f2fe492da349\r\n */\r\n\r\ndefine('j2d.base', [\r\n    'jquery.j2d', 'j2d.scene'\r\n], function (J2D, Scene) {\r\n    \"use strict\";\r\n\r\n    if (!Scene.prototype.addBaseNode) {\r\n        Scene.prototype.addBaseNode = function (pos, size) {\r\n            return new BaseNode(this.parent, pos, size);\r\n        };\r\n    }\r\n\r\n    var BaseNode = function (j2d, pos, size) {\r\n        this.j2d = j2d;\r\n        this.visible = true;\r\n        this.alpha = 1;\r\n        this.pos = pos;\r\n        this.size = size;\r\n        this.parent = false;\r\n        this.angle = 0;\r\n        this.layer = j2d.scene;\r\n        this.box = {\r\n            offset: {x: 0, y: 0},\r\n            size: {x: 0, y: 0}\r\n        };\r\n    };\r\n\r\n    BaseNode.prototype.resizeBox = function (offset, size) {\r\n        this.box.offset = offset;\r\n        this.box.size = size;\r\n    };\r\n\r\n    BaseNode.prototype.setLayer = function (layer) {\r\n        this.layer = layer ? this.j2d.layers.getLayer(layer) : this.j2d.scene;\r\n    };\r\n\r\n    BaseNode.prototype.getLayer = function () {\r\n        return this.layer;\r\n    };\r\n\r\n    BaseNode.prototype.setVisible = function (visible) {\r\n        this.visible = visible;\r\n    };\r\n\r\n    BaseNode.prototype.isVisible = function () {\r\n        return this.visible;\r\n    };\r\n\r\n    BaseNode.prototype.setAlpha = function (alpha) {\r\n        if (alpha < 0) alpha = 0;\r\n        if (alpha > 1) alpha = 1;\r\n        this.alpha = alpha;\r\n    };\r\n\r\n    BaseNode.prototype.getAlpha = function (alpha) {\r\n        return this.alpha;\r\n    };\r\n\r\n    BaseNode.prototype.moveTo = function (to, t) {\r\n        t = t ? t : 1;\r\n        this.move(this.j2d.vector.vec2df(\r\n            ((to.x - this.getPosition().x) / t),\r\n            ((to.y - this.getPosition().y) / t)\r\n        ));\r\n    };\r\n\r\n    BaseNode.prototype.setPosition = function (pos) {\r\n        this.pos = this.j2d.vector.vec2df(pos.x - Math.ceil(this.size.x / 2), pos.y - Math.ceil(this.size.y / 2));\r\n    };\r\n\r\n    BaseNode.prototype.move = function (pos) {\r\n        this.pos.x += pos.x;\r\n        this.pos.y += pos.y;\r\n    };\r\n\r\n    BaseNode.prototype.getPosition = function () {\r\n        return this.j2d.vector.vec2df(this.pos.x + Math.ceil(this.size.x / 2), this.pos.y + Math.ceil(this.size.y / 2));\r\n    };\r\n\r\n    BaseNode.prototype.setSize = function (size) {\r\n        this.size = size;\r\n    };\r\n\r\n    BaseNode.prototype.getSize = function () {\r\n        return this.size;\r\n    };\r\n\r\n    BaseNode.prototype.setParent = function (id) {\r\n        this.parent = id;\r\n    };\r\n\r\n    BaseNode.prototype.getDistance = function (id) {\r\n        return Math.ceil(Math.sqrt(\r\n                Math.pow(id.getPosition().x - this.getPosition().x, 2) +\r\n                Math.pow(id.getPosition().y - this.getPosition().y, 2)\r\n            )\r\n        );\r\n    };\r\n\r\n    BaseNode.prototype.getDistanceXY = function (id) {\r\n        return this.j2d.vector.vec2df(Math.abs(id.getPosition().x - this.getPosition().x), Math.abs(id.getPosition().y - this.getPosition().y));\r\n    };\r\n\r\n    BaseNode.prototype.isIntersect = function (id) {\r\n        var pos = {\r\n            x1: this.pos.x + this.box.offset.x,\r\n            x2: id.pos.x + id.box.offset.x,\r\n            y1: this.pos.y + this.box.offset.y,\r\n            y2: id.pos.y + id.box.offset.y\r\n        };\r\n\r\n        var size = {\r\n            x1: this.size.x + this.box.size.x,\r\n            x2: id.size.x + id.box.size.x,\r\n            y1: this.size.y + this.box.size.y,\r\n            y2: id.size.y + id.box.size.y\r\n        };\r\n\r\n        return (\r\n            (pos.y1 + size.y1 >= pos.y2) &&\r\n            (pos.x1 + size.x1 >= pos.x2)\r\n            ) && (\r\n            (pos.x1 < pos.x2 + size.x2) &&\r\n            (pos.y1 < pos.y2 + size.y2)\r\n            );\r\n    };\r\n\r\n    BaseNode.prototype.isCollision = function (id) {\r\n        var result = false;\r\n        if (\r\n            (this.getDistanceXY(id).x < (this.size.x / 2 + id.size.x / 2)) &&\r\n            (this.getDistanceXY(id).y < (this.size.y / 2 + id.size.y / 2))\r\n        ) {\r\n            result = true;\r\n        }\r\n        return result;\r\n    };\r\n\r\n    BaseNode.prototype.isLookScene = function () {\r\n        var yes = true;\r\n        if (\r\n            (this.pos.x > this.j2d.scene.viewport.x + this.j2d.scene.width ||\r\n            this.pos.x + this.size.x < this.j2d.scene.viewport.x) ||\r\n            (this.pos.y > this.j2d.scene.viewport.y + this.j2d.scene.height ||\r\n            this.pos.y + this.size.y < this.j2d.scene.viewport.y)\r\n        ) {\r\n            yes = false;\r\n        }\r\n        return yes;\r\n    };\r\n\r\n    BaseNode.prototype.turn = function (angle) {\r\n        this.angle = (this.angle % 360);\r\n        this.angle += angle;\r\n    };\r\n\r\n    BaseNode.prototype.setRotation = function (angle) {\r\n        this.angle = angle % 360;\r\n    };\r\n\r\n    BaseNode.prototype.getRotation = function (angle) {\r\n        return this.angle;\r\n    };\r\n\r\n    BaseNode.prototype.isOutScene = function () {\r\n        var o = {};\r\n\r\n        if (this.pos.x + this.size.x >= this.j2d.scene.viewport.x + this.j2d.scene.width) {\r\n            o.x = 1;\r\n        } else if (this.pos.x <= this.j2d.scene.viewport.x) {\r\n            o.x = -1;\r\n        } else {\r\n            o.x = 0;\r\n        }\r\n\r\n        if (this.pos.y + this.size.y >= this.j2d.scene.viewport.y + this.j2d.scene.height) {\r\n            o.y = 1;\r\n        } else if (this.pos.y <= this.j2d.scene.viewport.y) {\r\n            o.y = -1;\r\n        } else {\r\n            o.y = 0;\r\n        }\r\n\r\n        o.all = (o.x || o.y);\r\n\r\n        return o;\r\n    };\r\n\r\n    BaseNode.prototype.moveDir = function (speed) {\r\n        this.pos.x += speed * (Math.cos(this.j2d.math.rad(this.angle)));\r\n        this.pos.y += speed * (Math.sin(this.j2d.math.rad(this.angle)));\r\n    };\r\n\r\n    BaseNode.prototype.drawBox = function () {\r\n        var context = this.layer.context;\r\n\r\n        if (this.angle) {\r\n            context.save();\r\n            context.translate(this.getPosition().x - this.j2d.scene.viewport.x, this.getPosition().y - this.j2d.scene.viewport.y);\r\n            context.rotate(this.j2d.math.rad(this.angle));\r\n            context.translate(-(this.getPosition().x - this.j2d.scene.viewport.x), -(this.getPosition().y - this.j2d.scene.viewport.y));\r\n        }\r\n\r\n        context.lineWidth = 2;\r\n        context.strokeStyle = 'black';\r\n        context.lineCap = 'round';\r\n        context.beginPath();\r\n\r\n        context.rect(\r\n            this.pos.x - this.j2d.scene.viewport.x,\r\n            this.pos.y - this.j2d.scene.viewport.y,\r\n            this.size.x, this.size.y);\r\n        context.stroke();\r\n\r\n        context.strokeStyle = 'yellow';\r\n\r\n        context.beginPath();\r\n        context.rect(this.box.offset.x + this.pos.x - this.j2d.scene.viewport.x, this.box.offset.y + this.pos.y - this.j2d.scene.viewport.y,\r\n            this.box.size.x + this.size.x, this.box.size.y + this.size.y);\r\n        context.stroke();\r\n\r\n        context.lineCap = 'butt';\r\n        if (this.angle) {\r\n            context.restore();\r\n        }\r\n    };\r\n\r\n    return BaseNode;\r\n});\r\n"],"sourceRoot":"/source/"}