{"version":3,"sources":["j2d/j2d.text.js"],"names":["define","J2D","BaseNode","prototype","scene","addTextNode","pos","text","sizePx","color","family","width","colorL","TextNode","this","parent","j2d","call","vector","vec2df","vAlign","hAlign","box","offset","y","math","toInt","size","lineWidth","font","fullText","maxWidth","lines","split","context","i","len","length","measureText","x","Object","create","constructor","setSize","getSize","drawSimpleText","layer","fillStyle","textAlign","textBaseline","strokeStyle","strokeText","fillText","getText","setText","draw","visible","isLookScene","alpha","tmpAlpha","globalAlpha","angle","save","translate","getPosition","viewport","rotate","rad","restore"],"mappings":"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","file":"j2d/j2d.text.min","sourcesContent":["/**\r\n * J2D (jQuery plugin of the fork j2ds)\r\n *\r\n * @authors Skaner, likerRr, DeVinterX\r\n * @license zlib\r\n * @version 0.1.4\r\n * @see https://github.com/SkanerSoft/J2ds/commit/501b8993fc41960794572dc481a5f2fe492da349\r\n */\r\n\r\ndefine('j2d.text', [\r\n    'jquery.j2d',\r\n    'j2d.base'\r\n], function (J2D, BaseNode) {\r\n    \"use strict\";\r\n\r\n    if (!J2D.prototype.scene.addTextNode) {\r\n        J2D.prototype.scene.addTextNode = function (pos, text, sizePx, color, family, width, colorL) {\r\n            return new TextNode(this.parent, pos, text, sizePx, color, family, width, colorL);\r\n        };\r\n    }\r\n\r\n    var TextNode = function (j2d, pos, text, sizePx, color, family, width, colorL) {\r\n\r\n        BaseNode.call(this, j2d, pos, j2d.vector.vec2df(0, 0));\r\n\r\n        /*Свойства*/\r\n\r\n        this.vAlign = 'top';\r\n        this.hAlign = 'left';\r\n        this.color = color ? color : 'black';\r\n\r\n        this.family = family ? family : 'sans-serif';\r\n        this.sizePx = sizePx ? sizePx : 20;\r\n\r\n        this.box.offset.y = this.j2d.math.toInt(this.sizePx * 0.26);\r\n        this.box.size.y = -this.j2d.math.toInt(this.sizePx * 0.26);\r\n\r\n        this.lineWidth = width ? width : 0;\r\n        this.colorL = colorL ? colorL : 'black';\r\n\r\n        this.font = this.sizePx + 'px ' + this.family;\r\n\r\n        this.fullText = text;\r\n        this.maxWidth = 0;\r\n        this.lines = text.split(\"\\n\");\r\n\r\n        this.j2d.scene.context.font = this.font;\r\n\r\n        for (var i = 0, len = this.lines.length; i < len; i += 1) {\r\n            this.maxWidth = (this.maxWidth < this.j2d.scene.context.measureText(this.lines[i]).width ?\r\n                this.j2d.scene.context.measureText(this.lines[i]).width :\r\n                this.maxWidth);\r\n        }\r\n\r\n        this.size.x = this.maxWidth;\r\n        this.size.y = this.lines.length * this.sizePx;\r\n    };\r\n\r\n    TextNode.prototype = Object.create(BaseNode.prototype);\r\n    TextNode.prototype.constructor = TextNode;\r\n\r\n    TextNode.prototype.setSize = function (sizePx) {\r\n        this.sizePx = sizePx;\r\n        this.font = this.sizePx + 'px ' + this.family;\r\n        this.j2d.scene.context.font = this.font;\r\n\r\n        this.box.offset.y = this.j2d.math.toInt(this.sizePx * 0.26);\r\n        this.box.size.y = -this.j2d.math.toInt(this.sizePx * 0.26);\r\n\r\n        for (var i = 0, len = this.lines.length; i < len; i += 1) {\r\n            this.maxWidth = (this.maxWidth < this.j2d.scene.context.measureText(this.lines[i]).width ?\r\n                this.j2d.scene.context.measureText(this.lines[i]).width :\r\n                this.maxWidth);\r\n        }\r\n        this.size.x = this.maxWidth;\r\n        this.size.y = this.lines.length * this.sizePx;\r\n    };\r\n\r\n    TextNode.prototype.getSize = function () {\r\n        return this.sizePx;\r\n    };\r\n\r\n    TextNode.prototype.drawSimpleText = function (text, pos, color, colorL) {\r\n        var context = this.layer.context;\r\n        context.fillStyle = color ? color : this.color;\r\n        context.textAlign = this.hAlign;\r\n        context.textBaseline = this.vAlign;\r\n        context.font = this.font;\r\n        context.lineWidth = this.lineWidth;\r\n        context.strokeStyle = colorL ? colorL : this.colorL;\r\n\r\n        var lines = text.split(\"\\n\");\r\n\r\n        pos = pos ? pos : this.pos;\r\n\r\n        for (var i = 0, len = lines.length; i < len; i += 1) {\r\n            if (this.lineWidth) {\r\n                context.strokeText(lines[i], pos.x, pos.y + this.sizePx * i);\r\n            }\r\n            context.fillText(lines[i], pos.x, pos.y + this.sizePx * i);\r\n        }\r\n        context.lineWidth = 0;\r\n        context.strokeStyle = 'black';\r\n    };\r\n\r\n    TextNode.prototype.getText = function () {\r\n        return this.fullText;\r\n    };\r\n\r\n    TextNode.prototype.setText = function (text) {\r\n        this.fullText = text;\r\n        this.maxWidth = 0;\r\n        this.lines = text.split(\"\\n\");\r\n\r\n        this.j2d.scene.context.font = this.font;\r\n\r\n        this.box.offset.y = this.j2d.math.toInt(this.sizePx * 0.26);\r\n        this.box.size.y = -this.j2d.math.toInt(this.sizePx * 0.26);\r\n\r\n        for (var i = 0, len = this.lines.length; i < len; i += 1) {\r\n            this.maxWidth = (this.maxWidth < this.j2d.scene.context.measureText(this.lines[i]).width ?\r\n                this.j2d.scene.context.measureText(this.lines[i]).width :\r\n                this.maxWidth);\r\n        }\r\n        this.size.x = this.maxWidth;\r\n        this.size.y = this.lines.length * this.sizePx;\r\n    };\r\n\r\n    TextNode.prototype.draw = function () {\r\n        var context = this.layer.context;\r\n        if (this.visible && this.isLookScene()) {\r\n            if (this.alpha != 1) {\r\n                var tmpAlpha = context.globalAlpha;\r\n                context.globalAlpha = this.alpha;\r\n            }\r\n\r\n            if (this.angle) {\r\n                context.save();\r\n                context.translate(this.getPosition().x - this.j2d.scene.viewport.x, this.getPosition().y - this.j2d.scene.viewport.y);\r\n                context.rotate(this.j2d.math.rad(this.angle));\r\n                context.translate(-(this.getPosition().x - this.j2d.scene.viewport.x), -(this.getPosition().y - this.j2d.scene.viewport.y));\r\n            }\r\n\r\n            context.fillStyle = this.color;\r\n            context.textAlign = this.hAlign;\r\n            context.textBaseline = this.vAlign;\r\n            context.font = this.font;\r\n            context.lineWidth = this.lineWidth;\r\n            context.strokeStyle = this.colorL;\r\n\r\n            for (var i = 0, len = this.lines.length; i < len; i += 1) {\r\n                if (this.lineWidth) {\r\n                    context.strokeText(this.lines[i], this.pos.x, this.pos.y + this.sizePx * i);\r\n                }\r\n                context.fillText(this.lines[i], this.pos.x, this.pos.y + this.sizePx * i);\r\n            }\r\n\r\n            context.lineWidth = 0;\r\n            context.strokeStyle = 'black';\r\n\r\n            if (this.angle) {\r\n                context.restore();\r\n            }\r\n\r\n            if (this.alpha != 1) {\r\n                context.globalAlpha = tmpAlpha;\r\n            }\r\n        }\r\n    };\r\n\r\n    return TextNode;\r\n});\r\n"],"sourceRoot":"/source/"}