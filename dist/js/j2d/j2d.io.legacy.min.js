define("j2d.io.legacy",["jquery"],function(t){"use strict";var e=function(t){this.j2d=t,this.data={pos:{x:0,y:0},x:0,y:0,abs:{x:0,y:0},lClick:!1,mClick:!1,rClick:!1,touch:!1,keyDown:[],keyPress:[],keyPressed:[],keyUp:[],keyUpped:!1,canceled:!1,body:!1,anyKey:!1,writeMode:!1,displayCursor:"",visible:!0}};return e.prototype.init=function(){var t=this;e.activeElement=t.j2d.element,e.activeElement.focus(),t.j2d.options.window.ontouchstart=t.onTouch,t.j2d.options.window.ontouchmove=t.onTouch,t.j2d.options.window.ontouchend=function(){t.data.canceled=!1,t.falseInput()},t.j2d.options.window.oncontextmenu=function(){return!1},t.j2d.options.window.onselectstart=t.j2d.options.window.oncontextmenu,t.j2d.options.window.ondragstart=t.j2d.options.window.oncontextmenu,t.j2d.options.window.onmousedown=t.onClick,t.j2d.options.window.onmouseup=function(){t.data.canceled=!1,t.falseInput()},t.j2d.options.window.onmousemove=t.cursorPosition,t.j2d.options.window.onkeydown=function(e){t.keyEvent(e)},t.j2d.options.window.onkeyup=function(e){t.data.canceled=!1,t.keyEvent(e)},t.j2d.options.window.onkeypress=function(e){t.keyEvent(e)}},e.prototype.update=function(){var t=this.j2d.scene.canvas.offsetWidth/this.j2d.scene.width,e=this.j2d.scene.canvas.offsetHeight/this.j2d.scene.height;this.data.x=this.data.abs.x/t,this.data.y=this.data.abs.y/e,this.data.pos.x=this.j2d.scene.viewport.x+this.data.x,this.data.pos.y=this.j2d.scene.viewport.y+this.data.y},e.prototype.clear=function(){this.data.keyPress=[],this.data.keyUp=[]},e.prototype.keyList=function(){var t=[];for(var o in e.keys)e.keys.hasOwnProperty(o)&&t.push(o);return t},e.prototype.isKeyDown=function(t){return this.data.keyDown[e.keys[t]]},e.prototype.isKeyPress=function(t){return this.data.keyPress[e.keys[t]]},e.prototype.isKeyUp=function(t){return this.data.keyUp[e.keys[t]]},e.prototype.getPosition=function(){return this.j2d.vector.vec2df(this.data.pos.x,this.data.pos.y)},e.prototype.setWriteMode=function(t){this.data.writeMode=t},e.prototype.isWriteMode=function(){return this.data.writeMode},e.prototype.keyEvent=function(e){if("keydown"==e.type)this.data.keyPressed[e.keyCode]||(this.data.keyPress[e.keyCode]=!0,this.data.keyPressed[e.keyCode]=!0),this.data.writeMode?t(this.j2d.element).trigger("keyPress"):e.preventDefault();else if("keyup"==e.type)this.data.keyPressed[e.keyCode]&&(this.data.keyPress[e.keyCode]=!1,this.data.keyPressed[e.keyCode]=!1,this.data.keyUp[e.keyCode]=!0,this.data.keyUpped=!0,e.preventDefault());else if("keypress"==e.type&&this.data.writeMode){var o="";0!=e.which&&0!=e.charCode&&e.which>=32&&(o=String.fromCharCode(e.which)),t(this.j2d.element).trigger("keyPress",[o])}return this.data.keyDown[e.keyCode]="keydown"==e.type&&!this.data.canceled,this.data.anyKey=e.keyCode,!1},e.prototype.cancel=function(t){t?this.data.keyDown[e.keys[t]]=!1:(this.data.canceled=!0,this.falseInput(),this.data.keyDown=[])},e.prototype.onNode=function(t){return t.layer.visible?this.data.pos.x>t.options.position.x&&this.data.pos.x<t.options.position.x+t.options.size.x&&this.data.pos.y>t.options.position.y&&this.data.pos.y<t.options.position.y+t.options.size.y:!1},e.prototype.cursorPosition=function(t){var o=e.activeElement.j2d().options.io;if(!o.data.touch){var i,s;document.all?(i=t.x+document.body.scrollLeft,s=t.y+document.body.scrollTop):(i=t.pageX,s=t.pageY),o.data.abs.x=i,o.data.abs.y=s}},e.prototype.onClick=function(t){var o=e.activeElement.j2d().options.io;return!t.which&&t.button&&(1&t.button?t.which=1:4&t.button?t.which=2:2&t.button&&(t.which=3)),o.data.lClick=1==t.which&&!o.data.canceled,o.data.mClick=2==t.which&&!o.data.canceled,o.data.rClick=3==t.which&&!o.data.canceled,e.activeElement.focus(),t.preventDefault(),!1},e.prototype.onTouch=function(t){var o=e.activeElement.j2d().options.io;return o.data.abs.x=t.touches[0].pageX,o.data.abs.y=t.touches[0].pageY,o.data.lClick=!o.data.canceled,o.data.touch=!o.data.canceled,e.activeElement.focus(),t.preventDefault(),!1},e.prototype.falseInput=function(){this.data.lClick=!1,this.data.mClick=!1,this.data.rClick=!1},e.prototype.setCursorImage=function(e){t(this.j2d.element).css("cursor",'url("'+e+'"), auto')},e.prototype.setVisible=function(e){this.data.visible=e,e?t(this.j2d.element).css("cursor",this.data.displayCursor):(this.data.displayCursor=t(this.j2d.element).css("cursor"),t(this.j2d.element).css("cursor","none"))},e.prototype.isVisible=function(){return this.data.visible},e.keys={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,CTRL:17,SHIFT:16,ALT:18,ESC:27,ENTER:13,MINUS:189,PLUS:187,CAPS_LOCK:20,BACKSPACE:8,TAB:9,Q:81,W:87,E:69,R:82,T:84,Y:89,U:85,I:73,O:79,P:80,A:65,S:83,D:68,F:70,G:71,H:72,J:74,K:75,L:76,Z:90,X:88,V:86,B:66,N:78,M:77,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,C:67,9:57,NUM_0:45,NUM_1:35,NUM_2:40,NUM_3:34,NUM_4:37,NUM_5:12,NUM_6:39,NUM_7:36,NUM_8:38,NUM_9:33,NUM_MINUS:109,NUM_PLUS:107,NUM_LOCK:144,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},e.activeElement=void 0,e});